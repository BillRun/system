(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{186:function(e,t,n){e.exports='\x3c!-- Footer --\x3e\n<div class="footer">\n  <div class="shell">\n    <div class="section">\n      <div class="table footer">\n        <table style="font-size:16px;font-weight: 300;">\n          <tbody>\n            <tr>\n              <td>\n                <ul class="list-contacts step-company-details-footer">\n                <li><i class="fa fa-map-marker" aria-hidden="true"></i> 221 Murray Street, New York, NY 10007</li>\n\n                <li><i class="fa fa-phone" aria-hidden="true"></i> 1-800-123-4567</li>\n\n                <li><i class="fa fa-globe" aria-hidden="true"></i> http://billrun.com</a></li>\n\n                <li><i class="fa fa-at" aria-hidden="true"></i> cloud_support@billrun.com</a></li>\n                </ul>\n              </td>\n              <td>\n                <p class="credentials"> <span class="text">powered by</span> <img class="billrun-logo" src="'+n(441)+'" alt=""></p>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  </div>\n</div>\n</div>\n'},255:function(e){e.exports=JSON.parse('{"customerIdentification":{"sid":"Subscriber id (BillRun system field)"},"lines":{"arate":"Product reference","arate_key":"Product key","arategroup":"Campaign name","lastname":"Subscriber\'s surname","firstname":"Subscriber\'s first name","start":"Start time","channel":"Calling channel","stamp":"Unique record ID","billrun":"Billing cycle","src":"Calling ID","in_group":"Campaign inclusive units","clid":"Full Calling ID","dst":"Destination extension","charging_type":"Subscriber type","aprice":"Charge before taxes","log_stamp":"File unique ID","file":"File name","plan":"Subscriber\'s plan key","plan_ref":"Plan reference","billsec":"Billing duration","dcontext":"Destination context","lastapp":"Last dial plan","uniqueid":"Unique ID","sid":"Subscriber ID","userfield":"User field","amaflags":"Call indicator","usaget":"Activity type","duration":"Call duration","over_group":"Deviation units","usagev":"Activity volume","urt":"Record time","rebalance":"Rebalance","disposition":"Disposition","accountcode":"CDR account ID","type":"Input processor name","source":"Record source","connection_type":"Postpaid / Prepaid","end":"End time","aid":"Customer ID","process_time":"Process time","usagesb":"Accumulative usage","row_number":"Record number","realtime":"Realtime?","dstchannel":"Destination channel","answer":"Answer time","session_id":"Session ID","request_type":"Request type","record_type":"Record type","billrun_pretend":"Pretend?","request_num":"Request number","granted_return_code":"Return code","final_charge":"Total charge","pp_includes_name":"Bucket name","charging_usaget":"Charging activity type","balance_before":"Balance before","source_ref":"Update source reference","balance_ref":"Balance reference","balance_after":"Balance after","balance_normalized":"Balance normalized","pp_includes_external_id":"Bucket external ID"},"queue":{"calc_name":"Calculator stage","calc_time":"Last Calculation Time","realtime":"Realtime?","session_id":"Session ID","request_type":"Request type","record_type":"Record type","billrun_pretend":"Pretend?","request_num":"Request number","granted_return_code":"Return code"},"account":{"aid":"Customer ID","firstname":"First Name","lastname":"Last Name"},"subscription":{"aid":"Customer ID","sid":"Subscriber ID","firstname":"First Name","lastname":"Last Name","services":"Services","plan":"Plan","plan_activation":"Plan activation date"},"report":{"report_type_0":"Simple","report_type_1":"Grouped","count_group":"Count"},"event":{"type":"Event Type","event_type":"Event Type","extra_params.aid":"Customer ID","extra_params.sid":"Subscriber ID","based_on":"Condition Trigger","before":"Balance Before","after":"Balance After","notify_time":"Notify Time","creation_time":"Creation Time","value":"Value","stamp":"Unique record ID","returned_value":"Response"},"autorenew":{"aid":"Customer ID","sid":"Subscriber ID","bucket_group":"Bucket Group","cycles":"Total Cycles","cycles_remaining":"Remaining Cycles","next_renew":"Next Renew","last_renew":"Last Renew","interval":"Interval"},"service":{"description":"Title","name":"Key","period_type":"Eligibility Period","custom_period_type":"Custom"},"plan":{"description":"Title","name":"Key","upfront":"Charging Mode"},"product":{"usage_type_value":"Usage Type","usage_type_unit":"Usage Type Unit","pricing_method":"Pricing Method","description":"Title","key":"Key","usage_type":"Unit Type","price_from":"Pricing From","price_to":"Pricing To","price_value":"Price Per Interval","price_interval":"Pricing Interval","price_plan":"Plan Price Override"},"import":{"manual_mapping":"Map Manually CSV columns to entity fields","predefined_mapping":"Use file with predefined structure","permanentchange":"Update","rates.percentage":"Plan Price Override by Percentage"},"foreign":{"account_subscribers":"Customer Members"},"discount":{"description":"Title","key":"Key","priority":"Priority","type":"Type","cycles":"Cycles","select_plans":"Select Plans","select_services":"Select Services","discount_overall_limit":"Discount Overall Limit","type_monetary":"Monetary","type_percentage":"Percentage","min_subscribers":"Min Subscribers","max_subscribers":"Max Subscribers","proration":"Prorated","proration_inherited":"Inherited","proration_no":"No","matched_services":"Matched Services","monthly_fees":"Plans and included services","matched_plans":"Matched Plans","panel_plan_discount":"Plans Discount Values","sequential":"Sequential","panel_service_discount":"Services Discount Values"},"charge":{"description":"Title","key":"Key","priority":"Priority","type":"Type","cycles":"Cycles","select_plans":"Select Plans","select_services":"Select Services","discount_overall_limit":"Charge Overall Limit","type_monetary":"Monetary","type_percentage":"Percentage","min_subscribers":"Min Subscribers","max_subscribers":"Max Subscribers","proration":"Prorated","proration_inherited":"Inherited","proration_no":"No","matched_services":"Matched Services","monthly_fees":"Plans and included services","matched_plans":"Matched Plans","panel_plan_discount":"Plans Charge Values","panel_service_discount":"Services Charge Values","charge_values":"Charge Values","subject_general":"General","percentage_subject_not_compatible":"is not compatible with  General Charge."},"payment_files":{"creation_time":"Creation Time","parameters_string":"Parameters","transactions":"Transactions","start_process_time":"Generation start time","process_time":"Generation end time","file_name":"File name","created_by":"Created by","errors":"Errors","stamp":"File unique id","payment_gateway":"Payment Gateway","file_type":"File Type","status":"Status","status_failed_files":"Failed files","status_finished_files":"Finished files","status_running_files":"Running files"},"immediate_invoice":{"volume":"Volume","date":"Date","price":"Charge","product":"Product","subscriber":"Subscriber","select_rate_help":"Select Product","select_subscriber_help":"Select Subscriber","select_customer":"Select Customer","select_customer_help":"Type customer name or ID..."},"export_generator":{"name":"Name","status":"Status","status_active":"Active","status_disabled":"Not Active","query":"Query","file_name":"File Name","sequence_number_placeholder_description":"Sequence number","date_YYYYMMDDHHMMSS_placeholder_description":"Date in format 20201231235959","date":"Date","export_file_type":"Export File Type","time_range":"Time Range","record_type":"Record Type"},"suggestions":{"key":"Product","amount":"Correction Amount"},"status":"Status","amount":"Amount","type":"Type","key":"Key","billrun_key":"Cycle","usagev":"Activity volume","urt":"Record time","rebalance":"Rebalance","aid":"Customer ID","sid":"Subscriber ID","from":"From","to":"To","effective_date":"Effective Date"}')},256:function(e){e.exports=JSON.parse('{"service":{"collection":"services","audited":true,"uniqueField":"name","itemName":"service","itemsName":"services","itemType":"service","itemsType":"services","settingsKey":"services"},"plan":{"collection":"plans","audited":true,"uniqueField":"name","itemName":"plan","itemsName":"plans","itemType":"plan","itemsType":"plans","settingsKey":"plans"},"charging_plan":{"collection":"prepaidgroups","audited":true,"uniqueField":"name","itemName":"buckets group","itemsName":"buckets groups","itemType":"charging_plan","itemsType":"charging_plans"},"prepaid_plan":{"collection":"plans","audited":true,"uniqueField":"name","itemName":"prepaid plan","itemsName":"prepaid plans","itemType":"prepaid_plan","itemsType":"prepaid_plans"},"prepaid_include":{"collection":"prepaidincludes","audited":true,"uniqueField":"name","itemName":"prepaid bucket","itemsName":"prepaid buckets","itemType":"prepaid_include","itemsType":"prepaid_includes"},"product":{"collection":"rates","audited":true,"uniqueField":"key","itemName":"product","itemsName":"products","itemType":"product","itemsType":"products","settingsKey":"rates"},"discount":{"collection":"discounts","audited":true,"uniqueField":"key","itemName":"discount","itemsName":"discounts","itemType":"discount","itemsType":"discounts","settingsKey":"discounts"},"charge":{"collection":"charges","audited":true,"uniqueField":"key","itemName":"conditional charge","itemsName":"conditional charges","itemType":"charge","itemsType":"charges","settingsKey":"charges"},"subscription":{"collection":"subscribers","audited":true,"uniqueField":["sid","aid"],"itemName":"subscriber","itemsName":"subscribers","itemType":"subscription","itemsType":"subscriptions","settingsKey":"subscribers.subscriber"},"customer":{"collection":"accounts","audited":true,"uniqueField":"aid","itemName":"customer","itemsName":"customers","itemType":"customer","itemsType":"customers","settingsKey":"subscribers.account"},"report":{"collection":"reports","audited":true,"uniqueField":"key","itemName":"report","itemsName":"reports","itemType":"report","itemsType":"reports"},"usage":{"collection":"lines","settingsKey":"lines","uniqueField":"stamp","itemName":"usage","itemsName":"usages","itemType":"usage","itemsType":"usages"},"usage_archive":{"collection":"archive","settingsKey":"lines","uniqueField":"stamp","itemName":"usage (archive)","itemsName":"usages (archive)","itemType":"usage_archive","itemsType":"usages_archive"},"queue":{"collection":"queue","uniqueField":"stamp","itemName":"queue","itemsName":"queues","itemType":"queue","itemsType":"queues"},"tax":{"collection":"taxes","audited":true,"uniqueField":"key","itemName":"tax","itemsName":"tax rates","itemType":"tax","itemsType":"taxes","settingsKey":"taxes"},"logFile":{"collection":"log","uniqueField":"stamp","itemName":"received files","itemsName":"received files","itemType":"logFile","itemsType":"logFiles"},"paymentsTransactionsRequest":{"collection":"log","uniqueField":"stamp","itemName":"payments transactions request files","itemsName":"payments transactions request files","itemType":"payment_transactions_request_files","itemsType":"payments_transactions_request_files"},"paymentsTransactionsResponse":{"collection":"log","uniqueField":"stamp","itemName":"payments transactions response files","itemsName":"payments transactions response files","itemType":"payment_transactions_response_files","itemsType":"payments_transactions_response_files"},"paymentDenials":{"collection":"log","uniqueField":"stamp","itemName":"payment denials files","itemsName":"payment denials files","itemType":"payment_denials_files","itemsType":"payments_denials_files"},"paymentsFiles":{"collection":"log","uniqueField":"stamp","itemName":"transactions request file","itemsName":"transactions request file","itemType":"payment_files","itemsType":"payments_files"},"event":{"collection":"events","uniqueField":"stamp","itemName":"events","itemsName":"events","itemType":"event","itemsType":"events"},"suggestions":{"collection":"suggestions","itemName":"suggestion","itemsName":"suggestions","itemType":"suggestion","itemsType":"suggestions"},"auto_renew":{"collection":"autorenew","itemName":"recurring charge","itemsName":"recurring charges","itemType":"auto_renew","itemsType":"auto_renews"}}')},257:function(e){e.exports=JSON.parse('{"products":{"title":"Products","icon":"fa-book","route":"products","show":true,"roles":[],"order":1,"parent":"root"},"prepaid":{"title":"Prepaid","icon":"fa-cubes","route":"","show":true,"roles":[],"order":2,"parent":"root"},"prepaid_plans":{"title":"Plans","icon":"","route":"prepaid_plans","show":true,"roles":[],"order":0,"parent":"prepaid"},"prepaid_includes":{"title":"Buckets","icon":"","route":"prepaid_includes","show":true,"roles":[],"order":1,"parent":"prepaid"},"charging":{"title":"Buckets Groups","icon":"","route":"charging_plans","show":true,"roles":[],"order":2,"parent":"prepaid"},"recurring":{"title":"Recurring Charges","icon":"","route":"auto_renews","show":true,"roles":[],"order":3,"parent":"prepaid"},"postpaid":{"title":"Postpaid","icon":"fa-puzzle-piece","route":"","show":true,"roles":[],"order":3,"parent":"root"},"postpaid_plans":{"id":"postpaid","title":"Plans","icon":"","route":"plans","show":true,"roles":[],"order":0,"parent":"postpaid"},"services":{"title":"Services","icon":"","route":"services","show":true,"roles":[],"order":1,"parent":"postpaid"},"discounts":{"title":"Discounts","icon":"","route":"discounts","show":true,"roles":[],"order":2,"parent":"postpaid"},"charges":{"title":"Conditional Charges","icon":"","route":"charges","show":true,"roles":[],"order":2,"parent":"postpaid"},"customers":{"title":"Customers","icon":"fa-users","route":"customers","show":true,"roles":[],"order":4,"parent":"root"},"usage":{"title":"Usage","icon":"fa-list","route":"usage","show":true,"roles":[],"order":5,"parent":"root"},"cycle":{"title":"Maintenance","icon":"fa-clock-o","route":"","show":true,"roles":[],"order":6,"parent":"root"},"run_cycle":{"title":"Run a Billing Cycle","icon":"","route":"run_cycle","show":true,"roles":[],"order":0,"parent":"cycle"},"suggestions":{"title":"Repricing Suggestions","icon":"","route":"suggestions","show":true,"roles":[],"order":0,"parent":"cycle"},"account_receivables":{"title":"Account Receivables","icon":"fa-file-text-o","route":"","show":true,"roles":[],"order":7,"parent":"root"},"invoices":{"title":"Invoices","icon":"","route":"invoices","show":true,"roles":[],"order":0,"parent":"account_receivables"},"custom-payment-files":{"title":"Transactions Request File","icon":"","route":"custom-payment-files","show":true,"roles":[],"order":1,"parent":"account_receivables"},"tax":{"title":"Tax","icon":"fa-percent","route":"","show":true,"roles":[],"order":7.1,"parent":"root"},"taxes":{"title":"Rates","icon":"","route":"taxes","show":true,"roles":[],"order":0,"parent":"tax"},"tax_mapping":{"title":"Mapping Rules","icon":"","route":"taxes/mapping-rules","show":true,"roles":[],"order":1,"parent":"tax"},"templates":{"title":"Templates","icon":"fa-newspaper-o","route":"","show":true,"roles":[],"order":7.3,"parent":"root"},"invoice_template":{"title":"Invoice Template","icon":"","route":"invoice-template","show":true,"roles":["admin"],"order":0,"parent":"templates"},"email_templates":{"title":"Email Templates","icon":"","route":"email_templates","show":true,"roles":["admin"],"order":1,"parent":"templates"},"reports":{"title":"Reports","icon":"fa-list-alt","route":"reports","show":true,"roles":[],"order":7.5,"parent":"root"},"users":{"title":"User Management","icon":"fa-user","route":"users","show":true,"roles":[],"order":8,"parent":"root"},"audit_trail":{"title":"Audit Trail","icon":"fa-history","route":"audit-trail","show":true,"roles":[],"order":9,"parent":"root"},"settings":{"title":"Settings","icon":"fa-cog","route":"","show":true,"roles":["admin"],"order":10,"parent":"root"},"settings_general":{"title":"General Settings","icon":"","route":"settings","show":true,"roles":["admin"],"order":0,"parent":"settings"},"input_processors":{"title":"Input Processors","icon":"","route":"input_processors","show":true,"roles":["admin"],"order":1,"parent":"settings"},"export_generators":{"title":"Export Generators","icon":"","route":"export_generators","show":true,"roles":["admin"],"order":2,"parent":"settings"},"payment_gateways":{"title":"Payment Gateways","icon":"","route":"payment_gateways","show":true,"roles":["admin"],"order":3,"parent":"settings"},"collections":{"title":"Collection","icon":"","route":"collections","show":true,"roles":["admin"],"order":4,"parent":"settings"},"custom_fields":{"title":"Custom Fields","icon":"","route":"custom_fields","show":true,"roles":["admin"],"order":6,"parent":"settings"},"events":{"title":"Events","icon":"","route":"events","show":true,"roles":["admin"],"order":7,"parent":"settings"}}')},258:function(e){e.exports=JSON.parse('{"entities":{"balance":{"title":"postpaid balance "},"fraud":{"title":"fraud"},"balancePrepaid":{"title":"prepaid balance"}},"operators":{"fraud":{"conditions":[{"id":"in","title":"Is In"},{"id":"nin","title":"Is Not In"}],"threshold":[{"id":"in","title":"Is"},{"id":"nin","title":"Is Not"},{"id":"gt","title":"Is Greater Than","type":"number"},{"id":"gte","title":"Is Greater Than Or Equal","type":"number"},{"id":"lt","title":"Is Less Than","type":"number"},{"id":"lte","title":"Is Less Than Or Equal","type":"number"}]},"balance":{"conditions":[{"id":"in","title":"In","type":"tags"},{"id":"not_in","title":"Is Not In","type":"tags"},{"id":"is","title":"Is"},{"id":"is_not","title":"Is Not"},{"id":"is_less_than","title":"Is Less Than","type":"number"},{"id":"is_less_than_or_equal","title":"Is Less Than Or Equal","type":"number"},{"id":"is_greater_than","title":"Is Greater Than","type":"number"},{"id":"is_greater_than_or_equal","title":"Is Greater Than Or Equal","type":"number"},{"id":"reached_constant","title":"Reached Constant","type":"tags"},{"id":"reached_constant_recurring","title":"Reached Constant (Recurring)","type":"number"},{"id":"has_changed","title":"Has Changed","extra_field":false},{"id":"has_changed_to","title":"Has Changed To"},{"id":"has_changed_from","title":"Has Changed From"},{"id":"reached_percentage","title":"Reached Percentage","type":"tags"}]},"balancePrepaid":{"conditions":[{"id":"in","title":"In","type":"tags"},{"id":"not_in","title":"Is Not In","type":"tags"},{"id":"is","title":"Is"},{"id":"is_not","title":"Is Not"},{"id":"is_less_than","title":"Is Less Than","type":"number"},{"id":"is_less_than_or_equal","title":"Is Less Than Or Equal","type":"number"},{"id":"is_greater_than","title":"Is Greater Than","type":"number"},{"id":"is_greater_than_or_equal","title":"Is Greater Than Or Equal","type":"number"},{"id":"reached_constant","title":"Reached Constant","type":"tags"},{"id":"reached_constant_recurring","title":"Reached Constant (Recurring)","type":"number"},{"id":"has_changed","title":"Has Changed","extra_field":false},{"id":"has_changed_to","title":"Has Changed To"},{"id":"has_changed_from","title":"Has Changed From"}]}},"conditionsFields":[{"id":"usaget","entity":"line","effectOnUsaget":true,"inputConfig":{"inputType":"select","callback":"getUsageTypesOptions"}},{"id":"type","title":"Input processor name / BillRun type","effectOnUsaget":true,"inputConfig":{"inputType":"select","callback":"getFileTypeOptions"}},{"id":"subscriber.plan","entity":"line","inputConfig":{"inputType":"select","callback":"getPlansOptions"}},{"id":"arate_key","entity":"line","effectOnUsaget":true,"inputConfig":{"inputType":"select","callback":"getProductsOptions"}}],"thresholdFields":[{"id":"usagev","entity":"line","allowedWithUsage":["single"],"type":"number"},{"id":"aprice","entity":"line","allowedWithUsage":["single","multiple","empty"],"type":"number"},{"id":"final_charge","entity":"line","allowedWithUsage":["multiple","empty"],"type":"number"},{"id":"in_group","entity":"line","allowedWithUsage":["single"],"type":"number"},{"id":"over_group","entity":"line","allowedWithUsage":["single"],"type":"number"},{"id":"out_group","title":"Out Group","allowedWithUsage":["single"],"type":"number"}]}')},259:function(e){e.exports=JSON.parse('{"conditions":[{"id":"$eq","title":"Equal"},{"id":"$ne","title":"Does Not Equal"},{"id":"$exists","title":"Exists"},{"id":"$existsFalse","title":"Does Not Exist"},{"id":"$lt","title":"Is Less Than"},{"id":"$lte","title":"Is Less Than Or Equal"},{"id":"$gt","title":"Is Greater Than"},{"id":"$gte","title":"Is Greater Than Or Equal"},{"id":"$in","title":"Is Included In"},{"id":"$isTrue","title":"Is True (Boolean)"},{"id":"$isFalse","title":"Is False (Boolean)"},{"id":"$regex","title":"Matches regular expression"}],"paramsConditions":[{"id":"match","title":"Equals"},{"id":"equalFalse","title":"Does Not Equal"},{"id":"longestPrefix","title":"Longest Prefix"},{"id":"range","title":"In Range"}],"preFunctions":[{"id":"minute_of_hour","title":"Minute of hour (MM)","values":["urt"]},{"id":"hour_of_day","title":"Hour of day (HH)","values":["urt"]},{"id":"time_of_day","title":"Time of day (HHMM)","values":["urt"]},{"id":"day_of_week","title":"Day of week (Monday [1] to Sunday [7])","values":["urt"]},{"id":"day_of_month","title":"Day of month (DD)","values":["urt"]},{"id":"month_of_year","title":"Month of year (MM)","values":["urt"]},{"id":"month_and_day","title":"Month and day (MMDD)","values":["urt"]}]}')},260:function(e){e.exports=JSON.parse('{"allowed_entities":["discount","charge","customer","subscription","plan","service","product"],"allowed_entities_actions":{"create":["customer","subscription","product"],"permanentchange":["product"]},"allowed_entities_importype":{"manual_mapping":["customer","subscription","product"],"predefined_mapping":["discount","charge","product"]},"default_values_allowed_actions":{"create":["customer","subscription","product"],"permanentchange":[]},"predefined_values_allowed_actions":{"create":["customer","subscription","product"],"permanentchange":[]},"hidden_actions_fields":{"create":{"customer":[],"subscription":[],"product":["effective_date"]},"permanentchange":{"customer":[],"subscription":[],"product":["tariff_category","key","usage_type","usage_type_value","from"]}},"allowed_plays":["product"]}')},261:function(e){e.exports=JSON.parse('{"allowed_entities":["product","discount","charge"]}')},262:function(e){e.exports=JSON.parse('{"default_new_step_status":false,"step_types":{"mail":{"label":"Mail","icon":"fa-envelope-o","enable":true},"sms":{"label":"SMS","icon":"fa-commenting-o","enable":false},"http":{"label":"HTTP","icon":"fa-link","enable":true}},"http":{"mthods":["get","post"],"decoders":["json","xml"]}}')},263:function(e){e.exports=JSON.parse('{"entities":{"customer":"account","subscription":"subscriber","product":"rate","service":"service","plan":"plan","tax":"tax","discount":"discount","usage":"usage"},"defaultDisabledFields":{"discount":["key","description"],"customer":["first_name","last_name","firstname","lastname","address"],"subscription":["firstname","lastname","plan","services"]},"defaultHiddenFields":{"customer":["aid","payment_gateway","allowances"],"subscription":["sid","aid","plan_activation","play"],"product":["from","to","play","tax"],"service":["from","to","include","play","tax"],"tax":["from","to"],"discount":["from","to"],"plan":["from","to","play","tax"]},"unReorderFields":{"product":["key","description","rates"],"service":["name","description","price"],"tax":["key","description"],"discount":["key","description"],"plan":["name","description","price","upfront"]},"saveAsParams":["discount","tax"],"fields":[{"id":"text","type":"string","title":"Text"},{"id":"boolean","title":"Boolean","type":"boolean","defaultValue":false,"exclude":["unique","mandatory","searchable","multiple","select_options","select_list"]},{"id":"textarea","type":"string","title":"Text Area","exclude":["multiple","select_options","select_list"]},{"id":"percentage","type":"number","title":"Percentage","exclude":["multiple","select_options","select_list"]},{"id":"date","type":"date","title":"Date","exclude":["multiple","select_options","select_list"]},{"id":"daterange","type":"array","title":"Date Range","exclude":["select_options","select_list"]},{"id":"ranges","type":"array","title":"Range","exclude":["select_options","select_list"],"includeEntity":["subscription","product"]}],"foreignFields":{"entities":{"usage":["customer","subscription","product","service","plan","account_subscribers","tax"]},"translate":{"unixTimeToString":{"title":"Unix time To string","options":["Y-m-d H:i:s"]},"unixTimeToMongoDate":{"title":"Unix time to date"}},"conditions":[{"id":"$nin","title":"Does Not Equal"},{"id":"$in","title":"Equal"},{"id":"$lt","title":"Is Less Than","type":"number"},{"id":"$lte","title":"Is Less Than Or Equal","type":"number"},{"id":"$gt","title":"Is Greater Than","type":"number"},{"id":"$gte","title":"Is Greater Than Or Equal","type":"number"},{"id":"$regex","title":"Matches regular expression"}]}}')},264:function(e){e.exports=JSON.parse('{"conditions":{"fields":{"subscriber":[{"id":"aid","type":"number"},{"id":"sid","type":"number"},{"id":"plan","inputConfig":{"inputType":"select","callback":"getPlansOptions"}},{"id":"services","show":false},{"id":"plan_activation","type":"date"},{"id":"plan_deactivation","type":"date"},{"id":"activation_date","type":"date"},{"id":"deactivation_date","type":"date"},{"id":"play","inputConfig":{"inputType":"select","callback":"getPlayTypeOptions"}}],"account":[{"id":"aid","type":"number"}],"subscriber_services":[{"id":"name","title":"Name","type":"string","inputConfig":{"inputType":"select","callback":"getServicesOptions"}},{"id":"from","title":"From","type":"date"},{"id":"to","title":"To","type":"date"},{"id":"quantity","title":"Quantity","type":"number"}]},"valueOptions":[{"id":"@cycle_start_date@","title":"Billing Cycle Start Date","include":["date"],"exclude":[]},{"id":"@cycle_end_date@","title":"Billing Cycle End Date","include":["date"],"exclude":[]},{"id":"@plan_activation@","title":"Plan Activation Date","include":["date"],"exclude":["fieldid:plan_activation"]},{"id":"@plan_deactivation@","title":"Plan Deactivation Date","include":["date"],"exclude":["fieldid:plan_deactivation"]},{"id":"@activation_date@","title":"Activation Date","include":["date"],"exclude":["fieldid:activation_date"]},{"id":"@deactivation_date@","title":"Deactivation Date","include":["date"],"exclude":["fieldid:deactivation_date"]}],"operators":[{"id":"eq","title":"Equals","include":["date","datetime"]},{"id":"ne","title":"Does not equal","include":[],"exclude":[]},{"id":"in","title":"Equals","include":["string","textarea","number","percentage"],"exclude":[]},{"id":"nin","title":"Does not equal","include":["string","textarea","number","percentage"],"exclude":[]},{"id":"lt","title":"Is Less Than","include":["number","percentage","date","datetime"],"exclude":[]},{"id":"lte","title":"Is Less Than Or Equal","include":["number","percentage","date","datetime"],"exclude":[]},{"id":"gt","title":"Is Greater Than","include":["number","percentage","date","datetime"],"exclude":[]},{"id":"gte","title":"Is Greater Than Or Equal","include":["number","percentage","date","datetime"],"exclude":[]},{"id":"regex","title":"Contains","include":["string","textarea"],"exclude":[]},{"id":"is","title":"Equals","type":"boolean","include":["boolean"],"exclude":[],"trueLabel":"True","falseLabel":"False"},{"id":"is","title":"Is","type":"string","include":["daterange"],"exclude":[],"options":[{"value":"active","label":"Active"},{"value":"notActive","label":"Inactive"}]},{"id":"exists","title":"Exists","type":"boolean","include":["string","textarea","number","percentage","boolean","date","datetime","ranges","range"],"exclude":[]}]}}')},265:function(e){e.exports=JSON.parse('{"operators":[{"id":"last_days","title":"Last (days)","type":"number","include":[],"suffix":"Days"},{"id":"last_days_include_today","title":"Last (days including today)","type":"number","include":[],"suffix":"Days"},{"id":"last_hours","title":"Last (hours)","type":"number","include":[],"suffix":"Hours"},{"id":"eq","title":"Equals","include":["date","datetime","boolean"]},{"id":"in","title":"Equals","type":"array","include":["string","number"],"exclude":[]},{"id":"ne","title":"Does not equal","include":["boolean"],"exclude":[]},{"id":"nin","title":"Does not equal","type":"array","include":["string","number"],"exclude":[]},{"id":"lt","title":"<","include":["number","date","datetime"],"exclude":[]},{"id":"lte","title":"<=","include":["number","date","datetime"],"exclude":[]},{"id":"gt","title":">","include":["number","date","datetime"],"exclude":[]},{"id":"gte","title":">=","include":["number","date","datetime"],"exclude":[]},{"id":"like","title":"Contains","include":["string","number"],"exclude":[]},{"id":"regex","title":"Matches regular expression","include":["string","textarea"],"exclude":[]},{"id":"starts_with","title":"Starts with","include":["string"],"exclude":[]},{"id":"ends_with","title":"Ends with","include":["string"],"exclude":[]},{"id":"in_range","title":"Include\u200e","include":["ranges","range","daterange"]},{"id":"nin_range","title":"Does not include\u200e","include":["ranges","range","daterange"]},{"id":"exists","title":"Exists","type":"boolean","options":["yes","no"]}],"aggregate":[{"id":"group","title":"Group","include":["string","number","boolean","date"],"exclude":[]},{"id":"sum","title":"Sum","include":["number"],"exclude":[]},{"id":"avg","title":"Average","include":["number"],"exclude":[]},{"id":"first","title":"First","include":["string","number","boolean","date","ranges","range"],"exclude":[]},{"id":"last","title":"Last","include":["string","number","boolean","date","ranges","range"],"exclude":[]},{"id":"max","title":"Max","include":["number","date"],"exclude":[]},{"id":"min","title":"Min","include":["number","date"],"exclude":[]},{"id":"push","title":"List","include":["string","number","boolean","date"],"exclude":[]},{"id":"addToSet","title":"Unique List","include":["string","number","boolean","date","ranges","range"],"exclude":[]},{"id":"count","title":"Count","include":[]}]}')},266:function(e){e.exports=JSON.parse('{"recordTypeConditions":[{"id":"eq"},{"id":"in"},{"id":"ne"},{"id":"nin"},{"id":"lt"},{"id":"lte"},{"id":"gt"},{"id":"gte"},{"id":"exists"}],"filtrationConditions":[{"id":"eq"},{"id":"in"},{"id":"ne"},{"id":"nin"},{"id":"lt"},{"id":"lte"},{"id":"gt"},{"id":"gte"},{"id":"regex"},{"id":"exists"}],"timeRangeOptions":["minutes","hours","days"],"senderTypes":{"ftp":"FTP","ssh":"SFTP"},"fileTypes":[{"id":"separator","title":"CSV - Separator"},{"id":"fixed","title":"CSV - Fixed width"},{"id":"xml","title":"XML"}]}')},278:function(e,t){e.exports="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAA8AAD/4QQKaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjMtYzAxMSA2Ni4xNDU2NjEsIDIwMTIvMDIvMDYtMTQ6NTY6MjcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0idXVpZDo1RDIwODkyNDkzQkZEQjExOTE0QTg1OTBEMzE1MDhDOCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBMzI1QzFGRUM0NEYxMUU2QTE3OUQ3RTBEMDJDRUJBMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpBMzI1QzFGREM0NEYxMUU2QTE3OUQ3RTBEMDJDRUJBMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBJbGx1c3RyYXRvciBDQyAyMDE1IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ1dWlkOjkwOTQ0NzEyLWZhMjAtNGY3MS04MzZjLTA4OTMzZWVmOTY3OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2Y2Q2Y2M0My04MjU3LWQ1NGQtYTU4YS0xM2MwYmExMzFhMzciLz4gPGRjOnRpdGxlPiA8cmRmOkFsdD4gPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij5CaWxscnVuLWludm9pY2UtdjEuMjwvcmRmOmxpPiA8L3JkZjpBbHQ+IDwvZGM6dGl0bGU+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+0ASFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAPHAFaAAMbJUccAgAAAgACADhCSU0EJQAAAAAAEPzhH4nIt8l4LzRiNAdYd+v/7gAOQWRvYmUAZMAAAAAB/9sAhAAGBAQEBQQGBQUGCQYFBgkLCAYGCAsMCgoLCgoMEAwMDAwMDBAMDg8QDw4MExMUFBMTHBsbGxwfHx8fHx8fHx8fAQcHBw0MDRgQEBgaFREVGh8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx//wAARCABhAFADAREAAhEBAxEB/8QAogAAAgMBAQEBAAAAAAAAAAAAAAcEBQYDAgEIAQACAwEBAAAAAAAAAAAAAAAABQIDBAEGEAABAwIDAwkEBwUJAAAAAAABAgMEAAURIQYxEgdBUWFxgZEiMhOhsUIjYnKCkqIUFcGyU4Mk0VLCM2M0lBYXEQABAwIEAwcEAgMBAAAAAAABAAIDEQQhMRIFQVFhkaGx4SIyE/Bx0UKBUiMzJBX/2gAMAwEAAhEDEQA/AP1TQhFCEv8AWPGOwWNa4cAfqlxRilSW1YMtq5luZ4kcye8VQ+cDLFKLzd44sG+p3clReuKmubutX9eqEydjMP5IH2x8w9qqyunceKRS7ncScaDph5rMyHbhKVvyXnHlHapxaln8RNVF6xlr3ZmqGHJ8VW/HecZUNim1KQfYRQHoa17cjRaWzcUtdWhScJ65jI2szPnA/aPzB2Kq1s7hxWyLcriPjUdcfNNbRvGSx3tSIlxR+mT1YJBWrFhajkAlw4bpPMrvNao5wc8E9s93jlwd6XdyYVXpuihCKEJIcU+Kj0p56w2B4oiIJbmzWzm6dim21DYjnI83VtxzTcAvMbnuZcTHGcOJ5+SWDEQqzNYnPSmOGqntQhzVSXrY2FSExBhsqGtWiJBiDmo1rpiXFyGMNlSD1U6ELZaL0umZoTV760YlTKPQVhnvxQp8gdfhrfAKscVpt7SsEn28MVL4YcT5dtdj2TUK1G3P+GBNdxxaz3QlSj5m8Rhj8PVsthmpgckbbuToyI5Pacj9cPBPCti9Ol9xk1kux2FNuhublxugUgKSfE2wMnFDmKsd0dvNVE8lBTmlG73nxR6W+53gkJDjFRBIpY9y83BFVXEeMMNlZXOTFkamtx+iqi5Xhi7CP0VHUp6EGP0Ual3QvH5Nbi0ttoK1rIShKRiSTkABUmmqiWVTqt9jbsGgJMNwD1ExH3ZR5C4tslXd5eyvQMj+OKh5Js2L44SOhSkv9lS9wws9xQn5sKXIYWRt3HlFefUpHtrIP9QPVIbq3rbtdyJ70wODGsXLxZV2mYveuFrCUoUo+Jcc5IPSUeU9lbYJKiiY7PdmRmh3ub4JWcTbwu866uCt7eYiL/KMDkCWDuqw63N41knfVxSTcJfluDyGHZ5qBDYyFL3uV8TFasM1mc5bGtUxtmqy5XBq6hmoalLSvbcRx1xLbSC44s4IQkEknmAFdbUmgXdKY+idCfp7iLnckgzBmwxtDePxK+l7uvY+srLR6n5rZBb6cTmpvEq6Jh6YeYB+dOIYQOXd2rP3Rh21ffS6Y6cSpXb6MpzWSfgD/wAUe3hmXA6n/lBHuqhg/wCev1msT2f8p+uKX3D66uWPXVteJKGZLgjPg5AtyMEgnoCilXZRbvoQkdnIYrhp4HDtWeYcXJmOyHM1urUtR6VHE++qZSs0HqcSVttP6P1BdEJchwlqZOx5eDbfYpeAPZWdsD35BPILdzsgtjD4U3ogF+THa6AVrP7oHtqwbZIcyFvbZu4qxb4VujzXFI6mif8AEKl/5B/t3KwWvVTYvDG3oIMmY46ByISlv379WM2hvFxPd+VMWw4laW12G02wf0UdLayMC6fEs/aOJphDbMj9oVzWBuSky5caHHXJkuBplsYrWase8MFTgFIkAVKTuqrxJ1BdQtCVekD6UNjlwJ/eUa83cXJmf04JZM4vK1mvGEWnhy3bMRir0I+XKpJ9RR7Sgmm9wPjhDfsFddDTDpSV1I2qM5b30eF0x2nQekEhJ7kiszOH2Xmr1tKHomdw04TIhIN01GyFSApX5eC55EBJw9RwbCThiBsw9m6O3Gbk22zbNA1SDHkmMvUenWT6arlFSpOW4HUYjsByq0zxjNw7U5+VnML23f7E7/l3CMo8wdRj3Y0C5jP7N7V0SN5qSmZEUMUvtqHOFpP7amJG8wpVC5vXW2MjF2WyjoK0492NQdcRtzcO1BcFS3HXdpjpKYoVLd5MAUIx6VKGPcKwzbtE32+oqt0wGSw18vtyuzm9KXg0k4tsJyQns5T0mklxdvlPqy5LM95dmr3QellKfTeJaMG0ZxEH4lfxOoclMtstCf8AI7+PypwxY1KqeLd4TJns21pWKIaSt7D+IsDL7KffVm4TVeGjgs98+ppyS918wpu7twEjFyNHixin/UDKN8ffUa7SjqcgPBJNyGOnkAE471pnUOpNRyo9xlrh6WihsRmGCAuUtSApZWc8kqyzHUOWmEkReaE+lPZIJJZSHGkQy6qT/wCY6TDW42y62oZeol1RV+LeT7Kqdt8RV4tGDJU8/hpMYJXb5CZCORpzwL7/ACn2Uun2lw9hquG2IyVHJtFxhK3ZcZbWHxKHh7FDI0plgez3AhQ0kZrkE1RVC9tR3nnA2yhTjitiEgqJ7BXWtLjQCpXaLXWDQx30ybqkYDNEXbj9cj3U9s9r/aTs/KtZDzV7qS/R7JbS7kX1Dcis86sNuH91PLTO6uRCyvHgrJH6QlPZYhul/wDzE1RVGjlU24Oqz+W341Y/WOXbSS1aXvqfuUsa3U6pyzKpbBHe1RxIiqcTilyUqdJG0BttXqkHoJAT21vtwXvqlrWma4aOtT/GKdurdNyNQQmISLi9b2EvByV6HmdbCSPTxxGGZxzxHRTKRmoUqvQXVuZQAHForjTisW/w6uFqJnaVuTkgNEhbO+A7inaN9G6hR50kCl0tm5vqjKyi0LMYzVW+nuIoVhEvjZZkIO4qQEkZjI+ojak9XcKjDuVPTJgef5WiK4rg5bSPJiymg4w4h5pXxIIUPZTRj2vFQahagQVyctNrcO85DYWrnU2gn2ioG2jObW9gRpC7MxozA3WGkNJ5kJCR7KmyNrfaAEAKqvWqrbbEKTvB+UNjCDsP0j8PvrJc7hHFhm7koPkASwvNyn3ed6rxLr7hCGmkAkDE5IQmvPPlfM+pxKxSOLijVjzWmNOmypUDdrkEu3NSTj6bQzQziOc7f7CKafH8TNH7Oz/Cz3TxEzT+xzWg4NaTcgW12/TEbsu5gCOlQzRGBxB/mHxdQFMbWLS2qltVsWgyOzdl9vNMitSbpQ6u03f9F3h3U+mFrNseUXJ8ROKktknFRUj4mj+GsUsbmnU1IbiB9s8yR+w5jl5eCuoEvTWv4YfZUmDfm0/MQMCThy8m+jp2j30SQsuB/V63RSsnFRg5VMm3XyxP/NDjGeCZDSjuK6ljDuNJZoJYDxHUKVHNzUtnVV9SnBM1ZH0glR7yDXBuE4/YqwSFcpV9u0hJS9LcUk7UhW6D1hOAqp93K/NxXC8qHEt1wuLvpQmFOq2KUMkp+so5CiC3fIaNFVChOStZz9m0PFMiQtE3UTifktDNDOI8x5QOnaeTDOnccLLYf2k8FGWRsIqcXKi0Xom46sun/YL+FG2KX6qUuZKlLxxGX8Ie3YMqvt7cuOpyw29s64drf7PHyToACQABgBkANmFMk+RQhBAIIIxB2ihCX2ouE0R6X+qaakfpFyCt8NpxDCl843fE0fq5dFZZbYOxGBSubbRXVEdLu7yXFjV+uLIj8tqixOT4yRumfEAcBTzrCApP3t2o65G4OGoLjbqWPCVhPUY/XcvI1vwrlEqeYVHc+JBaU2QekNHCszmWzs20/j8KYvrcrm5rrhhF/wBvDXKX8KfT3gT/ADVfsqIFs3Jlfrqg30AXpzVeur22I2mrIu3RVZCW6ncATzpUsIR90E1frlcKNGkKJupZMI206qVp7hPGaki46kkfqs4nfLGZYCudW94nT9bAdFWxWgbicSuxbfjqkOo8uHmmClISAlIwSMgBsArWmaKEIoQihCKEIoQvhSk7QD10IogJSNgA6qEUX2hCKEIoQihCKEIoQuDs2O15ldwoQojmoLe3tKj2UIUdWrLYnaFd1FEL4nVtsVyK7qKIUhvUVvc2bw7KEKW1cIrvlUe0UIUgHEYihCKEIoQihChz/LQhUEvaa6uKuc20IXxFCFPjbRQhX9u8tcXVPoQihC//2Q=="},279:function(e,t){e.exports='<div class="shell">\n  <div class="container">\n    <div class="section section-invoice-head">\n      <table class="table-header">\n        <tbody>\n          <tr>\n            <td>\n              <h1>INVOICE</h1>\n            </td>\n            <td class="step-period">\n              <table class="table-inline">\n                <tbody>\n                  <tr>\n                    <td>Period</td>\n                    <td><strong>01/05 - 31/05</strong></td>\n                  </tr>\n                  <tr>\n                    <td>Invoice#</td>\n                    <td>100183</td>\n                  </tr>\n                  <tr>\n                    <td>Print Date</td>\n                    <td>19/06/2017</td>\n                  </tr>\n                </tbody>\n              </table>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n    <div class="section-info">\n      <table class="table-info">\n        <tbody><tr>\n            <td>\n              <small>to</small>\n            </td>\n            <td>\n              <h2>David Morrison</h2>\n              <span class="text">\n                <small>Account</small>\n                <span class="text">100183</span>\n              </span>\n            </td>\n          </tr>\n          <tr>\n            <td></td>\n            <td>\n714 Lexington Ave, New York, NY 10016 USA \n</td>\n          </tr>\n          <tr>\n            <td></td>\n            <td>david.morrison@example.com</td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n'},280:function(e,t){e.exports='<div class="section section-invoice-head">\n\t<div class="table">\n\t\t<table>\n\t\t\t<tbody><tr>\n\t\t\t\t<td class="page-title"><h3 class="inline">INVOICE</h3></td>\n\t\t\t\t<td>\n\t\t\t\t\t<span class="label">Customer</span>\n\t\t\t\t\t<h3 class="inline">David Morrison</h3>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<span class="label">Invoice#</span>\n\t\t\t\t\t<span>100183</span>\n\t\t\t\t</td>\n\t\t\t\t<td class="period">\n\t\t\t\t\t<span class="label">Period</span>\n\t\t\t\t\t<h3 class="inline">01/05 - 31/05</h3>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</tbody></table>\n\t</div>\x3c!-- /.table --\x3e\n</div>\n\n<div class="section section-invoice-base step-subscription-details">\n\t<h2>Subscription#1:</h2>\n\t<h1>Frank Reily</h1>\n</div>\n'},281:function(e,t){e.exports='\x3c!-- Body --\x3e\n<div class="wrapper">\n  <div class="shell">\n    <div class="container">\n        <div class="section section-invoice-details sumup">\n          <div class="section-head">\n            <h2 class="section-title section-title-alt">Invoice summary</h2>\x3c!-- /.section-title --\x3e\n          </div>\x3c!-- /.section-head --\x3e\n          <div class="section-body">\n            <div class="table table-default table-default-primary complex-sumup-wrapper">\n              <table class="complex-sumup">\n          <thead>\n            <tr>\n              <th>Description</th>\n              <th>Qty</th>\n              <th>Rate</th>\n              <th></th>\n              <th>Amount</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr class="step-plan">\n              <td class="desc step-plan">Premium unlimited plan</td>\n              <td class="qty">5</td>\n              <td class="rate">14.95</td>\n              <td class="span small-text"></td>\n              <td class="amount">$74.75</td>\n            </tr>\n            <tr class="">\n              <td class="desc">Voicemail service</td>\n              <td class="qty">1</td>\n              <td class="rate">14.95</td>\n              <td class="span small-text"></td>\n              <td class="amount">$14.95</td>\n            </tr>\n            <tr class="step-service">\n              <td class="desc">IP Phone rental</td>\n              <td class="qty">1</td>\n              <td class="rate">14.95</td>\n              <td class="span small-text"></td>\n              <td class="amount">$14.95</td>\n            </tr>\n            <tr class="">\n              <td class="desc">Call Recording</td>\n              <td class="qty">4</td>\n              <td class="rate">6.95</td>\n              <td class="span small-text"></td>\n              <td class="amount">$27.80</td>\n            </tr>\n            <tr class="step-discount">\n              <td class="desc">Premium unlimited plan discount</td>\n              <td class="qty">1</td>\n              <td class="rate">-14.95</td>\n              <td class="span small-text"></td>\n              <td class="amount">$-14.95</td>\n            </tr>\n            <tr class="">\n              <td colspan="4">Usage charges</td>\n              <td>$36.92</td>\n            </tr>\n            <tr class="">\n              <td colspan="4">Charges</td>\n              <td>$0.00</td>\n            </tr>\n            <tr class="last">\n              <td colspan="4">Refunds</td>\n              <td>$0.00</td>\n            </tr>\n            <tr class="total subtotal">\n              <td colspan="4">SUBTOTAL</td>\n              <td>$154.42</td>\n            </tr>\n            <tr class="total">\n              <td colspan="4">VAT (17%)</td>\n              <td>$26.25</td>\n            </tr>\n\x3c!--            <tr class="">\n              <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Local communications svc  tax </td>\n              <td>$14.82</td>\n            </tr>\n                <tr class="">\n              <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fl communications services tax </td>\n              <td>$21.20</td>\n            </tr>\n                <tr class="">\n              <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Federal trs fund </td>\n              <td>$1.02</td>\n            </tr>\n                <tr class="">\n              <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Federal universal service fund </td>\n              <td>$8.28</td>\n            </tr>\n                <tr class="last">\n              <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fl 911 surcharge </td>\n              <td>$2.00</td>\n            </tr>\n--\x3e\n            <tr class="grand-total">\n              <td colspan="4">GRAND TOTAL</td>\n              <td>$180.67</td>\n            </tr>\n              </tbody>\n            </table>\n          </div>\x3c!-- /.table table-default table-default-primary --\x3e\n        </div>\x3c!-- /.section-body --\x3e\n      </div>\n    </div>\n  </div>\n</div>\n'},282:function(e,t){e.exports='<div class="section section-invoice-details sumup">\n  <div class="section-head">\n    <h2 class="section-title section-title">Subscription Summary</h2>\x3c!-- /.section-title --\x3e\n  </div>\x3c!-- /.section-head --\x3e\n  <div class="section-body">\n    <div class="table table-default table-default-primary complex-sumup-wrapper">\n      <table class="complex-sumup">\n        <thead>\n          <tr>\n            <th>Description</th>\n            <th>Qty</th>\n\t\t\t<th>Rate</th>\n            <th></th>\n            <th>Amount</th>\n          </tr>\n        </thead>\n        <tbody>\n\t\t<tr class="step-plan">\n\t\t  <td class="desc step-plan">Premium unlimited plan</td>\n\t\t  <td class="qty">5</td>\n          <td class="rate">14.95</td>\n\t\t  <td class="span small-text"></td>\n\t\t  <td class="amount">$74.75</td>\n\t\t</tr>\n\t\t<tr class="">\n\t\t  <td class="desc">Voicemail service</td>\n\t\t  <td class="qty">1</td>\n          <td class="rate">14.95</td>\n\t\t  <td class="span small-text"></td>\n\t\t  <td class="amount">$14.95</td>\n\t\t</tr>\n\t\t<tr class="step-service">\n\t\t  <td class="desc">IP Phone rental</td>\n\t\t  <td class="qty">1</td>\n          <td class="rate">14.95</td>\n\t\t  <td class="span small-text"></td>\n\t\t  <td class="amount">$14.95</td>\n\t\t</tr>\n\t\t<tr class="">\n\t\t  <td class="desc">Call Recording</td>\n\t\t  <td class="qty">4</td>\n          <td class="rate">6.95</td>\n\t\t  <td class="span small-text"></td>\n\t\t  <td class="amount">$27.80</td>\n\t\t</tr>\n\t\t<tr class="step-discount">\n\t\t  <td class="desc">Premium unlimited plan discount</td>\n\t\t  <td class="qty">1</td>\n          <td class="rate">-14.95</td>\n\t\t  <td class="span small-text"></td>\n\t\t  <td class="amount">$-14.95</td>\n\t\t</tr>\n        <tr class="">\n          <td colspan="4">Usage charges</td>\n          <td>$36.92</td>\n        </tr>\n        <tr class="">\n          <td colspan="4">Charges</td>\n          <td>$0.00</td>\n        </tr>\n        <tr class="last">\n          <td colspan="4">Refunds</td>\n          <td>$0.00</td>\n        </tr>\n        <tr class="total subtotal">\n          <td colspan="4">SUBTOTAL</td>\n          <td>$154.42</td>\n        </tr>\n\t\t<tr class="total">\n\t\t  <td colspan="4">VAT (17%)</td>\n\t\t  <td>$26.25</td>\n\t\t</tr>\n\x3c!--        <tr class="">\n          <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Local communications svc  tax </td>\n          <td>$14.82</td>\n        </tr>\n            <tr class="">\n          <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fl communications services tax </td>\n          <td>$21.20</td>\n        </tr>\n            <tr class="">\n          <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Federal trs fund </td>\n          <td>$1.02</td>\n        </tr>\n            <tr class="">\n          <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Federal universal service fund </td>\n          <td>$8.28</td>\n        </tr>\n            <tr class="last">\n          <td colspan="4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fl 911 surcharge </td>\n          <td>$2.00</td>\n        </tr>\n--\x3e\n        <tr class="grand-total">\n          <td colspan="4">GRAND TOTAL</td>\n          <td>$180.67</td>\n        </tr>\n      </tbody>\n      </table>\n    </div>\x3c!-- /.table table-default table-default-primary --\x3e\n  </div>\x3c!-- /.section-body --\x3e\n</div>\n'},283:function(e,t){e.exports='<div class="section section-invoice-details step-usage-details">\n\t<div class="section-head">\n\t\t<h2 class="section-title">Usage Details</h2>\x3c!-- /.section-title --\x3e\n\t</div>\x3c!-- /.section-head --\x3e\n\n\t<div class="section-body">\n\t\t<div class="table table-default">\n\t\t\t<table class="table-usage">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Date &amp; Time</th>\n\t\t\t\t\t\t<th>Type</th>\n\t\t\t\t\t\t<th>Rate</th>\n\t\t\t\t\t\t<th>Volume</th>\n\t\t\t\t\t\t<th>Amount</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>01/05/2017 08:34</td>\n\t\t\t\t\t\t<td>Incoming SMS</td>\n\t\t\t\t\t\t<td>Incoming SMS in Italy</td>\n\t\t\t\t\t\t<td>1</td>\n\t\t\t\t\t\t<td>$ 1.00</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>02/05/2017 10:05</td>\n\t\t\t\t\t\t<td>Outgoing SMS</td>\n\t\t\t\t\t\t<td>Domestic SMS</td>\n\t\t\t\t\t\t<td>1</td>\n\t\t\t\t\t\t<td>$ 0.24</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>02/05/2017 10:08</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>Domestic calls</td>\n\t\t\t\t\t\t<td>00:12:41</td>\n\t\t\t\t\t\t<td>$ 10.00</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>03/05/2017 12:15</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>Domestic calls</td>\n\t\t\t\t\t\t<td>00:04:56</td>\n\t\t\t\t\t\t<td>$ 3.50</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>05/05/2017 08:34</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>Domestic calls</td>\n\t\t\t\t\t\t<td>00:09:14</td>\n\t\t\t\t\t\t<td>$ 7.02</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>05/05/2017 10:05</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>Domestic calls</td>\n\t\t\t\t\t\t<td>00:08:11</td>\n\t\t\t\t\t\t<td>$ 6.24</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr class="step-products">\n\t\t\t\t\t\t<td>06/05/2017 12:07</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>International call to France</td>\n\t\t\t\t\t\t<td>00:07:33</td>\n\t\t\t\t\t\t<td>$ 8.42</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>06/05/2017 12:15</td>\n\t\t\t\t\t\t<td>Outgoing call</td>\n\t\t\t\t\t\t<td>Domestic calls</td>\n\t\t\t\t\t\t<td>00:00:53</td>\n\t\t\t\t\t\t<td>$ 0.50</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\x3c!-- /.table table-default --\x3e\n\t</div>\x3c!-- /.section-body --\x3e\n</div>\n'},300:function(e,t,n){e.exports=n(545)},441:function(e,t,n){e.exports=n.p+"static/media/footer-logo.1f38670a.png"},442:function(e,t,n){},443:function(e,t,n){},540:function(e,t,n){},541:function(e,t,n){},542:function(e,t,n){},543:function(e,t,n){},544:function(e,t,n){},545:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(30),o=n.n(i),l=n(10),s=n(21),c=n(4),u=n(5),p=n(8),d=n(6),m=n(7),g=n(2),f=n(1),h=function(e){var t=e.hide,n=e.progress,a=e.progressLabel,i=e.reversed,o=e.saveLabel,l=e.hideSave,s=e.disableSave,c=e.onClickSave,u=e.cancelLabel,p=e.hideCancel,d=e.disableCancel,m=e.onClickCancel;return t?null:r.a.createElement("div",{style:{marginTop:12}},!l&&r.a.createElement(f.c,{onClick:c,bsStyle:i?"default":"primary",disabled:n||s,style:{minWidth:90,marginRight:10}},n&&r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-spinner fa-pulse"}),"\xa0\xa0"),n&&null!==a?a:o),!p&&r.a.createElement(f.c,{onClick:m,bsStyle:i?"primary":"default",disabled:d,style:{minWidth:90}},u),e.children)};h.defaultProps={children:null,hide:!1,hideCancel:!1,hideSave:!1,progress:!1,disableSave:!1,disableCancel:!1,cancelLabel:"Cancel",saveLabel:"Save",progressLabel:null,reversed:!1,onClickCancel:function(){},onClickSave:function(){}};var v=h,y=n(252),b=function(e){var t=e.inputNew,n=e.inputOld,a=e.title,i=e.show,o=e.onClose,l=e.diffType,s=e.closeLabel;return r.a.createElement(f.r,{show:i,onHide:o},r.a.createElement(f.r.Header,{closeButton:!0},r.a.createElement(f.r.Title,null,a)),r.a.createElement(f.r.Body,null,r.a.createElement("pre",null,r.a.createElement(y.a,{inputA:n,inputB:t,type:l}))),r.a.createElement(f.r.Footer,null,r.a.createElement("div",{className:"push-left",style:{width:"50%",display:"inline-block"}},r.a.createElement("p",{className:"text-center",style:{backgroundColor:"salmon",marginBottom:5}}," Old value "),r.a.createElement("p",{className:"text-center",style:{backgroundColor:"lightgreen",marginBottom:5}}," New value ")),r.a.createElement("div",{className:"push-right",style:{width:"50%",display:"inline-block"}},r.a.createElement(f.c,{onClick:o},s))))};b.defaultProps={show:!0,closeLabel:"Close",diffType:"json",title:"Diff"};var E=b,C=function(e){return r.a.createElement("div",null,r.a.createElement("p",null,e.loadingLabel),e.onClick&&r.a.createElement(f.c,{onClick:e.onClick,bsStyle:"default"},e.buttonLabel))};C.defaultProps={buttonLabel:"Back",loadingLabel:"Loading..."};var _=C,O=n(16),S=n.n(O),T=n(11),k=n.n(T),j=function(e){var t=e.from,n=e.to,a=e.status,i="";if(a.length)i=k()("cycle",{expired:"expired"===a,future:"future"===a,active:"active"===a});else{var o=S()(t),l=S()(n);i=k()("cycle",{expired:l.isBefore(S()()),future:o.isAfter(S()()),active:!l.isBefore(S()())&&!o.isAfter(S()())})}return r.a.createElement("div",{className:i})};j.defaultProps={from:"",to:"",status:""};var I=j,w=n(40),N=n(17),F=n(24),x=n.n(F),R=n(253),M=n.n(R),P=n(254),A=n.n(P),D=n(20),L=n.n(D),U={datetimeFormat:"DD/MM/YYYY HH:mm",datetimeLongFormat:"DD/MM/YYYY HH:mm:ss",dateFormat:"DD/MM/YYYY",timeFormat:"HH:mm",apiDateFormat:"YYYY-MM-DD",apiDateTimeFormat:"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]",listDefaultItems:10,planCycleUnlimitedValue:"UNLIMITED",serviceCycleUnlimitedValue:"UNLIMITED",productUnlimitedValue:"UNLIMITED",fieldKeyRegex:/^[A-Za-z0-9._]*$/,keyUppercaseRegex:/^[A-Z0-9_]+$/,keyUppercaseCleanRegex:/[^A-Z|0-9_]/g,keyRegex:/^[A-Za-z0-9_]*$/,keyCleanRegex:/[^a-z|A-Z|0-9_]/g,defaultLogo:"billRun-cloud-logo.png",billrunCloudLogo:"billRun-cloud-logo.png",billrunLogo:"billRun-logo.png",queue_calculators:["customer","rate","pricing","tax"],logoMaxSize:2,importMaxSize:100,chargingBufferDays:5},V=n(255),B={entities:["usage","usage_archive","subscription","customer","logFile","queue","event","bills","paymentsTransactionsRequest","paymentsTransactionsResponse","paymentDenials","paymentsFiles"],fields:{usage:[{id:"urt",type:"datetime"},{id:"lastname"},{id:"firstname"},{id:"stamp"},{id:"in_group",type:"number"},{id:"full_price",type:"number",title:"Plan / Service Full Price"},{id:"name",type:"string",title:"Plan / Service key"},{id:"key",title:"Discount key"},{id:"aprice",type:"number"},{id:"final_charge",type:"number"},{id:"file"},{id:"billsec",type:"number"},{id:"sid",type:"number"},{id:"over_group",type:"number"},{id:"usagev",type:"number"},{id:"aid",type:"number"},{id:"process_time",type:"datetime"},{id:"in_queue",type:"boolean"},{id:"usagesb",type:"number"},{id:"type",title:"Input processor name / BillRun type",inputConfig:{inputType:"select",callback:"getFileTypeOptions",options:[{value:"flat",label:"Subscription"},"service",{value:"credit",label:"Charge / Refund"},"discount",{value:"conditional_charge",label:"Conditional Charges"},"all"]}},{id:"session_id",type:"string"},{id:"billrun_pretend",type:"boolean"},{id:"billrun_status",title:"Billing cycle status",aggregatable:!1,inputConfig:{inputType:"select",options:[{value:"current",label:"Current"},{value:"first_unconfirmed",label:"First Unconfirmed"},{value:"last_confirmed",label:"Last Confirmed"},{value:"confirmed",label:"Confirmed"}]}},{id:"arate_key",inputConfig:{inputType:"select",callback:"getProductsOptions"}},{id:"arategroup",inputConfig:{inputType:"select",callback:"getGroupsOptions"}},{id:"billrun",inputConfig:{inputType:"select",callback:"getCyclesOptions"}},{id:"plan",inputConfig:{inputType:"select",callback:"getPlansOptions"}},{id:"usaget",inputConfig:{inputType:"select",callback:"getUsageTypesOptions"}},{id:"pp_includes_name",inputConfig:{inputType:"select",callback:"getBucketsOptions"}},{id:"pp_includes_external_id",inputConfig:{inputType:"select",callback:"getBucketsExternalIdsOptions"}},{id:"charging_usaget",inputConfig:{inputType:"select",callback:"getUsageTypesOptions"}},{id:"balance_before",type:"number"},{id:"balance_after",type:"number"},{id:"balance_normalized",type:"number"},{id:"start",title:"Proration start date",type:"datetime"},{id:"end",title:"Proration end date",type:"datetime"},{id:"subscriber.play",title:"Subscriber Play",inputConfig:{inputType:"select",callback:"getPlayTypeOptions"}},{id:"tax_data.taxes.key",title:"Tax key",inputConfig:{inputType:"select",callback:"getTaxesOptions"}},{id:"tax_data.total_tax",type:"number",title:"Tax rate"},{id:"tax_data.total_amount",type:"number",title:"Total taxes"},{id:"tax_data.total_embedded_amount",type:"number",title:"Tax embedded amount"},{id:"installments",type:"number",title:"Number of installments"},{id:"installment_no",type:"number",title:"Current installment No."},{id:"first_installment",type:"string",title:"Installments batch identifier"}],usage_archive:[],subscribers:[{id:"aid",type:"number"},{id:"sid",type:"number"},{id:"plan",inputConfig:{inputType:"select",callback:"getPlansOptions"}},{id:"services",inputConfig:{inputType:"select",callback:"getServicesOptions"}},{id:"plan_activation",type:"date"},{id:"deactivation_date",type:"date"},{id:"play",inputConfig:{inputType:"select",callback:"getPlayTypeOptions"}}],account:[{id:"aid",type:"number"}],event:[{id:"extra_params.aid",type:"number"},{id:"extra_params.sid",type:"number"},{id:"before",type:"number"},{id:"after",type:"number"},{id:"event_type",inputConfig:{inputType:"select",options:["balance","fraud"]}},{id:"based_on",inputConfig:{inputType:"select",options:["usage","monetary"]}},{id:"event_code",inputConfig:{inputType:"select",callback:"getEventCodeOptions"}},{id:"creation_time",type:"datetime"},{id:"notify_time",type:"datetime"},{id:"stamp"},{id:"returned_value",searchable:!1}],logFile:[{id:"file_name",title:"File name"},{id:"stamp",title:"Unique record ID"},{id:"start_process_time",type:"date"},{id:"received_time",type:"date"},{id:"process_time",type:"date"},{id:"logfile_status",columnable:!1,title:"Status",inputConfig:{inputType:"select",options:[{value:"not_processed",label:"Received"},{value:"processing",label:"Processing"},{value:"processed",label:"Processed"},{value:"crashed",label:"Crashed"}]}},{id:"source",title:"Source",inputConfig:{inputType:"select",callback:"getFileTypeOptions"}}],paymentsTransactionsRequest:[{id:"fetching_time",type:"date"},{id:"received_time",type:"date"},{id:"start_process_time",type:"date"},{id:"process_time",type:"date"},{id:"file_name",title:"File name"},{id:"payment_gateway",inputConfig:{inputType:"select",options:[{value:"Credit_Card",label:"Credit Card"},{value:"Direct_Debit",label:"Direct Debit"},{value:"OVC",label:"OVC"}]},title:"Payment Gateway"},{id:"errors",title:"Errors"},{id:"warnings",title:"Warnings"},{id:"info",title:"Info"},{id:"transactions",title:"Transactions",type:"number"},{id:"parameters_string",title:"Parameter String"},{id:"correlation_value",title:"Correlation Value"},{id:"cpg_name",title:"Payment Gateway Name"},{id:"cpg_file_type",title:"Payment Gateway File Type"}],paymentsTransactionsResponse:[{id:"fetching_time",type:"date"},{id:"received_time",type:"date"},{id:"start_process_time",type:"date"},{id:"process_time",type:"date"},{id:"file_name",title:"File name"},{id:"payment_gateway",inputConfig:{inputType:"select",options:[{value:"Credit_Card",label:"Credit Card"},{value:"Direct_Debit",label:"Direct Debit"},{value:"OVC",label:"OVC"}]},title:"Payment Gateway"},{id:"errors",title:"Errors"},{id:"warnings",title:"Warnings"},{id:"info",title:"Info"},{id:"transactions.confirmed",title:"Confirmed Transactions",type:"number"},{id:"transactions.rejected",title:"Rejected Transactions",type:"number"},{id:"transactions.denied",title:"Denied Transactions",type:"number"},{id:"last_file",type:"boolean",title:"Last File"},{id:"file_count",title:"Files Count",type:"number"},{id:"related_request_file",title:"Related Request File"},{id:"total_denied_amount",title:"Total Denied Amount In The File"},{id:"total_confirmed_amount",title:"Total Confirmed Amount In The File"},{id:"total_rejected_amount",title:"Total Rejected Amount In The File"},{id:"cpg_name",title:"Payment Gateway Name"},{id:"cpg_file_type",title:"Payment Gateway File Type"}],paymentDenials:[{id:"fetching_time",type:"date"},{id:"received_time",type:"date"},{id:"start_process_time",type:"date"},{id:"process_time",type:"date"},{id:"file_name",title:"File name"},{id:"payment_gateway",inputConfig:{inputType:"select",options:[{value:"Credit_Card",label:"Credit Card"},{value:"Direct_Debit",label:"Direct Debit"},{value:"OVC",label:"OVC"}]},title:"Payment Gateway"},{id:"errors",title:"Errors"},{id:"warnings",title:"Warnings"},{id:"info",title:"Info"},{id:"transactions.confirmed",title:"Confirmed Transactions",type:"number"},{id:"transactions.rejected",title:"Rejected Transactions",type:"number"},{id:"transactions.denied",title:"Denied Transactions",type:"number"},{id:"last_file",type:"boolean",title:"Last File"},{id:"file_count",title:"Files Count",type:"number"},{id:"related_request_file",title:"Related Request File"},{id:"total_denied_amount",title:"Total Denied Amount In The File"},{id:"total_confirmed_amount",title:"Total Confirmed Amount In The File"},{id:"total_rejected_amount",title:"Total Rejected Amount In The File"},{id:"cpg_name",title:"Payment Gateway Name"},{id:"cpg_file_type",title:"Payment Gateway File Type"}],paymentsFiles:[{id:"fetching_time",type:"date"},{id:"received_time",type:"date"},{id:"start_process_time",type:"date"},{id:"process_time",type:"date"},{id:"file_name",title:"File name"},{id:"payment_gateway",inputConfig:{inputType:"select",options:[{value:"Credit_Card",label:"Credit Card"},{value:"Direct_Debit",label:"Direct Debit"},{value:"OVC",label:"OVC"}]},title:"Payment Gateway"},{id:"errors",title:"Errors"},{id:"warnings",title:"Warnings"},{id:"info",title:"Info"},{id:"transactions.confirmed",title:"Confirmed Transactions",type:"number"},{id:"transactions.rejected",title:"Rejected Transactions",type:"number"},{id:"transactions.denied",title:"Denied Transactions",type:"number"},{id:"last_file",type:"boolean",title:"Last File"},{id:"file_count",title:"Files Count",type:"number"},{id:"related_request_file",title:"Related Request File"},{id:"total_denied_amount",title:"Total Denied Amount In The File"},{id:"total_confirmed_amount",title:"Total Confirmed Amount In The File"},{id:"total_rejected_amount",title:"Total Rejected Amount In The File"},{id:"cpg_name",title:"Payment Gateway Name"},{id:"cpg_file_type",title:"Payment Gateway File Type"}],queue:[{id:"calc_name",title:"Calculator Name",inputConfig:{inputType:"select",callback:"getCalcNameOptions"}},{id:"in_queue_since",type:"date"}],bills:[{id:"type",inputConfig:{inputType:"select",options:[{value:"inv",label:"Invoice"},{value:"rec",label:"Payment / Transaction"}]},title:"Type"},{id:"cancelled",type:"boolean",title:"Cancelled Payment?"},{id:"cancel",type:"string",title:"Cancelled BillRun Transaction ID"},{id:"cancellation",type:"boolean",title:"Cancellation Transaction?"},{id:"rejected",type:"boolean",title:"Rejected Payment?"},{id:"rejection",type:"boolean",title:"Rejection Transaction?"},{id:"aid",type:"number",title:"Customer ID"},{id:"invoice_id",type:"number",title:"Invoice ID"},{id:"due_date",type:"date",title:"Due Date"},{id:"due",type:"number",title:"Original Due Amount"},{id:"payer_name",type:"string",title:"Payer Name"},{id:"amount",type:"number",title:"Original Absolute Due Amount"},{id:"lastname",type:"string",title:"Customer's Last Name"},{id:"firstname",type:"string",title:"Customer's First Name"},{id:"payment_method",type:"string",title:"Payment Method"},{id:"urt",type:"date",title:"Creation Time"},{id:"invoice_date",type:"date",title:"Invoice Date"},{id:"total_paid",type:"number",title:"Total Paid Amount"},{id:"left_to_pay",type:"number",title:"Bill Unpaid Amount"},{id:"vatable_left_to_pay",type:"number",title:"Bill Vatable Left Amount"},{id:"waiting_payments",type:"number",title:"Pending BillRun's Transaction ID"},{id:"paid",inputConfig:{inputType:"select",options:[{value:"0",label:"Unpaid"},{value:"1",label:"Paid"},{value:"2",label:"Awaiting Payment"}]},title:"Status"},{id:"payment_gateway.name",inputConfig:{inputType:"select",options:[{value:"CreditGuard",label:"CreditGuard"}]},title:"Payment Gateway"},{id:"dir",inputConfig:{inputType:"select",options:[{value:"fc",label:"From Customer"},{value:"tc",label:"To Customer"}]},title:"Direction"},{id:"gateway_details.four_digits",type:"string",title:"Last 4 Digits"},{id:"left",type:"number",title:"Bill Reserved Amount"},{id:"waiting_for_confirmation",type:"boolean",title:"Waiting For Confirmation?"},{id:"txid",type:"string",title:"BillRun Transaction ID"},{id:"vendor_response.status",type:"string",title:"Vendor Response Status"},{id:"last_checked_pending",type:"date",title:"Last Status Check"},{id:"original_txid",type:"string",title:"Original BillRun Transaction ID"},{id:"rejection_code",type:"string",title:"Rejection Code"},{id:"denial.transaction_date",type:"datetime",title:"Denied Transaction Date"},{id:"denied_amount",type:"number",title:"Denied Amount"},{id:"denial.is_payments",type:"boolean",title:"Is Denied Payments"},{id:"denial.credit_date",type:"datetime",title:"Denial Credit Date"},{id:"denial.credit_date",type:"string",title:"Card Type"},{id:"is_denial",type:"boolean",title:"Is denial?"},{id:"installments.total_amount",type:"number",title:"Payment Gateway Installments - Total Amount"},{id:"installments.number_of_payments",type:"number",title:"Payment Gateway Number Of Installments"},{id:"installments.first_payment",type:"number",title:"Payment Gateway Installments - First Payment Amount"},{id:"installments.periodical_payments",type:"number",title:"Payment Gateway Installments - Periodical Payment Amount"},{id:"payment_agreement.id",type:"number",title:"Payments Agreement Identifier"},{id:"payment_agreement.installment_index",type:"number",title:"Payments Agreement Current Installment Index"},{id:"payment_agreement.installments_num",type:"number",title:"Payments Agreement - Number of installments"},{id:"payment_agreement.total_amount",type:"number",title:"Payments Agreement Total Amount"},{id:"payment_agreement.first_due_date",type:"datetime",title:"Payments Agreement Current Installment Due Date"},{id:"generated_pg_file_log",type:"string",title:"Payment Gateway File ID"}]},conditionsOperators:[{id:"last_days",title:"Last (days)",include:["fieldid:urt"],type:"number",suffix:"Days"},{id:"last_days_include_today",title:"Last (days including today)",include:["fieldid:urt"],type:"number",suffix:"Days"},{id:"last_hours",title:"Last (hours)",include:["fieldid:urt"],type:"number",suffix:"Hours"},{id:"eq",title:"Equals",include:["date","datetime","boolean","fieldid:billrun_status","fieldid:logfile_status"]},{id:"in",title:"Equals",include:["string","number"],exclude:["fieldid:billrun_status","fieldid:logfile_status","fieldid:errors","fieldid:warnings","fieldid:info"]},{id:"ne",title:"Does not equal",include:["boolean"],exclude:[]},{id:"nin",title:"Does not equal",include:["string","number"],exclude:["fieldid:billrun_status","fieldid:logfile_status","fieldid:errors","fieldid:warnings","fieldid:info"]},{id:"lt",title:"<",include:["number","date","datetime","fieldid:billrun"],exclude:[]},{id:"lte",title:"<=",include:["number","date","datetime","fieldid:billrun"],exclude:[]},{id:"gt",title:">",include:["number","date","datetime","fieldid:billrun"],exclude:[]},{id:"gte",title:">=",include:["number","date","datetime","fieldid:billrun"],exclude:[]},{id:"like",title:"Contains",include:["string","number"],exclude:["fieldid:logfile_status","fieldid:errors","fieldid:warnings","fieldid:info","fieldid:subscriber.play"]},{id:"starts_with",title:"Starts with",include:["string"],exclude:["fieldid:logfile_status","fieldid:errors","fieldid:warnings","fieldid:info","fieldid:subscriber.play"]},{id:"ends_with",title:"Ends with",include:["string"],exclude:["fieldid:logfile_status","fieldid:errors","fieldid:warnings","fieldid:info","fieldid:subscriber.play"]},{id:"in_range",title:"Include\u200e",include:["ranges","range","daterange"]},{id:"nin_range",title:"Does not include\u200e",include:["ranges","range","daterange"]},{id:"exists",title:"Exists",type:"boolean",include:["string","number","boolean","date","datetime","ranges","range","daterange"],exclude:["fieldid:billrun_status","fieldid:logfile_status","fieldid:subscriber.play"],options:["yes","no"]}],aggregateOperators:[{id:"group",title:"Group",include:["string","number","boolean","date"],exclude:["fieldid:count_group","fieldid:tax_data.total_amount","fieldid:errors","fieldid:warnings","fieldid:info"]},{id:"sum",title:"Sum",include:["number"],exclude:["fieldid:count_group","fieldid:tax_data.total_tax","fieldid:errors","fieldid:warnings","fieldid:info"]},{id:"avg",title:"Average",include:["number"],exclude:["fieldid:count_group","fieldid:tax_data.total_tax","fieldid:errors","fieldid:warnings","fieldid:info"]},{id:"first",title:"First",include:["string","number","boolean","date","ranges","range"],exclude:["fieldid:count_group"]},{id:"last",title:"Last",include:["string","number","boolean","date","ranges","range"],exclude:["fieldid:count_group"]},{id:"max",title:"Max",include:["number","date"],exclude:["fieldid:count_group","fieldid:errors","fieldid:warnings","fieldid:info"]},{id:"min",title:"Min",include:["number","date"],exclude:["fieldid:count_group","fieldid:errors","fieldid:warnings","fieldid:info"]},{id:"push",title:"List",include:["string","number","boolean","date"],exclude:["fieldid:count_group"]},{id:"addToSet",title:"Unique List",include:["string","number","boolean","date","ranges","range"],exclude:["fieldid:count_group"]},{id:"count",title:"Count",include:["fieldid:count_group","fieldid:errors","fieldid:warnings","fieldid:info"]}],outputFormats:[{id:"date_format",title:"Date",options:[{value:"d/m/Y",label:"31/12/2017"},{value:"m/d/Y",label:"12/31/2017"},{value:"Y-m-d",label:"2017-12-31"}]},{id:"datetime_format",title:"Date time",options:[{value:"d/m/Y H:i",label:"31/12/2017 22:05"},{value:"d/m/Y H:i:s",label:"31/12/2017 22:05:59"},{value:"m/d/Y h:i A",label:"12/31/2017 10:05 PM"},{value:"m/d/Y h:i:s A",label:"12/31/2017 10:05:59 PM"},{value:"c",label:"ISO 8601"}]},{id:"date_override",title:"Subtract / Add time",type:"number",valueTypes:[{value:"seconds",label:"Seconds"},{value:"minutes",label:"Minutes"},{value:"hours",label:"Hours"},{value:"days",label:"Days"},{value:"weeks",label:"Weeks"},{value:"months",label:"Months"},{value:"years",label:"Years"}]},{id:"time_format",title:"Time",options:[{value:"H:i",label:"22:05"},{value:"H:i:s",label:"22:05:59"},{value:"h:i A",label:"10:05 PM"},{value:"h:i:s A",label:"10:05:59 PM"}]},{id:"multiplication",title:"Multiply by a number"},{id:"default_empty",title:"Default Value",addOption:!0,options:[{value:"current_time",label:"Current Time"},{value:"current_start",label:"Current Billing Cycle Start"},{value:"current_end",label:"Current Billing Cycle End"},{value:"first_unconfirmed_start",label:"First Unconfirmed Billing Cycle Start"},{value:"first_unconfirmed_end",label:"First Unconfirmed Cycle End"},{value:"last_confirmed_start",label:"Last Confirmed Billing Cycle Start"},{value:"last_confirmed_end",label:"Last Confirmed Billing Cycle End"}]},{id:"vat_format",title:"Vat",options:[{value:"add_tax",label:"Add Vat"},{value:"remove_tax",label:"Remove Vat"}]},{id:"currency_format",title:"Currency",options:[{value:"suffix",label:"1234$"},{value:"prefix",label:"$1234"}]},{id:"billing_cycle",title:"Billing cycle",options:[{value:"start",label:"Start Date"},{value:"end",label:"End Date"}]}]},q=n(256),z=n(257),H=n(258),Y=n(259),G=n(260),K=n(261),W=n(262),J=n(263),$=n(264),Q=n(265),Z=n(266),X=g.c.Map(),ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Array.isArray(e)?e:[e];if(X.isEmpty()&&(X=g.c.fromJS(U)),!X.has(n[0]))switch(n[0]){case"env":var a=g.c.Map().withMutations(function(e){Object.entries(Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_serverApiUrl:"",REACT_APP_storageVersion:"2.2.0",REACT_APP_serverApiVersion:"5.14-beta1-epiccyic-1.0.0",REACT_APP_exportVersion:"v1",REACT_APP_serverApiTimeOut:"300000",REACT_APP_mailSupport:"cloud_support@billrun.com",REACT_APP_billrunCloudLogo:"billRun-cloud-logo.png",REACT_APP_billrunLogo:"billRun-logo.png"})).forEach(function(t){if(t[0].startsWith("REACT_APP_")){var n=t[0].replace("REACT_APP_",""),a=t[1];"true"===t[1]?a=!0:"false"===t[1]?a=!1:x()(a)&&(a=parseFloat(a)),e.set(n,a)}})});X=X.set("env",a);break;case"reports":X=X.set("reports",g.c.fromJS(B));break;case"fieldNames":X=X.set("fieldNames",g.c.fromJS(V));break;case"systemItems":X=X.set("systemItems",g.c.fromJS(q));break;case"mainMenu":X=X.set("mainMenu",g.c.fromJS(z));break;case"events":X=X.set("events",g.c.fromJS(H));break;case"rates":X=X.set("rates",g.c.fromJS(Y));break;case"import":X=X.set("import",g.c.fromJS(G));break;case"export":X=X.set("export",g.c.fromJS(K));break;case"collections":X=X.set("collections",g.c.fromJS(W));break;case"customFields":X=X.set("customFields",g.c.fromJS(J));break;case"discount":X=X.set("discount",g.c.fromJS($));break;case"exportGenerator":X=X.set("exportGenerator",g.c.fromJS(Z));break;case"conditions":X=X.set("conditions",g.c.fromJS(Q));break;default:console.log("Config category not exists ".concat(n))}return X.getIn(n,t)},te=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=ee(["fieldNames",t,e],!1);if("string"===typeof a&&a.length>0)return a;var r=ee(["fieldNames",e],!1);return"string"===typeof r&&r.length>0?r:null!==n?n:e},ne=function(e){switch(e.toLocaleLowerCase()){case"account":case"accounts":case"customer":return"account";case"subscription":case"subscriptions":case"subscribers":case"subscriber":return"subscription";case"lines":case"line":case"usage":return"lines";case"service":case"services":return"service";case"plan":case"plans":return"plan";case"rate":case"rates":case"product":case"products":return"product";default:return e}},ae=function(e){switch(e.toLocaleLowerCase()){case"account":case"accounts":case"customer":return"customer";case"lines":case"line":case"usage":return"usage";default:return ne(e)}},re=function(e){return e.get("first_name",e.get("firstname",""))},ie=function(e){return e.get("last_name",e.get("lastname",""))},oe=function(e){return e.get("aid","")},le=function(e){return e.get("sid","")},se=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.Map();switch(e){case"clone":case"create":var a=ee(["systemItems",t]);return a?"Create New ".concat(Object(D.titleCase)(a.get("itemName",a.get("itemType","")))):"Create";case"loading":case"closeandnew":var r=ee(["systemItems",t]);return r?"customer"===t?"Edit ".concat(Object(D.titleCase)(r.get("itemName",r.get("itemType","")))," - ").concat(re(n)," ").concat(ie(n)," [").concat(oe(n),"]"):"subscription"===t?"Edit ".concat(Object(D.titleCase)(r.get("itemName",r.get("itemType","")))," - ").concat(re(n)," ").concat(ie(n)," [").concat(le(n),"]"):"auto_renew"===t?"Edit ".concat(Object(D.titleCase)(r.get("itemName",r.get("itemType","")))):"Edit ".concat(Object(D.titleCase)(r.get("itemName",r.get("itemType","")))," - ").concat(n.get(r.get("uniqueField",""),"")):"Edit";case"view":var i=ee(["systemItems",t]);return i?"customer"===t?"".concat(Object(D.titleCase)(i.get("itemName",i.get("itemType","")))," - ").concat(re(n)," ").concat(ie(n)," [").concat(oe(n),"]"):"subscription"===t?"".concat(Object(D.titleCase)(i.get("itemName",i.get("itemType","")))," - ").concat(re(n)," ").concat(ie(n)," [").concat(le(n),"]"):"".concat(Object(D.titleCase)(i.get("itemName",i.get("itemType","")))," - ").concat(n.get(i.get("uniqueField",""),"")):"View";case"update":var o=ee(["systemItems",t]);return o?"customer"===t?"Update ".concat(Object(D.titleCase)(o.get("itemName",o.get("itemType","")))," - ").concat(re(n)," ").concat(ie(n)," [").concat(oe(n),"]"):"subscription"===t?"Update ".concat(Object(D.titleCase)(o.get("itemName",o.get("itemType","")))," - ").concat(re(n)," ").concat(ie(n)," [").concat(le(n),"]"):"Update ".concat(Object(D.titleCase)(o.get("itemName",o.get("itemType","")))," - ").concat(n.get(o.get("uniqueField",""),"")):"Update";default:return""}},ce=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S()();if(g.c.Map.isMap(e)){var a=e.get(t,!1);if("string"===typeof a){var r=S()(a);if(r.isValid())return r}var i=e.getIn([t,"sec"],!1);if("number"===typeof i){var o=S.a.unix(i);if(o.isValid())return o}}return n},ue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return g.c.Map.isMap(e)?e.getIn(["_id","$id"],t):t},pe=function(e){var t=e.getIn(["revision_info","early_expiration"],null);if(null!==t)return t;var n=ce(e,"to");return n.isAfter(S()())&&n.isBefore(S()().add(50,"years"))},de=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"to",n=ce(e,t);return n.isBefore(S()().add(50,"years"))},me=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"create";if(g.c.Map.isMap(e)){if(null===ue(e,null))return"create";var n=e.getIn(["revision_info","status"],""),a=e.getIn(["revision_info","is_last"],!0);return["expired"].includes(n)||"active"===n&&!a?"view":["future"].includes(n)||pe(e)?"update":"closeandnew"}return t},ge=function(e,t){return t&&ue(e,!1)?S.a.max(t,ce(e,"originalValue",ce(e,"from",S()(0)))):ue(e,!1)?ce(e,"originalValue",ce(e,"from",S()(0))):t||void 0},fe=function(e){return g.c.Map.isMap(e)?{value:e.get("value",""),label:e.get("label","")}:{value:e,label:Object(D.sentenceCase)(e)}},he=function(e){return fe(e.has("title")?g.c.Map({value:e.get("id"),label:e.get("title")}):e.get("id"))},ve=function(e){return fe(g.c.Map({value:e.get("field_name"),label:e.get("title",e.get("field_name"),"")}))},ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("unique",!1)&&!e.get("generated",!1)&&e.get("editable",!0)},be=function(e,t,n,a,r,i,o){var l=""===a?"":t.find(function(e){return e.get("id")===a},null,g.c.Map({title:i})).get("title",""),s=a===i?l:t.find(function(e){return e.get("id")===i},null,g.c.Map({title:i})).get("title",""),c=""===r?"":n.find(function(e){return e.get("id")===r},null,g.c.Map()).get("title",""),u=r===o?c:n.find(function(e){return e.get("id")===o},null,g.c.Map()).get("title",""),p=""===c||"group"===r?l:"".concat(l," (").concat(c,")");return""===e||e===p?""===u||"group"===o?s:"".concat(s," (").concat(u,")"):e},Ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=ee(["systemItems",ae(e),"settingsKey"],e);return t?n.split("."):n},Ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=Ee(e,!0),r=n.length>0?[].concat(Object(N.a)(a),Object(N.a)(n)):a;return t?r:r.join(".")},_e=function(e,t){return e.find(function(e){return e.get("key","")===t})||g.c.Map()},Oe=function(e){return e.get("rates",g.c.Map()).keySeq().first()||""},Se=function(e,t){return e.getIn(["rates",t,"BASE","rate",0,"uom_display","range"],"")},Te=function(e,t,n){var a=t.find(function(e){return e.get("usage_type","")===n})||g.c.Map();return(e.find(function(e){return e.get("type","")===a.get("property_type","")})||g.c.Map()).get("uom",g.c.List())},ke=function(e,t){return(e.find(function(e){return e.get("usage_type","")===t})||g.c.Map()).get("property_type","")},je=function(e,t,n,a){return(Te(e,t,n).find(function(e){return e.get("name","")===a})||g.c.Map()).get("label","")},Ie=function(e,t,n,a,r){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if("UNLIMITED"===r)return"UNLIMITED";var o=Te(e,t,n),l=(o.find(function(e){return e.get("name","")===a})||g.c.Map()).get("unit",1);return r.toString().split(",").map(function(e){return i?e*l:e/l}).join()},we=function(e,t,n,a,r){var i=n.get("rates",g.c.Map()).withMutations(function(n){n.forEach(function(i,o){i.forEach(function(i,l){var s="product"===r?o:l,c="product"===r?l:o;i.get("rate",g.c.List()).forEach(function(i,o){var l=i.getIn(["uom_display","range"],"counter"),u=i.getIn(["uom_display","interval"],"counter"),p=Ie(e,t,s,l,i.get("from"),a),d=x()(p)?parseFloat(p):p,m=i.get("to"),g="UNLIMITED"===m?"UNLIMITED":Ie(e,t,s,l,m,a),f=x()(g)?parseFloat(g):g,h=i.get("price"),v=x()(h)?parseFloat(h):h,y=Ie(e,t,s,u,i.get("interval"),a),b=x()(y)?parseFloat(y):y,E="product"===r?[s,c,"rate",o]:[c,s,"rate",o];n.setIn([].concat(E,["from"]),d),n.setIn([].concat(E,["to"]),f),n.setIn([].concat(E,["price"]),v),n.setIn([].concat(E,["interval"]),b)});var u=i.get("percentage",null);if(null!==u){var p="product"===r?[s,c]:[c,s],d=a?u/100:100*u;n.setIn([].concat(p,["percentage"]),d)}})})});return i.isEmpty()?g.c.Map():i},Ne=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return we(e,t,n,a,"product")},Fe=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return we(e,t,n,a,"plan")},xe=function(e){return!1!==e.get("cost",!1)?"cost":e.get("usage_types",g.c.Map()).keySeq().get(0,!1)},Re=function(e){return!1!==e.get("cost",!1)?"cost":g.c.List(e.get("usage_types",g.c.Map()).keySeq().toArray())},Me=function(e){return"cost"===xe(e)},Pe=function(e){return Me(e)?e.get("cost",""):e.get("value","")},Ae=function(e){return Me(e)?g.c.List(["cost"]):g.c.List(e.get("usage_types",g.c.Map()).keySeq().toArray())},De=function(e){return Me(e)?"cost":e.get("usage_types",g.c.Map()).valueSeq().get(0,g.c.Map()).get("unit",!1)},Le=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=n.get("include",g.c.Map()).withMutations(function(n){n.get("groups",g.c.Map()).forEach(function(r,i){var o=De(r),l=xe(r);if(o&&l&&!Me(r)){var s=Pe(r),c=Ie(e,t,l,o,s,a),u="UNLIMITED"===c?c:parseFloat(c);n.setIn(["groups",i,"value"],u)}})});return r.isEmpty()?g.c.Map():r},Ue=function(e){if(["","default"].includes(e.get("balance_period","default")))return{type:"default",unit:"",value:""};var t=e.get("balance_period","").split(" "),n=t[t.length-1],a=Number(t[t.length-2]);return{type:"custom_period",unit:n,value:"days"===n?a+1:a}},Ve=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.get("fields",g.c.List()).map(function(e){return g.c.Map({value:e,label:e})}).sortBy(function(e){return e.get("value","")}),a=e.getIn(["processor","calculated_fields"],g.c.List()).map(function(e){return e.get("target_field","")}).map(function(e){return g.c.Map({value:e,label:"".concat(e," (Computed)")})}).sortBy(function(e){return e.get("value","")});return g.c.List([].concat(Object(N.a)(n),Object(N.a)(a),Object(N.a)(g.c.fromJS(t))))},Be=function(e){return e.toString().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},qe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.reduce(function(e,t,n){return"".concat(e,".").concat(n,".").concat(t)},"rates")},ze=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"field_name";if(e.has("title"))return e;var a=ne(!t&&e.has("entity")?e.get("entity"):t),r=e.get(n,""),i=Object(D.sentenceCase)(e.get(n,""));return e.set("title",te(r,a,i))},He=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map(),n=e.get("plays",g.c.List());if(!n.isEmpty()){var a=n.reduce(function(e,n){return e.push(t.get(n,n))},g.c.List()).join(", ");return e.set("title","".concat(e.get("title","")," (").concat(a,")"))}return e},Ye=function(e){return[void 0,null,""].includes(e)?g.c.List():Array.isArray(e)?g.c.List(Object(N.a)(e)):g.c.Iterable.isIterable(e)?e.toList():g.c.List([e])},Ge=function(e,t){var n=e.get("title","").toUpperCase(),a=t.get("title","").toUpperCase();return n<a?-1:n>a?1:0},Ke=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"exclude",a=e.get(n,g.c.List());return!a.isEmpty()&&a.includes(t)},We=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"include",a=e.get(n,g.c.List());return!!a.isEmpty()||a.includes(t)},Je=function(e){return e.has("foreign")},$e=function(e){return"unixTimeToString"!==e.getIn(["foreign","translate","type"],"")},Qe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!t)return!1;var a=e.get("changeable_props",null);return null===a?!e.get("system",!1):""===n?!a.isEmpty():a.includes(n)},Ze=function(e){return e.map(function(e){return{value:e.get("name",""),label:e.get("label",e.get("name",""))}}).toArray()},Xe=function(e){if("string"!==typeof e||""===e)return{suffix:"",prefix:"",number:""};var t={minutes:"minutes",minute:"minutes",hours:"hours",hour:"hours",days:"days",day:"days",weeks:"weeks",week:"weeks",months:"months",month:"months",years:"years",year:"years"},n=M()(e.toLocaleLowerCase(),["+","-"," "]),a=Object(w.a)(n,2),r=a[0],i=a[1],o=A()(r,Object.keys(t)),l=Object(w.a)(o,2),s=l[0],c=l[1];return{prefix:i,number:x()(s)?Math.abs(parseFloat(s)):"",suffix:t[c]||""}},et=function(e){var t=ee(e,g.c.List());return tt(t)},tt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=ee(["conditions","operators"],g.c.List());return g.c.List().withMutations(function(n){e.forEach(function(e){var a=t.find(function(t){return t.get("id","")===e.get("id","")},null,null);null===a?n.push(e):n.push(a.merge(e))})})},nt=function(e){var t=e.revisions,n=e.size,a=e.item,i=e.start,o=e.itemName,l=g.c.List().withMutations(function(e){var n=g.c.Map();t.forEach(function(t){var a=g.c.Map({closed:!0,to:t.get("to","")});(pe(t)||function(e,t){var n=ce(e,"from",!1),a=ce(t,"to",!1);return!(!n||!a)&&n.isAfter(a.add(1,"days"))}(n,t))&&e.push(a),e.push(t),n=t})}).reverse(),s=null!==i?i:l.findIndex(function(e){return ue(e)===ue(a)}),c=Math.floor((n-1)/2),u=Math.max(s-c,0),p=u+n;p>=l.size&&(p=l.size,u=Math.max(p-n,0));var d=l.size>n&&p<l.size,m=l.size>n&&u>0,f=function(e){return r.a.createElement("li",{key:"".concat(ue(a,""),"-more-").concat(e),className:"more ".concat(e)},r.a.createElement("div",{style:{height:"22px"}},"\xa0"),r.a.createElement("div",null,r.a.createElement("div",null,"\xa0"),r.a.createElement("div",null,"\xa0")))};return r.a.createElement("ul",{className:"revision-history-list"},m&&f("before"),l.slice(u,p).map(function(e,t,n){if(e.get("closed",!1))return function(e){var t=ce(e,"to");return r.a.createElement("li",{key:"".concat(ue(e,""),"-closed"),className:"closed"},r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("i",{style:{fontSize:19},className:"fa fa-times-circle"})),r.a.createElement("small",{className:"date"},t.format("MMM DD"),r.a.createElement("br",null),t.format("YYYY"))))}(e);var i=ce(e,"from"),l=ue(e,"")===ue(a,""),s=k()("revision",{active:l,first:0===t,last:t===n.size-1});return r.a.createElement("li",{key:"".concat(ue(e,"")),className:s},r.a.createElement("div",null,r.a.createElement("div",null,l?r.a.createElement(I,{status:e.getIn(["revision_info","status"],"")}):r.a.createElement(kt,{item:e,itemName:o,type:"edit"},r.a.createElement(I,{status:e.getIn(["revision_info","status"],"")}))),r.a.createElement("small",{className:"date"},i.format("MMM DD"),r.a.createElement("br",null),i.format("YYYY"))))}),d&&f("after"))};nt.defaultProps={revisions:g.c.List(),item:g.c.Map(),itemName:"",size:5,start:null};var at=nt,rt=function(e){return r.a.createElement(f.r,{show:e.show,bsSize:e.modalSize},r.a.createElement(f.r.Header,{closeButton:null!==e.onHide,onHide:e.onHide},r.a.createElement(f.r.Title,null,e.title)),r.a.createElement(f.r.Body,null,e.children),(e.onCancel||e.onOk&&e.showOnOk)&&r.a.createElement(f.r.Footer,null,e.onCancel&&r.a.createElement(f.c,{bsSize:"small",style:{minWidth:90},onClick:e.onCancel,bsStyle:e.styleCancel},e.labelCancel),e.onOk&&e.showOnOk&&r.a.createElement(f.c,{bsSize:"small",style:{minWidth:90},onClick:e.onOk,bsStyle:e.styleOk,disabled:e.progress},e.progress&&r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-spinner fa-pulse"}),"\xa0\xa0"),e.progress&&null!==e.labelProgress?e.labelProgress:e.labelOk)))};rt.defaultProps={children:null,title:"",show:!1,progress:!1,labelOk:"OK",labelCancel:"Cancel",labelProgress:null,modalSize:void 0,onHide:null,onOk:null,showOnOk:!0,onCancel:null,styleOk:"primary",styleCancel:void 0};var it=rt,ot=function(e){return r.a.createElement(f.r,{show:e.show},r.a.createElement(f.r.Header,{closeButton:!1},r.a.createElement(f.r.Title,null,e.message)),e.children&&r.a.createElement(f.r.Body,null,e.children),r.a.createElement(f.r.Footer,null,"alert"!==e.type&&r.a.createElement(f.c,{bsSize:"small",style:{minWidth:90,marginRight:5},onClick:e.onCancel},e.labelCancel),r.a.createElement(f.c,{bsSize:"small",style:{minWidth:90},onClick:e.onOk,bsStyle:"delete"===e.type?"danger":"primary"},e.labelOk)))};ot.defaultProps={show:!1,type:"confirm",children:null,labelCancel:"Cancel",labelOk:"Ok",onCancel:null};var lt=ot,st=function(e){var t=e.label,n=e.onClick,i=e.type,o=e.action,l=e.disabled,s=e.title,c=e.data,u=e.buttonStyle,p=Object(a.useCallback)(function(){return n(c)},[n,c]);return r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:p,style:u,disabled:l,title:s},r.a.createElement("i",{className:"fa fa-plus"}),o.length>0&&" ".concat(o),t.length>0&&" ".concat(t),i.length>0&&" ".concat(i))};st.defaultProps={label:"New",action:"",type:"",title:"",data:null,disabled:!1,buttonStyle:{marginTop:15},onClick:function(){}};var ct=Object(a.memo)(st),ut={height:0,width:0,overflow:"hidden",display:"inline-block"},pt=function(e){var t=e.label,n=e.onClick,a=e.fileType,i=e.multiple,o=e.disabled,l=e.buttonStyle,s=e.buttonSize,c=k()("custom-file-upload","btn","full-width",{"btn-xs":"xsmall"===s,"btn-sm":"small"===s,"btn-lg":"large"===s,"btn-primary":"primary"===l,"btn-success":"success"===l,"btn-info":"info"===l,"btn-warning":"warning"===l,"btn-danger":"danger"===l,"btn-link":"link"===l,"btn-default":"default"===l});return r.a.createElement("label",{className:c},r.a.createElement("input",{type:"file",accept:a,onChange:n,multiple:i,disabled:o,style:ut}),r.a.createElement("i",{className:"fa fa-plus"})," ",t)};pt.defaultProps={label:"Add File",action:"",fileType:".csv",multiple:!0,disabled:!1,buttonStyle:"primary",buttonSize:void 0,onClick:function(){}};var dt=Object(a.memo)(pt),mt=n(27),gt=function(e){var t=e.type,n=e.label,i=e.data,o=e.actionStyle,l=e.showIcon,s=e.actionSize,c=e.actionClass,u=e.show,p=e.enable,d=e.helpText,m=e.renderFunc,g=e.onClick,h=e.index,v=e.isDropdown,y=Object(mt.a)(e,["type","label","data","actionStyle","showIcon","actionSize","actionClass","show","enable","helpText","renderFunc","onClick","index","isDropdown"]),b=Object(a.useMemo)(function(){return"boolean"===typeof u&&u||"function"===typeof u&&u(i,t)},[u,i,t]),E=Object(a.useMemo)(function(){return"function"===typeof p?p(i,t):p},[p,i,t]),C=Object(a.useMemo)(function(){return"string"===typeof d?d:d(i,t)},[d,i,t]),_=Object(a.useMemo)(function(){return null!==m&&"function"===typeof m},[m]),O=Object(a.useCallback)(function(){g(i,t)},[g,i,t]),S=Object(a.useMemo)(function(){return k()("fa fa-fw",{"fa-list-alt":"report"===t,"fa-eye":"view"===t,"fa-pencil":"edit"===t,"fa-files-o":"clone"===t,"fa-file-excel-o":["export_csv","export"].includes(t),"danger-red":["enable","remove"].includes(t),"fa-trash-o":"remove"===t,"fa-toggle-off":"enable"===t,"fa-toggle-on":"disable"===t,"fa-plus":["add","expand"].includes(t),"fa-calendar":"move"===t,"fa-repeat":"reopen"===t,"fa-cloud-upload":"import"===t,"fa-refresh":"refresh"===t,"fa-arrow-left":"back"===t,"fa-minus":"collapse"===t,"fa-cog":"settings"===t})},[t]);if(!b)return null;if(v){var T=y.onKeyDown,j=y.onSelect;return r.a.createElement(f.q,{eventKey:h,onKeyDown:T,onSelect:j,onClick:O,disabled:!E,bsStyle:"default"===o?void 0:o,bsSize:s,className:c},l&&r.a.createElement("i",{className:S}),l&&n.length>0&&r.a.createElement("span",null,"\xa0"),n.length>0&&n)}return r.a.createElement("span",{className:"action-button"},r.a.createElement(It,{helpText:C},_?e.renderFunc(e):r.a.createElement(f.c,{onClick:O,bsStyle:"default"===o?void 0:o,bsSize:s,className:c,disabled:!E},l&&r.a.createElement("i",{className:S}),l&&n.length>0&&r.a.createElement("span",null,"\xa0"),n.length>0&&n)))};gt.defaultProps={type:"",data:null,index:"",label:"",helpText:"",actionStyle:"link",actionSize:void 0,actionClass:"",showIcon:!0,enable:!0,show:!0,isDropdown:!1,renderFunc:null,onClick:function(){}};var ft=Object(a.memo)(gt),ht=function(e){var t=e.actions,n=e.data,a=e.type,i=e.doropDownLabel,o=e.doropDownStyle,l=e.doropDownSize,s=e.doropDownClass;return"dropdown"===a?r.a.createElement(f.i,{bsStyle:"default"===o?void 0:o,bsSize:l,title:i,id:"dropdown-size-extra-small",className:s},t.map(function(e,t){return r.a.createElement(ft,Object.assign({},e,{data:n,key:t,isDropdown:!0,index:t}))})):"group"===a?r.a.createElement(f.d,{className:"actions-buttons"},t.map(function(e,t){return r.a.createElement(ft,Object.assign({},e,{data:n,key:t}))})):r.a.createElement("div",{className:"actions-buttons"},t.filter(function(e){return"undefined"===typeof e.show||("function"===typeof e.show?e.show(n):e.show)}).map(function(e,t,a){var i=t===a.length-1,o=k()({mr10:!i,mr0:i});return r.a.createElement("span",{key:"".concat(e.type,"_").concat(t),className:o},r.a.createElement(ft,Object.assign({},e,{data:n})))}))};ht.defaultProps={actions:[],data:null,type:"default",doropDownLabel:"Actions",doropDownStyle:"primary",doropDownSize:"xsmall",doropDownClass:""};var vt=Object(a.memo)(ht),yt=n(55),bt=function(e){var t=e.items;return r.a.createElement("div",null,t)};bt.defaultProps={items:[]};var Et=Object(yt.SortableContainer)(bt),Ct=function(e){var t=e.element;return e.disabled?r.a.createElement("i",{className:"fa fa-bars fa-fw",style:{opacity:".05",lineHeight:"35px"}}):t};Ct.defaultProps={element:r.a.createElement("i",{className:"fa fa-bars fa-fw",style:{cursor:"row-resize",opacity:".25",lineHeight:"35px"}}),disabled:!1};var _t=Object(yt.SortableHandle)(Ct),Ot=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,n=e.format,a=e.timezone,i=e.emptyValue,o=t?S()(t).tz(a).format(n):i;return r.a.createElement("span",null,o)}}]),t}(a.Component);Ot.defaultProps={value:S()(),format:ee("dateFormat","DD/MM/YYYY"),emptyValue:"-"};var St=Object(l.connect)(function(e,t){return{timezone:e.settings.getIn(["billrun","timezone"])}})(Ot),Tt=function(e){var t=e.itemName,n=e.item,a=e.type;if(!t.length||["subscription"].includes(t))return e.children;var i=ee(["systemItems",t,"itemType"],""),o=ee(["systemItems",t,"itemsType"],"");switch(a){case"list":var l="/".concat(o);return r.a.createElement(s.b,{to:l},e.children);case"edit":var c="".concat(o,"/").concat(i,"/").concat(ue(n,""));return r.a.createElement(s.b,{to:c},e.children);case"clone":var u="".concat(o,"/").concat(i,"/").concat(ue(n,""));return r.a.createElement(s.b,{to:u,query:{action:"clone"}},e.children);default:return e.children}};Tt.defaultProps={children:null,item:g.c.Map(),itemName:"",type:"view"};var kt=Tt,jt=function(e){var t=e.helpText,n=e.children;if(null===n)return null;if(""===t)return n;var a=r.a.createElement(f.C,{id:"tooltip"},t);return r.a.createElement(f.t,{overlay:a,placement:"top"},r.a.createElement("span",{className:"disabled-elements-hack"},n))};jt.defaultProps={children:null,helpText:""};var It=jt,wt=n(269),Nt=n(267),Ft=n(183),xt=function(e){var t=e.value,n=e.onChange,a=e.editable,i=e.disabled,o=e.multi,l=e.clearable,s=e.noResultsText,c=e.options,u=e.allowCreate,p=e.addLabelText,d=e.placeholder,m=e.isAsync,g=e.isControlled,f=e.loadAsyncOptions,h=Object(mt.a)(e,["value","onChange","editable","disabled","multi","clearable","noResultsText","options","allowCreate","addLabelText","placeholder","isAsync","isControlled","loadAsyncOptions"]),v=(o?t.split(",").map(function(e){return"false"!==e&&("true"===e||e)}):[t]).filter(function(e){return""!==e});if(!a){var y=c.filter(function(e){return v.includes(e.value)}).map(function(e){return e.label}).join(", ");return r.a.createElement("div",{className:"non-editable-field"},y)}var b=i,E=o,C=l,_=s;"undefined"!==typeof s&&"string"===typeof s&&(_=function(){return s});var O=p;"undefined"!==typeof p&&"string"===typeof p&&(O=function(e){return p.replace("{label}",e)});var S=function(e,t){var a=t.action,r=t.removedValue,i=t.name,l="";return"clear"!==a&&null!==e&&(l=o?e.map(function(e){return e.value}).join(","):e.value),n(l,{option:e,action:a,removedValue:r,name:i})},T="";if(E)T=v.map(function(e){var t=c.findIndex(function(t){return e===t.value});return-1!==t?c[t]:{value:e,label:e}});else if(m)T=t;else if(""!==t){var k=c.findIndex(function(e){return t===e.value});T=-1!==k?c[k]:{value:t,label:t}}else T=null;return m&&!g?r.a.createElement(Ft.a,Object.assign({},h,{placeholder:d,classNamePrefix:"react-select",onChange:S,isMulti:E,isClearable:C,isDisabled:b,noOptionsMessage:_,formatCreateLabel:O,loadOptions:f})):m?r.a.createElement(Ft.a,Object.assign({},h,{placeholder:d,value:T,classNamePrefix:"react-select",onChange:S,isMulti:E,isClearable:C,isDisabled:b,noOptionsMessage:_,formatCreateLabel:O,loadOptions:f})):u?r.a.createElement(Nt.a,Object.assign({},h,{options:c,placeholder:d,value:T,classNamePrefix:"react-select",onChange:S,isMulti:E,isClearable:C,isDisabled:b,noOptionsMessage:_,formatCreateLabel:O})):r.a.createElement(wt.a,Object.assign({},h,{placeholder:d,options:c,value:T,classNamePrefix:"react-select",onChange:S,isMulti:E,isClearable:C,isDisabled:b,noOptionsMessage:_}))};xt.defaultProps={value:"",disabled:!1,editable:!0,multi:!1,isAsync:!1,isControlled:!0,clearable:!0,allowCreate:!1,noResultsText:void 0,placeholder:void 0,addLabelText:void 0,options:[],inputProps:{},onChange:function(){},loadAsyncOptions:function(){}};var Rt=xt,Mt=function(e){var t=e.onChange,n=e.value,a=e.editable,i=e.disabled,o=e.tooltip,l=e.suffix,s=e.preffix,c=Object(mt.a)(e,["onChange","value","editable","disabled","tooltip","suffix","preffix"]);if(a){var u=r.a.createElement("input",Object.assign({},c,{type:"number",className:"form-control",value:n,onChange:function(e){var n=e.target,a=n.value,r=n.id,i=x()(a)?parseFloat(a):a;t({target:{value:i,id:r}})},disabled:i,title:o}));return null!==l||null!==s?r.a.createElement(f.o,null,null!==s&&r.a.createElement(f.o.Addon,null,s),u,null!==l&&r.a.createElement(f.o.Addon,null,l)):u}return r.a.createElement("div",{className:"non-editable-field"},r.a.createElement("span",null,null!==s&&s,n,null!==l&&l))};Mt.defaultProps={value:"",required:!1,disabled:!1,editable:!0,placeholder:"",tooltip:"",suffix:null,preffix:null,onChange:function(){}};var Pt=Mt,At=function(e){var t=e.onChange,n=e.id,a=e.value,i=e.editable,o=e.disabled,l=i?r.a.createElement("input",{type:"number",step:"any",id:n,className:"form-control",min:"0",value:a,onChange:t,disabled:o}):r.a.createElement("span",null,x()(a)?parseFloat(a):a);return r.a.createElement("div",{className:"non-editable-field"},l)},Dt=n(58),Lt=function(e){var t=e.editable,n=e.value,a=e.disabled,i=e.placeholder,o=e.onChange,l=e.dateFormat,s=e.message,c=e.minDate,u=Object(mt.a)(e,["editable","value","disabled","placeholder","onChange","dateFormat","message","minDate"]),p=l||ee("dateFormat","DD/MM/YYYY");if(!t){var d=S.a.isMoment(n)&&n.isValid()?n.format(p):n;return r.a.createElement("div",{className:"non-editable-field"},d)}var m=a&&!n?"":i,g=S.a.isMoment(n)&&n.isValid()?n:null,f=S.a.isMoment(c)?c:void 0;return r.a.createElement(Dt.a,Object.assign({},u,{minDate:f,className:"form-control",dateFormat:p,selected:g,onChange:o,disabled:a,placeholderText:m}),s)};Lt.defaultProps={required:!1,disabled:!1,editable:!0,placeholder:"",message:null,onChange:function(){}};var Ut=Lt,Vt=function(e){var t=e.editable,n=e.value,a=e.disabled,i=e.placeholder,o=e.onChange,l=e.dateFormat,s=e.timeFormat,c=e.message,u=e.timeIntervals,p=e.minDate,d=Object(mt.a)(e,["editable","value","disabled","placeholder","onChange","dateFormat","timeFormat","message","timeIntervals","minDate"]),m="".concat(l," ").concat(s);if(!t){var g=S.a.isMoment(n)&&n.isValid()?n.format(m):n;return r.a.createElement("div",{className:"non-editable-field"},g)}var f=a&&!n?"":i,h=S.a.isMoment(n)&&n.isValid()?n:null,v=S.a.isMoment(p)?p:void 0;return r.a.createElement(Dt.a,Object.assign({},d,{minDate:v,calendarClassName:"date-picker-with-time",className:"form-control DatePickerTime",showTimeSelect:!0,timeIntervals:u,dateFormat:m,timeFormat:s,selected:h,onChange:function(e){var t=S.a.isMoment(e)&&e.isValid()?e.utc():"";o(t)},disabled:a,placeholderText:f}),c)};Vt.defaultProps={required:!1,disabled:!1,editable:!0,placeholder:"",message:null,dateFormat:ee("dateFormat","DD/MM/YYYY"),timeFormat:ee("timeFormat","HH:mm"),timeIntervals:15,onChange:function(){}};var Bt=Vt,qt=n(273),zt=n.n(qt),Ht=function(e){var t=e.editable,n=e.value,a=e.disabled,i=e.placeholder,o=e.onChange,l=e.inputProps,s=e.onlyUnique,c=Object(mt.a)(e,["editable","value","disabled","placeholder","onChange","inputProps","onlyUnique"]),u=Array.isArray(n)?n:[n];if(!t){var p=u.join(", ");return r.a.createElement("div",{className:"non-editable-field"},p)}var d={placeholder:a?"":i},m=Object.assign(d,l),g=m.fieldType,f=Object(mt.a)(m,["fieldType"]);return r.a.createElement(zt.a,Object.assign({},c,{addOnBlur:!0,value:u,onChange:o,inputProps:"undefined"===typeof g?f:m,disabled:a,renderTag:function(t){var n=t.tag,a=t.key,i=t.disabled,o=t.onRemove,l=t.classNameRemove,s=t.getTagDisplayValue,c=Object(mt.a)(t,["tag","key","disabled","onRemove","classNameRemove","getTagDisplayValue"]),u=e.getTagDisplayValue||s;return r.a.createElement("span",Object.assign({key:a},c),!i&&r.a.createElement("span",{className:l,onClick:function(){o(a)}},"\xd7"),u(n))},onlyUnique:s,renderInput:"undefined"===typeof g?void 0:function(e){e.addTag;var t=Object(mt.a)(e,["addTag"]);return r.a.createElement(Tn,t)}}))};Ht.defaultProps={value:[],required:!1,disabled:!1,editable:!0,placeholder:"",inputProps:{},onChange:function(){},getTagDisplayValue:null,onlyUnique:!1};var Yt=Ht,Gt=function(e){var t=e.onChange,n=e.id,a=e.value,i=e.editable,o=e.disabled,l=i?r.a.createElement("input",{type:"text",className:"form-control address",id:n,value:a,onChange:t,disabled:o}):r.a.createElement("span",null,a);return r.a.createElement("div",null,l)},Kt=function(e){var t=e.onChange,n=e.value,a=e.editable,i=e.disabled,o=e.suffix,l=e.preffix,s=Object(mt.a)(e,["onChange","value","editable","disabled","suffix","preffix"]);if(a){var c=r.a.createElement("input",Object.assign({},s,{type:"text",className:"form-control",value:n,onChange:t,disabled:i}));return null!==o||null!==l?r.a.createElement(f.o,null,null!==l&&r.a.createElement(f.o.Addon,null,l),c,null!==o&&r.a.createElement(f.o.Addon,null,o)):c}return r.a.createElement("div",{className:"non-editable-field"},r.a.createElement("span",null,null!==l&&"".concat(l," "),n,null!==o&&" ".concat(o)))};Kt.defaultProps={value:"",required:!1,disabled:!1,editable:!0,placeholder:"",suffix:null,preffix:null,onChange:function(){}};var Wt=Kt,Jt=function(e){var t=e.onChange,n=e.id,a=e.value,i=e.placeholder,o=void 0===i?"":i,l=e.disabled;return e.editable?r.a.createElement("textarea",{id:n,className:"form-control",value:a,onChange:t,placeholder:o,disabled:l}):r.a.createElement("span",null,a)},$t=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={value:n.props.value===n.props.unlimitedValue?"":n.props.value,unlimited:n.props.value==n.props.unlimitedValue},n.onUnlimitedChanged=function(e){var t=n.props.unlimitedValue,a=e.target.checked,r=a?t:n.state.value;n.setState({unlimited:a}),n.props.onChange(r)},n.onValueChanged=function(e){var t=e.target.value;n.setState({value:t}),n.props.onChange(t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.value,n=e.unlimited,a=this.props,i=a.unlimitedLabel,o=a.disabled,l=a.editable,s=a.suffix;return l?r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("input",{checked:n,onChange:this.onUnlimitedChanged,type:"checkbox",disabled:o}),r.a.createElement("small",{style:{verticalAlign:"bottom"}}," ",i)),r.a.createElement(f.k,{disabled:n||o,onChange:this.onValueChanged,type:"text",value:n?"":t}),null!==s&&r.a.createElement(f.o.Addon,null,s)):r.a.createElement("div",{className:"non-editable-field"},i)}}]),t}(a.Component);$t.defaultProps={unlimitedLabel:"Unlimited",unlimitedValue:"UNLIMITED",disabled:!1,editable:!0,suffix:null};var Qt=n(32),Zt=n.n(Qt),Xt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChange=function(e){var t=n.state.id,a=e.target.checked;n.props.onChange({target:{id:t,value:a}})},n.state={id:e.id||Zt.a.v4()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.id,t=this.props,n=t.value,a=t.editable,i=t.disabled,o=t.label;return a?null!==o?r.a.createElement("label",{htmlFor:e},r.a.createElement("input",{style:{verticalAlign:"top"},type:"checkbox",id:e,checked:n,disabled:i,onChange:this.onChange}),"\xa0\xa0",o):r.a.createElement("input",{type:"checkbox",id:e,checked:n,disabled:i,onChange:this.onChange}):r.a.createElement("span",null,n?"Yes":"No")}}]),t}(a.PureComponent);Xt.defaultProps={id:void 0,label:null,value:!1,editable:!0,checked:!1,disabled:!1,onChange:function(){}};var en=Xt,tn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).renderInput=function(){var e=n.state.id,t=n.props,a=t.name,i=t.value,o=t.disabled,l=t.checked,s=t.onChange;return r.a.createElement("input",{type:"radio",style:{verticalAlign:"top"},name:a,id:e,value:i,checked:l,disabled:o,onChange:s})},n.state={id:e.id||Zt.a.v4()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.id,t=this.props,n=t.value,a=t.editable,i=t.label,o=t.disabled,l=t.labelStyle;if(!a&&null!==i)return r.a.createElement("div",{className:"non-editable-field"},i);if(!a)return r.a.createElement("div",{className:"non-editable-field"},n);var s=this.renderInput();return null!==i?r.a.createElement("label",{htmlFor:e,style:l,className:o?"disabled":""},s,"\xa0",i):s}}]),t}(a.PureComponent);tn.defaultProps={id:void 0,name:void 0,label:null,value:"",editable:!0,checked:!1,disabled:!1,labelStyle:{paddingTop:10},onChange:function(){}};var nn=tn,an=[{value:"mr",label:"Mr."},{value:"mrs",label:"Mrs."},{value:"miss",label:"Miss"},{value:"dr",label:"Dr."},{value:"sir",label:"Sir"}],rn=function(e){return r.a.createElement(Tn,{fieldType:"select",options:an,onChange:function(t){var n={target:{id:e.id,value:t}};e.onChange(n)},value:e.value})},on=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChangedState=function(e){var t=n.props.disabledValue,a=e.target.checked,r=a?n.state.value:t;n.props.onChange(r),n.setState({off:!a})},n.onValueChanged=function(e){var t=n.getValue(e);n.setState({value:t}),n.props.onChange(t)},n.getValue=function(e){var t=n.props.inputProps.fieldType;switch(void 0===t?"text":t){case"date":return e;default:return e.target.value}};var a=e.compare(e.value,e.disabledValue),r=a?e.disabledValue:e.value;return n.state={value:r,off:a},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){if(!this.props.compare(e.value,this.props.value)){var t=e.compare(e.value,e.disabledValue),n=t?e.disabledValue:e.value;this.setState({value:n,off:t})}}},{key:"render",value:function(){var e=this.state,t=e.value,n=e.off,a=this.props,i=a.label,o=a.disabled,l=a.editable,s=a.suffix,c=a.inputProps,u=a.disabledDisplayValue;return l?r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("label",{className:"mb0"},r.a.createElement("input",{style:{verticalAlign:"bottom"},checked:!n,onChange:this.onChangedState,type:"checkbox",disabled:o})," ",i)),r.a.createElement(Tn,Object.assign({disabled:n||o,onChange:this.onValueChanged,value:n?u:t},c)),null!==s&&r.a.createElement(f.o.Addon,null,s)):r.a.createElement("div",{className:"non-editable-field"},n?u:t)}}]),t}(a.Component);on.defaultProps={label:"Enable",disabledValue:null,disabledDisplayValue:"",disabled:!1,editable:!0,suffix:null,inputProps:{},compare:function(e,t){return e===t}};var ln=n(219),sn=n.n(ln),cn=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showWYSIWYG:!1},n.initEditor=function(){var e=n.props,t=e.configName,a=e.editorName,r=CKEDITOR&&CKEDITOR.instances[a],i=t.length?"br/config/".concat(t,".js"):"";if(n.state.showWYSIWYG){if(r){window.CKEDITOR.instances[a].getData()!==unescape(n.props.value)&&window.setTimeout(function(){return n.toggleEditor(r,i)},100)}}else window.setTimeout(function(){return n.toggleEditor(r,i)},100)},n.toggleEditor=function(e,t){var a=n.props,r=a.editorName,i=a.disabled,o=n.props,l=o.fields,s=o.editorHeight;e&&e.destroy(!0);var c={readOnly:i,customConfig:t,toolbar:"Basic",height:s,placeholder_select:{placeholders:l}};window.CKEDITOR.replace(r,c),window.CKEDITOR.dtd.$removeEmpty.i=0,window.CKEDITOR.dtd.$removeEmpty.span=!1,window.CKEDITOR.instances[r].on("change",n.onChange),n.setState({showWYSIWYG:!0})},n.onChange=sn()(function(){var e=n.props.editorName,t=window.CKEDITOR.instances[e].getData();n.props.onChange(t)},250),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initEditor()}},{key:"shouldComponentUpdate",value:function(e,t){return this.props.value!==e.value}},{key:"componentDidUpdate",value:function(e,t){this.initEditor()}},{key:"componentWillUnmount",value:function(){var e=this.props.editorName,t=CKEDITOR&&CKEDITOR.instances[e];t&&t.destroy(!0)}},{key:"render",value:function(){var e=this.props,t=e.value,n=e.editorName,a=e.editorHeight,i=e.disabled,o=unescape(t||"");return r.a.createElement("div",{className:"TextEditor"},r.a.createElement("textarea",{name:n,value:o,style:{width:"100%",height:a},onChange:function(){},disabled:i}))}}]),t}(a.Component);cn.defaultProps={fields:[],value:"",configName:"",editorHeight:250,disabled:!1};var un=cn,pn=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeFrom=function(e){var t=n.props.value,a=n.getValue(e);n.props.onChange(t.set("from",a))},n.onChangeTo=function(e){var t=n.props.value,a=n.getValue(e);n.props.onChange(t.set("to",a))},n.getValue=function(e){var t=n.props.inputProps.fieldType;switch(void 0===t?"text":t){case"datetime":case"date":var a=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");return S.a.isMoment(e)&&e.isValid()?e.format(a):"";case"select":return e;default:return e.target.value}},n.setValue=function(e){var t=n.props.inputProps.fieldType;switch(void 0===t?"text":t){case"date":return""===e?null:S()(e);default:return e}},n.replaceValues=function(e,t,n){var a=Object.values(e);return a.includes("@valueFrom@")||a.includes("@valueTo@")?g.c.fromJS(e).map(function(e,a){return"@valueFrom@"===e?t:"@valueTo@"===e?n:e}).toJS():e},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.onChange,e.value),n=e.placeholder,a=e.editable,i=e.compact,o=e.inputFromProps,l=void 0===o?{}:o,s=e.inputToProps,c=void 0===s?{}:s,u=e.inputProps.fieldType,p=void 0===u?"text":u,d=Object(mt.a)(e,["onChange","value","placeholder","editable","compact","inputFromProps","inputToProps","inputProps"]),m=this.setValue(g.c.Map.isMap(t)?t.get("from",""):""),h=this.setValue(g.c.Map.isMap(t)?t.get("to",""):""),v="undefined"!==typeof n.from?n.from:"",y="undefined"!==typeof n.to?n.to:"",b=this.replaceValues(l,m,h),E=this.replaceValues(c,m,h);return a?r.a.createElement(f.o,{style:{width:"100%"}},!i&&r.a.createElement(f.o.Addon,null,r.a.createElement("small",null,"From")),r.a.createElement(Tn,Object.assign({},d,b,{fieldType:p,value:m,onChange:this.onChangeFrom,placeholder:v})),!i&&r.a.createElement(f.o.Addon,null,r.a.createElement("small",null,"To")),i&&r.a.createElement(f.o.Addon,null,r.a.createElement("small",null,"-")),r.a.createElement(Tn,Object.assign({},d,E,{fieldType:p,value:h,onChange:this.onChangeTo,placeholder:y}))):r.a.createElement("span",{className:"non-editable-field"},r.a.createElement(Tn,Object.assign({},d,b,{fieldType:p,value:m,placeholder:v,editable:!1,className:"inline"})),"\xa0-\xa0",r.a.createElement(Tn,Object.assign({},d,E,{fieldType:p,value:h,editable:!1,className:"inline"})))}}]),t}(a.PureComponent);pn.defaultProps={value:g.c.Map({from:"",to:""}),placeholder:{from:"",to:""},inputProps:{},editable:!0,compact:!1,onChange:function(){}};var dn=pn,mn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChange=function(e,t){var a=n.props.value;n.props.onChange(a.set(t,e))},n.onAdd=function(){var e=n.props.value;n.props.onChange(e.push(g.c.Map({from:"",to:""})))},n.onRemove=function(e){var t=n.props.value;n.props.onChange(t.delete(e))},n.state={id:e.id||Zt.a.v4()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=(t.onChange,t.value),a=t.editable,i=t.disabled,o=t.label,l=t.multi,s=t.removable,c=Object(mt.a)(t,["onChange","value","editable","disabled","label","multi","removable"]),u=this.state.id;if(!a)return r.a.createElement("span",null,n.map(function(e,t){return r.a.createElement("span",{key:"range_".concat(u,"_").concat(t)},t>0&&", ",r.a.createElement(dn,Object.assign({},c,{value:e,editable:!1})))}));var p=n.map(function(t,n){return r.a.createElement(f.l,{key:"range_".concat(u,"_").concat(n),className:"rangesField form-inner-edit-row mr0 ml0"},r.a.createElement(f.o,{style:{width:"100%"}},r.a.createElement(dn,Object.assign({},c,{value:t,onChange:function(t){e.onChange(t,n)},editable:!0,disabled:i})),s&&r.a.createElement(f.o.Button,null,r.a.createElement(f.c,{onClick:function(){e.onRemove(n)},disabled:i},r.a.createElement("i",{className:"fa fa-fw fa-trash-o danger-red"})))))}),d=n.size>0&&n.some(function(e){return""===e.get("from","")||""===e.get("to","")});return r.a.createElement("div",null,p,(l||!l&&0===n.size)&&r.a.createElement(ct,{buttonStyle:{marginTop:5,marginBottom:10},onClick:this.onAdd,action:"Add",label:"",type:o,disabled:i||d}))}}]),t}(a.PureComponent);mn.defaultProps={id:void 0,value:g.c.List(),label:"",inputProps:{},multi:!1,editable:!0,removable:!0,disabled:!0,onChange:function(){}};var gn=mn,fn=function(e){var t=e.onChange,n=e.value,a=e.editable,i=e.disabled,o=e.tooltip,l=e.preffix,s=Object(mt.a)(e,["onChange","value","editable","disabled","tooltip","preffix"]),c=x()(n)?parseFloat((100*parseFloat(n)).toFixed(3)):n;return a?r.a.createElement(f.o,null,null!==l&&r.a.createElement(f.o.Addon,null,l),r.a.createElement("input",Object.assign({},s,{type:"number",className:"form-control",value:c,onChange:function(e){var n=e.target,a=n.value,r=n.id,i=x()(a)?parseFloat(a)/100:a;t({target:{value:i,id:r}})},disabled:i,title:o})),r.a.createElement(f.o.Addon,null,"%")):r.a.createElement("div",{className:"non-editable-field"},r.a.createElement("span",null,null!==l&&"".concat(l," "),c,x()(c)&&"%"))};fn.defaultProps={value:"",required:!1,disabled:!1,editable:!0,placeholder:"",tooltip:"",preffix:null,onChange:function(){}};var hn=fn,vn=n(290),yn=n(274),bn=n.n(yn),En=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).colors={default:"#222222"},n.wrapperStyle={height:"auto",padding:"6px 4px"},n.onChangeJson=function(e){var t=n.props.onChange;e.error?t(!1):t(e.jsObject)},n.state={id:e.id||Zt.a.v4()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,n=e.editable,a=e.disabled,i=this.state.id;return r.a.createElement("div",{className:"form-control",style:this.wrapperStyle},r.a.createElement(vn.a,{id:i,height:"auto",width:"100%",theme:"light_mitsuketa_tribute",viewOnly:!n||a,colors:this.colors,placeholder:t,onChange:this.onChangeJson,locale:bn.a,confirmGood:!1}))}}]),t}(a.Component);En.defaultProps={value:null,id:void 0,required:!1,disabled:!1,editable:!0,tooltip:"",onChange:function(){}};var Cn=En,_n=function(e){var t=e.onChange,n=e.value,a=e.editable,i=e.disabled,o=e.suffix,l=e.preffix,s=Object(mt.a)(e,["onChange","value","editable","disabled","suffix","preffix"]);if(a){var c=r.a.createElement("input",Object.assign({},s,{type:"password",className:"form-control",value:n,onChange:t,disabled:i}));return null!==o||null!==l?r.a.createElement(f.o,null,null!==l&&r.a.createElement(f.o.Addon,null,l),c,null!==o&&r.a.createElement(f.o.Addon,null,o)):c}return r.a.createElement("div",{className:"non-editable-field"},r.a.createElement("span",null,null!==l&&"".concat(l," "),"******",null!==o&&" ".concat(o)))};_n.defaultProps={value:"",required:!1,disabled:!1,editable:!0,placeholder:"",suffix:null,preffix:null,onChange:function(){}};var On=_n,Sn=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).createInput=function(){var e=n.props,t=e.fieldType,a=(e.style,e.className,Object(mt.a)(e,["fieldType","style","className"]));switch(t){case"number":case"integer":case"decimal":return r.a.createElement(Pt,a);case"price":return r.a.createElement(At,a);case"date":return r.a.createElement(Ut,a);case"datetime":return r.a.createElement(Bt,a);case"tags":return r.a.createElement(Yt,a);case"address":return r.a.createElement(Gt,a);case"textarea":return r.a.createElement(Jt,a);case"unlimited":return r.a.createElement($t,a);case"toggeledInput":return r.a.createElement(on,a);case"checkbox":return r.a.createElement(en,a);case"radio":return r.a.createElement(nn,a);case"salutation":return r.a.createElement(rn,a);case"textEditor":return r.a.createElement(un,a);case"select":return r.a.createElement(Rt,a);case"ranges":return r.a.createElement(gn,a);case"range":return r.a.createElement(dn,a);case"percentage":return r.a.createElement(hn,a);case"json":return r.a.createElement(Cn,a);case"password":return r.a.createElement(On,a);default:return r.a.createElement(Wt,a)}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.style,n=e.className,a=e.fieldType;return r.a.createElement("div",{className:k()("Field","field-".concat(a),n),style:t},this.createInput())}}]),t}(a.PureComponent);Sn.defaultProps={value:void 0,required:!1,disabled:!1,editable:!0,fieldType:"text",label:"",style:{},className:void 0,onChange:function(){}};var Tn=Sn,kn=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={value:n.props.value},n.onChangeValue=function(e){var t=e.target.value;n.setState({value:t}),n.props.onChange&&n.props.onChange(t)},n.onAction=function(){var e=n.props.clearAfterAction,t=n.state.value;n.props.onAction(t),e&&n.onChangeValue({target:{value:""}})},n.getActionLabel=function(){var e=n.props.actionLabel;return e.length>0?" ".concat(e):null},n.getActionStyle=function(){switch(n.props.actionType){case"add":return"primary";case"remove":default:return}},n.isButtonDisabled=function(){var e=n.props.actionType,t=n.state.value;return"add"===e&&t.length<1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.inputProps,n=e.actionType,a=this.state.value,i=k()("fa fa-fw",{"danger-red":"remove"===n,"fa-trash-o":"remove"===n,"fa-plus":"add"===n});return r.a.createElement(f.o,null,r.a.createElement(Tn,Object.assign({},t,{onChange:this.onChangeValue,value:a})),r.a.createElement(f.o.Button,null,r.a.createElement(f.c,{onClick:this.onAction,bsStyle:this.getActionStyle(),disabled:this.isButtonDisabled()},r.a.createElement("i",{className:i}),this.getActionLabel())))}}]),t}(a.PureComponent);kn.defaultProps={fieldType:void 0,inputProps:{},actionLabel:"",actionType:"add",value:"",clearAfterAction:!1,onChange:null};var jn=kn,In=function(e){var t=e.progressIndicator;e.enterTimeout,e.exitTimeout;return r.a.createElement("div",{className:"progress-indicator-container",style:{position:"fixed",top:0,width:"100%",zIndex:5001}},t&&r.a.createElement("div",{key:"progressIndicator",className:"system-progress-indecator"}))};In.defaultProps={progressIndicator:!1,enterTimeout:250,exitTimeout:250};var wn=Object(l.connect)(function(e){return{progressIndicator:e.progressIndicator>0}})(In),Nn=n(18),Fn=function(e,t){return ce(e,t).format(ee("dateFormat","DD/MM/YYYY"))},xn=function(e){return"Cycle of ".concat(Fn(e,"start_date")," - ").concat(Fn(e,"end_date"))},Rn=function(e,t){return e.settings.getIn(["taxation"])},Mn=function(e,t){return e.settings.getIn(["plays"])},Pn=function(e,t){return e.settings.get("usage_types")},An=function(e,t){return e.settings.getIn(["rates","fields"])},Dn=function(e,t){return e.settings.get("invoice_export")},Ln=function(e,t){return e.settings.getIn(["events"])},Un=function(e,t){return e.settings.getIn(["collection"])},Vn=function(e,t){return e.settings.getIn(["payment_gateways"])},Bn=function(e,t){return t.settings.get("fields",g.c.List())},qn=function(e,t){return t.settings.getIn(["processor","calculated_fields"],g.c.List()).map(function(e){return e.get("target_field","")}).map(function(e){return{value:e,label:"".concat(e," (Computed)")}}).sortBy(function(e){return e.value})},zn=function(e){var t=g.c.Set(),n=e.getIn(["processor","default_usaget"],"");return""!==n&&(t=t.add(n)),e.getIn(["processor","usaget_mapping"],g.c.List()).forEach(function(e){var n=e.get("usaget","");""!==n&&(t=t.add(n))}),t.toList()},Hn=function(e,t){return e.settings.get("file_types",g.c.List())},Yn=Object(Nn.a)(Hn,function(e){var t=g.c.List();return e.forEach(function(e){var n=zn(e),a=e.getIn(["parser","custom_keys"],g.c.List());n.forEach(function(n){t=t.push(g.c.Map({fileType:e.get("file_type",""),usageType:n,customKeys:a}))})}),t}),Gn=Object(Nn.a)(Hn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return g.c.Map().withMutations(function(t){e.forEach(function(e){var n=zn(e);t.set(e.get("file_type"),n)})})}),Kn=Object(Nn.a)(Hn,function(e){var t=g.c.Set();return e.forEach(function(e){var n=e.getIn(["parser","structure"],g.c.List()).filter(function(e){return!0===e.get("checked",!0)}).map(function(e){return e.get("name","")});t=t.concat(n)}),t.toList()}),Wn=Object(Nn.a)(Hn,function(e){var t=g.c.Set();return e.forEach(function(e){var n=e.getIn(["processor","calculated_fields"],g.c.List()).map(function(e){return e.get("target_field","")});t=t.concat(n)}),t.toList()}),Jn=Object(Nn.a)(Hn,function(e){var t=g.c.Set();return e.forEach(function(e){e.get("rate_calculators",g.c.Map()).forEach(function(e){e.forEach(function(e){e.forEach(function(e){var n=e.filter(function(e){return e.get("rate_key","").startsWith("params.")}).map(function(e){return e.get("rate_key","")});t=t.concat(n)})})})}),t.toList()}),$n=Object(Nn.a)(Rn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("mapping")}),Qn=Object(Nn.a)(function(e,t){return e.settings.get("export_generators")},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e}),Zn=Object(Nn.a)(function(e,t){return e.settings.getIn(["plugin_actions"])},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.filter(function(e,t){return t.startsWith("import")}).reduce(function(e,t,n){var a=ne(n.split("import")[1]);return t.forEach(function(t){e=e.update(t,g.c.List(),function(e){return e.includes(a)?e:e.push(a)})}),e},g.c.Map())}),Xn=Object(Nn.a)(function(e,t){return e.settings.get("import")},function(e){return e}),ea=Object(Nn.a)(Rn,function(e){return e}),ta=Object(Nn.a)(ea,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("tax_type")}),na=Object(Nn.a)(function(e,t){return e.settings.getIn(["pricing"])},function(e){return e}),aa=Object(Nn.a)(function(e,t){return e.settings.getIn(["system"])},function(e){return e}),ra=Object(Nn.a)(Mn,function(e){return e}),ia=Object(Nn.a)(ra,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e?e.filter(function(e){return e.get("enabled",!0)}):g.c.List()}),oa=Object(Nn.a)(ia,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.size>1}),la=Object(Nn.a)(Mn,function(e){return e?e.filter(function(e){return e.get("enabled",!0)}):void 0}),sa=Object(Nn.a)(aa,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("closed_cycle_changes")}),ca=Object(Nn.a)(function(e,t){return e.settings.get("billrun")},function(e){return e}),ua=Object(Nn.a)(function(e,t){return e.settings.get("minimum_entity_start_date")},function(e){return e&&x()(e)?S.a.unix(e):S()(0)}),pa=Object(Nn.a)(na,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("currency")}),da=Object(Nn.a)(ca,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=e.get("charging_day");return x()(t)?t:Number(t)}),ma=Object(Nn.a)(Hn,function(e){if(e)return e.map(function(e){return e.get("file_type","")})}),ga=Object(Nn.a)(Pn,function(e){if(e)return e.map(function(e){return e.get("usage_type","")})}),fa=Object(Nn.a)(function(e,t){return e.settings.getIn(["events","balance"])},function(e){if(e)return e.map(function(e){return e.get("event_code","")})}),ha=Object(Nn.a)(Pn,function(e){return e}),va=Object(Nn.a)(function(e,t){return e.settings.get("property_types")},function(e){return e}),ya=Object(Nn.a)(function(e,t){var n=Array.isArray(t.entityName)?t.entityName:[t.entityName];return e.settings.getIn([].concat(Object(N.a)(n),["fields"]))},function(e){return e}),ba=Object(Nn.a)(function(e,t){return e.settings.getIn(["subscribers","account","fields"])},function(e){if(e)return e.map(function(e){return""!==e.get("title","")?e:e.set("title",te(e.get("field_name",""),"account"))})}),Ea=Object(Nn.a)(ba,function(e){return e?e.map(function(e){return e.get("field_name","")}):e}),Ca=Object(Nn.a)(la,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.reduce(function(e,t){return e.set(t.get("name"),t.get("label"))},g.c.Map())}),_a=Object(Nn.a)(function(e,t){return e.settings.getIn(["subscribers","subscriber","fields"])},function(e){if(e)return e.map(function(e){return""!==e.get("title","")?e:e.set("title",te(e.get("field_name",""),"subscription"))})}),Oa=Object(Nn.a)(_a,Ca,oa,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map(),n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.map(function(e){return n?He(e,t):e})}),Sa=Object(Nn.a)(function(e,t){return e.settings.getIn(["lines","fields"])},function(e){if(e)return e.map(function(e){return""!==e.get("title","")?e:e.has("foreign")?e.set("title",te(e.getIn(["foreign","field"],""),ne(e.getIn(["foreign","entity"],"")))):e.set("title",te(e.get("field_name",""),"lines"))})}),Ta=Object(Nn.a)(function(e,t){return e.settings.getIn(["bills","fields"])},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.map(function(e){return""!==e.get("title","")?e:e.has("foreign")?e.set("title",te(e.getIn(["foreign","field"],""),ne(e.getIn(["foreign","entity"],"")))):e.set("title",te(e.get("field_name",""),"bills"))})}),ka=Object(Nn.a)(Vn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return g.c.List().withMutations(function(t){e.forEach(function(e){e.getIn(["transactions_request"],g.c.List()).forEach(function(n){n.getIn(["generator","data_structure"],g.c.List()).forEach(function(n){!0===n.getIn(["save_to_bill"],!1)&&(""!==n.get("title","")?t.push(n.set("payment_gateway",e.get("name",""))):t.push(n.set("field_name",te(n.get("name",""),"bills")).set("payment_gateway",e.get("name",""))))})})})})}),ja=Object(Nn.a)(An,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.map(function(e){return ze(e,"product")})}),Ia=Object(Nn.a)(An,function(e){if(e){var t=e.find(function(e){return"tariff_category"===e.get("field_name","")});if(t)return g.c.List(t.get("select_options","").split(","))}}),wa=Object(Nn.a)(function(e,t){return e.settings.getIn(["services","fields"])},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.map(function(e){return ze(e,"service")})}),Na=Object(Nn.a)(function(e,t){return e.settings.getIn(["taxes","fields"])},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.map(function(e){return ze(e,"tax")})}),Fa=Object(Nn.a)(function(e,t){return e.settings.getIn(["discounts","fields"])},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.map(function(e){return ze(e,"discount")})}),xa=Object(Nn.a)(function(e,t){return e.settings.getIn(["charges","fields"])},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.map(function(e){return ze(e,"charge")})}),Ra=Object(Nn.a)(function(e,t){return e.settings.getIn(["plans","fields"])},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.map(function(e){return ze(e,"plan")})}),Ma=Object(Nn.a)(function(e,t){return e.settings.getIn(["template_token"])},function(e){return e}),Pa=Object(Nn.a)(Ma,function(e,t,n){return n},function(e,t){return e?e.filter(function(e,n){return t.includes(n)}).reduce(function(e,t,n){return g.c.List([].concat(Object(N.a)(e),Object(N.a)(t.map(function(e){return"".concat(n,"::").concat(e)}))))},g.c.List()):g.c.List()}),Aa=Object(Nn.a)(Un,function(e){return e?e.get("settings",g.c.Map()):void 0}),Da=Object(Nn.a)(Un,function(e){return e?e.get("steps",g.c.List()):void 0}),La=Object(Nn.a)(Da,function(e){return e?e.sortBy(function(e){return parseFloat(e.get("do_after_days",0))}):void 0}),Ua=Object(Nn.a)(Ln,function(e){return e?e.get("settings",g.c.Map()):void 0}),Va=Object(Nn.a)(Dn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("header")}),Ba=Object(Nn.a)(Dn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("footer")}),qa=Object(Nn.a)(Dn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("html_translation")}),za=Object(Nn.a)(Dn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("templates")}),Ha=Object(Nn.a)(Dn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("status")}),Ya=Object(Nn.a)(Vn,function(e){return e}),Ga=Object(Nn.a)(function(e,t){return e.settings.get("email_templates")},function(e){return e}),Ka=Object(Nn.a)(Ln,function(e,t){return t.eventType},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1?arguments[1]:void 0;return"balances"===t?e.get("balance"):"balance"===t?e.get("balance",g.c.List()).filter(function(e){return!e.get("prepaid",!1)}):"balancePrepaid"===t?e.get("balance",g.c.List()).filter(function(e){return e.get("prepaid",!1)}):e.get(t)}),Wa=Object(Nn.a)(Na,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.filter(function(e){return e.get("field_name","").startsWith("params.")}).map(ve).insert(0,{value:"key",label:"Key"}).toArray()}),Ja=Object(Nn.a)(Sa,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.filter(Je).map(ve).push({value:"type",label:"Type"}).push({value:"usaget",label:"Usage Type"}).push({value:"file",label:"File name"}).push({value:"installments",label:"Installments"}).toArray()}),$a=Object(Nn.a)(Sa,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.filter(Je).map(ve).push({value:"condition_result",label:"Condition Result"}).push({value:"hard_coded",label:"Hard Coded"}).push({value:"type",label:"Type"}).push({value:"usaget",label:"Usage Type"}).push({value:"file",label:"File name"}).toArray()}),Qa=Object(Nn.a)(Sa,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.filter(Je).map(ve).push({value:"type",label:"Type"}).push({value:"usaget",label:"Usage Type"}).push({value:"file",label:"File name"}).push({value:"computed",label:"Computed"}).toArray()}),Za=function(){return ee(["rates","preFunctions"],g.c.List()).reduce(function(e,t){var n=t.get("values",g.c.List()).map(function(e){return g.c.Map({value:"".concat(e,"___").concat(t.get("id","")),label:t.get("title",Object(D.titleCase)(t.get("id",""))),preFunction:t.get("id",""),preFunctionValue:e})});return g.c.List([].concat(Object(N.a)(e),Object(N.a)(n)))},g.c.List())},Xa=Object(Nn.a)(Bn,qn,function(){var e=[{value:"type",label:"Type"},{value:"usaget",label:"Usage Type"},{value:"connection_type",label:"Connection Type"},{value:"usagev",label:"Activity Volume"},{value:"file",label:"File name"}].concat(Object(N.a)(Za().map(fe)),[{value:"computed",label:"Computed"}]);return g.c.List(e)},function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List(),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.List();return(e=(t=n.map(function(e){return{value:e,label:e}}).sortBy(function(e){return e.value})).push.apply(t,Object(N.a)(a))).push.apply(e,Object(N.a)(r)).map(function(e){var t=e.value,n=e.label;return g.c.Map({value:t,label:n})})}),er=Object(Nn.a)(Sa,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.filter(Je).filter(function(e){return"rate"===e.get("available_from","")}).map(function(e){var t=e.get("field_name",""),n=e.get("title",Object(D.titleCase)(t));return{value:t,label:"".concat(n," (foreign field)")}})}),tr=Object(Nn.a)(Bn,qn,er,function(e,t){var n=[{value:"type",label:"Type"},{value:"usaget",label:"Usage Type"},{value:"connection_type",label:"Connection Type"},{value:"file",label:"File name"}];return t.computedLineKey&&"regex"===t.computedLineKey.get("type","regex")&&n.push.apply(n,Object(N.a)(Za().map(fe))),g.c.List(n)},function(){var e,t,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.List(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.c.List();return(e=(t=(n=a.map(function(e){return{value:e,label:e}}).sortBy(function(e){return e.value})).push.apply(n,Object(N.a)(r))).push.apply(t,Object(N.a)(i))).push.apply(e,Object(N.a)(o)).toArray()}),nr=function(e,t){if(null!==e)return e.map(function(e){return g.c.Map({label:"".concat(e.get("description","")," (").concat(e.get(t,""),")"),value:e.get(t,"")})})},ar=function(e){return e.list.get("available_groups",null)},rr=function(e){return e.list.get("pp_includes",null)},ir=Object(Nn.a)(function(e){return e.list.get("cycles_list",null)},function(e){if(null!==e)return e.map(function(e){return g.c.Map({label:xn(e),value:e.get("billrun_key","")})})}),or=Object(Nn.a)(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return g.c.Map().withMutations(function(t){n.forEach(function(n){var a=ee(["systemItems",n,"itemsType"],"");t.set(n,e.list.get("available_".concat(a),g.c.List()))})})},function(e){return e}),lr=Object(Nn.a)(function(e){return e.list.get("event_products",null)},function(e){return null===e?void 0:e}),sr=Object(Nn.a)(function(e){return e.list.get("suggestions_products",null)},function(e){return null===e?void 0:e}),cr=Object(Nn.a)(function(e){return e.list.get("all_rates",null)},function(){return"key"},nr),ur=Object(Nn.a)(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return e.list.get(n,null)},function(){return"key"},nr),pr=Object(Nn.a)(function(e){return e.list.get("available_accounts",null)},function(e){if(null!==e)return e.map(function(e){var t="";return t+=""!==e.get("firstname","").trim()?e.get("firstname","").trim():"",t+=""!==e.get("lastname","").trim()?" ".concat(e.get("lastname","").trim()):"",g.c.Map({label:t.trim(),value:e.get("aid","")})}).toJS()}),dr=Object(Nn.a)(function(e){return e.list.get("available_services",null)},function(){return"name"},nr),mr=Object(Nn.a)(function(e){return e.list.get("available_taxRates",null)},function(){return"key"},nr),gr=Object(Nn.a)(function(e){return e.list.get("available_plans",null)},function(){return"name"},nr),fr=Object(Nn.a)(Ca,function(e){if(null!==e)return e.map(function(e,t){return g.c.Map({label:e,value:t})})}),hr=Object(Nn.a)(ar,function(e){if(null!==e)return g.c.Set().withMutations(function(t){e.forEach(function(e){e.getIn(["include","groups"],g.c.Map()).keySeq().forEach(function(e){t.add(e)})})}).toList()}),vr=Object(Nn.a)(rr,function(e){if(null!==e)return e.map(function(e){return g.c.Map({label:e.get("name",""),value:e.get("name","")})})}),yr=Object(Nn.a)(rr,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e)return e.map(function(e){return{label:"".concat(e.get("name","")," (").concat(e.get("external_id",""),")"),value:e.get("external_id",""),charging_by:e.get("charging_by",""),charging_by_usaget:e.get("charging_by_usaget",""),charging_by_usaget_unit:e.get("charging_by_usaget_unit","")}}).toArray()}),br=Object(Nn.a)(rr,function(e){if(null!==e)return e.map(function(e){return g.c.Map({label:e.get("external_id",""),value:e.get("external_id","")})})}),Er=Object(Nn.a)(function(e){return e.list.get("audit")},function(e){return e}),Cr=Object(Nn.a)(function(e){return e.list.get("autocompleteUser",null)},function(e){if(null!==e)return e.map(function(e){return e.get("username")})}),_r=Object(Nn.a)(function(){return ee("systemItems")},function(e){if(null!==e)return e.filter(function(e){return e.get("audited",!1)}).map(function(e){return{key:e.get("collection",""),val:Object(D.sentenceCase)(e.get("itemsName",""))}}).toList().push({key:"Login",val:"Login"})}),Or=Object(Nn.a)(ar,function(e){if(null!==e)return g.c.Map().withMutations(function(t){e.forEach(function(e){e.getIn(["include","groups"],g.c.Map()).forEach(function(e,n){t.set(n,e)})})})}),Sr=Object(Nn.a)(function(){return ee("queue_calculators",[])},function(e){var t=[!1].concat(Object(N.a)(e));return e.map(function(e,n){return g.c.Map({label:Object(D.sentenceCase)(e),value:t[n]})})}),Tr=Object(Nn.a)(ar,function(e){if(null!==e)return g.c.Map().withMutations(function(t){e.forEach(function(e){t.set(e.get("name",""),e.getIn(["include","groups"],g.c.Map()).keySeq().toArray())})})}),kr=Object(Nn.a)(ar,va,function(e,t){return e?g.c.Set().withMutations(function(n){e.forEach(function(e){e.getIn(["include","groups"]).forEach(function(e){n.union(function(e,t){var n=g.c.List().withMutations(function(e){t&&!t.isEmpty()&&t.forEach(function(t){return e.push(t.get("unit",""))})}),a=g.c.List().withMutations(function(t){e.forEach(function(e){var n=e.get("uom",g.c.List()).reduce(function(e,t){return e.push(t.get("name",""))},g.c.List()),a=g.c.Map({type:e.get("type",""),uom:n});t.push(a)})});return g.c.Set().withMutations(function(e){a.forEach(function(t){n.forEach(function(n){t.get("uom",g.c.List()).includes(n)&&e.add(t.get("type",""))})})})}(t,e.get("usage_types",g.c.Map())))})})}):g.c.Set()}),jr=function(){return{type:"PROGRESS_INDICATOR_START"}},Ir=function(){return{type:"PROGRESS_INDICATOR_FINISH"}},wr="success",Nr="warning",Fr="danger",xr="info",Rr="DISMISS_ALL_ALERTS",Mr="DISMISS_ALERT",Pr="SHOW_ALERT",Ar={default:4e3,success:2e3,warning:4e3,danger:6e3,info:4e3},Dr=g.c.Record({type:"info",message:"",id:"",timeout:Ar.default});function Lr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ar.default,a=Zt.a.v4(),r=new Dr({message:e,type:t,id:a,timeout:n});return{type:Pr,alert:r}}function Ur(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Success",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ar.success;return Lr(e,wr,t)}function Vr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Warning",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ar.warning;return Lr(e,Nr,t)}function Br(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Error",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ar.danger;return Lr(e,Fr,t)}function qr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Info",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ar.info;return Lr(e,xr,t)}var zr=function(e){e.status;return Object(mt.a)(e,["status"])},Hr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(17574===e.code)throw window.location.reload(),new Error("login is required");return e},Yr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!e||0===e.status)throw e;return e},Gr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={credentials:"include"};return e&&Object.assign(t,e),t},Kr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch(e.api){case"billapi":case void 0:return"/billapi/".concat(e.entity,"/").concat(e.action);case"save":case"savePPIncludes":return"/admin/".concat(e.api);case"paymentgateways":case"custompaymentgateway":case"billrun":return"/".concat(e.api,"/").concat(e.action);default:return"/api/".concat(e.api)}},Wr=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n){var a=e.data[0].data,r=a.details,i=a.data,o=a.status,l=a.warnings,s=void 0===l?"warning":l;n(Ir());var c=null;try{if("undefined"===typeof r)throw new Error;c=r}catch(u){try{if("undefined"===typeof i)throw new Error;c=i}catch(p){}}if(1===o)t&&n(Ur(t));else if(2===o)try{(Array.isArray(s)?s:[s]).forEach(function(e){n(Vr(e,15e3))})}catch(u){}return{status:o,data:c}}},Jr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Error, please try again...";return function(n){if(console.log("Api Error Handler, error: ",e),n({type:"PROGRESS_INDICATOR_DISMISS"}),!1!==t){var a;if("string"===typeof e.message)a=e.message;else try{if("string"!==typeof(a=e.error[0].error.data.message))throw new Error}catch(r){try{if("string"!==typeof(a=e.error[0].error.message))throw new Error}catch(i){try{if("string"!==typeof(a=e.error.error[0].error.message))throw new Error}catch(o){try{if("string"!==typeof(a=e.error[0].error.desc))throw new Error}catch(l){a=t}}}}n(Br(a||t))}return{status:0,error:e}}},$r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Request timeout";return new Promise(function(a,r){var i=setTimeout(function(){r(new Error(n))},e);t.then(function(e){clearTimeout(i),a(e)}).catch(function(e){clearTimeout(i),r(e)})})},Qr=function(e){var t="".concat(ee(["env","serverApiUrl"],"")).concat(Kr(e)),n=e.params,a=document.createElement("form");a.target="_blank",a.method="POST",a.action=t,a.style.display="none",n.forEach(function(e){var t=Object.keys(e)[0],n=document.createElement("input");n.type="hidden",n.name=t,n.value=e[t],a.appendChild(n)}),document.body.appendChild(a),a.submit(),document.body.removeChild(a)},Zr=function(e){return"".concat(ee(["env","serverApiUrl"],"")).concat(Kr(e)).concat(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t="";return e&&Array.isArray(e)&&e.length>0&&(t=e.reduce(function(e,t,n){var a=Object.keys(t)[0],r=0===n?e:"".concat(e,"&");return"".concat(r).concat(encodeURIComponent(a),"=").concat(encodeURIComponent(t[a]))},"?")),t}(e.params))},Xr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Zr(e,t),a=Gr(e.options),r=e.name?{name:e.name}:{},i=e.timeout||ee(["env","serverApiTimeOut"],3e5);return $r(i,fetch(n,a),t.timeOutMessage).then(function(e){return e.json()}).then(Hr).then(Yr).then(function(e){return Object.assign(r,{data:e,status:1})}).catch(function(e){return Object.assign(r,{error:e,status:0})})},ei=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign({requiredAllSuccess:!0},t),a=Array.isArray(e)?e:[e],r=a.map(function(e){return Xr(e,n)});return Promise.all(r).then(function(e){var t=e.filter(function(e){return e.status}).map(zr),a=e.filter(function(e){return!e.status}).map(zr);if(t.length===e.length)return Promise.resolve({data:t});if(a.length===e.length)return Promise.reject({error:a});var r={error:a,data:t};return n.requiredAllSuccess?Promise.reject(r):Promise.resolve(r)})},ti=n(35),ni=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=Array.isArray(e)?e:[e],r={key:{$nin:[].concat(Object(N.a)(t),[""])},to:{$gt:S()().toISOString()},tariff_category:"retail"},i=[];"cost"!==a[0]&&i.push({$or:a.map(function(e){return Object(ti.a)({},"rates.".concat(e),{$exists:!0})})}),""!==n&&i.push({$or:[{play:{$exists:!0,$in:[].concat(Object(N.a)(n.split(",")),["",null])}},{play:{$exists:!1}}]}),0!==i.length&&(r.$and=i);var o=new FormData;return o.append("collection","rates"),o.append("size",99999),o.append("page",0),o.append("project",JSON.stringify({key:1,name:1})),o.append("query",JSON.stringify(r)),{api:"find",options:{method:"POST",body:o}}},ai=function(e,t){var n=new FormData;return n.append("action","save"),n.append("metadata",JSON.stringify(t)),n.append("query",JSON.stringify({filename:"file"})),n.append("file",e),{api:"files",name:"saveFile",options:{method:"POST",body:n}}},ri=function(e){return{api:"files",params:[{action:"read"},{query:JSON.stringify(e)}]}},ii=function(e,t){var n=new FormData;return n.append("category",t),n.append("action","set"),n.append("data",JSON.stringify(e)),{api:"settings",name:t,options:{method:"POST",body:n}}},oi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{api:"settings",name:e,params:[{category:e},{data:JSON.stringify(t)}]}},li=function(e,t){var n=new FormData;return n.append("category","file_types"),n.append("action",t),n.append("data",JSON.stringify(e)),{api:"settings",options:{method:"POST",body:n}}},si=function(e,t){return{api:"settings",params:[{category:"file_types"},{action:t},{data:JSON.stringify({file_type:e})}]}},ci=function(e,t){return{api:"settings",params:[{category:"export_generators"},{action:t},{data:JSON.stringify({name:e})}]}},ui=function(e,t,n,a){return{entity:"lines",action:"get",params:[{size:a},{page:t},{sort:JSON.stringify(n)},{query:JSON.stringify(e)}]}},pi=function(e,t,n,a){return{entity:"queue",action:"get",params:[{size:a},{page:t},{sort:JSON.stringify(n)},{query:JSON.stringify(e)}]}},di=function(e,t,n,a){return{entity:"balances",action:"get",params:[{size:a},{page:t},{sort:JSON.stringify(n)},{query:JSON.stringify(e)}]}},mi=function(e,t,n,a){return{entity:"balances",action:"get",params:[{size:a},{page:t},{sort:JSON.stringify(n)},{query:JSON.stringify(e)}]}},gi=function(e){return{api:"settings",params:[{category:"payment_gateways"},{action:"set"},{data:JSON.stringify(e)}]}},fi=function(e){return{api:"settings",params:[{category:"payment_gateways"},{action:"unset"},{data:JSON.stringify({name:e})}]}},hi=function(e,t,n){return{entity:e,action:t,timeout:36e5,options:{method:"POST",body:n}}},vi=function(e){return{action:"uniqueget",entity:e,params:[{query:JSON.stringify({"include.groups":{$exists:!0}})},{project:JSON.stringify({name:1,include:1})},{page:0},{size:9999}]}},yi=function(e,t){return{action:"get",entity:e,params:[{query:JSON.stringify({_id:t})},{page:0},{size:1}]}},bi=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:9999;switch(e){case"users":case"suggestions":t="get";break;default:t="uniqueget"}var l=null!==r?r:g.c.fromJS(n).filter(function(e){return 1===e});return{action:t,entity:e,params:[{page:0},{size:o},{query:JSON.stringify(a)},{project:JSON.stringify(n)},{sort:JSON.stringify(l)},{options:JSON.stringify(i)}]}},Ei=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{aid:1,firstname:1,lastname:1};return bi("accounts",e,{type:"account"})},Ci=function(){return bi("services",{name:1,description:1,play:1,quantitative:1,balance_period:1},{},{name:1})},_i=function(){return bi("prepaidincludes")},Oi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{key:1,description:1,play:1},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{key:1};return bi("rates",e,t,n)},Si=function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{key:1,description:1},t={tariff_category:"retail"};return bi("rates",e,t)}({key:1,description:1,rates:1})},Ti=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:1,description:1},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{name:1};return bi("plans",e,t,n)},ki=function(){return bi("users",{username:1})},ji=function(){return[vi("plans"),vi("services")]},Ii=bi("taxes",{key:1,description:1}),wi=function(e){return yi("services",e)},Ni=function(e){return yi("plans",e)},Fi=function(e){return{action:"uniqueget",entity:"rates",params:[{query:JSON.stringify({key:{$regex:"^".concat(e,"$")}})},{page:0},{size:1}]}},xi=function(e,t,n){var a=t.map(function(t){return g.c.Map({aid:e,sid:t.get("sid",""),rate:t.get("rate",""),credit_time:t.get("date",""),usagev:t.get("volume",""),type:t.get("type",""),aprice:t.get("price","")})});return{api:"onetimeinvoice",params:[{cdrs:JSON.stringify(a)},{aid:e},{send_email:n?1:0},{step:1},{allow_bill:1}]}},Ri=function(e,t,n,a,r){return{action:"get",entity:"audit",params:[{size:r},{page:t},{project:JSON.stringify(n)},{sort:JSON.stringify(a)},{query:JSON.stringify(e)}]}},Mi=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=new FormData;return r.append("page",0),r.append("size",9999),r.append("project",JSON.stringify(a)),r.append("sort",JSON.stringify(a)),r.append("query",JSON.stringify(Object(ti.a)({},t,{$in:n}))),{action:"uniqueget",entity:e,options:{method:"POST",body:r}}},Pi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Mi("rates","key",e,t)},Ai=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=[{aid:e}];return""!==t&&a.push({billrun_key:t}),""!==n&&a.push({query:JSON.stringify([[{field_name:"arate_key",op:"$eq",value:n}]])}),{api:"resetlines",params:a}},Di=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={api:"billrun",action:"cycles",params:[]};return e&&r.params.push({from:e}),t&&r.params.push({to:t}),r.params.push({newestFirst:n?1:0}),r.params.push({timeStatus:a?1:0}),r},Li=function(e){return{api:"billrun",action:"cycle",params:[{stamp:e}]}},Ui=function(e,t,n){return{api:"billrun",action:"completecycle",params:[{stamp:e},{rerun:t},{generate_pdf:n}]}},Vi=function(e){return{action:"get",entity:"billrun",params:[{query:JSON.stringify({billrun_key:e})},{project:JSON.stringify({_id:1})}]}},Bi=function(){return{api:"operations",params:[{action:"charge_account"},{filtration:"all"}]}},qi=function(e){var t=e.report,n=e.page,a=void 0===n?0:n,r=e.size,i=void 0===r?10:r;return{api:"report",params:[{action:"exportCSVReport"},{report:JSON.stringify(t)},{page:a},{size:i}]}},zi=function(e){return{api:"report",params:[{action:"exportCSV"},{report:e}]}},Hi=function(e,t){return{api:"accountinvoices",params:[{action:"expected_invoice"},{aid:e},{billrun_key:t}]}},Yi="GOT_LIST",Gi="ADD_TO_LIST",Ki="REMOVE_FROM_LIST",Wi="CLEAR_LIST",Ji="SET_NEXT_PAGE",$i=function(e,t){return{type:Yi,collection:e,list:t}},Qi=function(e,t){return{type:Gi,collection:e,items:t}},Zi=function(e,t){return function(n){return n(jr()),ei(t).then(function(t){try{return n($i(e,t.data[0].data.details)),n((a=t.data[0].data.next_page,{type:Ji,nextPage:a})),n(Wr(t))}catch(r){throw console.log("fetchList error: ",r),new Error("Error retrieving list")}var a}).catch(function(e){return n(Jr(e,"Network error - please refresh and try again"))})}},Xi=function(e){return{type:Wi,collection:e}},eo=function(e,t){return function(n){return n(Zi(e,t))}},to=function(e,t){return function(n){return n(function(e,t){return function(n){return n(jr()),ei(t).then(function(t){try{return n(Qi(e,t.data[0].data.details)),n(Wr(t))}catch(a){throw console.log("fetchToList error: ",a),new Error("Error retrieving list")}}).catch(function(e){return n(Jr(e,"Network error - please refresh and try again"))})}}(e,t))}},no=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(t){e.forEach(function(e){var n=Ye(ee(["systemItems",e,"uniqueField"],"")),a=g.c.Map().withMutations(function(t){t.set("_id",0),t.set("description",1),n.forEach(function(e){t.set(e,1)}),"service"===e&&t.set("quantitative",1)}),r=ee(["systemItems",e,"itemsType"],""),i=ee(["systemItems",e,"collection"],"");t(eo("available_".concat(r),bi(i,a)))})}},ao=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(t){e.forEach(function(e){var n=ee(["systemItems",e,"itemsType"],"");t(Xi("available_".concat(n)))})}},ro=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={val:null},n.onSelectPlan=function(e){e&&n.props.onSelectPlan(e),n.setState({val:null})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.planType;this.props.dispatch(eo("available_plans",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{name:1,description:1},n={connection_type:{$exists:!0}};return""!==e&&(n.connection_type.$eq=e),bi("plans",t,n)}(e)))}},{key:"render",value:function(){var e=this.props,t=e.options,n=e.selectedOptions,a=t.filter(function(e){return!n.includes(e.get("value",""))}).map(fe).toArray();return r.a.createElement("div",{className:"PlanSearch"},r.a.createElement(Tn,{fieldType:"select",value:this.state.val,onChange:this.onSelectPlan,options:a,placeholder:"Search by plan name...",noResultsText:"No plans found, please try another name"}))}}]),t}(a.Component);ro.defaultProps={options:g.c.List(),selectedOptions:[],onSelectPlan:function(){},planType:""};var io=Object(l.connect)(function(e,t){return{options:gr(e,t)}})(ro),oo=function(e,t){return t.item},lo=function(e,t){return t.location&&t.location.query&&t.location.query.action&&t.location.query.action.length>0?t.location.query.action:null},so=function(e,t){return t.params&&t.params.itemType&&t.params.itemType.length>0?t.params.itemType:null},co=function(e,t,n){if(n&&n.startsWith("source"))return e.entity.get(n);switch(n){case"prepaid_include":case"autorenew":case"customer":case"subscription":case"discount":case"charge":case"reports":case"importer":case"tax":return e.entity.get(n);case"charging_plan":return e.plan;default:return e[n]}},uo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;switch(e.get("entity")){case"customer":return t;case"subscription":return n;case"product":return a;default:return}},po=Object(Nn.a)(co,function(e,t,n){var a=ee(["systemItems",n,"collection"],"");return e.entityList.revisions.get(a)},function(e,t,n){return ee(["systemItems",n,"uniqueField"],"name")},function(e,t,n){if(t&&ue(e,!1))return t.get(e.get(n,""))}),mo=Object(Nn.a)(function(e,t){if(t.location&&t.location.query&&"undefined"!==typeof t.location.query.tab)return parseInt(t.location.query.tab)||void 0},function(e){return e}),go=Object(Nn.a)(function(e,t){if(t.location&&t.location.query&&"undefined"!==typeof t.location.query.t)return t.location.query.t},function(e){return e}),fo=Object(Nn.a)(function(e,t){if(t.location&&t.location.query&&"undefined"!==typeof t.location.query.u)return t.location.query.u},function(e){return e}),ho=Object(Nn.a)(function(e,t){if(t.location&&t.location.query&&"undefined"!==typeof t.location.query.sig)return t.location.query.sig},function(e){return e}),vo=Object(Nn.a)(function(e,t){if(t.location&&t.location.query&&"undefined"!==typeof t.location.query.message)return t.location.query.message},function(e){if(e)try{return JSON.parse(e)}catch(t){return}}),yo=Object(Nn.a)(function(e,t,n){return co(e,0,"source".concat(Object(D.upperCaseFirst)(n)))},function(e){return e}),bo=Object(Nn.a)(co,function(e){return e}),Eo=Object(Nn.a)(function(e,t){return t.params&&t.params.itemId&&t.params.itemId.length>0?t.params.itemId:null},function(e){return e}),Co=Object(Nn.a)(lo,Eo,bo,function(e,t,n){return e||(t?ue(n,!1)?me(n):"loading":"create")}),_o=Object(Nn.a)(so,function(e){return ee(["import","allowed_entities"],g.c.List()).includes(e)?e:void 0}),Oo=Object(Nn.a)(so,function(e){return ee("systemItems",g.c.Map()).keySeq().includes(e)?e:void 0}),So=Object(Nn.a)(lo,Eo,bo,function(e,t,n){return e||(t?ue(n,!1)?"update":"loading":"create")}),To=Object(Nn.a)(sa,ua,function(e,t){return e?null:t}),ko=Object(Nn.a)(oo,To,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return ge(e,t)}),jo=Object(Nn.a)(lo,function(e){return e||void 0}),Io=Object(Nn.a)(yo,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("rates")}),wo=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).handleSelectTab=function(e){var t=n.props.location,a=t.pathname,r=t.query;n.props.router.push({pathname:a,query:Object.assign({},r,{tab:e})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.children,a=e.activeTab;return r.a.createElement("div",null,r.a.createElement(f.B,{defaultActiveKey:a,animation:!1,id:t,onSelect:this.handleSelectTab},n))}}]),t}(a.Component);wo.defaultProps={id:Zt.a.v4(),children:null,activeTab:1};var No=Object(s.f)(Object(l.connect)(function(e,t){return{activeTab:mo(e,t)}})(wo)),Fo=n(275),xo=n.n(Fo),Ro=function(e){var t=e.steps,n=e.activeIndex;return r.a.createElement("div",{className:"stepper-container"},r.a.createElement(xo.a,{titleTop:5,lineMarginOffset:10,circleTop:0,size:25,titleFontSize:12,circleFontSize:12,activeStep:n,steps:t,defaultBorderColor:"#cccccc",defaultBorderStyle:"solid",defaultBorderWidth:1,activeColor:"#008cba",activeBorderColor:"#004b63",activeBorderStyle:"solid",activeBorderWidth:1,completeColor:"#008cba",completeTitleColor:"#757575",completeBorderColor:"#008cba",completeBorderStyle:"solid",completeBorderWidth:1}))};Ro.defaultProps={activeStep:0,steps:[]};var Mo=Ro,Po=n(26),Ao=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).handleTouchTap=n.handleTouchTap.bind(Object(Po.a)(n)),n.handleRequestClose=n.handleRequestClose.bind(Object(Po.a)(n)),n.state={open:!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleTouchTap",value:function(e){this.setState({open:!0,anchorEl:e.currentTarget})}},{key:"handleRequestClose",value:function(){this.setState({open:!1})}},{key:"render",value:function(){var e=this.props.contents;if(!e||""===e)return null;var t=r.a.createElement(f.C,{id:"tooltip"},e);return r.a.createElement("span",{style:{margin:5}},r.a.createElement(f.t,{placement:"top",overlay:t},r.a.createElement("i",{className:"fa fa-question-circle",style:{cursor:"pointer"}})))}}]),t}(a.Component),Do={name:"Unique key for the plan",description:"The title of the plan",add_product:"Add product to override price",add_include:"Add include unit type",include_groups:"Plan Include Groups",included_services:"Services that are included in the plan"},Lo={name:"The key of the service",description:"The title of the service",service_period_type_cycle:"Eligibility period is for a fixed / infinite number of billing cycles since subscribing to the service. Service price / includes are per cycle.",service_period_type_custom_period:"Service is charged once for the whole period. Includes are valid for the whole defined period and are independent of the billing cycle."},Uo={name:"Group name should be unique for all plans",products:"Products should be unique for all plans",shared_desc:"The includes will be shared with all the customer's subscribers. This is useful for family or organization package",pooled_desc:"When the 'Pooled' option is activated, each subscriber, under the same customer, will 'Add' its 'Includes' allocation to the customer pool. The allocation can be either monetary allocation or a volume [call minutes, GBs of data, etc] based.",quantityAffected_desc:"When the 'Quantity Affected' option is activated, each subscriber, under the same customer, will 'Add' its 'Includes' allocation to the customer pool, multiplied by the subscribers' service quantity. The allocation can be either monetary allocation or a volume [call minutes, GBs of data, etc] based."},Vo={description:"Title",key:"Key",tieredPricing:"tiered pricing defines a price PER unit within a range",volumePricing:"volume pricing defines a price for ALL units within the range",addToRetail:"in case of non retail rate, determine whether or not the product will be included in the retail price"},Bo={description:"Title",key:"Key",sequential:'When checked, the "percent off" considers already discounted amounts (by former discounts)'},qo={method_simple:"All Rows",method_grouped:"Group rows",block_conditions:"You can use conditions to refine reports to show only results that meet specific criteria.",block_columns_simple:"Please add one or more report columns.",block_columns_grouped:"Please add one or more report columns and their function.",block_sort:"You can set sort fields to control the order in which data appears in a report.",block_formatter:"You can set column format to change default style of report value.",block_preview:"Click on preview to generate the report.",add_sort_disabled_no_fields:"To add sort first select report columns",add_formatter_disabled_no_fields:"To add column format first select report columns",add_conditions_disabled_no_entity:"To add conditions first select report entity",add_columns_disabled_no_entity:"To add columns first select report entity"},zo={email_after_confirmation:'Once an invoice is confirmed, it will be emailed to the customer\'s email for customer eligible for the "email" shipping method'},Ho={key:"The key of the tax",description:"The title of the tax"},Yo={regexHelper:"In case you want to run a regular expression on the computed field before calculating the rate",mustMetHelper:"This means than in case the condition is not met - a rate will not be found"},Go={over_group:"The balance entity stores usages & costs on the subscriber level. There is one main balance per billing cycle per subscriber which keeps track of the services & products included in the subscriber's plan, as well as exceeding usages. Multiple balances can exist at the same time, in case services are purchased by the subscriber."},Ko=function(e){var t=e.item,n=e.conditionFieldsOptions,i=e.valueWhenOptions,o=e.onSaveComputedLineKey,l=e.onHideComputedLineKey,s=Object(a.useState)(t),c=Object(w.a)(s,2),u=c[0],p=c[1],d=["$exists","$existsFalse","$isTrue","$isFalse"].includes(u.get("operator",""));if(!u)return null;var m=function(e){return function(t){var n=t.target.value;p(u.setIn(e,n))}},h=function(e){return function(t){var n=u.withMutations(function(n){n.setIn(e,t);var a=e[1];if("operator"===e[0]){var r="$regex"===u.get("operator","")&&"$regex"!==t,i="$regex"!==u.get("operator","")&&"$regex"===t;(r||i||d)&&(n.deleteIn(["line_keys",1]),n.deleteIn(["line_keys",0,"regex"]))}"hard_coded"===t?n.deleteIn(["projection",a,"value"]):"condition_result"===t&&(n.deleteIn(["projection",a,"value"]),n.deleteIn(["projection",a,"regex"]))});p(n)}},v=function(e){var t=e.target.value,n=u.withMutations(function(e){e.set("type",t),"regex"===t&&(e.deleteIn(["line_keys",1]),e.delete("operator"),e.delete("must_met"),e.delete("projection"))});p(n)},y=ee(["rates","conditions"],Object(g.b)()).map(he).toArray(),b="regex"===u.get("type","regex");return r.a.createElement(it,{title:"Computed Rate Key",show:!0,onOk:function(){o(u)},onHide:l,labelOk:"OK",modalSize:"large"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:2},"Computation Type"),r.a.createElement(f.g,{sm:10},r.a.createElement("span",null,r.a.createElement("span",{className:"inline mr10"},r.a.createElement(Tn,{fieldType:"radio",name:"computed-type",id:"computed-type-regex",value:"regex",checked:b,onChange:v,label:"Regex"})),r.a.createElement("span",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",name:"computed-type",id:"computed-type-condition",value:"condition",checked:!b,onChange:v,label:"Condition"}))))),r.a.createElement("div",{className:"separator"}),r.a.createElement(f.l,{key:"computed-field-1"},r.a.createElement(f.g,{sm:2,componentClass:f.h},b?"Field":"First Field"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:h(["line_keys",0,"key"]),value:u.getIn(["line_keys",0,"key"],""),options:n,allowCreate:!0})),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:u.getIn(["line_keys",0,"regex"],""),disabledValue:"",onChange:h(["line_keys",0,"regex"]),disabled:""===u.getIn(["line_keys",0,"key"],"")||d,label:r.a.createElement("span",null,"Regex",r.a.createElement(Ao,{contents:Yo.regexHelper})),fieldType:"toggeledInput"}))),!b&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.l,{key:"computed-operator"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Operator"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:h(["operator"]),value:u.get("operator",""),options:y}))),r.a.createElement(f.l,{key:"computed-field-2"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Second Field"),r.a.createElement(f.g,{sm:5},"$regex"===u.get("operator","")&&r.a.createElement(Tn,{value:u.getIn(["line_keys",1,"key"],""),onChange:function(e){var t=e.target.value;p(u.setIn(["line_keys",1,"key"],t))}}),"$regex"!==u.get("operator","")&&r.a.createElement(Tn,{fieldType:"select",onChange:h(["line_keys",1,"key"]),value:u.getIn(["line_keys",1,"key"],""),options:n,disabled:d})),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:u.getIn(["line_keys",1,"regex"],""),disabledValue:"",onChange:h(["line_keys",1,"regex"]),disabled:""===u.getIn(["line_keys",1,"key"],"")||"$regex"===u.get("operator",""),label:r.a.createElement("span",null,"Regex",r.a.createElement(Ao,{contents:Yo.regexHelper})),fieldType:"toggeledInput"}))),r.a.createElement(f.l,{key:"computed-must-met"},r.a.createElement(f.g,{componentClass:f.h,sm:2},"Must met?",r.a.createElement(Ao,{contents:Yo.mustMetHelper})),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"checkbox",id:"computed-must-met",value:u.get("must_met",!1),onChange:function(e){var t=e.target.value,n=u.withMutations(function(e){e.set("must_met",t),t&&e.setIn(["projection","on_false"],Object(g.b)())});p(n)},className:"input-min-line-height"}))),r.a.createElement(f.l,{key:"computed-cond-project-true"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Value when True"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:h(["projection","on_true","key"]),value:u.getIn(["projection","on_true","key"],"condition_result"),options:i})),["hard_coded"].includes(u.getIn(["projection","on_true","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:u.getIn(["projection","on_true","value"],""),onChange:m(["projection","on_true","value"])})),!["","hard_coded","condition_result"].includes(u.getIn(["projection","on_true","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:u.getIn(["projection","on_true","regex"],""),disabledValue:"",onChange:h(["projection","on_true","regex"]),disabled:""===u.getIn(["projection","on_true","key"],""),label:"Regex",fieldType:"toggeledInput"}))),r.a.createElement(f.l,{key:"computed-cond-project-false"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Value when False"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:h(["projection","on_false","key"]),value:u.getIn(["projection","on_false","key"],"condition_result"),options:i,disabled:u.get("must_met",!1)})),["hard_coded"].includes(u.getIn(["projection","on_false","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:u.getIn(["projection","on_false","value"],""),onChange:m(["projection","on_false","value"])})),!["","hard_coded","condition_result"].includes(u.getIn(["projection","on_false","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:u.getIn(["projection","on_false","regex"],""),disabledValue:"",onChange:h(["projection","on_false","regex"]),disabled:""===u.getIn(["projection","on_false","key"],""),label:"Regex",fieldType:"toggeledInput"}))))))};Ko.defaultProps={item:Object(g.b)(),conditionFieldsOptions:[],valueWhenOptions:[]};var Wo=Ko,Jo=function(e){var t=e.condition,n=e.index,i=e.priorityIndex,o=e.type,l=e.onUpdate,s=e.onRemove,c=e.allowRemove,u=e.lineKeyOptions,p=e.paramsKeyOptions,d=e.paramsTypeOptions,m=e.conditionFieldsOptions,h=e.valueWhenOptions,v=Object(a.useState)(null),y=Object(w.a)(v,2),b=y[0],E=y[1],C=Object(a.useMemo)(function(){return Object(g.b)({type:t.getIn(["computed","type"],"regex"),line_keys:t.getIn(["computed","line_keys"],Object(g.a)()),operator:t.getIn(["computed","operator"],""),must_met:t.getIn(["computed","must_met"],!1),projection:Object(g.b)({on_true:Object(g.b)({key:t.getIn(["computed","projection","on_true","key"],"condition_result"),regex:t.getIn(["computed","projection","on_true","regex"],""),value:t.getIn(["computed","projection","on_true","value"],"")}),on_false:Object(g.b)({key:t.getIn(["computed","projection","on_false","key"],"condition_result"),regex:t.getIn(["computed","projection","on_false","regex"],""),value:t.getIn(["computed","projection","on_false","value"],"")})})})},[t]),_=Object(a.useCallback)(function(e){"computed"===e?E(C):t.has("computed")&&l([n,"computed"],null),l([n,"line_key"],e)},[l,n,C,t]),O=Object(a.useCallback)(function(e){l([n,"type"],e)},[l,n]),S=Object(a.useCallback)(function(e){l([n,"entity_key"],e)},[l,n]),T=Object(a.useCallback)(function(e){l([n,"line_key"],"computed"),l([n,"computed"],e),E(null)},[l,n]),k=Object(a.useMemo)(function(){return[{type:"remove",onClick:s,show:c,helpText:"Remove Condition ".concat(n+1," of Priority ").concat(i+1),actionStyle:"default"}]},[s,c,i,n]),j=Object(a.useMemo)(function(){var e=t.getIn(["computed","operator"],""),n=ee(["rates","conditions"],Object(g.b)()).find(function(t){return t.get("id","")===e},null,Object(g.b)()).get("title",""),a=t.getIn(["computed","line_keys",0,"key"],""),r=m.find(function(e){return e.value===a}),i=t.getIn(["computed","line_keys",1,"key"],""),o=m.find(function(e){return e.value===i});return[{type:"edit",onClick:function(){E(C)},label:"".concat(r?r.label:a," ").concat(n," ").concat(o?o.label:i),show:"computed"===t.get("line_key",""),actionClass:"pr0 pl0 mt5"}]},[t,m,C]),I=Object(a.useMemo)(function(){return d.map(he).toArray()},[d]);return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",null,"CDR Field")),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{fieldType:"select",options:u,onChange:_,value:t.get("line_key","")}),r.a.createElement(vt,{actions:j,data:n})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",null,"Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement(Tn,{fieldType:"select",options:I,onChange:O,value:t.get("type",""),disabled:""===t.get("line_key","")})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",null,Object(D.titleCase)(o)," Parameter")),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{fieldType:"select",options:p,onChange:S,value:t.get("entity_key",""),disabled:""===t.get("type","")})),r.a.createElement(f.g,{sm:1},r.a.createElement(vt,{actions:k,data:n})),r.a.createElement(f.g,{sm:12,smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("hr",{className:"mt10 mb10"})),b&&r.a.createElement(Wo,{onSaveComputedLineKey:T,onHideComputedLineKey:function(){E(null)},item:b,conditionFieldsOptions:m,valueWhenOptions:h}))};Jo.defaultProps={condition:Object(g.b)(),index:0,allowRemove:!0,priorityIndex:0,lineKeyOptions:[],paramsKeyOptions:[],conditionFieldsOptions:[],valueWhenOptions:[],paramsTypeOptions:ee(["rates","paramsConditions"],Object(g.a)())};var $o=Object(a.memo)(Jo),Qo={marginTop:5},Zo=function(e){var t=e.priority,n=e.index,i=e.type,o=e.paramsKeyOptions,l=e.lineKeyOptions,s=e.conditionFieldsOptions,c=e.valueWhenOptions,u=e.onUpdate,p=e.onRemove,d=e.onAdd,m=Object(a.useMemo)(function(){return[n]},[n]),h=Object(a.useMemo)(function(){return[].concat(Object(N.a)(m),["filters"])},[m]),v=Object(a.useMemo)(function(){return t.get("filters",Object(g.a)())},[t]),y=Object(a.useCallback)(function(e,t){null===t?u(h,v.deleteIn(e)):u([].concat(Object(N.a)(h),Object(N.a)(e)),t)},[u,h,v]),b=Object(a.useCallback)(function(e){p([].concat(Object(N.a)(h),[e]))},[p,h]),E=Object(a.useMemo)(function(){return[{type:"remove",onClick:p,helpText:"Remove Priority ".concat(n+2),actionClass:"pr0 pl0 pt0"}]},[p,n]),C=r.a.createElement("div",null,"Priority ".concat(n+2),r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:E,data:m})));return r.a.createElement(f.v,{header:C,collapsible:!0,className:"collapsible",defaultExpanded:!0},r.a.createElement("div",{className:"priority-conditions"},r.a.createElement(f.g,{sm:12,className:"form-inner-edit-rows"},v.isEmpty()&&r.a.createElement("small",null,"No conditions found"),!v.isEmpty()&&r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{className:"ml5 mb0"},"CDR Field")),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{className:"mb0"},"Operator")),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{className:"mb0"},Object(D.titleCase)(i)," Parameter")),r.a.createElement(f.g,{sm:1,xsHidden:!0})),v.map(function(e,t){return r.a.createElement($o,{key:t,index:t,priorityIndex:n,allowRemove:v.size>1,type:i,lineKeyOptions:l,paramsKeyOptions:o,conditionFieldsOptions:s,valueWhenOptions:c,condition:e,onUpdate:y,onRemove:b})})),r.a.createElement(f.g,{sm:12,className:"ml5 pl0"},r.a.createElement(ct,{onClick:d,data:h,label:"Add Condition",buttonStyle:Qo}))))};Zo.defaultProps={priority:Object(g.b)(),lineKeyOptions:[],paramsKeyOptions:[],conditionFieldsOptions:[],valueWhenOptions:[],index:0};var Xo=Object(a.memo)(Zo),el={},tl={marginLeft:21},nl=Object(g.b)(),al=Object(g.b)({filters:Object(g.a)([nl]),cache_db_queries:!0}),rl=function(e){var t=e.type,n=e.category,i=e.priorities,o=e.lineKeyOptions,l=e.paramsKeyOptions,s=e.conditionFieldsOptions,c=e.valueWhenOptions,u=e.onAdd,p=e.onUpdate,d=e.onRemove,m=Object(a.useCallback)(function(e){u([n,"priorities"].concat(Object(N.a)(e)),nl)},[u,n]),h=Object(a.useCallback)(function(){var e=al.set("uiFlag",Object(g.b)({id:Zt.a.v4()}));u([n,"priorities"],e)},[u,n]),v=Object(a.useCallback)(function(e){var t=e.target.value;p([n,"default_fallback"],t)},[p,n]),y=Object(a.useCallback)(function(e,t){p([n,"priorities"].concat(Object(N.a)(e)),t)},[p,n]),b=Object(a.useCallback)(function(e){d([n,"priorities"].concat(Object(N.a)(e)))},[d,n]);return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("div",{style:tl},"Priority 1")},r.a.createElement(Tn,{fieldType:"checkbox",value:!0,label:"Use tax rate forced by product/service/plan",disabled:!0})),i.get("priorities",Object(g.a)()).map(function(e,a){return r.a.createElement(Xo,{key:e.getIn(["uiFlag","id"],a),index:a,category:n,type:t,priority:e,count:i.size,lineKeyOptions:o,paramsKeyOptions:l,conditionFieldsOptions:s,valueWhenOptions:c,onAdd:m,onUpdate:y,onRemove:b})}),r.a.createElement(f.v,{header:r.a.createElement("div",{style:tl},"Priority ",i.get("priorities",Object(g.a)()).size+2)},r.a.createElement(Tn,{fieldType:"checkbox",value:!0,label:"Use tax rate referenced by product/service/plan",disabled:!0})),r.a.createElement(f.v,{header:r.a.createElement("div",{style:tl},"Priority ",i.get("priorities",Object(g.a)()).size+3)},r.a.createElement(Tn,{fieldType:"checkbox",value:i.get("default_fallback",!1),onChange:v,label:"Use default tax rate"})),r.a.createElement(ct,{label:"Add Priority",onClick:h,buttonStyle:el}))};rl.defaultProps={priorities:Object(g.b)(),lineKeyOptions:[],paramsKeyOptions:[],conditionFieldsOptions:[],valueWhenOptions:[]};var il=rl,ol=Object(Nn.a)(function(e,t){switch(t.config.getIn(["inputConfig","callback"])){case"getCyclesOptions":return ir(e,t);case"getProductsOptions":var n=t.config.getIn(["inputConfig","callbackArgument"],g.c.Map());if(!n.isEmpty()){var a=qe(n);return ur(e,t,a)}return cr(e,t);case"getPlansOptions":return gr(e,t);case"getServicesOptions":return dr(e,t);case"getGroupsOptions":return hr(e,t);case"getUsageTypesOptions":return ga(e,t);case"getBucketsOptions":return vr(e,t);case"getBucketsExternalIdsOptions":return br(e,t);case"getFileTypeOptions":return ma(e,t);case"getPlayTypeOptions":return fr(e,t);case"getCalcNameOptions":return Sr(e,t);case"getEventCodeOptions":return fa(e,t);case"getTaxesOptions":return mr(e,t);default:return}},function(e){return e}),ll="UPDATE_SETTING",sl="GOT_SETTINGS",cl="ADD_PAYMENT_GATEWAY",ul="REMOVE_PAYMENT_GATEWAY",pl="UPDATE_PAYMENT_GATEWAY",dl="REMOVE_SETTING_FIELD",ml="PUSH_TO_SETTING",gl="SET_FIELD_POSITION",fl=function(e){return{type:cl,gateway:e}},hl=function(e){return{type:ul,gateway:e}},vl=function(e){return{type:pl,gateway:e}},yl=function(e,t,n){return{type:ll,category:e,name:t,value:n}},bl=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{type:ml,category:e,path:n,value:t}},El=function(e,t){return{type:dl,category:e,name:t}},Cl=function(e){return{type:sl,settings:e}},_l=function(e,t){var n="data:image/png;base64,".concat(e);return yl("files",t,n)},Ol=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ai(e,t);return ei(n)},Sl=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file";return function(n){var a=localStorage.getItem(t);if(a)return n(_l(a,t));var r=ri(e);return ei(r).then(function(e){return e.data&&e.data[0]&&e.data[0].data&&e.data[0].data.desc?(localStorage.setItem(t,e.data[0].data.desc),n(_l(e.data[0].data.desc,t)),!0):e}).catch(function(e){return n(Jr(e)),e})}},Tl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,a){var r=t.success,i=void 0===r?"Settings saved successfully!":r,o=t.error,l=void 0===o?"Error saving settings":o,s=["import.mapping"];n(jr());var c=a().settings,u=Array.isArray(e)?e:[e];if(0===(u=u.filter(function(e){return!s.includes(e)})).length){return n(Wr({data:[{data:{status:2,warnings:"No settings to save"}}]}))}var p=u.length>1,d=u.map(function(e){var t=c.getIn(e.split("."));return"taxation"===e&&(t=t.set("vat",t.get("vat")/100)),p?Object(ti.a)({},e,t):t}),m=p?"ROOT":u[0],g=p?d:d[0],f=ii(g,m);return ei(f).then(function(e){return n(Wr(e,i))}).catch(function(e){return n(Jr(e,l))})}},kl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var a=(Array.isArray(e)?e:[e]).map(function(e){return oi(e,t)});return ei(a).then(function(e){return n(Cl(e.data)),!0}).catch(function(e){return n(Jr(e)),!1})}},jl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e?localStorage.clear():e.forEach(function(e){localStorage.removeItem(e)})},Il=function(e,t){return function(n){n(jr());var a,r="remove"===t?(a=e,{api:"settings",params:[{category:"shared_secret"},{action:"unset"},{data:JSON.stringify({key:a})}]}):function(e){return{api:"settings",params:[{category:"shared_secret"},{action:"set"},{data:JSON.stringify(e)}]}}(e);return ei(r).then(function(e){var a=["create"].includes(t)?"created":"";return""===a&&(a=["remove"].includes(t)?"removed":"updated"),n(Wr(e,"The secret key was ".concat(a)))}).catch(function(e){return n(Jr(e,"Error saving secret"))})}},wl={getPlansOptions:function(){return eo("available_plans",Ti())},getCyclesOptions:function(){return eo("cycles_list",Di())},getServicesOptions:function(){return eo("available_services",Ci())},getUsageTypesOptions:function(){return kl("usage_types")},getBucketsOptions:function(){return eo("pp_includes",_i())},getBucketsExternalIdsOptions:function(){return eo("pp_includes",_i())},getFileTypeOptions:function(){return kl("file_types")},getPlayTypeOptions:function(){return kl("plays")},getEventCodeOptions:function(){return kl("events")},getTaxesOptions:function(){return eo("available_taxRates",Ii)},getGroupsOptions:function(){return function(e){return ei(ji()).then(function(t){try{return e($i("available_groups",t.data[0].data.details)),e(Qi("available_groups",t.data[1].data.details)),e(Wr(t))}catch(n){throw new Error("Error retrieving 'Groups' options")}}).catch(function(t){return e(Jr(t))})}},getProductsOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return function(t){if(e.isEmpty())return t(eo("all_rates",Oi()));var n=qe(e);return t(eo(n,Oi({key:1,description:1},e)))}},unknownCallback:function(e){console.log("unsupported select options callback, data: ",e)}},Nl=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).initFieldOptions=function(e,t){if(e.hasIn(["inputConfig","callback"])&&t.isEmpty()){var a=e.getIn(["inputConfig","callback"]),r=e.getIn(["inputConfig","callbackArgument"],g.c.Map());if(wl.hasOwnProperty(a))return n.props.dispatch(wl[a](r));var i={callback:a,args:r};return wl.unknownCallback(i)}},n.onChangeText=function(e){var t=e.target.value;n.props.onChange(t)},n.onChangeSelect=function(e){var t=n.props.field,a=["nin","in","$nin","$in"].includes(t.get("op",""));if(e&&e.length>0){var r=a?Ye(e.split(",")):e;n.props.onChange(r)}else{var i=a?g.c.List():"";n.props.onChange(i)}},n.onChangeBoolean=function(e){var t=""===e?"":[1,"1","true",!0,"yes","on"].includes(e);n.props.onChange(t)},n.onChangeNumber=function(e){var t=e.target.value,a=Number(t);isNaN(a)?n.props.onChange(t):n.props.onChange(a)},n.onChangePercentage=function(e){var t=e.target.value,a=x()(t)?parseFloat(t)/100:t;isNaN(a)?n.props.onChange(t):n.props.onChange(a)},n.onChangeMultiValues=function(e){var t=n.props,a=t.config,r=t.operator;Array.isArray(e)?[a.get("type",""),r.get("type","")].includes("number")?n.props.onChange(g.c.List(e).map(function(e){return x()(e)?parseFloat(e):e})):n.props.onChange(g.c.List(e)):n.props.onChange(g.c.List())},n.onChangeDate=function(e){if(S.a.isMoment(e)&&e.isValid()){var t=ee("apiDateTimeFormat","YYYY-MM-DD");n.props.onChange(e.format(t))}else n.props.onChange(null)},n.onChangeDateTime=function(e){if(S.a.isMoment(e)&&e.isValid()){var t=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");n.props.onChange(e.format(t))}else n.props.onChange(null)},n.onChangeDateOption=function(e){"date"===e?n.props.onChange(null):n.props.onChange(e)},n.getOptionsValues=function(e){var t=e.config,n=e.operator,a=e.dynamicSelectOptions,r=e.customValueOptions;return g.c.List().withMutations(function(e){a&&e.concat(a),t&&e.concat(t.getIn(["inputConfig","options"],g.c.List())),n&&e.concat(n.get("options",g.c.List())),r&&r.forEach(function(t){e.push(g.c.fromJS(he(t)))})}).map(fe).toArray()},n.formatValueTagDateTime=function(e){return S()(e).format(ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"))},n.formatValueTagPercentage=function(e){return x()(e)?"".concat(parseFloat((100*parseFloat(e)).toFixed(3)),"%"):e},n.formatValueTagDate=function(e){return S()(e).format(ee("dateFormat","DD/MM/YYYY"))},n.renderCustomInputDate=function(e){var t=e.addTag,n=e.disabled,a=ee("apiDateTimeFormat","YYYY-MM-DD");return r.a.createElement("span",{className:"custom-field-input"},r.a.createElement(Tn,{fieldType:"date",value:null,onChange:function(e){t(e.format(a))},disabled:n}))},n.renderCustomInputDateTime=function(e){var t=e.addTag,n=e.disabled,a=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");return r.a.createElement("span",{className:"custom-field-input"},r.a.createElement(Tn,{fieldType:"datetime",value:null,onChange:function(e){t(e.format(a))},disabled:n}))},n.renderCustomInputNumber=function(e){e.addTag;var t=e.onChange,n=e.value,a=Object(mt.a)(e,["addTag","onChange","value"]);return r.a.createElement(Tn,Object.assign({fieldType:"number",onChange:t,value:n},a))},n.renderCustomInputPercentage=function(e){e.addTag;var t=e.onChange,n=e.value,a=Object(mt.a)(e,["addTag","onChange","value"]);return r.a.createElement(Tn,Object.assign({fieldType:"percentage",onChange:t,value:n},a))},n.renderInputBoolean=function(){var e=n.props,t=e.field,a=e.disabled,i=e.editable,o=e.operator,l=t.get("value","");""!==l&&(l=[1,"1","true",!0,"yes","on"].includes(t.get("value",""))?1:0);var s=[{value:1,label:o.get("trueLabel","Yes")},{value:0,label:o.get("falseLabel","No")}];return r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:s,value:l,onChange:n.onChangeBoolean,disabled:a,editable:i})},n.renderInputSelect=function(){var e=n.props,t=e.field,a=e.disabled,i=e.editable,o=e.config,l=e.operator,s=e.dynamicSelectOptions,c=e.customValueOptions,u=n.getOptionsValues({config:o,operator:l,dynamicSelectOptions:s,customValueOptions:c}),p=["nin","in","$nin","$in"].includes(t.get("op",""));return r.a.createElement(Tn,{fieldType:"select",clearable:!1,multi:p,options:u,value:Ye(t.get("value",[])).join(","),onChange:n.onChangeSelect,disabled:a,editable:i})},n.renderInputNumber=function(){var e=n.props,t=e.field,a=e.disabled,i=e.editable;if(["nin","in","$nin","$in"].includes(t.get("op",""))){var o=Ye(t.get("value",[])).toArray();return r.a.createElement(Tn,{fieldType:"tags",value:o,onChange:n.onChangeMultiValues,disabled:a,editable:i,renderInput:n.renderCustomInputNumber})}return r.a.createElement(Tn,{fieldType:"number",value:t.get("value",""),onChange:n.onChangeNumber,disabled:a,editable:i})},n.renderInputPercentage=function(){var e=n.props,t=e.field,a=e.disabled,i=e.editable;if(["nin","in","$nin","$in"].includes(t.get("op",""))){var o=Ye(t.get("value",[])).toArray();return r.a.createElement(Tn,{fieldType:"tags",value:o,onChange:n.onChangeMultiValues,disabled:a,editable:i,renderInput:n.renderCustomInputPercentage,getTagDisplayValue:n.formatValueTagPercentage})}return r.a.createElement(Tn,{fieldType:"percentage",value:t.get("value",""),onChange:n.onChangeNumber,disabled:a,editable:i})},n.renderInputDate=function(){var e=n.props,t=e.field,a=e.disabled,i=e.editable,o=e.config,l=e.operator,s=e.dynamicSelectOptions,c=e.customValueOptions;if(["nin","in","$nin","$in"].includes(t.get("op",""))){var u=Ye(t.get("value",[])).toArray();return r.a.createElement(Tn,{fieldType:"tags",value:u,onChange:n.onChangeMultiValues,disabled:a,editable:i,renderInput:n.renderCustomInputDate,getTagDisplayValue:n.formatValueTagDate})}var p=t.get("value",null),d=n.getOptionsValues({config:o,operator:l,dynamicSelectOptions:s,customValueOptions:c});if(d.length>0){var m=d.findIndex(function(e){return e.value===p}),g=-1===m?"Date":d[m].label;return r.a.createElement(f.o,null,r.a.createElement(f.i,{disabled:a,onSelect:n.onChangeDateOption,componentClass:f.o.Button,id:"date-select-options",title:g,className:"full-width"},r.a.createElement(f.q,{key:"date",eventKey:"date"},"Select Date:"),r.a.createElement(f.q,{divider:!0}),d.map(function(e){return r.a.createElement(f.q,{key:e.value,eventKey:e.value},e.label)})),-1===m&&r.a.createElement(Tn,{fieldType:"date",value:S()(p),onChange:n.onChangeDateTime,disabled:a,editable:i}))}return r.a.createElement(Tn,{fieldType:"date",value:S()(p),onChange:n.onChangeDateTime,disabled:a,editable:i})},n.renderInputDateTime=function(){var e=n.props,t=e.field,a=e.disabled,i=e.editable;if(["nin","in","$nin","$in"].includes(t.get("op",""))){var o=Ye(t.get("value",[])).toArray();return r.a.createElement(Tn,{fieldType:"tags",value:o,onChange:n.onChangeMultiValues,disabled:a,editable:i,renderInput:n.renderCustomInputDateTime,getTagDisplayValue:n.formatValueTagDateTime})}var l=S()(t.get("value",null)).utc();return r.a.createElement(Tn,{fieldType:"datetime",value:l,onChange:n.onChangeDateTime,disabled:a,editable:i})},n.renderInputString=function(){var e=n.props,t=e.field,a=e.disabled,i=e.editable;if(["nin","in","$nin","$in"].includes(t.get("op",""))){var o=Ye(t.get("value",[])).toArray();return r.a.createElement(Tn,{fieldType:"tags",value:o,onChange:n.onChangeMultiValues,disabled:a,editable:i})}return r.a.createElement(Tn,{value:t.get("value",""),onChange:n.onChangeText,disabled:a})},n.renderInput=function(){var e=n.props,t=e.field,a=e.config,r=e.operator;return[a.get("type",""),r.get("type","")].includes("boolean")?n.renderInputBoolean():[a.get("type","string"),r.get("type","")].includes("string")&&("select"===a.getIn(["inputConfig","inputType"])||r.has("options"))&&["eq","ne","nin","in","$eq","$ne","$nin","$in","is","$is"].includes(t.get("op",""))?n.renderInputSelect():[a.get("type",""),r.get("type","")].includes("number")?n.renderInputNumber():[a.get("type",""),r.get("type","")].includes("percentage")?n.renderInputPercentage():[a.get("type",""),r.get("type","")].includes("date")?n.renderInputDate():[a.get("type",""),r.get("type","")].includes("datetime")?n.renderInputDateTime():n.renderInputString()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.config,n=e.dynamicSelectOptions;this.initFieldOptions(t,n)}},{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.field,a=t.config,r=t.operator,i=t.dynamicSelectOptions,o=t.disabled,l=t.editable;return!g.c.is(n,e.field)||!g.c.is(a,e.config)||!g.c.is(i,e.dynamicSelectOptions)||!g.c.is(r,e.operator)||o!==e.disabled||l!==e.editable}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.config,a=t.dynamicSelectOptions,r=t.operator,i=t.customValueOptions;g.c.is(e.config,n)||this.initFieldOptions(n,a);var o=g.c.fromJS(this.getOptionsValues({config:n,operator:r,dynamicSelectOptions:a,customValueOptions:i})),l=g.c.fromJS(this.getOptionsValues({config:e.config,operator:e.operator,dynamicSelectOptions:e.dynamicSelectOptions,customValueOptions:e.customValueOptions})),s=!l.isEmpty()&&!o.map(function(e){return e.get("value")}).sort().equals(l.map(function(e){return e.get("value")}).sort());(""!==e.config.get("type","")&&e.config.get("type","")!==n.get("type","")||s)&&this.props.onChange("")}},{key:"render",value:function(){var e=this.props.operator,t=this.renderInput();return e.has("prefix")?r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,e.get("prefix","")),t):e.has("suffix")?r.a.createElement(f.o,null,t,r.a.createElement(f.o.Addon,null,e.get("suffix",""))):t}}]),t}(a.Component);Nl.defaultProps={field:g.c.Map(),config:g.c.Map(),operator:g.c.Map(),dynamicSelectOptions:g.c.List(),customValueOptions:g.c.List(),disabled:!1,editable:!0,onChange:function(){}};var Fl=Object(l.connect)(function(e,t){return{dynamicSelectOptions:ol(e,t)}})(Nl),xl=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeField=function(e){var t=n.props.index;n.props.onChangeField(t,e)},n.onChangeOperator=function(e){var t=n.props.index;n.props.onChangeOperator(t,e)},n.onChangeValue=function(e){var t=n.props.index;n.props.onChangeValue(t,e)},n.onRemove=function(e){var t=n.props.index;n.props.onRemove(t,e)},n.getConfig=function(){var e=n.props,t=e.item;return e.fields.find(function(e){return e.get("id","")===t.get("field","")},null,g.c.Map())},n.getOperator=function(){var e=n.props,t=e.item,a=e.operators,r=n.getConfig();return a.filter(function(e){return!n.isInBlackList(e,r)&&n.isInWhiteList(e,r)}).find(function(e){return e.get("id","")===t.get("op","")},null,g.c.Map())},n.getFieldOptions=function(){return n.props.fields.filter(function(e){return e.get("filter",!0)}).map(he).toArray()},n.isInBlackList=function(e,t){var a=n.props.item,r=e.get("exclude",g.c.List()),i="fieldid:".concat(t.get("id","")),o=t.get("type","string"),l="op:".concat(a.get("op",""));return r.includes(i)||r.includes(o)||r.includes(l)},n.isInWhiteList=function(e,t){var a=n.props.item,r=e.get("include",g.c.List()),i="fieldid:".concat(t.get("id","")),o=t.get("type","string"),l="op:".concat(a.get("op",""));return r.includes(o)||r.includes(i)||r.includes(l)},n.getOpOptions=function(){var e=n.props.operators,t=n.getConfig();return e.filter(function(e){return!n.isInBlackList(e,t)&&n.isInWhiteList(e,t)}).map(he).toArray()},n.getCustomValueOptions=function(){var e=n.props.customValueOptions,t=n.getConfig();return e.filter(function(e){return!n.isInBlackList(e,t)&&n.isInWhiteList(e,t)})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.item,a=t.index,r=t.disabled,i=t.fields,o=t.operators,l=t.editable,s=t.error;return!g.c.is(n,e.item)||!g.c.is(i,e.fields)||!g.c.is(o,e.operators)||a!==e.index||r!==e.disabled||l!==e.editable||s!==e.error}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,a=n.item,r=n.index,i=this.getOpOptions()||[];""===a.get("op","")&&1===i.length?this.props.onChangeOperator(r,i[0].value):e.item.get("field","")===a.get("field","")||""===a.get("op","")||i.map(function(e){return e.value}).includes(a.get("op",""))||this.props.onChangeOperator(r,"")}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.disabled,a=e.editable,i=e.error,o=this.getConfig(),l=this.getOperator(),s=this.getFieldOptions(),c=this.getOpOptions(),u=this.getCustomValueOptions(),p=n||""===t.get("field",""),d=n||""===t.get("op","")||p;return r.a.createElement(f.l,{className:"form-inner-edit-row",validationState:i?"error":null},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:4,className:"pl0"},r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:s,value:t.get("field",""),onChange:this.onChangeField,disabled:n,editable:a})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},"Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:c,value:t.get("op",""),onChange:this.onChangeOperator,disabled:p,editable:a})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Value")),r.a.createElement(f.g,{sm:4},r.a.createElement(Fl,{field:t,config:o,operator:l,customValueOptions:u,disabled:d,editable:a,onChange:this.onChangeValue})),a&&r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:this.onRemove,bsSize:"small",className:"pull-left",disabled:n},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))),i&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.n,null,r.a.createElement("small",null,i))))}}]),t}(a.Component);xl.defaultProps={item:g.c.Map(),index:0,disabled:!1,editable:!0,fields:g.c.List(),operators:g.c.List(),customValueOptions:g.c.List(),error:!1,onChangeField:function(){},onChangeOperator:function(){},onChangeValue:function(){},onRemove:function(){}};var Rl=xl,Ml=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onAddCondition=function(){n.props.onAdd(t.defaultCondition)},n.renderRow=function(e,t){var a=n.props,i=a.operators,o=a.fields,l=a.customValueOptions,s=a.disabled,c=a.editable,u=a.errors;return r.a.createElement(Rl,{key:t,item:e,index:t,fields:o,operators:i,customValueOptions:l,disabled:s,editable:c,error:u.get("".concat(t),!1),onChangeField:n.props.onChangeField,onChangeOperator:n.props.onChangeOperator,onChangeValue:n.props.onChangeValue,onRemove:n.props.onRemove})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.conditions,a=t.fields,r=t.disabled,i=t.editable,o=t.operators,l=t.addConditionLabel,s=t.noConditionsLabel,c=t.errors;return!g.c.is(n,e.conditions)||!g.c.is(a,e.fields)||!g.c.is(o,e.operators)||!g.c.is(c,e.errors)||r!==e.disabled||i!==e.editable||l!==e.addConditionLabel||s!==e.noConditionsLabel}},{key:"render",value:function(){var e=this.props,t=e.conditions,n=e.disabled,a=e.editable,i=e.fields,o=e.addConditionLabel,l=e.noConditionsLabel,s=t.map(this.renderRow),c=i.isEmpty()||n;return r.a.createElement("div",{className:"conditions-list"},!s.isEmpty()&&r.a.createElement(f.g,{sm:12,className:"form-inner-edit-rows"},r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"field"},"Field")),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"operator"},"Operator")),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"value"},"Value")))),s.isEmpty()&&l.length>0&&r.a.createElement(f.g,{sm:12},r.a.createElement("small",null,l)),!s.isEmpty()&&r.a.createElement(f.g,{sm:12},s),a&&this.props.onAdd&&r.a.createElement(f.g,{sm:12,className:"pl0 pr0"},r.a.createElement(ct,{onClick:this.onAddCondition,label:o,disabled:c})))}}]),t}(a.Component);Ml.defaultProps={conditions:g.c.List(),fields:g.c.List(),operators:g.c.List(),customValueOptions:g.c.List(),errors:g.c.Map(),disabled:!1,editable:!0,addConditionLabel:"Add Condition",noConditionsLabel:"No conditions found",onChangeField:function(){},onChangeOperator:function(){},onChangeValue:function(){},onAdd:null,onRemove:function(){}},Ml.defaultCondition=g.c.Map({field:"",op:"",value:""});var Pl=Ml,Al=n(104),Dl="Oops! Something went wrong. Please try again in a few moments.",Ll="GOT_ENTITY",Ul="UPDATE_ENTITY_FIELD",Vl="DELETE_ENTITY_FIELD",Bl="CLEAR_ENTITY",ql="CLONE_RESET_ENTITY",zl=function(e,t,n){return{type:Ul,collection:e,path:t,value:n}},Hl=function(e,t){return{type:Vl,collection:e,path:t}},Yl=function(e,t){return{type:Ll,collection:e,entity:t}},Gl=function(e,t){return{type:Ll,collection:"source".concat(Object(D.upperCaseFirst)(e)),entity:t}},Kl=function(e,t){return{type:ql,collection:e,uniquefields:ee(["systemItems",t,"uniqueField"],[])}},Wl=function(e){return{type:Bl,collection:e}},Jl=function(e,t,n){return function(e,t){var n=ee("apiDateFormat","YYYY-MM-DD");switch(t){case"move":var a=new FormData,r={_id:e.getIn(["_id","$id"],"undefined")};a.append("query",JSON.stringify(r));var i=e.has("from")?{from:ce(e,"from").format(n)}:{to:ce(e,"to").format(n)};return a.append("update",JSON.stringify(i)),a;case"close":var o=new FormData,l={_id:e.getIn(["_id","$id"],"undefined")};o.append("query",JSON.stringify(l));var s={to:ce(e,"to").format(n)};return o.append("update",JSON.stringify(s)),o;case"delete":var c=new FormData,u={_id:e.getIn(["_id","$id"],"undefined")};return c.append("query",JSON.stringify(u)),c;case"create":var p=new FormData,d=ce(e,"from").format(n),m=e.withMutations(function(e){e.set("from",d).delete("originalValue")});return p.append("update",JSON.stringify(m)),p;case"import":var f=new FormData;return e.has("files")&&e.get("files",[]).forEach(function(e,t){f.append("files[".concat(t,"]"),e,e.name)}),f.append("update",JSON.stringify(e.delete("files"))),f;case"export":var h=ee(["env","exportVersion"],"");return e.map(function(e,t){return""!==h&&"file_name"===t?"".concat(e,"_").concat(h):e}).reduce(function(e,t,n){return e.push(Object(ti.a)({},n,JSON.stringify(t)))},g.c.List()).toArray();case"update":var v=new FormData,y={_id:e.getIn(["_id","$id"],"undefined")},b=e.withMutations(function(e){e.delete("_id").delete("originalValue")});return v.append("query",JSON.stringify(y)),v.append("update",JSON.stringify(b)),v;case"closeandnew":var E=new FormData,C=e.withMutations(function(t){var n=ce(e,"originalValue",null);null!==n&&n.isSame(ce(e,"from",S()(0)),"days")&&t.delete("from"),t.delete("_id").delete("originalValue")});E.append("update",JSON.stringify(C));var _={_id:e.getIn(["_id","$id"],"undefined")};return E.append("query",JSON.stringify(_)),E;case"reopen":var O=new FormData,T={_id:ue(e,"undefined")},k={from:e.get("from","undefined")};return O.append("query",JSON.stringify(T)),O.append("update",JSON.stringify(k)),O;default:return new FormData}}(t,n)},$l=function(e,t,n){return function(a){a(jr());var r=function(e,t,n){return"closeandnew"===n&&ce(t,"from").isSame(ce(t,"originalValue",S()(0)),"day")?"update":"clone"===n?"create":n}(0,t,n),i=Jl(0,t,r),o=hi(e,r,i);return ei(o,{timeOutMessage:Dl}).then(function(e){return a(Wr(e))}).catch(function(e){return a(Jr(e,"Error saving Entity"))})}},Ql=function(e,t){return function(n){var a=ee(["systemItems",e,"collection"],e),r=function(e,t){return{action:"export",entity:e,params:t,options:{method:"GET"}}}(a,Jl(0,t,"export")),i=Zr(r);return window.open(i),!0}},Zl=function(e,t){return function(n){return n(jr()),ei(t,{timeOutMessage:Dl}).then(function(t){return n(Yl(e,t.data[0].data.details[0])),n(Wr(t))}).catch(function(e){return n(Jr(e,"Error retrieving Entity"))})}},Xl=function(e,t){return function(n){return n(Zl(e,t))}},es=function(e,t){return function(n){return n($l(e,t,"delete"))}},ts=function(e,t){return function(n){return n($l(e,t,"close"))}},ns=function(e,t,n){return function(a){var r=g.c.Map().withMutations(function(e){e.set("_id",t.get("_id")),"to"===n?e.set("to",t.get("to")):e.set("from",t.get("from"))});return a($l(e,r,"move"))}},as=function(e,t,n){return function(a){var r=g.c.Map({_id:t.get("_id"),from:n});return a($l(e,r,"reopen"))}},rs=function(e,t){return!t.get("mandatory",!1)||(t.get("type",!1),!["",null,void 0].includes(e))||"".concat(t.get("title",t.get("field_name",""))," field is required.")},is=function(e,t,n,a,r,i){return function(o){var l=bi(e,n,t,a,r,i);return ei(l,{timeOutMessage:Dl}).then(function(e){if(e&&e.data&&e.data[0]&&e.data[0].data&&e.data[0].data.details)return e.data[0].data.details;throw new Error}).catch(function(e){return!1})}},os=function e(t,n){var a=n.get("multiple",!1);if(""===t||a&&(Array.isArray(t)&&0===t.length||g.c.is(t,g.c.List())))return!1;if(a&&(Array.isArray(t)||g.c.Iterable.isIterable(t))){var r=n.set("multiple",!1);return t.reduce(function(t,n){return!1!==t?t:e(n,r)},!1)}switch(n.get("type","")){case"number":case"decimal":return!x()(t)&&"Value must be numeric";case"integer":return(!x()(t)||"".concat(parseInt(t))!=="".concat(t))&&"Value must be integer";case"json":return!1===t;default:return!1}},ls=function(e){var t=e.sid,n=e.aid,a=e.editable,i=e.onChange,o=e.searchPlaceholder,l=e.noResultsPlaceholder,s=e.dispatch,c={value:0,label:"Customer Level",aid:0},u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.filter(function(e){return!t.includes(e.get("sid",""))}).map(p).toList().insert(0,c).toArray()},p=function(e){var t=[re(e),ie(e)].map(function(e){return e.trim()}).filter(function(e){return""!==e}).join(" "),n=e.get("sid",""),a=e.get("aid","");return{value:x()(n)?parseFloat(n):n,label:"".concat(t," (Subscriber ID: ").concat(e.get("sid",""),", Customer ID: ").concat(e.get("aid",""),")"),aid:x()(a)?parseFloat(a):a,name:t}},d=Object(Al.a)(500,function(e,t){!function(e,t){if(""===e)return t([c]);var a={firstname:{$regex:e,$options:"i"},lastname:{$regex:e,$options:"i"},aid:parseFloat(n),sid:parseFloat(e)};s(is("subscribers",a,{sid:1,aid:1,firstname:1,lastname:1},{aid:1,sid:1,firstname:1,lastname:1},{or_fields:["firstname","lastname","sid"]})).then(function(e){return t(u(g.c.fromJS(e)))}).catch(function(){return t([])})}(e,t)});return r.a.createElement(Tn,{fieldType:"select",value:"".concat(t),onChange:function(e,t){t.option;i(e)},clearable:!1,isAsync:!0,isControlled:!1,cacheOptions:!0,defaultOptions:!0,placeholder:o,loadAsyncOptions:d,noResultsText:l,disabled:!a})};ls.defaultProps={sid:0,aid:0,currency:"",editable:!0,accountsOptions:[],searchPlaceholder:"Enter subscriber id, customer id, first name or last name",noResultsPlaceholder:"No subscriber found"};var ss=Object(l.connect)()(ls),cs=function(e){var t=e.editable,n=e.onChange,a=e.searchPlaceholder,i=e.noResultsPlaceholder,o=e.dispatch,l=function(e){return e.map(s).toList().toArray()},s=function(e){return{value:e.get("key",""),label:e.get("description",""),play:e.play}},c=Object(Al.a)(500,function(e,t){!function(e,t){if(""===e)return t([]);var n={key:{$regex:e,$options:"i"},description:{$regex:e,$options:"i"}},a={or_fields:Object.keys(n)};o(is("rates",n,{key:1,description:1,play:1},{description:1},a)).then(function(e){return t(l(g.c.fromJS(e)))}).catch(function(){return t([])})}(e,t)});return r.a.createElement(Tn,{fieldType:"select",onChange:function(e){n(e)},clearable:!1,isAsync:!0,isControlled:!1,cacheOptions:!0,placeholder:a,loadAsyncOptions:c,noResultsText:i,disabled:!t})};cs.defaultProps={editable:!0,accountsOptions:[],searchPlaceholder:"Enter key or title",noResultsPlaceholder:"No rates found"};var us=Object(l.connect)()(cs),ps="SET_PAGE_TITLE",ds="SYSTEM_REQUIREMENTS_LOADING_COMPLETE",ms="READY",gs="RUNNING",fs="FINISHED",hs="STARTING",vs="PAUSED",ys="CANCELED";function bs(e){return{type:ps,title:e}}var Es=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{type:"SET_ON_BOARDING_STEP",step:e}},Cs=function(){return{type:"SET_ON_BOARDING_STATE",state:ms}},_s=function(){return{type:"SET_ON_BOARDING_STATE",state:vs}},Os=function(){return{type:"SET_ON_BOARDING_STATE",state:gs}},Ss=function(){return{type:"SET_ON_BOARDING_STATE",state:fs}},Ts=function(){return{type:"SET_ON_BOARDING_STATE",state:ys}},ks=function(e){return{type:"CONFIRM_SHOW",confirm:e}},js=function(e,t,n){return{type:"EDIT_FORM_SHOW",item:e,component:t,config:n}},Is=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{type:"EDIT_FORM_SET_ERROR",fieldId:e,message:t}},ws=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{type:"SET_PAGE_FLAG",page:e,flag:t,value:n}},Ns=Object(Nn.a)(function(e){return e.guiState.page.getIn(["onBoarding","state"])},function(e){return e}),Fs=Object(Nn.a)(function(e){return e.guiState.page.getIn(["onBoarding","step"])},function(e){return e}),xs=Object(Nn.a)(Ns,function(e){return e===gs}),Rs=Object(Nn.a)(Ns,function(e){return e===fs}),Ms=Object(Nn.a)(Ns,function(e){return e===ms}),Ps=Object(Nn.a)(Ns,function(e){return e===vs}),As=Object(Nn.a)(Ns,function(e){return e===hs}),Ds=Object(Nn.a)(function(e){return e.guiState.page.getIn(["formModalData","item"])},function(e){return e}),Ls=Object(Nn.a)(function(e){return e.guiState.page.getIn(["formModalData","component"])},function(e){return e}),Us=Object(Nn.a)(function(e){return e.guiState.page.getIn(["formModalData","config"])},function(e){return e}),Vs=Object(Nn.a)(function(e){return e.guiState.page.getIn(["formModalData","errors"])},function(e){return e}),Bs=Object(Nn.a)(function(e){return e.guiState.page.getIn(["formModalData","show"])},function(e){return e}),qs=Object(Nn.a)(function(e){return e.guiState.page.getIn(["confirm"])},function(e){return e}),zs=Object(Nn.a)(function(e){return e.guiState.menu.getIn(["main"])},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.reduce(function(e,t){return t.get("subMenus",g.c.List()).isEmpty()?e:e.push.apply(e,Object(N.a)(t.get("subMenus",g.c.List())))},e).reduce(function(e,t){if(""!==t.get("route","")){var n=g.c.Map({view:t.get("roles",g.c.List())});return e.set(t.get("route","-"),n)}return e},g.c.Map())}),Hs=Object(Nn.a)(function(e){return e.guiState.page.get("flag")},function(e,t,n){return n},function(e,t,n,a){return a},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=null!==n?[t,n]:[t];return e.getIn(a,void 0)}),Ys=function(e){var t=e.confirm,n=e.dispatch;if(!1===t.get("show",!1))return null;var a=function(e){return function(){e&&"function"===typeof e&&e(),n({type:"CONFIRM_HIDE"})}},i=t.get("labelOk"),o=a(t.get("onOk")),l=t.get("labelCancel"),s=a(t.get("onCancel")),c=t.get("message"),u=t.get("type"),p=t.get("children");return r.a.createElement(lt,{show:!0,labelOk:i,onOk:o,labelCancel:l,onCancel:s,message:c,type:u},p)};Ys.defaultProps={confirm:g.c.Map()};var Gs=Object(l.connect)(function(e){return{confirm:qs(e)}})(Ys),Ks=n(39),Ws=function(e){var t=e.show,n=e.item,a=e.component,i=e.config,o=e.hideModal,l=e.closeModal,s=e.errors,c=Object(mt.a)(e,["show","item","component","config","hideModal","closeModal","errors"]);if(!t)return null;if(t&&!a)throw new Error("ReduxFormModal require component parameter");var u=i.toJS(),p=u.title,d=u.labelOk,m=void 0===d?"Save":d,g=u.onOk,f=u.labelCancel,h=void 0===f?"Cancel":f,v=u.onCancel,y=u.modalSize,b=void 0===y?"large":y,E=u.allowSubmitWithError,C=void 0!==E&&E,_=u.showOnOk,O=void 0===_||_,S=Object(mt.a)(u,["title","labelOk","onOk","labelCancel","onCancel","modalSize","allowSubmitWithError","showOnOk"]),T=o(v);return r.a.createElement(it,{show:!0,title:p,onOk:function(){if(!C&&s.some(function(e){return!e||e.length>0}))return!1;return o(g)(n)},labelOk:m,onCancel:T,labelCancel:h,onHide:l,modalSize:b,showOnOk:O},function(e,t){var n=t.item,a=t.setItem,i=t.updateField,o=t.removeField,l=t.setError,s=Object(mt.a)(t,["item","setItem","updateField","removeField","setError"]);return r.a.createElement(e,Object.assign({},s,{item:n,setItem:a,setError:l,updateField:i,removeField:o}))}(a,Object(Ks.a)({item:n,errors:s},c,S)))};Ws.defaultProps={show:!1,item:void 0,component:void 0,config:g.c.Map(),errors:g.c.Map()};var Js=Ws,$s=Object(l.connect)(function(e){return{show:Bs(e),item:Ds(e),component:Ls(e),config:Us(e),errors:Vs(e)}},function(e){return{closeModal:function(){var t={message:"Are you sure you want to close and discard all changes?",labelOk:"Yes",type:"delete",onOk:function(){return e({type:"EDIT_FORM_HIDE"})}};return e(ks(t))},hideModal:function(t){return function(n){if(t&&"function"===typeof t){var a=t(n);return a&&a.then&&"function"===typeof a.then?a.then(function(){e({type:"EDIT_FORM_HIDE"})}).catch(function(){}):!1!==a&&e({type:"EDIT_FORM_HIDE"})}return e({type:"EDIT_FORM_HIDE"})}},setItem:function(t){e({type:"EDIT_FORM_SET_ITEM",item:t})},updateField:function(t,n){e(function(e,t){return{type:"EDIT_FORM_UPDATE_ITEM_FIELD",path:e,value:t}}(t,n))},removeField:function(t){e(function(e){return{type:"EDIT_FORM_DELETE_ITEM_FIELD",path:e}}(t))},setError:function(t,n){e(Is(t,n))}}},function(e,t,n){var a={};return e.config&&e.config.get("skipConfirmOnClose",!1)&&(a.closeModal=t.hideModal()),Object(Ks.a)({},e,Object(Ks.a)({},t,a),n)})(Js),Qs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return{type:"TOGGLE_SIDE_BAR",state:e}},Zs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:"PREPARE_MAIN_MENU_STRUCTURE",mainMenuOverrides:e}},Xs=function(e){return ee("mainMenu",g.c.Map()).withMutations(function(t){e&&e.size&&e.forEach(function(e,n){t.has(n)&&e.forEach(function(e,a){t.setIn([n,a],e)})})})},ec=function e(t,n){return t.filter(function(e){return e.get("parent")===n}).map(function(e,t){return e.set("id",t)}).toList().sort(function(e,t){return e.get("order",999)<t.get("order",999)?-1:1}).map(function(n,a){var r=e(t,n.get("id"));return n.withMutations(function(e){r.size&&e.set("subMenus",r),e.set("order",a)})})},tc="LOGOUT",nc=function(e){return Xl("users",function(e){return yi("users",e)}(e))},ac=function(e,t){return $l("users",e,t)},rc=function(e){return function(t){return t(es("users",e))}},ic=function(e,t){return{type:Ul,collection:"users",path:e,value:t}},oc=function(e){return{type:Vl,collection:"users",path:e}},lc=function(e){return{type:"LOGIN",data:e}},sc=function(){return{type:tc}},cc=function(e,t){return function(n){var a=function(e,t){var n=new FormData;return n.append("username",e),n.append("password",t),{api:"auth",options:{method:"POST",body:n}}}(e,t);return n(jr()),n({type:"CLEAR_LOGIN_ERROR"}),ei(a).then(function(e){return n(lc(e.data[0].data.details)),n(Ir()),e}).catch(function(e){return n(function(e){return{type:"LOGIN_ERROR",error:e}}("Incorrect username or password, please try again.")),n(Ir()),e})}},uc=function(){return function(e){var t={api:"auth",params:[{action:"logout"}]};return e(jr()),ei(t).then(function(t){return e(sc()),e(Ir()),jl(),t}).catch(function(t){return e(Ir()),jl(),t})}},pc=function(e){return function(t){t(jr());var n=function(e){return{api:"passwordretrieval",params:[{action:"sendForm"},{email:e}]}}(e);return ei(n).then(function(e){return t(Wr(e,"Success. If the user exists, a password reset email should be received shortly"))}).catch(function(e){return t(Jr(e,"Error sending email"))})}},dc=function(e,t,n,a){return function(r){r(jr());var i=function(e,t,n,a){return{action:"changepassword",entity:"users",params:[{query:JSON.stringify({_id:e})},{update:JSON.stringify({password:a})},{_sig_:t},{_t_:n}]}}(e,t,n,a);return ei(i).then(function(e){return r(Wr(e,"The password was changed successfuly"))}).catch(function(e){return r(Jr(e))})}},mc=function(e){var t=e.route,n=e.id,a=e.active,i=e.icon,o=e.title,l=e.onSetActive,c=k()({active:a});return r.a.createElement(s.b,{to:"/".concat(t),id:n,className:c,onClick:function(){l(n)}},r.a.createElement("i",{className:i}),r.a.createElement("span",null,o))};mc.defaultProps={route:"",id:"",active:!1,icon:"",title:"",onSetActive:function(){}};var gc=mc,fc=function(e){var t=e.id,n=e.open,a=e.active,i=e.icon,o=e.title,l=e.collapse,s=e.children,c=k()("sub-menu",{open:n}),u=k()({active:!1!==a}),p=r.a.createElement("a",{href:"#id",id:t,onClick:function(n){n.preventDefault(),e.onClick(t)},className:u,key:"main_link"},r.a.createElement("i",{className:i}),r.a.createElement("span",null,o),r.a.createElement("span",{className:"fa arrow"})),d=r.a.createElement("ul",{className:"nav nav-second-level"},s);if(!(l||!n&&!1!==a))return r.a.createElement("li",{className:c},p,d);var m=!1===a?r.a.createElement(f.C,{id:t},r.a.createElement("i",{className:"fa ".concat(i," fa-fw")})," ",o):r.a.createElement(f.C,{id:"".concat(t,"_").concat(a.get("id","open"))},r.a.createElement("span",null,r.a.createElement("i",{className:"fa ".concat(i," fa-fw")})," ",o,"\xa0",r.a.createElement("i",{className:"fa fa-angle-right fa-fw"})," ",a.get("title","")));return r.a.createElement("li",{className:c},r.a.createElement(f.t,{placement:l?"right":"top",overlay:m},p),d)};fc.defaultProps={children:null,id:"",title:"",icon:"",open:!1,active:!1,collapse:!1,onClick:function(){}};var hc=fc,vc=n(291),yc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={startIndex:0,autoStart:!0,run:!1},n.onCancel=function(){n.props.dispatch(Ts())},n.onPause=function(){n.props.dispatch(_s())},n.onFinish=function(){n.onStepChanged(0),n.props.dispatch(Ss())},n.onPending=function(){n.onStepChanged(0),n.props.dispatch(Cs()),n.setState({autoStart:!0})},n.onStart=function(){n.props.dispatch(Os())},n.onRestart=function(){n.onStepChanged(0),n.onStart(),n.setState({autoStart:!0})},n.onStepChanged=function(e){n.props.dispatch(Es(e))},n.switchToRun=function(){n.setState({run:!0})},n.askCancel=function(){var e={message:"Are you sure you want to skip the tour ?",onOk:n.onCancel,labelOk:"Skip tour",type:"delete"};n.props.dispatch(ks(e))},n.getSteps=function(){return[{title:"1. Customer details",text:r.a.createElement("span",null,"Customer name, id and address. Invoices are generated per customer.",r.a.createElement("br",null),r.a.createElement(s.b,{to:"customers/customer",onClick:n.onPause},"Click here to create a customer")),style:{beacon:{offsetY:-75}},selector:".table-info",type:"click"},{title:"2. Plans",text:r.a.createElement("span",null,"A customer can have multiple subscriptions, each one tied to exactly one plan with recurring charges.",r.a.createElement("br",null),r.a.createElement(s.b,{to:"plans/plan",onClick:n.onPause},"Click here to create a plan")),style:{beacon:{offsetY:-25}},selector:".step-plan",type:"click"},{title:"3. Services",text:r.a.createElement("span",null,"Every subscription can register to extra services that are charged periodically.",r.a.createElement("br",null),r.a.createElement(s.b,{to:"services/service",onClick:n.onPause},"Click here to create a service")),style:{beacon:{offsetY:-25}},selector:".step-service",type:"click"},{title:"4. Discounts",text:r.a.createElement("span",null,"Build automatic discounts based on various combinations on subscription plans / services.",r.a.createElement("br",null),r.a.createElement(s.b,{to:"discounts/discount",onClick:n.onPause},"Click here to create a discount")),style:{beacon:{offsetY:-25}},selector:".step-discount",type:"click"},{title:"5. Subscription details",text:r.a.createElement("span",null,"This section appears for every subscription of the customer and shows aggregated amounts on the subscription level."),style:{beacon:{offsetY:-25}},selector:".step-subscription-details",type:"click"},{title:"6. Usage details",text:r.a.createElement("span",null,"If billing also by usage, the usage details can be included in the invoice (optional).",r.a.createElement("br",null),"BillRun's input processors can receive events either in online (HTTP request) or offline (files) mode.",r.a.createElement("br",null),r.a.createElement(s.b,{to:{pathname:"/select_input_processor_template",query:{action:"new"}},onClick:n.onPause},"Click here to set up an input processor")),style:{beacon:{offsetY:-25}},selector:".table-usage",type:"click"},{title:"7. Products",text:r.a.createElement("span",null,"You can create different products which define pricing rules based on various usage events.",r.a.createElement("br",null),r.a.createElement(s.b,{to:"/products/product",onClick:n.onPause},"Click here to create a product")),style:{beacon:{offsetY:-25}},selector:".step-products",type:"click"},{title:"8. Company details",text:r.a.createElement("span",null,"Your company logo, name, address, etc. appear at the invoice header & footer.",r.a.createElement("br",null),r.a.createElement(s.b,{to:{pathname:"/settings",query:{tab:1}},onClick:n.onPause},"Set up your company details here")),style:{beacon:{offsetY:-25}},selector:".step-company-details-header",type:"click"},{title:"9. Billing cycle management",text:r.a.createElement("span",null,"You are in full control of the billing cycle run. See the billing cycle run progress as it runs and watch invoices as soon as they're created. Confirm or reset the cycle after reviewing it and charge your customers, all functionalities available from one screen!",r.a.createElement("br",null),r.a.createElement(s.b,{to:"run_cycle",onClick:n.onPause},"Go to billing cycle management screen")),style:{beacon:{offsetY:-65}},selector:".step-period",type:"click"}]},n.joyrideEventHandler=function(e){var t=n.props.step;if(["close"].includes(e.action)||"finished"!==e.type)if("error:target_not_found"===e.type){var a="next"===e.action?e.index+1:e.index-1;n.setState({startIndex:a}),n.onStepChanged(a)}else if("close"===e.action&&"finished"===e.type){var r=Math.max(e.steps.length-2,0);n.setState({startIndex:r,run:!0,autoStart:!1})}else"start"===e.action?0!==t&&n.setState({startIndex:t}):"next"===e.action&&"step:before"===e.type?n.onStepChanged(e.index):"back"===e.action&&"step:after"===e.type&&n.onStepChanged(e.index-1);else n.onFinish()},n.renderIsReadyContent=function(){return r.a.createElement(f.y,null,r.a.createElement(f.g,{smPush:1,sm:10},r.a.createElement("p",null,"In this short tutorial we will walk you through the main features of BillRun by examining a sample BillRun invoice and guiding you how to do it yourself with just a few clicks.")),r.a.createElement(f.g,{smPush:1,sm:10},r.a.createElement(f.c,{onClick:n.onStart,bsStyle:"success"},"Let's start the tour!")))},n.renderIsFinishedContent=function(){return r.a.createElement(f.y,null,r.a.createElement(f.g,{smPush:1,sm:10},r.a.createElement("p",null,"We're done!"),r.a.createElement("p",null,"Thank you for taking the tour!")),r.a.createElement(f.g,{smPush:1,sm:10},r.a.createElement(f.c,{onClick:n.onPending,bsStyle:"success"},"Start Using Billrun!")))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e,t){var n=this.props,a=n.isPaused,r=n.isRunnig,i=this.state.autoStart;(a&&!e.isPaused||!r&&e.isRunnig)&&(i||t.autoStart?setTimeout(this.switchToRun,500):this.switchToRun()),e.isRunnig||this.setState({startIndex:0})}},{key:"render",value:function(){var e=this.props,t=e.isRunnig,n=e.isFinished,a=e.isStarting,i=e.mobalTitle,o=this.state,l=o.startIndex,s=o.autoStart,c=o.run;return a?r.a.createElement(it,{show:!0,title:i,labelCancel:"Maybe later",onCancel:this.onPending,onHide:this.onPending},r.a.createElement("div",{className:"text-center"},this.renderIsReadyContent())):t?r.a.createElement(vc.a,{type:"continuous",showStepsProgress:!1,scrollToFirstStep:!0,scrollToSteps:!0,disableOverlay:!0,showOverlay:!0,debug:!1,stepIndex:l,steps:this.getSteps(),run:c,autoStart:s,callback:this.joyrideEventHandler}):n?r.a.createElement(it,{show:!0,title:i,labelCancel:"Start Tour Again",onCancel:this.onRestart,onHide:this.onPending},r.a.createElement("div",{className:"text-center"},this.renderIsFinishedContent())):null}}]),t}(a.Component);yc.defaultProps={step:0,isRunnig:!1,isFinished:!1,isStarting:!1,isPaused:!1,mobalTitle:r.a.createElement("span",null,"Welcome to BillRun",r.a.createElement("i",{className:"fa fa-registered",style:{fontSize:12,verticalAlign:"text-top"}}),"\xa0Cloud!")};var bc=Object(l.connect)(function(e){return{isRunnig:xs(e),isFinished:Rs(e),isStarting:As(e),isPaused:Ps(e),step:Fs(e)}})(yc),Ec=function(e){var t=e.isRunnig,n=e.isReady,a=e.isPaused,i=e.eventKeyBase,o=e.onRun,l=e.onStart;return n?r.a.createElement(f.q,{eventKey:i,onClick:l,active:!1},"Start Tour"):a?r.a.createElement(f.q,{eventKey:i,onClick:o,className:"running",active:!0},r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-play fa-fw"})," Resume Tour")):t?r.a.createElement(f.q,{eventKey:i,className:"running",active:!0},"You are in  tour"):null};Ec.defaultProps={eventKeyBase:1,isRunnig:!1,isReady:!1,isPaused:!1,onRun:function(){},onStart:function(){}};var Cc=Ec,_c=Object(l.connect)(function(e){return{isRunnig:xs(e),isReady:Ms(e),isPaused:Ps(e)}},function(e){return{onRun:function(){e(Os())},onStart:function(){e({type:"SET_ON_BOARDING_STATE",state:hs})}}})(Cc),Oc=n(277),Sc=n.n(Oc),Tc=n(278),kc=n.n(Tc),jc=function(e){var t=e.page,n=e.total;return r.a.createElement("div",{className:"section section-header"},r.a.createElement("div",{className:"table"},r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"step-company-details-header"},r.a.createElement("img",{src:kc.a,alt:"logo",style:{width:60,objectFit:"contain"}}),"\xa0\xa0Company Name"),r.a.createElement("td",null,r.a.createElement("div",{className:"paging"},"page ",r.a.createElement("span",{className:"page"},t)," of ",r.a.createElement("span",{className:"topage"},n))))))))};jc.defaultProps={page:1,total:1};var Ic=jc,wc=n(279),Nc=n.n(wc),Fc=n(280),xc=n.n(Fc),Rc=n(281),Mc=n.n(Rc),Pc=n(282),Ac=n.n(Pc),Dc=n(283),Lc=n.n(Dc),Uc=n(186),Vc=n.n(Uc),Bc=(n(442),n(443),function(){return r.a.createElement("div",{className:"invoice-help"},r.a.createElement(Ic,{page:"1",total:"2"}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Nc.a}}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Mc.a}}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Vc.a}}),r.a.createElement("hr",{className:"page-separator"}),r.a.createElement(Ic,{page:"2",total:"2"}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:xc.a}}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Ac.a}}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Lc.a}}),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:Vc.a}}))});Bc.defaultProps={};var qc=Bc,zc=function(e){var t=e.onPause,n=e.onStop;return r.a.createElement(Sc.a,{onEscape:t},r.a.createElement("div",{className:"ExampleInvoice"},r.a.createElement("div",{className:"invoice-page-modal"}),r.a.createElement("div",{className:"invoice-page-wrapper"},r.a.createElement("div",{className:"clearfix",style:{marginBottom:25}},r.a.createElement("div",{className:"pull-left"},r.a.createElement("h4",{style:{margin:0}},"Example Invoice")),r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{bsStyle:"link",onClick:t,className:"close"},r.a.createElement("i",{className:"fa fa-times",style:{color:"#222222",fontSize:16,marginTop:-10,marginRight:-10}})))),r.a.createElement(qc,null),r.a.createElement("hr",null),r.a.createElement(v,{saveLabel:"Pause",onClickSave:t,cancelLabel:"End Tour",onClickCancel:n}))))};zc.defaultProps={onPause:function(){},onStop:function(){}};var Hc=zc,Yc=Object(l.connect)(null,function(e){return{onPause:function(){e(_s())},onStop:function(){var t=function(){e(Es(0)),e(Cs())};e(ks({message:"Are you sure you want to end the tour ?",onOk:t,labelOk:"End tour",labelCancel:"Continue tour",type:"delete"}))}}})(Hc),Gc=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showCollapseButton:!1,openSmallMenu:!1,openSubMenu:[]},n.setOpenMenusItems=function(){var e=n.props,t=e.router,a=e.menuItems,r=n.state.openSubMenu;a.filter(n.filterEnabledMenu).filter(n.filterPermission).forEach(function(e){e.get("subMenus",g.c.List()).filter(function(e){return t.isActive(e.get("route",""))}).size>0&&n.setState({openSubMenu:[].concat(Object(N.a)(r),[e.get("id")])})})},n.onWindowResize=function(){var e=window.innerWidth<768;n.state.showCollapseButton!==e&&n.setState({showCollapseButton:e,openSmallMenu:!e})},n.onCollapseSidebar=function(){n.props.dispatch(Qs())},n.onSetActive=function(){n.setState({openSmallMenu:!1})},n.onToggleSubMenu=function(e){var t=n.state.openSubMenu,a=t.includes(e)?t.filter(function(t){return t!==e}):[].concat(Object(N.a)(t),[e]);n.setState({openSubMenu:a}),n.props.dispatch(Qs(!1))},n.toggleSmallMenu=function(){n.setState({openSmallMenu:!n.state.openSmallMenu})},n.resetMenuActive=function(){n.onSetActive("")},n.clickLogout=function(e){e.preventDefault(),n.props.dispatch(uc()).then(function(){n.props.router.push("/")})},n.filterEnabledMenu=function(e){return e.get("show",!1)},n.filterHiddenMenu=function(e,t){return!n.props.hiddenItems.includes(e.get("id",""))},n.filterPermission=function(e){var t=n.props.userRoles,a=e.get("roles",g.c.List());return 0===a.size||(!!t.includes("admin")||a.toSet().intersect(t).size>0)},n.renderSubMenu=function(e,t){var a=n.props,i=a.router,o=a.collapseSideBar,l=n.state.openSubMenu,s=e.get("id",""),c=e.get("icon",""),u=e.get("title",""),p=e.get("subMenus",g.c.List()).filter(n.filterEnabledMenu).filter(n.filterHiddenMenu).filter(n.filterPermission),d=p.filter(function(e){return i.isActive(e.get("route",""))}),m=l.includes(s);return r.a.createElement(hc,{key:t,active:d.get(0,!1),icon:"fa ".concat(c," fa-fw"),id:s,onClick:n.onToggleSubMenu,open:m,title:u,collapse:o},p.map(n.renderMenu))},n.renderMenu=function(e,t){return e.get("subMenus")?n.renderSubMenu(e,t):n.renderMenuItem(e,t)},n.renderMenuItem=function(e,t){var a=n.props,i=a.router,o=a.collapseSideBar,l=e.get("id",""),s=e.get("icon",""),c=e.get("title",""),u=e.get("route",""),p=o,d=r.a.createElement("li",{key:t},r.a.createElement(gc,{active:i.isActive(u),icon:"fa ".concat(s," fa-fw"),id:l,onSetActive:n.onSetActive,route:u,title:c}));if(!p)return d;var m=""===s?r.a.createElement(f.C,{id:"".concat(l,"_").concat(t)},c):r.a.createElement(f.C,{id:"".concat(l,"_").concat(t)},r.a.createElement("i",{className:"fa ".concat(s," fa-fw")})," ",c);return r.a.createElement(f.t,{key:"".concat(l,"_").concat(t),placement:o?"right":"top",overlay:m},d)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.onWindowResize(),window.addEventListener("resize",this.onWindowResize)}},{key:"componentDidMount",value:function(){this.setOpenMenusItems()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.routes,a=t.collapseSideBar,r=e.routes[e.routes.length-1].path,i=n[n.length-1].path;a||r===i||this.setOpenMenusItems()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize)}},{key:"render",value:function(){var e=this.state,t=e.showCollapseButton,n=e.openSmallMenu,a=this.props,i=a.userName,o=a.companyNeme,l=a.menuItems,c=a.logo,u=a.collapseSideBar,p=a.router,d=k()("navbar","navbar-default","navbar-fixed-top",{"collapse-sizebar":u,"small-screen-menu":t}),m=k()("navbar-default","sidebar","main-menu","scrollbox",{"small-screen-menu":t&&n}),g=k()("nav","navbar-top-links","navbar-right",{"small-screen-menu":t});return r.a.createElement("nav",{className:d,id:"top-nav",role:"navigation"},t&&r.a.createElement("button",{type:"button",className:"navbar-toggle",onClick:this.toggleSmallMenu,style:{position:"absolute",right:0,top:0}},r.a.createElement("span",{className:"sr-only"},"Toggle navigation"),r.a.createElement("span",{className:"icon-bar"}),r.a.createElement("span",{className:"icon-bar"}),r.a.createElement("span",{className:"icon-bar"})),r.a.createElement("div",{className:"navbar-header"},r.a.createElement(s.b,{to:"/",className:"navbar-brand",onClick:this.resetMenuActive},r.a.createElement("img",{src:c,style:{height:22},alt:"Logo"}),r.a.createElement("span",{className:"brand-name"},o)),!t&&r.a.createElement(f.c,{bsSize:"xsmall",id:"btn-collapse-menu",onClick:this.onCollapseSidebar},r.a.createElement("i",{className:"fa fa-chevron-left"}),r.a.createElement("i",{className:"fa fa-chevron-left"}))),r.a.createElement("ul",{className:g},r.a.createElement(_c,{eventKeyBase:2}),r.a.createElement(f.s,{id:"nav-user-menu",eventKey:1,title:r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-user fa-fw"}),i)},r.a.createElement(f.q,{eventKey:1.1,href:"#about",active:p.isActive("about")},r.a.createElement("i",{className:"fa fa-question-circle fa-fw"})," About"),r.a.createElement(f.q,{eventKey:1.2,onClick:this.clickLogout},r.a.createElement("i",{className:"fa fa-sign-out fa-fw"})," Logout"))),(!t||t&&n)&&r.a.createElement("div",{className:m,role:"navigation"},r.a.createElement("div",{className:"sidebar-nav"},r.a.createElement("ul",{className:"nav in",id:"side-menu"},l.filter(this.filterEnabledMenu).filter(this.filterHiddenMenu).filter(this.filterPermission).map(this.renderMenu)))))}}]),t}(a.Component);Gc.defaultProps={companyNeme:"",userName:"",menuItems:g.c.List(),userRoles:[],collapseSideBar:!1,routes:[],hiddenItems:[]};var Kc=Object(s.f)(Object(l.connect)(function(e){return{companyNeme:e.settings.get("tenant",g.c.Map()).get("name"),userName:e.user.get("name")||void 0,menuItems:e.guiState.menu.get("main")||void 0,collapseSideBar:e.guiState.menu.get("collapseSideBar")||void 0,userRoles:e.user.get("roles")||void 0,logo:e.settings.getIn(["files","logo"])||void 0}})(Gc)),Wc=n(547),Jc=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).handleAlertDismiss=function(){var e=n.props.alert.id;n.props.handleAlertDismiss(e)},n.autoHideTimer=null,n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.alert.timeout,n=e.transitioTime;t>0&&(clearTimeout(this.autoHideTimer),this.autoHideTimer=setTimeout(this.handleAlertDismiss,t+n))}},{key:"componentWillUnmount",value:function(){clearTimeout(this.autoHideTimer)}},{key:"render",value:function(){var e=this.props.alert,t=e.type,n=e.message,a=[wr,Fr,xr,Nr].includes(t)?t:xr;return r.a.createElement(f.a,{bsStyle:a,onDismiss:this.handleAlertDismiss},r.a.createElement("div",null,n))}}]),t}(a.Component);Jc.defaultProps={transitioTime:0};var $c=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleAlertsDismiss=function(){n.props.hideAllAlerts()},n.handleAlertDismiss=function(e){n.props.hideAlert(e)},n.renderClearAll=function(){return r.a.createElement("div",{style:{textAlign:"right"}},r.a.createElement(f.c,{onClick:n.handleAlertsDismiss},n.props.clearAllButtobLabel))},n.renderAlert=function(e){var t=n.props,a=t.enterTimeout,i=t.exitTimeout;return r.a.createElement(Jc,{alert:e,handleAlertDismiss:n.handleAlertDismiss,key:e.get("id"),transitioTime:a+i+100})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.enterTimeout,n=e.exitTimeout,a=e.alerts,i=e.showClearAllButton,o=a.map(this.renderAlert);return r.a.createElement(Wc.a,{timeout:{enter:t,exit:n},classNames:"alerts"},r.a.createElement("div",{className:"alert-notifier-container"},o,i&&o.size>1&&this.renderClearAll()))}}]),t}(a.Component);$c.defaultProps={alerts:g.c.List(),clearAllButtobLabel:"Clear All",showClearAllButton:!0,enterTimeout:500,exitTimeout:300};var Qc={hideAllAlerts:function(){return{type:Rr}},hideAlert:function(e){return{type:Mr,id:e}}},Zc=Object(l.connect)(function(e){return{alerts:e.alerts}},Qc)($c),Xc=function(){return r.a.createElement(f.g,{md:12,style:{textAlign:"center",marginTop:50}},r.a.createElement("i",{className:"fa fa-frown-o fa-fw",style:{fontSize:70}}),r.a.createElement("h3",{style:{color:"#777"}},"404"),r.a.createElement("h5",{style:{color:"#777"}},"The page you are looking for cannot be found"),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement(s.b,{to:"/"},"Return to home page")))},eu=function(){return r.a.createElement(f.g,{md:12,style:{textAlign:"center",marginTop:50}},r.a.createElement("i",{className:"fa fa-frown-o fa-fw",style:{fontSize:70}}),r.a.createElement("h3",{style:{color:"#777"}},"403"),r.a.createElement("h5",{style:{color:"red"}},"You don't have permission to access this page"),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement(s.b,{to:"/"},"Return to home page")))},tu=Object(l.connect)(null,function(e){return{logout:e(uc())}})(function(e){var t=e.logout;return r.a.createElement(f.g,{md:12,style:{textAlign:"center",marginTop:50}},r.a.createElement("i",{className:"fa fa-smile-o fa-fw",style:{fontSize:70}}),r.a.createElement("h5",{style:{color:"#777"}},"You already logged in"),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement(s.b,{to:"/"},"Return to home page"),"or",r.a.createElement(f.c,{variant:"link",onClick:t},r.a.createElement("i",{className:"fa fa-sign-out fa-fw"}),"Logout")))}),nu=function(e){var t=e.onIgnore;return r.a.createElement(f.g,{md:12,style:{textAlign:"center",marginTop:50}},r.a.createElement("i",{className:"fa fa-heartbeat fa-fw",style:{fontSize:70}}),r.a.createElement("h3",{style:{color:"#777"}},"500"),r.a.createElement("h5",{style:{color:"red"}},"Something went wrong."),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement(f.c,{bsStyle:"link",onClick:function(){return window.location.reload()}},"Reload page"),"or",r.a.createElement(f.c,{bsStyle:"link",onClick:function(){return window.location="/"}},"Return to home page"),t&&r.a.createElement("span",null,"or",r.a.createElement(f.c,{bsStyle:"link",onClick:t},"Ignore error and continue"))))};nu.defaultProps={onIgnore:null};var au=ee(["env","billrunCloudLogo"],ee(["env","billrunLogo"],"")),ru="".concat("","/assets/img/").concat(au),iu=ee(["env","mailSupport"],""),ou=function(){return r.a.createElement("div",{style:{marginTop:"10%",textAlign:"center"}},r.a.createElement(f.u,null,"Welcome to ",r.a.createElement("img",{alt:"BillRun Cloud",title:"BillRun Cloud",src:ru,style:{height:50,marginBottom:20}})),""!==iu&&r.a.createElement("p",null,"For any support topics please contact",r.a.createElement("br",null),r.a.createElement("a",{href:"mailto:".concat(iu)},iu)))},lu=ee(["env","billrunCloudLogo"],ee(["env","billrunLogo"],"")),su="".concat("","/assets/img/").concat(lu),cu=ee(["env","serverApiVersion"],""),uu=function(){return r.a.createElement("div",{style:{marginTop:20,textAlign:"left"}},""!==lu&&r.a.createElement("img",{alt:"BillRun Cloud",title:"BillRun Cloud",src:su,style:{height:25,marginBottom:20}}),""!==cu&&r.a.createElement("h5",null,"version ",r.a.createElement("strong",null,cu)))},pu="".concat("","/assets/img/").concat(ee(["env","billrunLogo"],"")),du=function(){return r.a.createElement("div",{id:"footer"},r.a.createElement("div",null,r.a.createElement("p",{className:"muted credit"},r.a.createElement("span",{style:{verticalAlign:"middle",marginRight:5}},r.a.createElement("small",null,"Powered by")),r.a.createElement("a",{href:"http://bill.run/",target:"_blank",rel:"noreferrer noopener powered-by"},r.a.createElement("img",{src:pu,style:{height:20},alt:"Logo"})))))},mu=function(e){var t=e.show,n=e.sending,i=e.onCancel,o=e.updateSending,l=e.onResetPass,s=Object(a.useState)(""),c=Object(w.a)(s,2),u=c[0],p=c[1],d=Object(a.useState)(""),m=Object(w.a)(d,2),g=m[0],h=m[1],v=n?"Sending":"Reset",y=k()("fa",{"fa-envelope-o":!n,"fa-spinner fa-pulse":n});return r.a.createElement(it,{title:"Reset Password",show:t,closeButton:!0,onHide:i},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{validationState:""!==g?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Email"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(f.k,{type:"text",name:"mail",onChange:function(e){p(e.target.value),h("")},value:u,disabled:n}),r.a.createElement(f.n,null,"The email you registered as username"),""!==g&&r.a.createElement(f.n,null,g))),r.a.createElement(f.c,{bsStyle:"success",bsSize:"lg",block:!0,onClick:function(){if(""===u)return h("Email is required"),!1;o(!0),l(u)},disabled:n},r.a.createElement("i",{className:y}),"\xa0",v)))};mu.defaultProps={show:!0,sending:!1};var gu=mu,fu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={username:"",password:"",error:"",progress:!1,resetPassword:!1,sending:!1},n.clickLogin=function(e){var t=n.state,a=t.username,r=t.password;n.setState({progress:!0}),e.preventDefault(),n.props.dispatch(cc(a,r)).then(function(){!0!==n.unmounted&&n.setState({progress:!1})})},n.clickResetPassword=function(){n.setState({resetPassword:!0})},n.onChangeUsername=function(e){var t=e.target.value;n.setState({username:t,error:""})},n.onChangePassword=function(e){var t=e.target.value;n.setState({password:t,error:""})},n.onCancel=function(){n.setState({resetPassword:!1})},n.updateSending=function(e){n.setState({sending:e})},n.onResetPass=function(e){n.props.dispatch(pc(e)).then(n.afterSendingMail)},n.afterSendingMail=function(){n.setState({sending:!1}),n.setState({resetPassword:!1})},n.renderLoginForm=function(){var e=n.state,t=e.error,a=e.progress,i=e.resetPassword,o=e.sending;return r.a.createElement(f.g,{md:4,mdOffset:4},r.a.createElement(f.v,{header:"Please Sign In",className:"login-panel"},r.a.createElement(f.j,{onSubmit:n.clickLogin},r.a.createElement("fieldset",null,r.a.createElement(f.l,{validationState:t.length>0?"error":null},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("i",{className:"fa fa-user fa-fw"})),r.a.createElement(f.k,{autoFocus:!0,type:"text",placeholder:"Email address",value:n.state.username,onChange:n.onChangeUsername}))),r.a.createElement(f.l,{validationState:t.length>0?"error":null},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("i",{className:"fa fa-key fa-fw"})),r.a.createElement(f.k,{type:"password",placeholder:"Password",value:n.state.password,onChange:n.onChangePassword}))),r.a.createElement(f.c,{type:"submit",bsStyle:"success",bsSize:"large",block:!0,onClick:n.clickLogin,disabled:a},a&&r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-spinner fa-pulse"})," \xa0\xa0\xa0"),"Login"))),t.length>0&&r.a.createElement(f.a,{bsStyle:"danger",style:{marginTop:15},className:"mb0"},t),r.a.createElement(f.c,{type:"button",bsStyle:"link",bsSize:"small",block:!0,onClick:n.clickResetPassword,disabled:a},"Forgot Your Password?")),i&&r.a.createElement(gu,{sending:o,updateSending:n.updateSending,onCancel:n.onCancel,onResetPass:n.onResetPass}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.state.error!==e.error&&this.setState({error:e.error})}},{key:"componentWillUnmount",value:function(){this.unmounted=!0}},{key:"render",value:function(){return this.props.auth?r.a.createElement(tu,null):r.a.createElement(f.y,null,this.renderLoginForm())}}]),t}(a.Component);fu.defaultProps={auth:!1,error:""};var hu=Object(l.connect)(function(e){return{auth:e.user.get("auth"),error:e.user.get("error")}})(fu),vu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={password:"",password1:"",error:"",sending:!1},n.validate=function(){var e=n.state,t=e.password;return t===e.password1&&""!==t},n.onPasswordChange=function(e){var t=n.state.password1,a=e.target.value.trim(),r="";a.length<1?r="Password is required":t.length>0&&a!==t&&(r="Passwords do not match"),n.setState({error:r,password:a})},n.onPassword1Change=function(e){var t=n.state.password,a=e.target.value.trim(),r="";a.length<1?r="Please fill confirm password":a!==t&&(r="Passwords do not match"),n.setState({error:r,password1:a})},n.onSavePassword=function(e){e.preventDefault();var t=n.props,a=t.itemId,r=t.signature,i=t.timestamp,o=n.state.password;n.validate()&&(n.setState({sending:!0}),n.props.dispatch(dc(a,r,i,o)).then(n.afterSave))},n.afterSave=function(e){n.setState({sending:!1}),1===e.status&&n.props.router.push("/login")},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){!0===this.props.auth&&this.props.router.push("/")}},{key:"render",value:function(){var e=this.state,t=e.password,n=e.password1,a=e.error,i=e.sending,o=this.props.username,l=a.length>0||a.length>0;return r.a.createElement(f.g,{md:4,mdOffset:4},r.a.createElement(f.v,{header:"Reset Password",className:"login-panel"},r.a.createElement(f.j,null,r.a.createElement("fieldset",null,r.a.createElement(f.l,null,r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("i",{className:"fa fa-user fa-fw"})),r.a.createElement(Tn,{value:o,disabled:!0}))),r.a.createElement(f.l,{validationState:l?"error":null},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement("i",{className:"fa fa-key fa-fw"})),r.a.createElement(f.k,{autoFocus:!0,type:"password",placeholder:"New password",value:t,onChange:this.onPasswordChange,disabled:i,style:{borderBottom:0}}),r.a.createElement(f.k,{type:"password",placeholder:"Confirm new password",value:n,onChange:this.onPassword1Change,disabled:i})),a.length>0&&r.a.createElement(f.n,null,a))),r.a.createElement(f.c,{type:"submit",bsStyle:"primary",bsSize:"lg",block:!0,onClick:this.onSavePassword,disabled:i},i&&r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-spinner fa-pulse"})," \xa0"),"Save"))))}}]),t}(a.Component);vu.defaultProps={auth:!1,itemId:"",signature:"",timestamp:"",username:""};var yu=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t),signature:ho(e,t),timestamp:go(e,t),username:fo(e,t),auth:e.user.get("auth")}})(vu)),bu=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){!0===this.props.auth&&this.props.router.push("/")}},{key:"render",value:function(){return r.a.createElement(hu,null)}}]),t}(a.Component);bu.defaultProps={auth:!1};var Eu=Object(s.f)(Object(l.connect)(function(e){return{auth:e.user.get("auth")}})(bu)),Cu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getView=function(){var e=n.props,t=e.auth,a=e.systemRequirementsLoad,r="waiting";switch(!1===t?r="noLogin":a&&!0===t&&(r="ready"),r){case"ready":return n.renderWithLayout();case"noLogin":return n.renderWithoutLayout();default:return n.renderAppLoading()}},n.renderAppLoading=function(){var e=n.props.logo;return r.a.createElement("div",null,r.a.createElement(wn,null),r.a.createElement(Zc,null),r.a.createElement("div",{className:"container"},r.a.createElement(f.g,{md:4,mdOffset:4},r.a.createElement("div",{style:{marginTop:"33%",textAlign:"center"}},r.a.createElement("img",{alt:"logo",src:e,style:{height:50}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("p",null,"Loading...")))))},n.renderWithoutLayout=function(){return r.a.createElement("div",null,r.a.createElement(wn,null),r.a.createElement(Zc,null),r.a.createElement("div",{className:"container"},n.props.children))},n.renderWithLayout=function(){var e=n.props,t=e.title,a=e.children,i=e.routes,o=e.isTourRunnig,l="CSI"===e.taxType?["tax"]:[];return r.a.createElement("div",{id:"wrapper"},r.a.createElement(wn,null),r.a.createElement(Gs,null),r.a.createElement($s,null),r.a.createElement(Zc,null),r.a.createElement(bc,null),r.a.createElement(Kc,{routes:i,hiddenItems:l}),r.a.createElement("div",{id:"page-wrapper",className:"page-wrapper"},o&&r.a.createElement(Yc,null),r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},t&&r.a.createElement(f.u,null,t))),r.a.createElement("div",null,a),r.a.createElement("div",{id:"footer-push"})),r.a.createElement(du,null))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(function(e){var t={api:"auth"};return e(jr()),ei(t).then(function(t){return e(lc(t.data[0].data.details)),e(Ir()),t}).catch(function(t){return e(sc()),e(Ir()),t})})}},{key:"componentDidMount",value:function(){var e=this.props,t=e.routes,n=e.title,a=t[t.length-1].title||n;a.length&&this.props.dispatch(bs(a))}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.props,a=n.title,r=n.auth;null===n.mainMenuOverrides&&null!==e.mainMenuOverrides&&this.props.dispatch(Zs(e.mainMenuOverrides));var i=e.routes[e.routes.length-1].title;"undefined"!==typeof i&&i!==a&&this.props.dispatch(bs(i)),!0!==r&&!0===e.auth&&this.props.dispatch(kl(["pricing","tenant","menu","billrun","usage_types","property_types","plays","taxation"])).then(function(e){return e?t.props.logoName:""}).then(function(e){return!(e&&e.length>0)||t.props.dispatch(Sl({filename:e},"logo"))}).then(function(){t.props.dispatch({type:ds})})}},{key:"render",value:function(){return r.a.createElement("div",null,this.getView())}}]),t}(a.Component);Cu.displayName="App",Cu.defaultProps={mainMenuOverrides:null,auth:null,title:"",logoName:"",taxType:"",systemRequirementsLoad:!1,isTourRunnig:!1};var _u=Object(s.f)(Object(l.connect)(function(e){return{auth:e.user.get("auth"),title:e.guiState.page.get("title"),systemRequirementsLoad:e.guiState.page.get("systemRequirementsLoad"),mainMenuOverrides:e.settings.getIn(["menu","main"]),logo:e.settings.getIn(["files","logo"]),logoName:e.settings.getIn(["tenant","logo"]),isTourRunnig:xs(e),taxType:ta(e)}})(Cu)),Ou=function(e){var t=function(t){function n(){return Object(c.a)(this,n),Object(p.a)(this,Object(d.a)(n).apply(this,arguments))}return Object(m.a)(n,t),Object(u.a)(n,[{key:"render",value:function(){var t=this.props,n=t.auth,a=t.roles,i=t.permissions,o=t.action,l=t.location,s=Object(mt.a)(t,["auth","roles","permissions","action","location"]);if(!a||!n)return r.a.createElement(hu,null);if(0===i.size)return null;if(a.includes("admin"))return r.a.createElement(e,Object.assign({},s,{location:l}));var c=l.pathname.substr(1),u=i.getIn([c,o],g.c.List());return 0===u.size?r.a.createElement(e,Object.assign({},s,{location:l})):0===u.toSet().intersect(a).size?r.a.createElement(eu,{location:l}):r.a.createElement(e,Object.assign({},s,{location:l}))}}]),n}(a.Component);t.defaultProps={auth:null,roles:null,permissions:g.c.Map(),action:"view"};return Object(l.connect)(function(e,t){return{auth:e.user.get("auth"),roles:e.user.get("roles"),permissions:zs(e),action:jo(e,t)}})(t)},Su=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={hasError:!1},n.onClickAskCloseImport=function(){n.setState(function(){return{hasError:!1}})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidCatch",value:function(e,t){0}},{key:"render",value:function(){return this.state.hasError,this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),t}(a.Component),Tu=n(187),ku=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getRowAction=function(e,t,a){var r=n.props.actions.filter(function(n){var a="undefined"!==typeof n.onClickColumn,r=n.onClickColumn===e.id,i=n.onClickColumn===t;return a&&(r||i)});return 0!==r.length&&r.reduce(function(e,t){if(!1===e){if("undefined"===typeof t.onClick)return!1;if("undefined"!==typeof t.enable)if(!("function"===typeof t.enable?t.enable(a):t.enable))return!1;if("undefined"!==typeof t.show)if(!("function"===typeof t.show?t.show(a):t.show))return!1;return t.onClick}return e},!1)},n.onClickHeader=function(e){var t=-1*n.props.sort.get(e,1);n.props.onSort(Object(ti.a)({},e,t))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"displayByType",value:function(e,t){var n=e.id.split(".").filter(function(e){return""!==e});switch(e.type){case"percentage":var a=t.get(e.id,"");return x()(a)?"".concat(parseFloat((100*parseFloat(a)).toFixed(3)),"%"):a;case"date":return r.a.createElement(St,{value:S()(t.getIn(n,0)),format:ee("dateFormat","DD/MM/YYYY")});case"time":case"datetime":return t.hasIn(n)?S()(t.getIn(n,0)).format(ee("datetimeFormat","DD/MM/YYYY HH:mm")):"";case"mongodate":return t.hasIn([].concat(Object(N.a)(n),["sec"]))?S.a.unix(t.getIn([].concat(Object(N.a)(n),["sec"]),0)).format(ee("dateFormat","DD/MM/YYYY")):"";case"mongotime":case"mongodatetime":return t.hasIn([].concat(Object(N.a)(n),["sec"]))?S.a.unix(t.getIn([].concat(Object(N.a)(n),["sec"]),0)).format(ee("datetimeFormat","DD/MM/YYYY HH:mm")):"";case"timestamp":return t.hasIn(n)?S.a.unix(t.getIn(n,0)).format(ee("datetimeFormat","DD/MM/YYYY HH:mm")):"";case"fullDate":return t.hasIn([].concat(Object(N.a)(n),["sec"]))?S.a.unix(t.getIn([].concat(Object(N.a)(n),["sec"]))).format(ee("datetimeLongFormat","DD/MM/YYYY HH:mm:ss")):"";case"text":default:var i=t.getIn(n,"");return Array.isArray(i)||g.c.List.isList(i)?i.join(", "):i}}},{key:"printEntityField",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1?arguments[1]:void 0;return g.c.Iterable.isIterable(e)?t.parser?t.parser(e,t):this.displayByType(t,e):this.printEntityField(g.c.fromJS(e),t)}},{key:"buildRow",value:function(e,t){var n=this,a=this.props,i=a.onClickEdit,o=a.edit;return t.map(function(a,l){if(!1===a.display)return null;var s,c=n.getRowAction(a,l,e);return s=c?r.a.createElement("button",{className:"btn btn-link",onClick:c.bind(n,e)},n.printEntityField(e,a)):o&&(0===l&&"state"!==a.id||1===l&&"state"===t[0].id)?r.a.createElement("button",{className:"btn btn-link",onClick:i.bind(n,e)},n.printEntityField(e,a)):n.printEntityField(e,a),r.a.createElement("td",{key:l,className:a.cssClass},s)})}},{key:"render",value:function(){var e=this,t=this.props,n=t.sort,a=t.items,i=t.fields,o=void 0===i?[]:i,l=t.onClickEdit,s=t.edit,c=void 0!==s&&s,u=t.editText,p=t.className,d=t.enableRemove,m=t.onClickRemove,g=t.enableEnabled,h=t.onClickEnabled,v=t.actions,y=o.map(function(t,a){var i=t.sort?e.onClickHeader.bind(e,t.id):function(){},o=t.sort?{cursor:"pointer"}:{},l=null;if(!1===t.display)return null;if(t.sort){var s=k()("sort-indicator","fa",{"fa-sort-down":-1===n.get(t.id,0),"fa-sort-up":1===n.get(t.id,0),"fa-sort":0===n.get(t.id,0)});l=r.a.createElement("i",{className:s})}return t.title||t.placeholder?r.a.createElement("th",{key:a,onClick:i,className:t.cssClass,style:o},t.title||t.placeholder,l):r.a.createElement("th",{key:a,onClick:i,className:t.cssClass,style:o},Object(D.titleCase)(t.id),l)}),b=o.length;g&&(y=[r.a.createElement("th",{key:-1})].concat(Object(N.a)(y)),b+=1),c&&(y.push(r.a.createElement("th",{key:o.length},"\xa0")),b+=1),d&&(y.push(r.a.createElement("th",{key:o.length+1},"\xa0")),b+=1),v.length>0&&(y.push(r.a.createElement("th",{key:o.length+1},"\xa0")),b+=1);var E=r.a.createElement(Tu.Tooltip,{id:"tooltip"},u||"Edit"),C=a?a.size<1?r.a.createElement("tr",null,r.a.createElement("td",{colSpan:b,style:{textAlign:"center"}},"No items found")):a.map(function(t,n){return r.a.createElement("tr",{key:n,className:t.get("enabled",!0)?"":"disabled disabled-bg"},g&&r.a.createElement("td",{className:"edit-tb"},r.a.createElement("input",{type:"checkbox",checked:t.get("enabled",!0),onChange:h.bind(e,t)})),e.buildRow(t,o),c&&r.a.createElement("td",{className:"edit-tb"},r.a.createElement("button",{className:"btn btn-link",onClick:l.bind(e,t)},u||r.a.createElement(Tu.OverlayTrigger,{overlay:E,placement:"left"},r.a.createElement("i",{className:"fa fa-pencil"})))),d&&r.a.createElement("td",{className:"edit-tb"},r.a.createElement(f.c,{onClick:m.bind(e,t),bsSize:"small",className:"pull-left"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove")),v.length>0&&r.a.createElement("td",{className:"td-actions"},r.a.createElement(vt,{actions:v,data:t})))}):null;return r.a.createElement("div",{className:"List row ".concat(p)},r.a.createElement("div",{className:"table-responsive col-lg-12"},r.a.createElement("table",{className:"table table-hover table-striped table-bordered"},r.a.createElement("thead",null,r.a.createElement("tr",null,y)),r.a.createElement("tbody",null,C))))}}]),t}(a.Component);ku.defaultProps={enableRemove:!1,onClickRemove:function(){},onClickEdit:function(){},onSort:function(){},sort:g.c.Map(),className:"",enableEnabled:!1,onClickEnabled:function(){},actions:[]};var ju=ku,Iu=function(e){var t=e.size,n=e.count,a=e.page,i=e.nextPage,o=a*t,l="previous".concat(0===a?" disabled":""),s="next".concat(i?"":" disabled "),c=0===n?0:"".concat(o+1," to ").concat(o+n),u="Page ".concat(a+1);return r.a.createElement("div",{className:"col-12"},r.a.createElement("div",{className:"col-6 pull-left"},r.a.createElement("ul",{className:"pagination"},r.a.createElement("li",{className:l},r.a.createElement("a",{onClick:function(t){t.preventDefault(),a>0&&e.onChangePage(a-1)}},r.a.createElement("i",{className:"fa fa-chevron-left"}))),r.a.createElement("span",{className:"detalis",style:{padding:"0 10px"}},u,0!==c&&" | ".concat(c)),r.a.createElement("li",{className:s},r.a.createElement("a",{onClick:function(t){t.preventDefault(),i&&e.onChangePage(a+1)}},r.a.createElement("i",{className:"fa fa-chevron-right"}))))),r.a.createElement("div",{className:"col-6 pull-right"},e.onChangeSize&&r.a.createElement("select",{value:t,className:"form-control",onChange:function(t){var n=t.target.value;e.onChangeSize(n)},style:{paddingTop:0,paddingBottom:0,height:25}},r.a.createElement("option",{value:5},"5"),r.a.createElement("option",{value:10},"10"),r.a.createElement("option",{value:15},"15"),r.a.createElement("option",{value:20},"20"))))};Iu.defaultProps={page:0,nextPage:!1};var wu=Iu,Nu=n(105),Fu=n.n(Nu),xu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={states:n.props.states},n.onSelectState=function(e,t){var a=n.state.states,r=parseInt(e.val()),i=t?a.push(r):a.filter(function(e){return e!==r});n.setState({states:i})},n.onDropdownHide=function(){var e=n.state.states;n.props.onChangeState(e)},n.buttonTitle=function(){return""},n.getHistoryOptions=function(){var e=n.state.states;return[{value:2,label:'<span><div class="cycle expired option" /> Closed</span>',selected:e.includes(2),disabled:e.includes(2)&&1===e.size},{value:0,label:'<span><div class="cycle active option" /> Active</span>',selected:e.includes(0),disabled:e.includes(0)&&1===e.size},{value:1,label:'<span><div class="cycle future option" /> Planned</span>',selected:e.includes(1),disabled:e.includes(1)&&1===e.size}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.states,n=this.state.states;g.c.is(n,t)||this.setState({states:t})}},{key:"shouldComponentUpdate",value:function(e,t){var n=this.state.states;return!g.c.is(n,t.states)}},{key:"render",value:function(){return r.a.createElement(Fu.a,{multiple:!0,enableHTML:!0,data:this.getHistoryOptions(),onChange:this.onSelectState,buttonWidth:"100%",nonSelectedText:"Select State",allSelectedText:"<span><div class='cycle all option' /> All States</span>",selectAllNumber:!1,onDropdownHide:this.onDropdownHide,buttonTitle:this.buttonTitle})}}]),t}(a.Component);xu.defaultProps={states:g.c.List()};var Ru=xu,Mu=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).unfilterCond=function(e){return"undefined"===typeof e||null===e?"":g.c.Map.isMap(e)?e.get("$regex",""):"".concat(e)},n.onClearFilter=function(){n.setState({filter_by:[],string:""},function(){n.onClickFilterBtn()})},n.onChangeFilterString=n.onChangeFilterString.bind(Object(Po.a)(n)),n.onSelectFilterField=n.onSelectFilterField.bind(Object(Po.a)(n)),n.onClickFilterBtn=n.onClickFilterBtn.bind(Object(Po.a)(n)),n.buildQueryString=n.buildQueryString.bind(Object(Po.a)(n)),n.filterCond=n.filterCond.bind(Object(Po.a)(n));var a="",r=[];if(!e.filter.isEmpty()){var i=e.filter.first();r=e.filter.keySeq().toArray(),a=n.unfilterCond(i)}return n.state={string:a,filter_by:r},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){}},{key:"onChangeFilterString",value:function(e){var t=e.target.value;this.setState({string:t})}},{key:"filterCond",value:function(e,t){var n=this.props.fields.find(function(t){return t.id===e});if(!n)return{$regex:t,$options:"i"};switch(n.type){case"number":return parseFloat(t);case"datetime":return t;case"text":default:return{$regex:t,$options:"i"}}}},{key:"buildQueryString",value:function(){var e=this,t=this.state,n=t.string,a=t.filter_by,r=this.props.base,i=Object.values(r).reduce(function(t,n,a){return Object.assign({},t,Object(ti.a)({},a,e.filterCond(a,n)))},{});return n.replace(/\s/gi,"")?a.reduce(function(t,a){return Object.assign({},t,Object(ti.a)({},a,e.filterCond(a,n)))},i):i}},{key:"onClickFilterBtn",value:function(){(0,this.props.onFilter)(this.buildQueryString())}},{key:"onSelectFilterField",value:function(e,t){var n=e.val(),a=this.state.filter_by,r=a.includes(n);if(!t||!r)return!t&&r?this.setState({filter_by:a.filter(function(e){return e!==n})}):this.setState({filter_by:a.concat(n)})}},{key:"render",value:function(){var e=this.props,t=e.fields,n=void 0===t?[]:t,a=e.children,i=this.state,o=i.filter_by,l=i.string,s=n.filter(function(e){return!1!==e.showFilter}).map(function(e,t){var n=o.includes(e.id);return{value:e.id,label:e.placeholder,selected:n}});return r.a.createElement("div",{className:"Filter row",style:{marginBottom:10}},r.a.createElement("div",{className:"filter-warp"},r.a.createElement("div",{className:"pull-left"},r.a.createElement("input",{id:"filter-string",placeholder:"Search for...",onChange:this.onChangeFilterString,value:l,className:"form-control"})),r.a.createElement("div",{className:"pull-left"},r.a.createElement(Fu.a,{data:s,multiple:!0,onChange:this.onSelectFilterField,buttonWidth:"100%",nonSelectedText:"Search in fields"})),r.a.createElement("div",{className:"search-button pull-left"},r.a.createElement("button",{className:"btn btn-default search-btn",onClick:this.onClickFilterBtn,type:"submit",disabled:l&&0===o.length||!l&&0===o.length},r.a.createElement("i",{className:"fa fa-search"}))),r.a.createElement("div",{className:"search-button pull-left"},r.a.createElement("button",{className:"btn btn-default search-btn",onClick:this.onClearFilter,type:"button"},r.a.createElement("i",{className:"fa fa-eraser"}))),a))}}]),t}(a.Component);Mu.defaultProps={filter:g.c.Map(),fields:[],base:{},children:null},(function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={filters:n.props.filter},n.onChangeInput=function(e){var t=e.target,a=t.id,r=t.value;n.onChange(a,r)},n.onChangeDate=function(e,t){var a=t?t.toJSON():"";n.onChange("urt",a)},n.onChangeDateFrom=function(e,t){var a=t?t.toJSON():"",r=n.state.filters.get(e,{});r.from=a,n.onChange(e,r)},n.onChangeDateTo=function(e,t){var a=t?t.toJSON():"",r=n.state.filters.get(e,{});r.to=a,n.onChange(e,r)},n.onChange=function(e,t){var a=n.state.filters;t?n.setState({filters:a.set(e,t)}):n.setState({filters:a.delete(e)})},n.onClear=function(){var e=g.c.Map();n.setState({filters:e}),n.props.onFilter(e.toJS())},n.onApplay=function(){var e=n.state.filters;n.props.onFilter(e.toJS())},n.getFilterInput=function(e){var t=n.state.filters.get(e.id,"");switch(e.type){case"select":var a=e.options.map(function(e,t){var n,a;return e&&e.key&&e.val?(n=e.val,a=e.key):a=n=e,r.a.createElement("option",{key:t,value:a},n)});return r.a.createElement("select",{id:e.id,className:"form-control",value:t,onChange:n.onChangeInput},"[",r.a.createElement("option",{key:"select",value:""},"Select..."),", ...",a,"]");case"date":return r.a.createElement(Dt.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:t.length?S()(t):null,onChange:n.onChangeDate.bind(Object(Po.a)(n),e.id),isClearable:!0,placeholderText:"Select Date..."});case"date-range":var i=t?t.from:"";i=i?S()(i):null;var o=t?t.to:"";return o=o?S()(o):null,r.a.createElement("div",{style:{width:"100%"}},r.a.createElement("div",{className:"pull-left",style:{width:"48%"}},r.a.createElement(Dt.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:i,selectsStart:!0,startDate:i,endDate:o,onChange:n.onChangeDateFrom.bind(Object(Po.a)(n),e.id),isClearable:!0,placeholderText:"Select Start Date..."})),r.a.createElement("div",{className:"pull-right",style:{width:"48%"}},r.a.createElement(Dt.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:o,selectsEnd:!0,startDate:i,endDate:o,onChange:n.onChangeDateTo.bind(Object(Po.a)(n),e.id),isClearable:!0,placeholderText:"Select End Date..."})));default:return r.a.createElement("input",{id:e.id,onChange:n.onChangeInput,value:t,placeholder:"Search...",className:"form-control"})}},n.renderTitles=function(e,t,n){var a=L.a.titleCase(e.title||e.placeholder||e.id),i={width:"".concat(100/(0===n.length?1:n.length),"%")};return r.a.createElement("th",{style:i,key:t},a)},n.renderInputs=function(e,t,a){var i=n.getFilterInput(e),o=k()({pl0:0===t,pr0:t===a.length-1});return r.a.createElement("td",{className:o,key:t},i)},n.renderActions=function(){var e=n.props.fields;return[r.a.createElement("td",{colSpan:e.length-1,className:"pl0",key:"search"},r.a.createElement(f.c,{bsStyle:"primary",onClick:n.onApplay,className:"full-width mr10"},r.a.createElement("i",{className:"fa fa-search"}),"\xa0Search")),r.a.createElement("td",{className:"pr0",key:"reset"},r.a.createElement(f.c,{onClick:n.onClear,className:"full-width"},r.a.createElement("i",{className:"fa fa-eraser danger-red"}),"\xa0Reset"))]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.fields,t=e.map(this.renderTitles),n=e.map(this.renderInputs),a=this.renderActions();return r.a.createElement("div",{className:"AdvancedFilter"},r.a.createElement(f.A,{responsive:!0,className:"mb10"},r.a.createElement("thead",null,r.a.createElement("tr",null,t)),r.a.createElement("tbody",null,r.a.createElement("tr",null,n),r.a.createElement("tr",null,a))))}}]),t}(a.Component)).defaultProps={fields:[],filter:g.c.Map()};var Pu=function(e){var t=e.filter,n=e.placeholder,a=e.onChange,i=e.onClear;return r.a.createElement(f.o,{className:"mini-list-filter"},r.a.createElement(Tn,{onChange:a,value:t,placeholder:n,autoComplete:"off"}),r.a.createElement(f.o.Addon,{className:"filter-reset"},r.a.createElement(f.c,{bsSize:"xsmall",bsStyle:"link",disabled:""===t,onClick:i,title:"reset filter"},r.a.createElement("i",{className:"fa fa-eraser danger-red"}))))};Pu.defaultProps={filter:"",placeholder:"Filter..."};var Au=Pu,Du=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showConfirmClose:!1,showCloseDetails:!1,closeDate:pe(n.props.item)?ce(n.props.item,"to",null):null},n.onClickCloseConfirm=function(){n.setState({showConfirmClose:!1,showCloseDetails:!1,closeDate:null})},n.onClickCloseOk=function(){var e=n.state.closeDate,t=n.props,a=t.itemName,r=t.item,i=ee(["systemItems",a,"collection"],"");if(r){var o=r.set("to",e.toISOString());n.props.dispatch(ts(i,o)).then(n.afterClose)}},n.afterClose=function(e){var t=n.state.closeDate,a=n.props.item,r=t.format(ee("dateFormat","DD/MM/YYYY"));if(e.status){n.props.dispatch(Ur("Close date was set to ".concat(r)));var i=ue(a,"");n.onClickCloseConfirm(),n.props.onCloseItem(i)}},n.toggleCloseAction=function(){var e=n.state.showCloseDetails;n.setState({showCloseDetails:!e})},n.toggleCloseConfirm=function(){var e=n.state.showConfirmClose;n.setState({showConfirmClose:!e})},n.onChangeFrom=function(e){var t=n.state.closeDate,a=n.props.dangerousFrom;e&&e.isBefore(a)?n.confirmSelectedDate(e,t):n.setState({closeDate:e})},n.confirmSelectedDate=function(e,t){var a=e.format(ee("dateFormat","DD/MM/YYYY")),r={message:"Billing cycle for the date you have chosen is already over.",children:"Are you sure you want to use ".concat(a,"?"),onOk:function(){n.setState({closeDate:e})},onCancel:function(){n.setState({closeDate:t})}};n.props.dispatch(ks(r))},n.dayDateClass=function(e){var t=n.props,a=t.minDate,r=t.dangerousFrom;if(e.isBetween(a,r))return"danger-red"},n.renderDateFromfields=function(){var e=n.props,t=e.item,a=e.minDate,i=n.state.closeDate,o=ce(t,"to",null),l=null===i||o&&i&&o.isSame(i),s=[S()()];return r.a.createElement("div",{className:"inline"},r.a.createElement("div",{className:"inline"},r.a.createElement(Tn,{fieldType:"date",value:i,onChange:n.onChangeFrom,isClearable:!0,placeholderText:"Select Date...",minDate:a.clone().add(1,"days"),highlightDates:s,dayClassName:n.dayDateClass})),r.a.createElement(f.c,{onClick:n.toggleCloseConfirm,style:{marginLeft:5,verticalAlign:"bottom"},disabled:l,bsStyle:"primary",className:"inline"},"OK"))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(kl(["minimum_entity_start_date","system"]))}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.itemName,a=this.state,i=a.showCloseDetails,o=a.showConfirmClose;return"active"===t.getIn(["revision_info","status"],"")&&t.getIn(["revision_info","is_last"],!1)?r.a.createElement("div",null,r.a.createElement(f.c,{bsStyle:"link",onClick:this.toggleCloseAction,style:{verticalAlign:"bottom",lineHeight:"24px"}},"Close ",ee(["systemItems",n,"itemName"],"item")," ",r.a.createElement("i",{className:"fa fa-angle-right"})),i&&this.renderDateFromfields(),r.a.createElement(lt,{onOk:this.onClickCloseOk,onCancel:this.onClickCloseConfirm,show:o,message:"Are you sure you want to close the revision?",labelOk:"Yes"})):null}}]),t}(a.Component);Du.defaultProps={item:g.c.Map(),minDate:S()(0),dangerousFrom:S()(0),onCloseItem:function(){}};var Lu=Object(l.connect)(function(e,t){return{minDate:ko(e,t),dangerousFrom:ua(e,t)}})(Du),Uu=n(3),Vu=n.n(Uu),Bu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={startDate:ce(n.props.item,"from",null),endDate:ce(n.props.item,"to",null),activeTab:n.props.item.getIn(["revision_info","movable_from"],!0)?1:2,progress:!1,showEndConfirm:!1,showStartConfirm:!1},n.onClickEndMoveOk=function(){n.onClickOk("to")},n.onClickStartMoveOk=function(){n.onClickOk("from")},n.onClickOk=function(e){var t=n.state,a=t.startDate,r=t.endDate,i=n.props.item.withMutations(function(e){return e.set("from",a.toISOString()).set("to",r.toISOString())});n.onClickCloseConfirm(),n.props.onMoveItem(i,e)},n.onClickCancel=function(){n.props.onCancelMoveItem()},n.onChangeDateFrom=function(e){var t=n.props,a=t.item,r=t.minStartDate,i=n.state.startDate;null!==e?e.isBefore(r)&&!e.isSame(ce(a,"from",null),"day")?n.confirmSelectedDate(e,i,"startDate"):n.setState({startDate:e}):n.setState({startDate:ce(a,"from",null)})},n.onChangeDateTo=function(e){var t=n.props,a=t.item,r=t.minStartDate,i=n.state.endDate;null!==e?e.isBefore(r)&&!e.isSame(ce(a,"to",null),"day")?n.confirmSelectedDate(e,i,"endDate"):n.setState({endDate:e}):n.setState({endDate:ce(a,"to",null)})},n.confirmSelectedDate=function(e,t,a){var r=e.format(ee("dateFormat","DD/MM/YYYY")),i={message:"Billing cycle for the date you have chosen is already over.",children:"Are you sure you want to use ".concat(r,"?"),onOk:function(){n.setState(Object(ti.a)({},a,e))},onCancel:function(){n.setState(Object(ti.a)({},a,t))}};n.props.dispatch(ks(i))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n.toggleStartConfirm=function(){var e=n.state.showStartConfirm;n.setState({showStartConfirm:!e})},n.toggleEndConfirm=function(){var e=n.state.showEndConfirm;n.setState({showEndConfirm:!e})},n.onClickCloseConfirm=function(){n.setState({showEndConfirm:!1,showStartConfirm:!1})},n.onUnlimitedChanged=function(e){var t=n.props.item,a=e.target.value,r=S()().add(50,"years").isBefore(ce(t,"to",null));a?r?n.setState({endDate:ce(t,"to",null)}):n.setState({endDate:S()().add(100,"years")}):r?n.setState({endDate:S()().add(1,"day")}):n.setState({endDate:ce(t,"to",null)})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(kl(["minimum_entity_start_date","system"]))}},{key:"componentWillReceiveProps",value:function(e){g.c.is(this.props.item,e.item)||this.setState({startDate:ce(e.item,"from",null),endDate:ce(e.item,"to",null)})}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.revisions,a=e.itemName,i=e.minStartDate,o=this.state,l=o.startDate,s=o.endDate,c=o.activeTab,u=o.progress,p=o.showEndConfirm,d=o.showStartConfirm;if(n.isEmpty())return null;var m=Ye(ee(["systemItems",a,"uniqueField"],"")).get(0,""),g="".concat(t.get(m,"")," - Move"),h={marginLeft:5,verticalAlign:"bottom"},v=l.isSame(ce(t,"from",null),"days")||u,y=s.isSame(ce(t,"to",null),"days")||u,b=ee("dateFormat","DD/MM/YYYY"),E=S()().add(50,"years").isBefore(s),C="Are you sure you want to set start date to be ".concat(l.format(b)," ?"),_="Are you sure you want to set end date to be  ".concat(E?"infinite":s.format(b)," ?"),O=n.findIndex(function(e){return ue(e)===ue(t)}),T=0===O,k=ge(n.get(O+1,null),S()(0)),j=ce(t,"to"),I=ge(t,S()(0)),w=T?S()().add(200,"years"):ce(n.get(O-1),"to"),N=!t.getIn(["revision_info","movable_from"],!0),F=!t.getIn(["revision_info","movable_to"],!0)||E&&T,x=[ce(t,"from",null)],R=[ce(t,"to",null)];return r.a.createElement(it,{show:!0,title:g,labelCancel:"Close",onCancel:this.onClickCancel,onHide:this.onClickCancel},r.a.createElement("div",{className:"text-center move-modal"},r.a.createElement(at,{revisions:n,item:t,size:10}),r.a.createElement(f.j,{horizontal:!0,style:{padding:"35px 50px 0 50px"}},r.a.createElement(f.l,null,r.a.createElement(f.B,{bsStyle:"pills",defaultActiveKey:c,animation:!1,id:"move-entity",onSelect:this.handleSelectTab},r.a.createElement(f.z,{title:"Move Start Date",eventKey:1,disabled:!t.getIn(["revision_info","movable_from"],!0)},r.a.createElement("br",null),r.a.createElement(f.g,{sm:3,className:"text-right",style:{padding:"10px 15px"}},"\xa0"),r.a.createElement(f.g,{sm:6,className:"pr0"},r.a.createElement(Tn,{fieldType:"date",value:l,minDate:k,maxDate:j,onChange:this.onChangeDateFrom,isClearable:!0,placeholder:"Select Start Date...",disabled:N,dayClassName:function(e){return k.isBefore(i)&&!e.isSame(ce(t,"from",null),"days")&&e.isBetween(k,i,"day","[)")?"danger-red":void 0},highlightDates:x})),r.a.createElement(f.g,{sm:3,className:"pl0 text-left"},r.a.createElement(f.c,{onClick:this.toggleStartConfirm,style:h,disabled:v,bsStyle:"primary"},"OK"),r.a.createElement(lt,{onOk:this.onClickStartMoveOk,onCancel:this.onClickCloseConfirm,show:d,message:C,labelOk:"Yes"}))),r.a.createElement(f.z,{title:"Move End Date",eventKey:2,disabled:!t.getIn(["revision_info","movable_to"],!0)},r.a.createElement("br",null),r.a.createElement(f.g,{sm:3,className:"text-right",style:{padding:"10px 15px"}},r.a.createElement(Tn,{value:E,onChange:this.onUnlimitedChanged,fieldType:"checkbox",label:"Infinite",disabled:!T})),r.a.createElement(f.g,{sm:6,className:"pr0"},r.a.createElement(Tn,{fieldType:"date",value:E&&T?null:s,onChange:this.onChangeDateTo,isClearable:!0,minDate:I,maxDate:w,disabled:F,placeholder:"Select End Date...",dayClassName:function(e){return I.isBefore(i)&&!e.isSame(ce(t,"to",null),"days")&&e.isBetween(I,i,"day","[)")?"danger-red":void 0},highlightDates:R})),r.a.createElement(f.g,{sm:3,className:"pl0 text-left"},r.a.createElement(f.c,{onClick:this.toggleEndConfirm,style:h,disabled:y,bsStyle:"primary"},"OK"),r.a.createElement(lt,{onOk:this.onClickEndMoveOk,onCancel:this.onClickCloseConfirm,show:p,message:_,labelOk:"Yes"}))))))))}}]),t}(a.Component);Bu.defaultProps={itemId:Vu.a.string,item:g.c.Map(),revisions:g.c.List(),minStartDate:S()(0),onMoveItem:function(){},onCancelMoveItem:function(){}};var qu=Object(l.connect)(function(e,t){return{minStartDate:ua(e,t),item:t.revisions.find(function(e){return ue(e)===t.itemId})}})(Bu),zu=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={fromDate:null,validationErrors:g.c.Map({from:""})},n.onClickOk=function(){var e=n.state,t=e.fromDate,a=e.validationErrors,r=n.props.item;null===t?n.setState({fromDate:t,validationErrors:a.set("from","required")}):n.props.onReopenItem(r,t.toISOString())},n.onClickCancel=function(){n.props.onCancelReopenItem()},n.onChangeFromDate=function(e){var t=n.state.validationErrors,a=null===e?"required":"";n.setState({fromDate:e,validationErrors:t.set("from",a)})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.revisions,a=e.itemName,i=this.state,o=i.fromDate,l=i.validationErrors,s=n.first(),c=ce(s,"to"),u=Ye(ee(["systemItems",a,"uniqueField"],g.c.List())).get(0,""),p="".concat(t.get(u,"")," - Reopen"),d=l.get("from","");return r.a.createElement(it,{show:!0,title:p,labelCancel:"Close",onCancel:this.onClickCancel,onHide:this.onClickCancel,labelOk:"Reopen",onOk:this.onClickOk},r.a.createElement("div",{className:"text-center reopen-modal"},r.a.createElement(f.j,{horizontal:!0,style:{padding:"35px 50px 0 50px"}},r.a.createElement(f.l,{validationState:d.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:4},"Reopen From Date"),r.a.createElement(f.g,{sm:6,className:"pr0"},r.a.createElement(Tn,{fieldType:"date",value:o,minDate:c,onChange:this.onChangeFromDate,isClearable:!0,placeholder:"Select Reopen From Date..."}),r.a.createElement(f.n,null,d.length>0?d:null))))))}}]),t}(a.Component);zu.defaultProps={item:g.c.Map(),revisions:g.c.List(),onReopenItem:function(){},onCancelReopenItem:function(){}};var Hu=zu,Yu="CLEAR_ENTITY_LIST",Gu="CLEAR_ITEMS",Ku="SET_NEXT_PAGE",Wu="SET_ITEMS",Ju="SET_FILTER",$u="SET_PAGE",Qu="SET_SORT",Zu="SET_SIZE",Xu="SET_STATE",ep="SET_REVISIONS",tp="CLEAR_REVISIONS",np="CLEAR_NEXT_PAGE",ap=function(e,t){return{type:Qu,collection:e,sort:t}},rp=function(e,t){return{type:Zu,collection:e,size:t}},ip=function(e,t){return{type:Ju,collection:e,filter:t}},op=function(e,t){return{type:$u,collection:e,page:t}},lp=function(e,t){return{type:Xu,collection:e,state:t}},sp=function(e,t){return{type:tp,collection:e,key:t}},cp=function(e){return{type:Yu,collection:e}},up=function(e){return{type:Gu,collection:e}},pp=function(e,t){return function(n){return n(jr()),ei(t).then(function(t){try{return n(function(e,t){return{type:Wu,collection:e,list:t}}(e,t.data[0].data.details)),n(function(e,t){return{type:Ku,collection:e,nextPage:t}}(e,t.data[0].data.next_page)),n(Wr(t))}catch(a){throw console.log("fetchList error: ",a),new Error("Error retrieving list")}}).catch(function(e){return n(Jr(e,"Network error - please refresh and try again"))})}},dp=function(e,t,n){return function(a){var r=Ye(n),i=Ye(t),o=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:9999,r=t.reduce(function(t,a,r){var i=n.get(r,"");switch("string"===typeof i&&(i=Be(i)),e){case"subscribers":return t.set(a,i);default:return t.set(a,{$regex:"^".concat(i,"$")})}},g.c.Map({})),i={from:1,to:1,description:1,revision_info:1},o=t.reduce(function(e,t){return e.set(t,1)},g.c.Map(i));return{action:"get",entity:e,params:[{sort:JSON.stringify({from:-1})},{query:JSON.stringify(r)},{project:JSON.stringify(o)},{page:0},{size:a},{state:JSON.stringify([0,1,2])}]}}(e,i,r);return ei(o).then(function(t){try{return a(function(e,t,n){return{type:ep,collection:e,key:t,revisions:n}}(e,n,t.data[0].data.details)),a(Wr(t))}catch(r){throw console.log("fetch revision error: ",r),new Error("fetch revision error")}}).catch(function(e){return a(Jr(e,"Network error - please refresh and try again"))})}},mp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showConfirmRemove:!1,itemToRemove:null,showMoveModal:!1,itemToMove:null,itemToReopen:null},n.isItemLast=function(e){return e.getIn(["revision_info","is_last"],!0)},n.isItemEditable=function(e){return["future"].includes(e.getIn(["revision_info","status"],""))||n.isItemActive(e)&&n.isItemLast(e)},n.isItemMovable=function(e){return e.getIn(["revision_info","movable_from"],!0)||e.getIn(["revision_info","movable_to"],!0)},n.isItemReopenable=function(e){var t=n.props.items,a=t.indexOf(e),r=a>0?t.get(a-1,g.c.Map()):g.c.Map(),i=t.first();return["expired"].includes(e.getIn(["revision_info","status"],""))&&!["expired"].includes(r.getIn(["revision_info","status"],""))&&de(i)},n.isItemActive=function(e){return["active"].includes(e.getIn(["revision_info","status"],""))},n.isItemExpired=function(e){return["expired"].includes(e.getIn(["revision_info","status"],""))},n.parseEditShow=function(e){return n.isItemEditable(e)},n.parseViewShow=function(e){return!n.isItemEditable(e)},n.parseMoveEnable=function(e){return n.isItemMovable(e)},n.parseReopenEnable=function(e){return n.isItemReopenable(e)},n.parserState=function(e){return r.a.createElement(I,{status:e.getIn(["revision_info","status"],"")})},n.parseFromDate=function(e){var t=ce(e,"from",null);return S.a.isMoment(t)?r.a.createElement(St,{value:t,format:ee("dateFormat","DD/MM/YYYY")}):"-"},n.parseToDate=function(e){var t=ce(e,"to",null),a=n.isItemExpired(e)||n.isItemActive(e)&&!n.isItemLast(e);return S.a.isMoment(t)&&(pe(e)||a)?r.a.createElement(St,{value:t.subtract(1,"seconds"),format:ee("dateFormat","DD/MM/YYYY")}):"-"},n.onClickEdit=function(e){var t=n.props.itemName;if(n.props.onSelectItem(),n.props.onActionEdit)n.props.onActionEdit(e,t);else{var a=ue(e,""),r=ee(["systemItems",t,"itemType"],""),i=ee(["systemItems",t,"itemsType"],"");n.props.router.push("".concat(i,"/").concat(r,"/").concat(a))}},n.onClickRemove=function(e){n.setState({showConfirmRemove:!0,itemToRemove:e})},n.onClickRemoveClose=function(){n.setState({showConfirmRemove:!1,itemToRemove:null})},n.onClickClone=function(e){var t=n.props.itemName;if(n.props.onSelectItem(),n.props.onActionClone)n.props.onActionClone(e,t,"clone");else{var a=ue(e,""),r=ee(["systemItems",t,"itemType"],""),i=ee(["systemItems",t,"itemsType"],"");n.props.router.push({pathname:"".concat(i,"/").concat(r,"/").concat(a),query:{action:"clone"}})}},n.onClickRemoveOk=function(){var e=n.props.itemName,t=n.state.itemToRemove,a=ee(["systemItems",e,"collection"],"");n.props.dispatch(es(a,t)).then(n.afterRemove)},n.onClickMove=function(e){n.setState({showMoveModal:!0,itemToMove:e})},n.onClickMoveClose=function(){n.setState({showMoveModal:!1,itemToMove:null})},n.onClickMoveOk=function(e,t){var a=n.props.itemName,r=ee(["systemItems",a,"collection"],"");n.props.dispatch(ns(r,e,t)).then(n.afterMove)},n.afterMove=function(e){e.status&&(n.props.dispatch(Ur("Revision was moved")),n.props.onCloseItem())},n.afterRemove=function(e){var t=n.state.itemToRemove,a=n.props.itemName;if(e.status){n.props.dispatch(Ur("Revision was removed"));var r=ee(["systemItems",a,"collection"],""),i=Ye(ee(["systemItems",a,"uniqueField"],g.c.List())),o=i.map(function(e){return t.get(e,"")}),l=ue(t);n.props.dispatch(dp(r,i,o)),n.onClickRemoveClose(),n.props.onDeleteItem(l)}},n.onClickReopen=function(e){n.setState({showReopenModal:!0,itemToReopen:e})},n.onClickReopenClose=function(){n.setState({showReopenModal:!1,itemToReopen:null})},n.onClickReopenOk=function(e,t){var a=n.props.itemName,r=ee(["systemItems",a,"collection"],"");n.props.dispatch(as(r,e,t)).then(n.afterReopen)},n.afterReopen=function(e){e.status&&(n.props.dispatch(Ur("Revision was reopened")),n.onClickReopenClose(),n.props.onCloseItem())},n.getActionHelpText=function(e,t){var a=n.props.itemName;switch(Object(D.lowerCase)(t)){case"clone":return"Clone as new ".concat(ee(["systemItems",a,"itemName"],"item"));case"remove":return"Remove revision";case"edit":return"Edit revision";case"view":return"View revision details";case"move":return"Move revision in time";case"reopen":return"Reopen revision";default:return Object(D.sentenceCase)(t)}},n.getListFields=function(){return[{id:"state",parser:n.parserState,cssClass:"state"},{id:"from",title:"Start date",parser:n.parseFromDate,cssClass:"short-date"},{id:"to",title:"To date",parser:n.parseToDate}]},n.getListActions=function(){return[{type:"view",helpText:n.getActionHelpText,onClick:n.onClickEdit,show:n.parseViewShow,onClickColumn:"from"},{type:"edit",helpText:n.getActionHelpText,onClick:n.onClickEdit,show:n.parseEditShow,onClickColumn:"from"},{type:"clone",helpText:n.getActionHelpText,onClick:n.onClickClone},{type:"move",helpText:n.getActionHelpText,onClick:n.onClickMove,enable:n.parseMoveEnable},{type:"reopen",helpText:n.getActionHelpText,onClick:n.onClickReopen,enable:n.parseReopenEnable},{type:"remove",helpText:n.getActionHelpText,onClick:n.onClickRemove}]},n.renderMoveModal=function(){var e=n.props,t=e.items,a=e.itemName,i=n.state,o=i.showMoveModal,l=i.itemToMove;return o?r.a.createElement(qu,{itemId:ue(l),itemName:a,revisions:t,onMoveItem:n.onClickMoveOk,onCancelMoveItem:n.onClickMoveClose}):null},n.renderReopenModal=function(){var e=n.props,t=e.items,a=e.itemName,i=n.state,o=i.showReopenModal,l=i.itemToReopen;return o?r.a.createElement(Hu,{item:l,itemName:a,revisions:t,onReopenItem:n.onClickReopenOk,onCancelReopenItem:n.onClickReopenClose}):null},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.items,n=e.itemName,a=this.state.showConfirmRemove,i=this.getListFields(),o=this.getListActions(),l=t.find(this.isItemActive);return r.a.createElement("div",null,r.a.createElement(ju,{items:t,fields:i,edit:!1,actions:o,className:"scrollbox screen-height-70"}),l&&r.a.createElement(Lu,{itemName:n,item:l,onCloseItem:this.props.onCloseItem}),r.a.createElement(lt,{onOk:this.onClickRemoveOk,onCancel:this.onClickRemoveClose,show:a,message:"Are you sure you want to remove this revision?",labelOk:"Yes"}),this.renderMoveModal(),this.renderReopenModal())}}]),t}(a.Component);mp.defaultProps={items:g.c.List(),onSelectItem:function(){},onDeleteItem:function(){},onCloseItem:function(){}};var gp=Object(s.f)(Object(l.connect)()(mp)),fp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showList:!1},n.onEnter=function(){var e=n.props,t=e.collection,a=e.item,r=e.revisionBy;if(!e.revisions){var i=Ye(r).map(function(e){return a.get(e,"")});n.props.dispatch(dp(t,r,i))}},n.onCloseItem=function(){var e=n.props,t=e.collection,a=e.item,r=e.revisionBy,i=Ye(r).map(function(e){return a.get(e,"")});n.props.dispatch(dp(t,r,i))},n.showManageRevisions=function(){var e=n.refs.revisionOverlay;(void 0===e?{}:e).hide(),n.setState({showList:!0})},n.hideManageRevisions=function(){n.setState({showList:!1})},n.renderRevisionTooltip=function(){var e=n.props,t=e.item,a=e.revisions,i=e.size,o=e.revisionBy,l=e.allowManageRevisions,s=e.itemName,c=Ye(o).get(0,""),u="".concat(t.get(c,"")," - Revision History");return a?r.a.createElement(f.x,{id:"".concat(ue(t,""),"-revisions"),title:u,className:"entity-revision-history-popover"},r.a.createElement(at,{revisions:a,item:t,size:i,itemName:s}),r.a.createElement("hr",{style:{margin:0,borderColor:"#3A3A3A",borderWidth:2}}),l&&r.a.createElement(f.c,{bsStyle:"link",style:{color:"#fff"},onClick:n.showManageRevisions},"Manage Revisions")):r.a.createElement(f.x,{id:"".concat(ue(t,""),"-loading"),title:u,className:"entity-revision-history-popover"},r.a.createElement("div",{style:{padding:15}},r.a.createElement("i",{className:"fa fa-spinner fa-pulse"}),"\xa0\xa0\xa0loading..."),r.a.createElement("hr",null),r.a.createElement("div",{style:{padding:"8px 12px 7px"}},"\xa0"))},n.renderVerisionList=function(){var e=n.props,t=e.item,a=e.itemName,i=e.revisions,o=e.revisionBy,l=n.state.showList,s=Ye(o).get(0,""),c="".concat(t.get(s,"")," - Revision History");return r.a.createElement(it,{title:c,show:l,onCancel:n.hideManageRevisions,onHide:n.hideManageRevisions,labelCancel:"Close"},r.a.createElement(gp,{items:i,itemName:a,onSelectItem:n.hideManageRevisions,onActionEdit:n.props.onActionEdit,onActionClone:n.props.onActionClone,onCloseItem:n.onCloseItem}))},n.renderHelpTooltip=function(){var e=n.props.item;return r.a.createElement(f.C,{id:"".concat(ue(e,""),"-help")},"Click to get",r.a.createElement("br",null),"revision history")},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.item;return r.a.createElement("div",null,r.a.createElement(f.t,{trigger:"click",rootClose:!0,placement:"right",ref:"revisionOverlay",overlay:this.renderRevisionTooltip(),onEnter:this.onEnter},r.a.createElement(f.t,{overlay:this.renderHelpTooltip(),placement:"left"},r.a.createElement("div",{className:"clickable"},r.a.createElement(I,{status:e.getIn(["revision_info","status"],"")})))),this.renderVerisionList())}}]),t}(a.Component);fp.defaultProps={item:g.c.Map(),revisions:void 0,size:5,allowManageRevisions:!0};var hp=Object(l.connect)(function(e,t){var n=ee(["systemItems",t.itemName,"uniqueField"],""),a=ee(["systemItems",t.itemName,"collection"],""),r=Ye(n).map(function(e){return t.item.get(e,"")}).join("_");return{revisions:e.entityList.revisions.getIn([a,r]),collection:a,revisionBy:n}})(fp),vp=n(56),yp=Object(Nn.a)(ba,function(e){return e?-1!==e.findIndex(ye)?e:e.push(g.c.Map({unique:!0,generated:!1,mandatory:!0,field_name:"account_import_id",title:"Customer Import ID (for subscriber import)"})):e}),bp=Object(Nn.a)(_a,yp,function(e,t){if(e){var n=t.filter(ye);return n.size>0?e.withMutations(function(e){n.forEach(function(t){e.push(g.c.Map({linker:!0,field_name:t.get("field_name","linker"),title:t.get("title",t.get("field_name","linker"))}))})}):e.push(g.c.Map({linker:!0,field_name:"account_import_id",title:"Customer Import ID"}))}return e}),Ep=Object(Nn.a)(ja,function(e){var t=["to","rates","tax"],n=["key"],a=["tariff_category"];return g.c.List().withMutations(function(r){e.forEach(function(e){var i=e.withMutations(function(e){n.includes(e.get("field_name",""))&&e.set("unique",!0),a.includes(e.get("field_name",""))&&e.set("mandatory",!0),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("unique",!1)||"key"===e.get("field_name","")&&e.get("mandatory",!1)&&e.get("system",!1)||"name"===e.get("field_name","")&&e.get("mandatory",!1)&&e.get("system",!1)}(e)&&e.set("updater",!0)}),o=i.get("editable",!0),l=t.includes(i.get("field_name",""));if(o&&!l?r.push(i):r.push(i.set("show",!1)),"tax"===i.get("field_name","")){var s=g.c.Map({field_name:"tax__taxation",title:"Taxation"});r.push(ze(s,"product"));var c=g.c.Map({field_name:"tax__custom_tax",title:"Tax custom rate"});r.push(ze(c,"product"));var u=g.c.Map({field_name:"tax__custom_logic",title:"Tax custom logic"});r.push(ze(u,"product"))}if("rates"===i.get("field_name","")){var p=g.c.Map({field_name:"price_from"});r.push(ze(p,"product"));var d=g.c.Map({field_name:"price_to"});r.push(ze(d,"product"));var m=g.c.Map({field_name:"price_interval"});r.push(ze(m,"product"));var f=g.c.Map({field_name:"price_value"});r.push(ze(f,"product"));var h=g.c.Map({field_name:"price_plan"});r.push(ze(h,"product"));var v=g.c.Map({field_name:"rates.percentage",help:"Field will effect only if 'Plan Price Override' value is different from BASE"});r.push(ze(v,"import"))}});var i=g.c.Map({field_name:"usage_type",mandatory:!0});r.push(i);var o=g.c.Map({field_name:"effective_date",mandatory:!0});r.push(o)})}),Cp=Object(Nn.a)(Xn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("mapping",g.c.List()).toList()}),_p=Object(Nn.a)(bo,yp,bp,Ep,function(e,t,n,a){return Object(vp.d)(function(e){return e?e.toArray():void 0},function(t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map();if(e){var n=t.get("entity",""),a={subscription:[{value:"from",label:"From",editable:!0,generated:!1,unique:!1,mandatory:!0},{value:"to",label:"To",editable:!0,generated:!1,unique:!1,mandatory:!0}],customer:[{value:"from",label:"From",editable:!0,generated:!1,unique:!1,mandatory:!0},{value:"to",label:"To",editable:!0,generated:!1,unique:!1,mandatory:!0}]};return e.withMutations(function(t){(a[n]||[]).filter(function(t){return-1===e.findIndex(function(e){return e.value===t.value})}).forEach(function(e){t.push(e)})})}}(t,e)},function(t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map(),n=ne(t.get("entity",""));if(e)return e.map(function(e){return{value:e.get("field_name",""),label:e.get("title",te(e.get("field_name",""),n)),editable:e.get("editable",!0),generated:e.get("generated",!1),unique:e.get("unique",!1),mandatory:e.get("mandatory",!1),linker:e.get("linker",!1),updater:e.get("updater",!1),select_options:e.get("select_options",!1),multiple:e.get("multiple",!1),help:e.get("help",!1),show:e.get("show",!0),plays:e.get("plays",g.c.List())}})}(t,e)},uo)(e,t,n,a)}),Op=Object(Nn.a)(bo,function(e,t){return ee(["import","allowed_entities_importype"],g.c.Map())},Zn,function(e,t,n,a){return a},function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return g.c.List().withMutations(function(r){var i=a;""===i&&e&&""!==e.get("entity","")&&(i=e.get("entity","")),t.filter(function(e){return e.includes(i)}).forEach(function(e,t){if("predefined_mapping"===t){var n=ee(["env","exportVersion"],"");r.push(g.c.Map({value:t,label:"".concat(Object(D.sentenceCase)(te(t,"import"))," (").concat(n,")")}))}else r.push(t)}),n.filter(function(e){return e.includes(i)}).forEach(function(e,t){r.push(g.c.Map({value:t,label:Object(D.sentenceCase)(te(t,"import")),type:"plugin"}))})}).map(function(e){return g.c.Map.isMap(e)?{value:e.get("value",""),label:e.get("label",""),type:e.get("type","")}:{value:e,label:Object(D.sentenceCase)(te(e,"import")),type:""}}).toArray()}),Sp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onClickNew=function(){var e=n.props,t=e.itemsType,a=e.itemType;n.props.router.push("".concat(t,"/").concat(a))},n.onClickRefresh=function(){var e=n.props.collection;n.fetchItems(n.props),n.props.dispatch(sp(e)),n.props.onListRefresh&&n.props.onListRefresh()},n.onClickImport=function(){var e=n.props.itemType;n.props.router.push("/import/".concat(e))},n.onClickExport=function(){var e=n.props.itemType,t=S()().format("YYYYMMDD"),a=g.c.Map({file_name:"export_".concat(e,"_").concat(t)}),r=g.c.fromJS(n.getExportQuery(n.props)).merge(a);n.props.dispatch(Ql(e,r))},n.onSort=function(e){var t=n.props.itemsType;n.props.dispatch(op(t,0)),n.props.dispatch(ap(t,e))},n.onFilter=function(e){var t=n.props.itemsType;n.props.dispatch(op(t,0)),n.props.dispatch(ip(t,e))},n.onPageChange=function(e){var t=n.props.itemsType;n.props.dispatch(op(t,e))},n.onSizeChange=function(e){var t=n.props.itemsType;n.props.dispatch(op(t,0)),n.props.dispatch(rp(t,e))},n.onStateChange=function(e){var t=n.props.itemsType;n.props.dispatch(op(t,0)),n.props.dispatch(lp(t,e))},n.onClickEditItem=function(e){var t=n.props,a=t.itemsType,r=t.itemType,i=e.getIn(["_id","$id"]);n.props.router.push("".concat(a,"/").concat(r,"/").concat(i))},n.onClickViewItem=function(e){var t=n.props,a=t.itemsType,r=t.itemType,i=e.getIn(["_id","$id"]);n.props.router.push("".concat(a,"/").concat(r,"/").concat(i,"?action=view"))},n.buildQuery=function(e){var t=e.collection,n=e.page,a=e.size,r=e.sort,i=e.filter,o=e.state,l=e.baseFilter,s=e.projectFields,c=e.api,u=e.showRevisionBy,p=u?Object(Ks.a)({},s,{to:1,from:1,revision_info:1}):s,d=Object(Ks.a)({},i.toObject(),l),m={or_fields:Object.keys(i.toObject())},g={action:c,entity:t,params:[{sort:JSON.stringify(r)},{query:JSON.stringify(d)},{project:JSON.stringify(p)},{page:n},{size:a},{options:JSON.stringify(m)}]};return u&&g.params.push({states:JSON.stringify(o)}),g},n.fetchItems=function(e){var t=e.itemsType;n.props.dispatch(pp(t,n.buildQuery(e)))},n.parserState=function(e){var t=n.props,a=t.itemType,i=t.allowManageRevisions;return r.a.createElement(hp,{item:e,itemName:a,allowManageRevisions:i})},n.addStateColumn=function(e){return[{id:"state",parser:n.parserState,cssClass:"state"}].concat(Object(N.a)(e))},n.isImportEnabled=function(){var e=n.props.itemType;return!0===window.import_export||ee(["import","allowed_entities"],g.c.List()).includes(e)},n.showImportEnabled=function(){var e=n.props.typeSelectOptions;return n.isImportEnabled()&&e.length>0},n.isExportEnabled=function(){var e=n.props.itemType;return!0===window.import_export||ee(["export","allowed_entities"],g.c.List()).includes(e)},n.getListActions=function(){var e=n.props.listActions,t=[{type:"export",label:"Export",onClick:n.onClickExport,show:n.isExportEnabled,actionStyle:"primary",actionSize:"xsmall"},{type:"import",label:"Import",onClick:n.onClickImport,show:n.showImportEnabled(),actionStyle:"primary",actionSize:"xsmall"},{type:"refresh",label:"Refresh",actionStyle:"primary",showIcon:!0,onClick:n.onClickRefresh,actionSize:"xsmall"},{type:"add",label:"Add New",actionStyle:"primary",showIcon:!0,onClick:n.onClickNew,actionSize:"xsmall"}];return null===e?t:e.map(function(e){var n=t.find(function(t){return t.type===e.type});return n?Object.assign(n,e):e}).reverse()},n.getExportQuery=function(e){return n.buildQuery(e).params.reduce(function(e,t,n){return["page","size"].includes(n)||Object.assign(e,t),e},{})},n.renderPanelHeader=function(){var e=n.props,t=e.entityKey,a=e.itemsType,i=ee(["systemItems",t,"itemsName"],Object(D.noCase)(a));return r.a.createElement("div",null,"List of all available ",i,r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:n.getListActions()})))},n.renderFilter=function(){var e=n.props,t=e.filter,a=e.filterFields,i=e.entityFields.filter(function(e){return e.get("searchable",!1)}).map(function(e){return g.c.Map({id:e.get("field_name",""),placeholder:e.get("title",e.get("field_name",""))})}).withMutations(function(e){g.c.fromJS(a).forEach(function(t){e.findIndex(function(e){return e.get("id","")===t.get("id","")})<0&&e.push(t)})}).reverse().toJS();return 0===i.length?null:r.a.createElement(Mu,{filter:t,fields:i,onFilter:n.onFilter},n.renderStateFilter())},n.renderStateFilter=function(){var e=n.props,t=e.state;return e.showRevisionBy?r.a.createElement("div",{className:"pull-right"},r.a.createElement(Ru,{states:t,onChangeState:n.onStateChange})):null},n.renderPager=function(){var e=n.props,t=e.items,a=e.size,i=e.page,o=e.nextPage;return r.a.createElement(wu,{page:i,size:a,count:t.size,nextPage:o,onChangePage:n.onPageChange,onChangeSize:n.onSizeChange})},n.getActions=function(){var e=n.props,t=e.actions,a=e.showRevisionBy?1:0,r={type:"edit",showIcon:!0,helpText:"Edit",onClick:n.onClickEditItem,show:!0,onClickColumn:a},i={type:"view",showIcon:!0,helpText:"View",onClick:n.onClickViewItem,show:!0,onClickColumn:a};return t.map(function(e){switch(e.type){case"edit":return Object.assign(r,e);case"view":return Object.assign(i,e);default:return e}})},n.renderList=function(){var e=n.props,t=e.items,a=e.sort,i=e.tableFields,o=e.showRevisionBy,l=n.getActions(),s=o?n.addStateColumn(i):i;return r.a.createElement(ju,{sort:a,items:t,fields:s,onSort:n.onSort,actions:l})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.entityKey,t=ee(["systemItems",e,"settingsKey"],e);this.props.dispatch(kl("".concat(t,".fields")));var n=this.props,a=n.forceRefetchItems,r=n.items,i=n.sort,o=n.defaultSort,l=n.itemsType,s=n.fetchOnMount;(a||null==r||r.isEmpty())&&s&&this.fetchItems(this.props),i.isEmpty()&&!o.isEmpty()&&this.props.dispatch(ap(l,o))}},{key:"componentDidMount",value:function(){var e=this.props.itemsType;if(this.isImportEnabled()){var t="import".concat(Object(D.upperCaseFirst)(e));this.props.dispatch(kl("plugin_actions",{actions:[t]}))}}},{key:"componentWillUpdate",value:function(e,t){var n=this.props.page!==e.page,a=this.props.size!==e.size,r=!g.c.is(this.props.filter,e.filter),i=!g.c.is(this.props.sort,e.sort),o=!g.c.is(this.props.state,e.state),l=g.c.fromJS(this.props.baseFilter),s=g.c.fromJS(e.baseFilter),c=!g.c.is(l,s),u=this.props.refreshString!==e.refreshString;(n||a||r||i||o||c||u)&&this.fetchItems(e)}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return null===this.props.items?r.a.createElement(_,null):r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:this.renderPanelHeader()},this.renderFilter(),this.renderList()),this.renderPager()))}}]),t}(a.Component);Sp.defaultProps={entityKey:void 0,items:null,api:"uniqueget",page:0,size:ee("listDefaultItems",10),nextPage:!1,editable:!0,allowManageRevisions:!0,showRevisionBy:!1,inProgress:!1,forceRefetchItems:!1,fetchOnMount:!0,baseFilter:{},tableFields:[],filterFields:[],typeSelectOptions:[],entityFields:g.c.List(),projectFields:{},sort:g.c.Map(),defaultSort:g.c.Map(),filter:g.c.Map(),state:g.c.List([0,1,2]),refreshString:"",actions:[],listActions:null,onListRefresh:null};var Tp=Object(s.f)(Object(l.connect)(function(e,t){var n=t.itemType,a=t.itemsType,r=t.itemType,i=t.collection||t.itemsType,o=t.showRevisionBy;if("undefined"!==typeof t.entityKey){r=t.entityKey;var l=ee(["systemItems",t.entityKey],g.c.Map());n=l.get("itemType",n),a=l.get("itemsType",a),i=l.get("collection",a),!1!==t.showRevisionBy&&(o=l.get("uniqueField",t.showRevisionBy))}return{collection:i,itemType:n,itemsType:a,entityKey:r,showRevisionBy:o,items:e.entityList.items.get(a),page:e.entityList.page.get(a),state:e.entityList.state.get(a),nextPage:e.entityList.nextPage.get(a),sort:e.entityList.sort.get(a),filter:e.entityList.filter.get(a),size:e.entityList.size.get(a),inProgress:e.progressIndicator>0,entityFields:ya(e,{entityName:ee(["systemItems",r,"settingsKey"],r).split(".")}),typeSelectOptions:Op(e,t,"importer",n)}})(Sp)),kp=n(149),jp=n.n(kp),Ip=n(150),wp=n.n(Ip),Np=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).playsValueToList=function(e){return""===e?g.c.List():g.c.List.isList(e)?e:Array.isArray(e)?g.c.List(Object(N.a)(e)):g.c.List(e.split(","))},n.onChange=function(e){var t=n.props.entity,a=n.playsValueToList(t.get("play","")),r=n.playsValueToList(e);if(a.every(function(e){return r.includes(e)}))return n.props.onChange(r.join(","));var i={children:"By removing play value all play related data will be removed",message:"Are you sure you want to change play?",onOk:function(){n.props.onChange(e,!0)},onCancel:function(){n.forceUpdate()},type:"delete",labelOk:"Yes"};return n.props.dispatch(ks(i))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(kl(["plays"]))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.availablePlays,a=t.mandatory,r=t.editable,i=t.onChange,o=t.entity,l=!e.availablePlays.isEmpty()&&g.c.is(n,e.availablePlays);null===o.get("play",null)&&a&&r&&l&&i(e.availablePlays.find(function(e){return e.get("enabled",!0)&&e.get("default",!1)},null,e.availablePlays.first()).get("name",""))}},{key:"render",value:function(){var e=this.props,t=e.availablePlays,n=e.entity,a=e.editable,i=e.multi,o=e.mandatory,l=e.labelStyle,s=e.fieldStyle;if(!function(e){return e.size>1}(t))return null;var c=i?"Play/s":"Play",u=this.playsValueToList(n.get("play","")).join(",");return r.a.createElement(f.l,{key:"play"},r.a.createElement(f.g,{componentClass:f.h,sm:l.sm,lg:l.lg},c,o&&r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:s.sm,lg:s.lg},r.a.createElement(Tn,{fieldType:"select",options:Ze(t),value:u,onChange:this.onChange,multi:i,placeholder:"",clearable:!o,editable:a})))}}]),t}(a.Component);Np.defaultProps={availablePlays:g.c.List(),editable:!0,labelStyle:{sm:3,lg:2},fieldStyle:{sm:8,lg:9},multi:!1,mandatory:!1,onChange:function(){}};var Fp=Object(l.connect)(function(e,t){return{availablePlays:la(e,t)}})(Np),xp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={fileError:null,predefinedFileError:null,delimiterError:null,operations:g.c.List()},n.setoperation=function(e,t){var a=ee(["import","allowed_entities_actions"],g.c.List()).filter(function(t){return t.includes(e)}).keySeq().map(function(e){return g.c.Map({value:e,label:Object(D.sentenceCase)(te(e,"import"))})}).toList();a.size>0&&(""===t||0===a.filter(function(e){return e.get("value","")===t}).size)&&n.props.onChange("operation",a.getIn([0,"value"],"")),n.setState({operations:a})},n.resetFile=function(){n.props.onChange("fileContent",""),n.props.onChange("fileName","")},n.onChangeOperation=function(e){n.props.onChange("operation",e)},n.onParseCsvComplete=function(e,t){0===e.errors.length?(n.props.onChange("file",t),n.props.onChange("fileContent",e.data),n.props.onChange("fileName",t.name),n.setState({fileError:null})):(n.setState({fileError:"Error in CSV file"}),n.resetFile())},n.onParseScvError=function(e,t){n.setState({fileError:"Error in CSV file"}),n.resetFile()},n.onFileUpload=function(e){var t=n.props.item,a=e.target.files;if(n.isValidFile(a[0])){var r=t.get("fileDelimiter",",");jp.a.parse(a[0],{skipEmptyLines:!0,delimiter:r,header:!1,preview:2,complete:n.onParseCsvComplete,error:n.onParseScvError})}else{var i=1024*ee("importMaxSize",8)*1024;n.setState({fileError:"Max file size is ".concat(wp()(i).human())}),e.target.value=null}},n.onFileReset=function(e){e.target.value=null,n.resetFile()},n.onUploadPredefinedFile=function(e){var t=n.props.item,a=e.target.files,r=[];if(a.length>0)for(var i=0;i<a.length;i++)r.push(a[i]);n.props.onChange("files",[].concat(Object(N.a)(t.get("files",[])),r)),e.target.value=null},n.onRemovePredefinedFile=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=n.props.item,a=-1===e?[]:t.get("files",[]).filter(function(t,n){return n!==e});0===a.length?n.props.onDelete("files"):n.props.onChange("files",a)},n.onChangeDelimiter=function(e){e.length?(n.props.onChange("fileDelimiter",e),n.setState({delimiterError:null})):(n.props.onDelete("fileDelimiter"),n.setState({delimiterError:"Delimiter is required"}))},n.onChangeEntity=function(e){n.props.onDelete("map"),n.props.onDelete("multiFieldAction"),n.props.onDelete("play"),n.props.onDelete("importType"),e.length?n.props.onChange("entity",e):n.props.onDelete("entity")},n.onChangeImportType=function(e){e.length?n.props.onChange("importType",e):n.props.onDelete("importType")},n.onSelectExistingMapper=function(e){n.props.onSelectMapping(e)},n.onChangePlay=function(e){n.props.onDelete("map"),n.props.onDelete("multiFieldAction"),e.length?n.props.onChange("play",e):n.props.onDelete("play")},n.isValidFile=function(e){var t=1024*ee("importMaxSize",8)*1024;return e.size<=t},n.createEntityTypeOptions=function(e){return e.map(function(e){return{value:e,label:Object(D.sentenceCase)(ee(["systemItems",e,"itemName"],e))}})},n.createSavedMapperOptions=function(){return n.props.mapperOptions.map(function(e){return{value:e.get("label",""),label:e.get("label","")}}).toList()},n.predefinedFileActions=function(){return[{type:"remove",helpText:"Remove file",onClick:n.onRemovePredefinedFile,actionClass:"pl0 pr0"}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.item;this.setoperation(e.get("entity",""),e.get("operation",""))}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.typeSelectOptions;this.props.item.get("entity","")!==t.get("entity","")&&this.setoperation(t.get("entity",""),t.get("operation",""));var a=t.get("importType","");n&&1===n.length&&n[0].value!==a&&this.onChangeImportType(n[0].value);var r=this.props.item.get("importType","");""!==r&&r!==a&&this.props.onDelete("files")}},{key:"render",value:function(){var e=this.state,t=e.delimiterError,n=e.predefinedFileError,a=e.fileError,i=e.operations,o=this.props,l=o.item,s=o.delimiterOptions,c=o.entityOptions,u=o.mapperName,p=o.mapperOptions,d=o.showPlay,m=o.typeSelectOptions,g=l.get("fileDelimiter",""),h=l.get("operation",""),v=l.get("entity",""),y=l.get("fileName",""),b=l.get("importType",""),E=c&&1===c.length,C=this.createEntityTypeOptions(c),_=""!==y,O=i.map(fe).toJS(),S=this.createSavedMapperOptions().toJS(),T=this.predefinedFileActions(),k=m.filter(function(e){return"plugin"===e.type}).map(function(e){return e.value}).includes(b);return r.a.createElement("div",{className:"StepUpload"},!E&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},"Entity"),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeEntity,options:C,value:v,placeholder:"Select entity to import....",clearable:!1}))),1!==m.length&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},"Import option"),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeImportType,options:m,value:b,placeholder:"Select import option....",clearable:!1}))),!["manual_mapping"].includes(b)&&r.a.createElement(f.l,{validationState:null===n?null:"error"},r.a.createElement(f.g,{sm:3,componentClass:f.h},"Upload CSV"),r.a.createElement(f.g,{sm:9},r.a.createElement("dl",null,r.a.createElement("dt",null,r.a.createElement(dt,{onClick:this.onUploadPredefinedFile}),null!==n&&r.a.createElement(f.n,null,n)),l.get("files",[]).map(function(e,t){return r.a.createElement("dd",{style:{height:28},key:"".concat(t,"-").concat(e.name)},r.a.createElement("span",{className:"inline ml10 mr10"},r.a.createElement(vt,{actions:T,data:t})),e.name)})))),["manual_mapping"].includes(b)&&r.a.createElement(f.l,{validationState:null===t?null:"error"},r.a.createElement(f.g,{sm:3,componentClass:f.h},"Delimiter"),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{fieldType:"select",allowCreate:!0,onChange:this.onChangeDelimiter,options:s,value:g,placeholder:"Select or add new",addLabelText:"{label}",clearable:!1,disabled:_}),null!==t&&r.a.createElement(f.n,null,t,"."),_&&r.a.createElement(f.n,{className:"mb0"},"To change delimiter please remove CSV file."))),["manual_mapping"].includes(b)&&r.a.createElement(f.l,{validationState:null===a?null:"error"},r.a.createElement(f.g,{sm:3,componentClass:f.h},"Upload CSV"),r.a.createElement(f.g,{sm:9},r.a.createElement("div",{style:{paddingTop:5}},""!==y?r.a.createElement("p",{style:{margin:0}},y,r.a.createElement(f.c,{bsStyle:"link",title:"Remove file",onClick:this.onFileReset,style:{padding:"0 0 0 10px",marginBottom:1}},r.a.createElement("i",{className:"fa fa-minus-circle danger-red"}))):r.a.createElement("input",{type:"file",accept:".csv",onChange:this.onFileUpload,onClick:this.onFileReset}),null!==a&&r.a.createElement(f.n,null,a,".")))),i.size>1&&!1===k&&r.a.createElement(f.l,{validationState:null===t?null:"error"},r.a.createElement(f.g,{sm:3,componentClass:f.h},"Import Action"),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeOperation,options:O,value:h,placeholder:"Select import action",addLabelText:"{label}",clearable:!1,disabled:1===i.size||""===v}))),d&&r.a.createElement(Fp,{entity:l,onChange:this.onChangePlay,labelStyle:{sm:3,lg:3},fieldStyle:{sm:9,lg:9}}),["manual_mapping"].includes(b)&&p.size>0&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},"Saved Mapper"),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{fieldType:"select",onChange:this.onSelectExistingMapper,options:S,value:u,placeholder:"Select saved mapper",clearable:!0}))))}}]),t}(a.Component);xp.defaultProps={item:g.c.Map(),mapperOptions:g.c.List(),delimiterOptions:[{value:"\t",label:"Tab"},{value:" ",label:"Space"},{value:",",label:"Comma"}],entityOptions:[],typeSelectOptions:[],showPlay:!1,mapperName:"",onChange:function(){},onDelete:function(){},onSelectMapping:function(){}};var Rp=xp,Mp=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activityTypeError:"",propertyTypeError:""},n.onChangeField=function(e){var t=e.target,a=t.id,r=t.value,i="label"===a?["usage_type","label"]:[a],o="label"===a?[L.a.snakeCase(r),r]:[r];n.setState({activityTypeError:""===r?"Activity type required":""}),n.props.onUpdateItem(i,o)},n.onChangePropertyType=function(e){n.setState({propertyTypeError:""===e?"Property type required":""}),n.props.onUpdateItem(["property_type","invoice_uom","input_uom"],[e,"",""])},n.onChangeInvoiceUom=function(e){n.props.onUpdateItem("invoice_uom",e)},n.onChangeInputUom=function(e){n.props.onUpdateItem("input_uom",e)},n.getAvailablePropertyTypes=function(){return n.props.propertyTypes.map(function(e){return{value:e.get("type",""),label:e.get("type","")}}).toArray()},n.getUom=function(e){return n.props.propertyTypes.find(function(t){return t.get("type","")===e},null,g.c.Map()).get("uom",g.c.List())},n.getAvailableUom=function(){var e=n.props.item;return n.getUom(e.get("property_type","")).map(function(e){return{value:e.get("name",""),label:e.get("label","")}}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.getAvailableUom();return r.a.createElement(it,{title:"Activity Type",show:!0,onOk:this.props.onSave,onCancel:this.props.onCancel,labelOk:"OK"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{validationState:""!==this.state.activityTypeError?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:4},"Activity Type"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{id:"label",onChange:this.onChangeField,value:this.props.item.get("label",""),disabled:!this.props.editBase}),""!==this.state.activityTypeError&&r.a.createElement(f.n,null,this.state.activityTypeError))),r.a.createElement(f.l,{validationState:""!==this.state.propertyTypeError?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:4},"Property Type"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangePropertyType,value:this.props.item.get("property_type",""),options:this.getAvailablePropertyTypes(),disabled:!this.props.editBase}),""!==this.state.propertyTypeError&&r.a.createElement(f.n,null,this.state.propertyTypeError))),this.props.selectUoms&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:4},"Invoice Unit of Measure"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeInvoiceUom,value:this.props.item.get("invoice_uom",""),options:e}))),this.props.selectUoms&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:4},"Default Unit of Measure"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeInputUom,value:this.props.item.get("input_uom",""),options:e})))))}}]),t}(a.Component);Mp.defaultProps={item:g.c.Map(),propertyTypes:g.c.List(),selectUoms:!1,editBase:!0};var Pp=Mp,Ap=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={currentItem:null},n.onChangeUsaget=function(e){n.props.onChangeUsaget(e)},n.onChangeUnit=function(e){return function(t){n.props.onChangeUnit(t,e)}},n.onCancelNewUsageType=function(){n.setState({currentItem:null})},n.onSaveNewUsageType=function(){var e=n.props.usageTypesData,t=n.state.currentItem;n.setState({currentItem:null}),n.props.dispatch(yl("usage_types",e.size,t)),n.props.dispatch(Tl("usage_types")),n.props.onChangeUsaget(t.get("usage_type",""))},n.onClickNewUsageType=function(){n.setState({currentItem:g.c.Map()})},n.onUpdateUsageType=function(e,t){var a=n.state.currentItem,r=Array.isArray(e)?e:[e],i=Array.isArray(t)?t:[t];n.setState({currentItem:a.withMutations(function(e){r.forEach(function(t,n){return e.set(t,i[n])})})})},n.getAvailableUsageTypes=function(){var e=n.props,t=e.usageTypesData,a=e.usagetFilter;return t.filter(a).map(function(e){return{value:e.get("usage_type",""),label:e.get("label","")}}).toJS()},n.getAvailableUnits=function(){var e=n.props,t=e.propertyTypes,a=e.usageTypesData,r=e.usaget,i=e.unitFilter,o=e.showDisplayUnits,l=a.find(function(e){return e.get("usage_type","")===r})||g.c.Map();return(t.find(function(e){return e.get("type","")===l.get("property_type","")})||g.c.Map()).get("uom",g.c.List()).filter(function(e){return!1!==e.get("unit",!1)||o&&!1!==e.get("convertFunction",!1)}).filter(i).map(function(e){return{value:e.get("name",""),label:e.get("label","")}}).toArray()},n.renderUsageTypeSelect=function(){var e=n.props,t=e.enabled,a=e.editable,i=e.usaget;return e.showSelectTypes&&r.a.createElement(Tn,{fieldType:"select",options:n.getAvailableUsageTypes(),value:i,disabled:!t,editable:a,onChange:n.onChangeUsaget})},n.renderAddUsageTypeButton=function(){return r.a.createElement(f.c,{className:"btn-primary",onClick:n.onClickNewUsageType,disabled:!n.props.enabled},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0")},n.renderUnitSelect=function(){var e=n.props,t=e.enabled,a=e.editable,i=e.unit,o=e.usaget;return r.a.createElement(Tn,{fieldType:"select",onChange:n.onChangeUnit(o),value:i,options:n.getAvailableUnits(),disabled:!t||!o,editable:a})},n.renderNewUsageTypeForm=function(){var e=n.props.propertyTypes,t=n.state.currentItem;return t&&r.a.createElement(Pp,{item:t,propertyTypes:e,onUpdateItem:n.onUpdateUsageType,onSave:n.onSaveNewUsageType,onCancel:n.onCancelNewUsageType})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.usageTypesData,n=e.propertyTypes,a=[];t.isEmpty()&&a.push("usage_types"),n.isEmpty()&&a.push("property_types"),a.length>0&&this.props.dispatch(kl(["usage_types","property_types"]))}},{key:"componentWillReceiveProps",value:function(e){this.props.usaget!==e.usaget&&this.onChangeUnit(e.usaget)("")}},{key:"render",value:function(){var e=this.props,t=e.showUnits,n=e.showAddButton,a=e.showSelectTypes,i=e.editable;return a?r.a.createElement("span",null,r.a.createElement(f.g,{sm:7,className:"pr0 pl0"},n&&i?r.a.createElement(f.o,null,r.a.createElement(f.o.Button,null,this.renderAddUsageTypeButton()),this.renderUsageTypeSelect()):this.renderUsageTypeSelect()),r.a.createElement(f.g,{sm:5,className:"pr0"},t&&this.renderUnitSelect()),this.renderNewUsageTypeForm()):r.a.createElement("span",null,t&&this.renderUnitSelect(),this.renderNewUsageTypeForm())}}]),t}(a.Component);Ap.defaultProps={usageTypesData:g.c.List(),propertyTypes:g.c.List(),usaget:"",unit:"",onChangeUsaget:function(){},onChangeUnit:function(){},editable:!0,enabled:!0,showUnits:!0,showAddButton:!0,usagetFilter:function(){return!0},unitFilter:function(){return!0},showSelectTypes:!0,showDisplayUnits:!1};var Dp=Object(l.connect)(function(e,t){return{usageTypesData:ha(e,t),propertyTypes:va(e,t)}})(Ap),Lp=function(e){var t=e.mapFrom,n=e.mapTo,a=e.defaultValue,i=e.options,o=e.mapResult,l=e.operation,s=e.defaultValuesOperation,c=e.entity,u=e.multiFieldAction,p=function(n){""!==n?(e.onChange(["map",t.value],n),t.multiple&&!u.has(t.value)&&e.onChange(["multiFieldAction",t.value],"append")):(e.onDelete(["map",t.value]),t.multiple&&e.onDelete(["multiFieldAction",t.value]))},d=function(t){e.onChange(["map","usage_type_unit"],t)},m=function(t){e.onChange(["map","usage_type_value"],t)},g=function(n){e.onChange(["multiFieldAction",t.value],n),"remove"===n&&e.onDelete(["map",t.value])},h=t.unique||"create"!==l&&t.multiple,v=function(){switch(t.value){case"usage_type":return r.a.createElement(Dp,{usaget:o.get("usage_type_value"),unit:o.get("usage_type_unit"),onChangeUsaget:m,onChangeUnit:d});case"tariff_category":var e=t.select_options&&t.select_options.length?t.select_options.split(",").filter(function(e){return""!==e}).map(function(e){return{value:e,label:Object(D.sentenceCase)(e)}}):[];return r.a.createElement(Tn,{fieldType:"select",value:n,onChange:p,options:e,placeholder:"Select ".concat(t.label)});default:var a=t.multiple&&"remove"===u.get(t.value,"");return r.a.createElement(Tn,{fieldType:"select",allowCreate:!0,options:i,value:n,onChange:p,placeholder:"Select CSV field or set default value...",addLabelText:'Click to set default value "{label}" for all rows',disabled:a})}},y=function(e){switch(e){case"append":return r.a.createElement("i",{className:"fa fa-plus"});case"replace":return r.a.createElement("i",{className:"fa fa-refresh"});case"remove":return r.a.createElement("i",{className:"fa fa-trash-o danger-red"});default:return""}},b=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t?r.a.createElement("span",null,y(e),"\xa0"):"";switch(e){case"append":return r.a.createElement("span",null,n,"Append");case"replace":return r.a.createElement("span",null,n,"Replace");case"remove":return r.a.createElement("span",null,n,"Remove");default:return"Select action..."}};return r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},t.label,t.mandatory&&null===a&&"create"===l&&r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:9},h?r.a.createElement(f.o,null,v(),t.unique&&r.a.createElement(f.o.Addon,null,r.a.createElement(f.p,{bsStyle:"info"},"Unique field")),function(){if("create"===l||!t.multiple)return null;var e=u.get(t.value,!1),n=r.a.createElement("span",{className:"control-label"},b(e));return r.a.createElement(f.i,{onSelect:g,id:"".concat(t.value,"-actions"),componentClass:f.o.Button,title:n},function(){var e=!o.has(t.value)&&"remove"!==u.get(t.value,!1);return["append","replace","remove"].map(function(n){var a=u.get(t.value,!1)===n;return r.a.createElement(f.q,{eventKey:n,active:a,key:"".concat(t.value,"-").concat(n,"-action"),disabled:e&&"remove"!==n},b(n))})}())}()):v(),"string"===typeof t.help&&""!==t.help&&r.a.createElement(f.n,{className:"mb0 mt0"},t.help),null!==a&&s.get(l).includes(c)&&r.a.createElement(f.n,{className:"mb0"},"Default value if no value is selected:\xa0",r.a.createElement(f.p,{bsStyle:"primary",style:{padding:"1px 6px",fontWeight:"bold"}},!0===a?"Yes":!1===a?"No":a))))};Lp.defaultProps={mapResult:g.c.Map(),mapFrom:"",mapTo:"",defaultValue:null,options:[],entity:"",operation:"",defaultValuesOperation:ee(["import","default_values_allowed_actions"],g.c.Map()),multiFieldAction:g.c.Map(),onChange:function(){},onDelete:function(){}};var Up=Lp,Vp=function(e){var t=e.item,n=e.fields,a=e.ignoredHeaders,i=e.mapperPrefix,o=e.defaultFieldsValues,l=t.get("fileContent",[])||[],s=t.getIn(["linker","field"],"")||"",c=t.getIn(["linker","value"],"")||"",u=t.getIn(["updater","field"],"")||"",p=t.getIn(["updater","value"],"")||"",d=t.get("operation","create"),m=l[0]||[],g=function(t){""!==t?e.onChange(["linker","field"],t):e.onDelete(["linker","field"])},h=function(t){""!==t?e.onChange(["linker","value"],t):e.onDelete(["linker","value"])},v=function(t){""!==t?e.onChange(["updater","field"],t):e.onDelete(["updater","field"])},y=function(t){""!==t?e.onChange(["updater","value"],t):e.onDelete(["updater","value"])},b=function(t){""!==t?e.onChange(["map","effective_date"],t):e.onDelete(["map","effective_date"])},E=function(e,t){return e.mandatory&&!t.mandatory?-1:!e.mandatory&&t.mandatory?1:e.unique&&!t.unique?-1:!e.unique&&t.unique?1:n.findIndex(function(t){return t.value===e.value})>n.findIndex(function(e){return e.value===t.value})?1:-1},C=function(t){return!t.generated&&!1!==t.show&&"effective_date"!==t.value&&t.editable&&(!t.hasOwnProperty("linker")||!t.linker)&&e.customFilterFields(t)},_=m.map(function(e,t){return{label:e,value:"".concat(i).concat(t)}}).filter(function(e){return!a.includes(e.label)});return r.a.createElement(f.g,{md:12,className:"StepMapper scrollbox"},function(){if(0===l.length)return r.a.createElement(f.p,{bsStyle:"default"},"Please upload a file.");if(0===m.length)return r.a.createElement(f.p,{bsStyle:"default"},"No CSV headers was found, please check your file.");var a=n.filter(C).sort(E).map(function(n){var a=o.find(function(e,t){return t===n.value});return r.a.createElement(Up,{key:"header_".concat(n.value),defaultValue:a,mapFrom:n,mapTo:t.getIn(["map",n.value],""),operation:d,entity:t.get("entity"),options:_,mapResult:t.get("map"),multiFieldAction:t.get("multiFieldAction"),mapperPrefix:i,onChange:e.onChange,onDelete:e.onDelete})}),O=function(){var e=n.filter(function(e){return e.hasOwnProperty("linker")&&e.linker}).map(function(e){return{value:e.value,label:e.label}});return 0===e.length?null:r.a.createElement(f.v,{header:"Linker",className:"mb0"},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},"Link to field",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{fieldType:"select",onChange:g,options:e,value:s,placeholder:"Select field to link..."}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},"Link by value from",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{fieldType:"select",onChange:h,options:_,value:c,placeholder:"Select CSV field to link..."}))))}(),S=function(){var e=n.filter(function(e){return e.hasOwnProperty("updater")&&e.updater}).map(function(e){return{value:e.value,label:e.label}});return 0===e.length?null:r.a.createElement(f.v,{header:"Updater"},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:6,componentClass:f.h,className:"text-left"},"Unique field used for the update",r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Tn,{fieldType:"select",onChange:v,options:e,value:u,placeholder:"Select field to  update by..."})),r.a.createElement(f.g,{sm:6,componentClass:f.h,className:"text-left"},"Match unique field to CSV column",r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Tn,{fieldType:"select",onChange:y,options:_,value:p,placeholder:"Select CSV field to update..."}))),r.a.createElement("hr",{className:"mt0 mb10"}),r.a.createElement(f.l,{className:"mb0"},r.a.createElement(f.g,{sm:3,componentClass:f.h},"Update Revision by Effective Date",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{fieldType:"select",onChange:b,options:_,value:t.getIn(["map","effective_date"],""),placeholder:"Select CSV field to update...",allowCreate:!0}))))}();return r.a.createElement("div",null,null!==S&&"permanentchange"===d&&S,r.a.createElement("div",null,a),null!==O&&O)}())};Vp.defaultProps={item:g.c.Map(),fields:[],defaultFieldsValues:g.c.Map(),ignoredHeaders:[],mapperPrefix:"",customFilterFields:function(){return!0},onChange:function(){},onDelete:function(){}};var Bp=Vp,qp=function(e){var t=e.fields,n=e.rows,i=e.selectedMapper,o=e.defaultMappedName,l=e.saveMapper,s=e.removeMapper,c=e.entity,u=Object(a.useState)(["",null].includes(i)?o:i),p=Object(w.a)(u,2),d=p[0],m=p[1],h=n.get(0,g.c.Map()),v=h.filter(function(e,t){return["__UPDATER__","effective_date"].includes(t)}),y=h.filter(function(e,t){return!["__LINKER__","__UPDATER__","__MULTI_FIELD_ACTION__","__CSVROW__","__ERRORS__","effective_date"].includes(t)}),b=function(e){var t=["",null].includes(e)?o:e;l(t)},E=[{type:"edit",helpText:"Update mapper with new mapping or name",onClick:b,show:null!==i,actionSize:"xsmall",actionStyle:"primary"},{type:"add",helpText:"Save Mapper for latter use",onClick:b,show:null===i,actionSize:"xsmall",actionStyle:"primary"},{type:"remove",helpText:"Remove Mapper",onClick:function(e){m(""),s(e)},show:null!==i,actionSize:"xsmall",actionStyle:"danger"}],C=function(e,t){return e.isEmpty()?null:r.a.createElement(f.v,{header:"Errors",key:t},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},e.sortBy(function(e,t){return parseInt(t)}).map(function(e,t){return r.a.createElement("dl",{className:"mb0",key:t},r.a.createElement("dt",null,"row ",t),e.map(function(e,n){return r.a.createElement("dd",{key:"".concat(t,"-").concat(n)},"- ",e)}))}).toList().toArray())))};return r.a.createElement("div",{className:"StepValidate"},r.a.createElement("div",null,r.a.createElement("h4",{className:"pull-left"},"Example Import"),r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.o,{style:{width:300,marginTop:7}},r.a.createElement(f.o.Addon,{style:{fontSize:13,padding:"6px 9px"}},"Mapper"),r.a.createElement("input",{type:"text",className:"form-control",value:d,onChange:function(e){var t=e.target.value;m(t)},placeholder:"Enter mapper name",style:{height:28,fontSize:13}}),r.a.createElement(f.o.Button,null,r.a.createElement(vt,{actions:E,data:d,type:"group"})))),r.a.createElement("div",{className:"clearfix"})),r.a.createElement("hr",{className:"mt0 mb0"}),r.a.createElement("div",{className:"row-fields scrollbox"},n.map(function(e){return e.filter(function(e,t){return"__ERRORS__"===t}).map(C).toList().toArray()}),y.size>0&&r.a.createElement(f.v,{header:"Map"},y.map(function(e,n){var a=t.find(function(e){return e.value===n}),i=["number","string","boolean"].includes(typeof e)?e:"complex value cannot be displayed in preview";return r.a.createElement(f.l,{key:"row_".concat(n)},r.a.createElement(f.g,{sm:3,componentClass:f.h},a?a.label:te(n,ne(c),Object(D.sentenceCase)(n))),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{value:i,disabled:!0})))}).toList().toArray()),h.filter(function(e,t){return"__LINKER__"===t}).map(function(e,n){var a=t.find(function(t){return t.value===e.get("field","")});return r.a.createElement(f.v,{header:"Linker",className:"mb0",key:n},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,componentClass:f.h},a?a.label:e.get("field","")),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{value:e.get("value",""),disabled:!0}))))}).toList().toArray(),v.size>0&&r.a.createElement(f.v,{header:"Updater",className:"mb0"},v.map(function(e,n){var a="effective_date"===n?"effective_date":e.get("field",""),i="effective_date"===n?e:e.get("value",""),o=t.find(function(e){return e.value===a});return r.a.createElement(f.l,{key:n},r.a.createElement(f.g,{sm:3,componentClass:f.h},o?o.label:a),r.a.createElement(f.g,{sm:9},r.a.createElement(Tn,{value:i,disabled:!0})))}).toList().toArray())))};qp.defaultProps={fields:[],entity:"",selectedMapper:"",defaultMappedName:"",rows:g.c.List(),saveMapper:function(){},removeMapper:function(){}};var zp=qp,Hp=n(284),Yp=n(51),Gp=n.n(Yp),Kp=function(e){var t=e.item,n=t.get("fileDelimiter",","),a=t.get("fileContent",[])||[],i=t.get("fileName","errors"),o=t.get("entity",""),l=["predefined_mapping","manual_mapping"].includes(t.get("importType",""))?t.getIn(["result"],g.c.Map()):t.getIn(["result","imported_entities"],g.c.List())||g.c.List(),s=function(){var e=[];return l.forEach(function(t,n){!0!==t&&a[n-1]&&e.push([].concat(Object(N.a)(a[n-1]),[t,n]))}),e};return r.a.createElement("div",{className:"StepResult"},r.a.createElement("h4",null,"Import status"),function(){if(t.hasIn(["result","created"])||t.hasIn(["result","updated"])){var e=t.getIn(["result","created"],0),l=t.getIn(["result","updated"],0),c=ee(["systemItems",o,"itemName"],""),u=Gp()(c,Number(e)),p=Gp()(c,Number(l)),d=t.getIn(["result","general_errors"],g.c.List()),m=r.a.createElement("div",{className:"mb5"},r.a.createElement(f.p,{bsStyle:"danger"},"Errors :"),r.a.createElement("ol",{className:"pt0 pb0"},d.map(function(e,t){return r.a.createElement("li",{key:"error_".concat(t)},e)}).toArray())),h=t.getIn(["result","general_warnings"],g.c.List()),v=r.a.createElement("div",{className:"mb5"},r.a.createElement(f.p,{bsStyle:"warning"},"Warnings :"),r.a.createElement("ol",{className:"pt0 pb0"},h.map(function(e,t){return r.a.createElement("li",{key:"warning_".concat(t)},e)}).toArray()));return r.a.createElement("div",{className:"ml10"},r.a.createElement(f.p,{bsStyle:"success"},"Success :"),r.a.createElement("ul",{className:"pt0 pb0"},r.a.createElement("li",null,"Created ",e," ",u),r.a.createElement("li",null,"Updated ",l," ",p)),d.size>0&&m,h.size>0&&v)}var y=t.getIn(["result"],g.c.Map());if(0===y.size)return r.a.createElement("div",{className:"ml10"},r.a.createElement(f.p,{bsStyle:"default"},"No records were imported"));if(y.every(function(e){return!0===e}))return r.a.createElement("div",{className:"ml10"},r.a.createElement(f.p,{bsStyle:"success"},y.size," records were successfully imported"));if(y.every(function(e){return!0!==e}))return r.a.createElement("div",{className:"ml10"},r.a.createElement(f.p,{bsStyle:"danger"},"No records were imported. please fix the errors and try again."));var b=y.filter(function(e){return!0===e}),E=null;if("manual_mapping"===t.get("importType",",")){var C=s(),_=[].concat(Object(N.a)(a[0]),["import_error_message","import_error_row"]);E=r.a.createElement(Hp.CSVLink,{data:C,headers:_,separator:n,filename:"errors_".concat(i)},"Click here to download CSV file with errors")}return r.a.createElement("div",{className:"ml10"},r.a.createElement("p",null,r.a.createElement(f.p,{bsStyle:"success"},b.size)," rows were successfully imported.",r.a.createElement("br",null),r.a.createElement(f.p,{bsStyle:"danger"},y.size-b.size)," rows failed to import.",r.a.createElement("br",null),"Please remove successfully imported rows from the file, fix the errors and try again."),E)}(),r.a.createElement("br",null),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Details"),collapsible:!0,className:"collapsible"},l.sortBy(function(e,t){return parseInt(t)}).map(function(e,t){return!0===e?null:r.a.createElement("dl",{className:"mb5",key:"status_".concat(t)},r.a.createElement("dt",null,x()(t)?"row ".concat(t):t,!0===e&&r.a.createElement(f.p,{bsStyle:"success",className:"ml10"},"Success"),!1===e&&r.a.createElement(f.p,{bsStyle:"info",className:"ml10"},"No errors"),!1!==e&&!0!==e&&!g.c.Iterable.isIterable(e)&&r.a.createElement(f.p,{bsStyle:"danger",className:"ml10"},e)),g.c.Iterable.isIterable(e)&&e.map(function(e,n){var a="default";return"warning"===n?a="warning":"error"===n&&(a="danger"),r.a.createElement("dd",{className:"ml10",key:"status_error_".concat(t,"_").concat(n)},"- ",r.a.createElement(f.p,{bsStyle:a},e))}).toList().toArray())}).toList().toArray()))};Kp.defaultProps={item:g.c.Map()};var Wp=Kp,Jp=function(){return r.a.createElement("div",{className:"StepImporting text-center"},r.a.createElement("p",{className:"pt50"},"Action can take some time"),r.a.createElement("p",{className:"pt20"},r.a.createElement("i",{className:"fa fa-spinner fa-pulse"})," Please wait..."))};Jp.defaultProps={};var $p=Jp,Qp=Object(g.b)({map:Object(g.b)(),fileDelimiter:","}),Zp=function(){return Yl("importer",Qp)},Xp=function(e,t){return zl("importer",e,t)},ed=function(e){return Hl("importer",e)},td=function(e,t,n){return function(e,t,n){return function(a){a(jr());var r=Jl(0,t,"import");r.append("operation",n);var i=hi(e,"import",r);return ei(i,{timeOutMessage:Dl}).then(function(e){return a(Wr(e))}).catch(function(e){return a(Jr(e,"Error importing Entities"))})}}(e,t,n)},nd=function(e){return g.a.isList(e)?e:e.reduce(function(e,t,n){return e.push(Object(g.b)({field:n,value:t}))},Object(g.a)())},ad=function(e){return g.b.isMap(e)?e:e.reduce(function(e,t){return e.set(t.get("field",""),t.get("value",""))},Object(g.b)())},rd=function(e){return e.update("map",Object(g.a)(),ad).update("multiFieldAction",Object(g.a)(),ad)},id=function(e){return e.update("map",Object(g.b)(),nd).update("multiFieldAction",Object(g.b)(),nd)},od=function(e){return function(t,n){var a=n().settings.getIn(["import","mapping"],Object(g.a)()).push(e);return t(cd(a,"Mapper '".concat(e.get("label",""),"' was saved")))}},ld=function(e,t){return function(n,a){var r=a().settings.getIn(["import","mapping"],Object(g.a)()).set(t,e);return n(cd(r,"Mapper '".concat(e.get("label",""),"' was updated")))}},sd=function(e){return function(t,n){var a=n().settings.getIn(["import","mapping"],Object(g.a)()).filter(function(t){return t.get("label","")!==e});return t(cd(a,"Mapper '".concat(e,"' was removed")))}},cd=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mapper was saved",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Error saving mapper";return function(a){a(jr());var r=e.map(id),i=ii(r,"import.mapping");return ei(i).then(function(e){return a(Wr(e,t))}).catch(function(e){return a(Jr(e,n))}).finally(function(){return a(kl("import.mapping"))})}},ud=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={status:"create",stepIndex:0,mapperPrefix:"__csvindex__"},n.initImportEntity=function(e){e&&1===e.size&&n.onChange("entity",e.first())},n.getImporterSteps=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=n.props.item,a=t.get("importType",""),r=[];return"manual_mapping"===a?(r.push({id:"upload",stepDate:{title:"Upload File"}}),r.push({id:"mapping",stepDate:{title:"Field Map"}}),r.push({id:"validate",stepDate:{title:"Validate"},okLabel:"Confirm and Import",okAction:n.onImport})):r.push({id:"upload",stepDate:{title:"Upload File"},okLabel:"Import",okAction:n.onImport}),r.push({id:"importing",stepDate:{title:"Importing"}}),r.push({id:"finish",stepDate:{title:"Finish"},okLabel:"Close",okAction:n.onFinish}),null===e?r:r[e]||{}},n.onChange=function(e,t){var a=n.props.item.get("operation","create");n.props.dispatch(Xp(e,t)),"operation"===e&&a!==t&&n.onSelectMapping()},n.onDelete=function(e){n.props.dispatch(ed(e))},n.onFinish=function(){n.props.onFinish&&n.props.onFinish()},n.getPredefinedValues=function(){var e=n.props,t=e.item,a=e.predefinedValues,r=e.predefinedValuesOperation,i=t.get("entity",""),o=t.get("operation","create");return r.get(o,g.c.List()).includes(i)?a.get(i,g.c.Map()):g.c.Map()},n.getDefaultValues=function(){var e=n.props,t=e.item,a=e.defaultValues,r=e.defaultValuesOperation,i=t.get("entity",""),o=t.get("operation","create");return r.get(o,g.c.List()).includes(i)?a.get(i,g.c.Map()):g.c.Map()},n.createManualMappingImportData=function(){var e=n.props,t=e.item,a=e.importFields;return g.c.Map({files:[t.get("file","")],map:t.get("map",g.c.List()),delimiter:t.get("fileDelimiter",","),linker:t.get("linker",g.c.Map()),updater:t.get("updater",g.c.Map()),multi_field_action:t.get("multiFieldAction",g.c.Map()),predefined_values:n.getPredefinedValues(),default_values:n.getDefaultValues(),import_fields:a,mapper_name:t.get("mapperName",g.c.Map())})},n.onClearItems=function(e){n.props.onClearItems&&n.props.onClearItems(e)},n.onImport=function(){var e=n.props.item,t=e.get("entity",""),a=e.get("operation","create"),r=ee(["systemItems",t,"collection"],""),i="manual_mapping"===e.get("importType","")?n.createManualMappingImportData():e;""!==t?(n.setState({status:"progress"}),n.onNextStep(),n.props.dispatch(td(r,i,a)).then(n.afterImport)):n.props.dispatch(Br("No Import data found"))},n.onNextStep=function(){var e=n.state.stepIndex;n.setState({stepIndex:e+1})},n.onPrevStep=function(){var e=n.state.stepIndex;"importing"===n.getImporterSteps(e-1).id?n.setState({stepIndex:e-2}):n.setState({stepIndex:e-1})},n.combineRateLines=function(e,t,a){var r=n.props,i=r.importFields,o=r.item,l=r.propertyTypes,s=r.usageTypesData,c=i.filter(function(e){return e.multiple}).map(function(e){return e.value}),u=o.get("operation","create"),p=["__MULTI_FIELD_ACTION__","__UPDATER__","__CSVROW__","__ERRORS__","price_plan","price_from","price_to","price_interval","price_value","usage_type_value","usage_type_unit"],d=["tax__type","tax__taxation","tax__custom_logic","tax__custom_tax"];return e.withMutations(function(e){if(""!==t.get("rates.percentage","")&&"BASE"!==t.get("price_plan","BASE")){var n=["rates",t.get("usage_type_value","_KEEP_SOURCE_USAGE_TYPE_"),t.get("price_plan","BASE"),"percentage"],r=parseFloat(t.get("rates.percentage",1));e.setIn(n,r)}else if(""!==t.get("price_value",""))if(t.has("price_from")&&t.has("price_to")&&t.has("price_interval")&&t.has("price_value")&&(t.has("usage_type_unit")&&t.has("usage_type_value")&&"create"===u||"create"!==u)){var i=["rates",t.get("usage_type_value","_KEEP_SOURCE_USAGE_TYPE_"),t.get("price_plan","BASE"),"rate"],m=g.c.Map({from:t.get("price_from",0),to:t.get("price_to","UNLIMITED"),interval:t.get("price_interval",0),price:t.get("price_value",0),uom_display:g.c.Map({range:t.get("usage_type_unit","_KEEP_SOURCE_USAGE_TYPE_UNIT_"),interval:t.get("usage_type_unit","_KEEP_SOURCE_USAGE_TYPE_UNIT_")})});e.updateIn(i,g.c.List(),function(e){return e.push(m)})}else{var f=["price_from","price_to","price_interval","price_value"];"create"===o.get("operation","create")&&(f.push("usage_type_value"),f.push("usage_type_unit")),f.forEach(function(n){t.has(n)||e.update("__ERRORS__",g.c.Map(),function(e){return e.update(t.get("__CSVROW__","unknown"),g.c.List(),function(e){return e.push("missing ".concat(n," data"))})})})}t.forEach(function(n,r){if(0===a||p.includes(r)||d.includes(r)||c.includes(r)||n===e.get(r,"")||e.update("__ERRORS__",g.c.Map(),function(e){return e.update(t.get("__CSVROW__","unknown"),g.c.List(),function(e){return e.push("different values for ".concat(r," field"))})}),c.includes(r)){var i=e.get(r,g.c.List());if(!g.c.List.isList(i)){var o=i.split(",").map(function(e){return e.trim()});e.set(r,g.c.List(o))}var l=g.c.Set(e.get(r,g.c.List()));l=l.concat(n.split(",").map(function(e){return e.trim()})),e.set(r,l.toList())}if(d.includes(r)&&t.has(r)){var s=r.split("__"),u=[s[0],0,s[1]];0!==a&&n!==e.getIn(u,"")?e.update("__ERRORS__",g.c.Map(),function(e){return e.update(t.get("__CSVROW__","unknown"),g.c.List(),function(e){return e.push("different values for ".concat(Object(D.titleCase)(s[0])," ").concat(Object(D.titleCase)(s[1])," field"))})}):e.update(s[0],g.c.List(),function(e){return e.update(0,g.c.Map(),function(e){return e.set(s[1],t.get(r,""))})})}});var h=Ne(l,s,e,!0);h.isEmpty()||e.set("rates",h);var v=e.get("__CSVROW__",g.c.List());g.c.List.isList(v)||(v=g.c.List([v])),0!==a&&(v=v.push(t.get("__CSVROW__","unknown"))),e.set("__CSVROW__",v),e.delete("tax__custom_logic").delete("tax__custom_tax").delete("tax__taxation").delete("rates.percentage").delete("price_plan").delete("price_from").delete("price_to").delete("price_interval").delete("price_value").delete("usage_type_value").delete("usage_type_unit")})},n.alterProductsData=function(e){return g.c.List().withMutations(function(t){var a=n.props,r=a.item,i=a.showPlay,o=r.get("operation","create"),l="create"===o?"from":"effective_date",s=g.c.fromJS(e).sortBy(function(e){return e.get(l,"")}).reverse().groupBy(function(e){return e.getIn(["__UPDATER__","value"],e.get("key","key"))}).map(function(e){return e.sortBy(function(e){return e.get("price_from","")}).groupBy(function(e){return e.get(l,"")}).map(function(e){return e.reduce(n.combineRateLines,e.first())})}),c=!1;s.forEach(function(e){e.forEach(function(e){e.withMutations(function(n){i&&n.set("play",r.get("play","")),e.has(l)||n.update("__ERRORS__",g.c.Map(),function(t){return t.withMutations(function(t){e.get("__CSVROW__",g.c.List()).forEach(function(e){t.update(e,g.c.List(),function(e){return e.push("missing ".concat(l," field"))})})})}),"permanentchange"!==o||e.has("__UPDATER__")||n.update("__ERRORS__",g.c.Map(),function(t){return t.withMutations(function(t){e.get("__CSVROW__",g.c.List()).forEach(function(e){t.update(e,g.c.List(),function(e){return e.push("missing updater field")})})})}),n.has("__ERRORS__")&&(c=!0),t.push(n)})})}),n.props.dispatch(Xp("error",c))})},n.alterData=function(e){switch(n.props.item.get("entity","")){case"product":return n.alterProductsData(e);default:return e}},n.removeMapper=function(){var e=n.props.item.get("mapperName","");n.props.dispatch(sd(e)),n.props.dispatch(Xp("mapperName",""))},n.onSaveMapping=function(e){var t=n.props,a=t.item,r=t.savedMappers,i=a.get("mapperName",""),o=r.findIndex(function(t){return t.get("label","")===e}),l=a.get("map",g.c.List()),s=a.get("linker",g.c.Map()),c=a.get("updater",g.c.Map()),u=a.get("multiFieldAction",g.c.Map()),p=g.c.Map({label:e,map:l,updater:c,linker:s,multiFieldAction:u});if(""===i||-1===o){if(-1!==o)return n.props.dispatch(Br('Mapper with name "'.concat(e,'" already exists')));n.props.dispatch(od(p))}else n.props.dispatch(ld(p,o));n.props.dispatch(Xp("mapperName",e))},n.onSelectMapping=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=n.props.savedMappers,a=t.find(function(t){return t.get("label","")===e},null,g.c.Map()),r=a.get("map",g.c.Map())===g.c.List()?g.c.Map():a.get("map",g.c.Map());n.props.dispatch(Xp("map",r.filter(function(e,t){return n.customFilterMapperFields({value:t})})));var i=a.get("linker",g.c.Map())===g.c.List()?g.c.Map():a.get("linker",g.c.Map());n.props.dispatch(Xp("linker",i));var o=a.get("updater",g.c.Map())===g.c.List()?g.c.Map():a.get("updater",g.c.Map());n.props.dispatch(Xp("updater",o));var l=a.get("multiFieldAction",g.c.Map())===g.c.List()?g.c.Map():a.get("multiFieldAction",g.c.Map());n.props.dispatch(Xp("multiFieldAction",l)),n.props.dispatch(Xp("mapperName",e))},n.getOkButtonLable=function(){var e=n.state.stepIndex;return n.getImporterSteps(e).okLabel||"Next"},n.getOkButtonAction=function(){var e=n.state.stepIndex;return n.getImporterSteps(e).okAction||n.onNextStep},n.getFormattedRows=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=n.props,a=t.item,r=t.predefinedValues,i=t.defaultValues,o=t.importFields,l=t.predefinedValuesOperation,s=t.defaultValuesOperation,c=n.state.mapperPrefix,u=a.get("fileContent",[]),p=a.get("linker",null),d=a.get("updater",null),m=a.get("entity",[]),f=a.get("operation","create"),h=a.get("map",g.c.List()),v=a.get("multiFieldAction",null);return g.c.List().withMutations(function(t){if(Array.isArray(u))for(var n=-1===e?u.length:Math.min(e+1,u.length),a=function(e){var n=g.c.Map().withMutations(function(t){if(t.set("__CSVROW__",e+1),["create"].includes(f)&&s.get(f,g.c.List()).includes(m)&&i.has(m)&&i.get(m,g.c.Map()).forEach(function(e,n){""===t.get(n,"")&&t.set(n,e)}),h.forEach(function(n,a){var r=n;if(n.startsWith(c)){var i=n.substring(c.length);r=u[e][i]}var l=o.find(function(e){return e.value===a});"ranges"===(l?l.type:"string")&&(r=g.c.List().withMutations(function(e){r.split(",").forEach(function(t){var n=t.split("-");e.push(g.c.Map({from:n[0],to:n[1]}))})})),t.set(a,r)}),["create"].includes(f)&&l.get(f,g.c.List()).includes(m)&&r.has(m)&&r.get(m,g.c.Map()).forEach(function(e,n){t.set(n,e)}),null!==p&&""!==p.get("field","")&&""!==p.get("value","")){var n=p.get("value","").substring(c.length);t.set("__LINKER__",g.c.Map({field:p.get("field",""),value:u[e][n]}))}if(null!==d&&""!==d.get("field","")&&""!==d.get("value","")){var a=d.get("value","").substring(c.length);t.set("__UPDATER__",g.c.Map({field:d.get("field",""),value:u[e][a]}))}null===v||v.isEmpty()||t.set("__MULTI_FIELD_ACTION__",v)});t.push(n)},y=1;y<n;y++)a(y)})},n.afterImport=function(e){var t=n.props.item;if(n.onNextStep(),[1,2].includes(e.status)){var a=g.c.fromJS(e.data)||g.c.Map(),r=a.get("imported_entities",a.toList());if(a.has("created",!1))n.setState({status:"finish"});else{var i=r.every(function(e){return!0===e}),o=r.every(function(e){return!0!==e});i||r.size>0&&!o?n.setState({status:"finish"}):n.setState({status:"create"})}n.onChange("result",a),n.onClearItems(t.get("entity",""))}else n.onDelete("result"),n.setState({status:"create"})},n.customFilterMapperFields=function(e){var t=n.props,a=t.item,r=t.hiddenActionFields,i=a.get("entity",""),o=e.plays||g.c.List(),l=a.get("play","");if(!o.isEmpty()&&""!==l&&!o.includes(l))return!1;var s=a.get("operation","create");return!r.getIn([s,i],g.c.List()).includes(e.value)},n.renderStepper=function(){var e=n.state.stepIndex,t=n.getImporterSteps();return r.a.createElement(Mo,{activeIndex:e,steps:t.map(function(e){return e.stepDate})})},n.renderStepContent=function(){var e=n.props,t=e.item,a=e.importFields,i=e.entityOptions,o=e.ignoredHeaders,l=e.defaultValues,s=e.savedMappers,c=e.showPlay,u=e.typeSelectOptions,p=n.state,d=p.stepIndex,m=p.mapperPrefix,f=t.get("entity",""),h=t.get("mapperName","");switch(n.getImporterSteps(d).id){case"importing":return r.a.createElement($p,null);case"upload":return r.a.createElement(Rp,{item:t,entityOptions:i.toJS(),onChange:n.onChange,onDelete:n.onDelete,onSelectMapping:n.onSelectMapping,mapperName:h,mapperOptions:s,typeSelectOptions:u,showPlay:c});case"mapping":return r.a.createElement(Bp,{item:t,customFilterFields:n.customFilterMapperFields,onChange:n.onChange,onDelete:n.onDelete,fields:a,defaultFieldsValues:l.get(f,g.c.Map()),ignoredHeaders:o,mapperPrefix:m});case"validate":return r.a.createElement(zp,{entity:f,fields:a,rows:n.alterData(n.getFormattedRows()),selectedMapper:""===h?null:h,defaultMappedName:""===t.get("fileName","")?void 0:t.get("fileName"),saveMapper:n.onSaveMapping,removeMapper:n.removeMapper});case"finish":return r.a.createElement(Wp,{item:t});default:return r.a.createElement("p",null,"Not valid Step")}},n.renderActionButtons=function(){var e=n.state,t=e.stepIndex,a=e.status,i=n.props.item,o="progress"===a,l="finish"===a,s=2===t&&i.get("error",!1),c=n.getImporterSteps(t);return r.a.createElement(v,{cancelLabel:n.getOkButtonLable(),onClickCancel:n.getOkButtonAction(),disableCancel:o||s||""===i.get("importType",""),saveLabel:"Back",hideCancel:3===t&&null===n.props.onFinish||"importing"===c.id,hideSave:"importing"===c.id,disableSave:0===t||o||l,onClickSave:n.onPrevStep,reversed:!0})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.entityOptions;this.props.dispatch(Zp()),this.initImportEntity(e),this.props.dispatch(kl("import.mapping"))}},{key:"componentWillReceiveProps",value:function(e){var t=e.restartString,n=e.item,a=e.entityOptions;t!==this.props.restartString&&(this.props.dispatch(Zp()),this.setState({status:"create",stepIndex:0})),g.c.is(this.props.entityOptions,a)||this.initImportEntity(a);var r=n.get("entity",""),i=this.props.item.get("entity","");if(""!==r&&i!==r){var o=ee(["systemItems",r,"collection"],""),l="import".concat(Object(D.upperCaseFirst)(o));this.props.dispatch(kl("plugin_actions",{actions:[l]}))}}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Wl("importer"))}},{key:"render",value:function(){return r.a.createElement("div",{className:"Importer"},this.renderStepper(),r.a.createElement("hr",{style:{margin:"20px -15px 0 -15px"}}),r.a.createElement(f.j,{horizontal:!0,className:"mb0"},this.renderStepContent()),r.a.createElement("div",{className:"clearfix"}),r.a.createElement("hr",{className:"mt0"}),this.renderActionButtons())}}]),t}(a.Component);ud.defaultProps={entityOptions:ee(["import","allowed_entities"],g.c.List()),item:g.c.Map(),importFields:[],predefinedValues:g.c.Map(),defaultValues:g.c.Map(),defaultValuesOperation:ee(["import","default_values_allowed_actions"],g.c.Map()),predefinedValuesOperation:ee(["import","predefined_values_allowed_actions"],g.c.Map()),hiddenActionFields:ee(["import","hidden_actions_fields"],g.c.Map()),ignoredHeaders:["import_error_message","import_error_row"],savedMappers:g.c.List(),restartString:"",typeSelectOptions:[],showPlay:!1,onFinish:null,onClearItems:null,usageTypesData:g.c.List(),propertyTypes:g.c.List()};var pd=Object(l.connect)(function(e,t){var n=bo(e,t,"importer"),a=n?n.get("entity",""):"",r=ee(["import","allowed_plays"],g.c.List()),i=oa(e,t);return{item:n,importFields:_p(e,t,"importer"),savedMappers:Cp(e,t,"importer"),typeSelectOptions:Op(e,t,"importer"),showPlay:i&&r.includes(a),usageTypesData:ha(e,t),propertyTypes:va(e,t)}})(ud),dd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={refreshString:""},n.onCloseImport=function(){var e=n.props,t=e.item;if(e.importEntity){n.clearList(t.get("entity",""));var a=["subscription","customer"].includes(t.get("entity",""))?"customer":t.get("entity",""),r=ee(["systemItems",a,"itemsType"],"");n.props.router.push("/".concat(r))}else n.setState({refreshString:S()().format()})},n.clearList=function(e){if(""!==e){if(["subscription","customer"].includes(e))n.props.dispatch(cp("customers")),n.props.dispatch(cp("subscribers"));else{var t=ee(["systemItems",e,"itemsType"],"");n.props.dispatch(cp(t))}var a=ee(["systemItems",e,"collection"],"");n.props.dispatch(sp(a))}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.importEntity;if(e){var t=ee(["systemItems",e,"itemsName"],e);this.props.dispatch(bs(Object(D.titleCase)("Import ".concat(t))))}else this.props.dispatch(bs("Import"));this.props.dispatch(kl(["rates.fields","subscribers.account","subscribers.subscriber"]))}},{key:"componentWillReceiveProps",value:function(e){var t=e.importEntity;if(this.props.importEntity!==t)if(this.setState({refreshString:S()().format()}),t){var n=ee(["systemItems",t,"itemsName"],t);this.props.dispatch(bs(Object(D.titleCase)("Import ".concat(n))))}else this.props.dispatch(bs("Import"))}},{key:"render",value:function(){var e=this.state.refreshString,t=this.props.importEntity,n=t?g.c.List([t]):t,a=ee("apiDateFormat","YYYY-MM-DD"),i=S()().format(a),o=S()().add(100,"years").format(a),l=g.c.Map({from:i,to:o}),s=g.c.Map({from:i,to:o}),c=g.c.Map({from:i,to:o,price_plan:"BASE",pricing_method:"tiered",price_from:0,price_to:ee("productUnlimitedValue","")}),u=g.c.Map({subscription:l,customer:s,product:c}),p=g.c.Map({});return r.a.createElement(f.v,null,r.a.createElement(pd,{entityOptions:n,onFinish:this.onCloseImport,onClearItems:this.clearList,defaultValues:u,predefinedValues:p,restartString:e}))}}]),t}(a.Component);dd.defaultProps={importEntity:void 0,item:g.c.Map()};var md=Object(s.f)(Object(l.connect)(function(e,t){return{importEntity:_o(e,t)||void 0,item:bo(e,t,"importer")}})(dd)),gd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showImport:!1,showCloseImportConfirm:!1,refreshString:""},n.getListFields=function(){var e=n.props,t=e.accountFields,a=e.accountAllwaysShownFields;return t.filter(function(e){return e.get("show_in_list",!1)||a.includes(e.get("field_name",""))}).map(function(e){return{id:e.get("field_name"),placeholder:e.get("title",te(e.get("field_name",""),"account")),sort:!0,type:"aid"===e.get("field_name")?"number":"text"}}).toJS()},n.getListActions=function(){return[{type:"add"},{type:"refresh"},{type:"import",onClick:n.onClickImprt,show:n.getEntityOptions().size>0}]},n.getActions=function(){return[{type:"edit"}]},n.getEntityOptions=function(){return ee(["import","allowed_entities"],g.c.List()).reduce(function(e,t){return["customer","subscription"].includes(t)?e.push(t):e},g.c.List())},n.onCloseImport=function(){n.setState({showImport:!1,showCloseImportConfirm:!1,refreshString:S()().format()})},n.onClickImprt=function(){n.setState({showImport:!0})},n.onClickAskCloseImport=function(){n.setState({showCloseImportConfirm:!0})},n.onClickCancelCloseConfirm=function(){n.setState({showCloseImportConfirm:!1})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.accountFields;(null===e||e.isEmpty())&&this.props.dispatch(kl(["subscribers"]))}},{key:"render",value:function(){var e=this.props,t=e.accountFields,n=e.importItem,a=this.state,i=a.showImport,o=a.refreshString,l=a.showCloseImportConfirm;if(null===t)return r.a.createElement(_,null);var s=this.getListFields(),c=this.getListActions(),u=this.getActions(),p=ee("apiDateFormat","YYYY-MM-DD"),d=S()().format(p),m=S()().add(100,"years").format(p),f=this.getEntityOptions(),h=ee(["systemItems",n.get("entity",""),"itemsName"],""),v=g.c.Map({subscription:g.c.Map({from:d,to:m}),customer:g.c.Map({from:d,to:m})});return r.a.createElement("div",null,r.a.createElement(Tp,{collection:"accounts",itemsType:"customers",itemType:"customer",tableFields:s,filterFields:s,actions:u,listActions:c,refreshString:o}),r.a.createElement(it,{show:i,title:"Import ".concat(Object(D.titleCase)(h)),onHide:this.onClickAskCloseImport,modalSize:"large"},r.a.createElement(pd,{entityOptions:f,onFinish:this.onCloseImport,defaultValues:v})),r.a.createElement(lt,{onOk:this.onCloseImport,onCancel:this.onClickCancelCloseConfirm,show:l,message:"Are you sure you want to close import ?",labelOk:"Yes"}))}}]),t}(a.Component);gd.defaultProps={accountFields:null,accountAllwaysShownFields:g.c.List(["aid","firstname","lastname"]),importItem:g.c.Map()};var fd=Object(s.f)(Object(l.connect)(function(e,t){return{accountFields:ba(e,t),importItem:bo(e,t,"importer")}})(gd)),hd=n(34),vd=n.n(hd),yd=function(e,t,n,a,r){return function(i){i(jr());var o=function(e,t,n,a,r){return{api:"pay",params:[{method:e},{payments:JSON.stringify([{amount:n,aid:t,payer_name:a,dir:"fc",deposit_slip:"",deposit_slip_bank:"",cheque_no:r,source:"web"}])}]}}(e,t,n,a,r);return ei(o).then(function(e){return i(Wr(e,"Payment sent successfully!"))}).catch(function(e){return i(Jr(e,"Error paying"))})}},bd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={validationErrors:Object(g.b)({method:"required",monetaryValue:"required"}),method:"",monetaryValue:"",progress:!1},n.initDefaultValues=function(){var e=n.props.debt;null!==e&&n.onChangeMonetaryValue({target:{value:Math.abs(e)}})},n.onChangeValue=function(e,t){var a=n.state.validationErrors,r={};r[e]=t,0===t.length?r.validationErrors=a.set(e,"required"):r.validationErrors=a.set(e,""),n.setState(r)},n.onChangeMethodValue=function(e){n.onChangeValue("method",e)},n.onChangeMonetaryValue=function(e){var t=e.target.value;n.onChangeValue("monetaryValue",t)},n.onChangeChequeNumValue=function(e){var t=e.target.value;n.onChangeValue("chequeNum",t)},n.getAvailableMethods=function(){return n.props.methods.map(function(e,t){return{value:t,label:e}}).toList().toArray()},n.onPay=function(){var e=n.props,t=e.aid,a=e.payerName,r=n.state,i=r.method,o=r.monetaryValue,l=r.chequeNum;n.setState(function(){return{progress:!0}}),n.props.dispatch(yd(i,t,o,a,l)).then(n.afterPay)},n.afterPay=function(e){n.setState(function(){return{progress:!1}}),e.status&&n.props.onClose()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initDefaultValues()}},{key:"render",value:function(){var e=this.props.currency,t=this.state,n=t.validationErrors,a=t.method,i=t.monetaryValue,o=t.chequeNum,l=t.progress,s=this.getAvailableMethods();return r.a.createElement(it,{show:!0,labelOk:"Pay",title:"Offline Payment",onOk:this.onPay,onCancel:this.props.onClose,progress:l},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{validationState:n.get("method","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Method"),r.a.createElement(f.g,{sm:8},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeMethodValue,value:a,options:s}),n.get("method","").length>0?r.a.createElement(f.n,null,n.get("method","")):"")),r.a.createElement(f.l,{validationState:n.get("monetaryValue","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Monetary Value"),r.a.createElement(f.g,{sm:8},r.a.createElement(f.o,null,r.a.createElement(Tn,{id:"monetaryValue",onChange:this.onChangeMonetaryValue,value:i,fieldType:"number"}),r.a.createElement(f.o.Addon,null,vd()(e))),n.get("monetaryValue","").length>0?r.a.createElement(f.n,null,n.get("monetaryValue","")):"")),"cheque"===a&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Cheque Number"),r.a.createElement(f.g,{sm:8},r.a.createElement(Tn,{id:"chequeNum",onChange:this.onChangechequeNumValue,value:o,fieldType:"number"})))))}}]),t}(a.Component);bd.defaultProps={payerName:"",methods:Object(g.b)({cash:"Cash",cheque:"Cheque",credit:"Credit Card"}),currency:"",debt:null};var Ed=Object(l.connect)(function(e,t){return{currency:pa(e,t)}})(bd),Cd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getCyclesSelectOptions=function(){var e=n.props,t=e.cycles,a=e.statusesToDisplay;return!0===e.timeStatus?t.filter(function(e){return a.contains(e.get("cycle_time_status",""))}).map(function(e){return{value:e.get("billrun_key",""),label:xn(e)}}).toArray():t.filter(function(e){return a.contains(e.get("cycle_status",""))}).map(function(e){return{value:e.get("billrun_key",""),label:xn(e)}}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(eo("cycles_list",Di(this.props.from,this.props.to,this.props.newestFirst,this.props.timeStatus)))}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Xi("cycles_list"))}},{key:"render",value:function(){var e=this.props,t=e.multi,n=e.selectedCycles;return r.a.createElement(Tn,{fieldType:"select",multi:t,value:n,onChange:this.props.onChange,options:this.getCyclesSelectOptions()})}}]),t}(a.Component);Cd.defaultProps={cycles:Object(g.a)(),selectedCycles:"",statusesToDisplay:Object(g.a)(["current","future","running","to_run","finished","confirmed"]),onChange:function(){},multi:!1,from:"",to:"",newestFirst:!0,timeStatus:!1};var _d=Object(l.connect)(function(e){return{cycles:e.list.get("cycles_list")}})(Cd),Od=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showList:!1},n.initFormDate=function(){var e=n.props.mode;if(["closeandnew"].includes(e)){var t=S()().add(1,"day");n.onChangeFrom(t)}},n.showManageRevisions=function(){n.setState({showList:!0})},n.hideManageRevisions=function(){n.setState({showList:!1})},n.onDeleteItem=function(e){var t=n.props,a=t.item,r=t.revisions,i=t.itemName;if(ue(a)===e)if(r.size>1){var o=ee(["systemItems",i,"itemType"],""),l=ee(["systemItems",i,"itemsType"],""),s=r.findIndex(function(e){return ue(e)===ue(a)}),c=-1!==s?r.get(s+1,r.get(s-1,"")):r.get(0,"");n.props.onActionEdit?n.props.onActionEdit(c):n.props.router.push("".concat(l,"/").concat(o,"/").concat(ue(c)))}else n.props.backToList(!0);else n.props.reLoadItem();n.props.clearList()},n.onCloseItem=function(){n.props.clearRevisions(),n.props.clearList(),n.props.reLoadItem()},n.renderVerisionList=function(){var e=n.props,t=e.itemName,a=e.revisions,i=e.item,o=n.state.showList,l=Ye(ee(["systemItems",t,"uniqueField"],"")).get(0,""),s="".concat(i.get(l,"")," - Revision History");return r.a.createElement(it,{title:s,show:o,onCancel:n.hideManageRevisions,onHide:n.hideManageRevisions,labelCancel:"Close"},r.a.createElement(gp,{items:a,itemName:t,onSelectItem:n.hideManageRevisions,onDeleteItem:n.onDeleteItem,onCloseItem:n.onCloseItem,onActionEdit:n.props.onActionEdit,onActionClone:n.props.onActionClone}))},n.onChangeFrom=function(e){var t=n.props,a=t.item,r=t.dangerousFrom;if(e&&(n.props.onChangeFrom(["from"],e.format("YYYY-MM-DD")),e.isBefore(r)&&!e.isSame(ce(a,"originalValue"),"day"))){var i=ce(a,"from");n.confirmSelectedDate(e,i)}},n.filterLegalFromDate=function(e){var t=n.props.minFrom;return e.isSameOrAfter(t,"day")},n.renderRevisionsBlock=function(){var e=n.props,t=e.item,a=e.revisions,i=e.revisionItemsInTimeLine,o=e.mode,l=e.itemName;return["clone","create"].includes(o)?null:r.a.createElement("div",{className:"inline pull-right"},r.a.createElement("div",{className:"inline mr10"},r.a.createElement(at,{revisions:a,item:t,itemName:l,size:i})),r.a.createElement("div",{className:"inline"},r.a.createElement(f.c,{bsStyle:"link",className:"pull-right",style:{padding:"0 10px 15px 10px"},onClick:n.showManageRevisions},"Manage Revisions")))},n.renderDateViewBlock=function(){var e=n.props.item,t=ce(e,"originalValue"),a=ce(e,"to").subtract(1,"seconds"),i=ee("dateFormat","DD/MM/YYYY");return r.a.createElement("div",{className:"inline",style:{width:190,padding:0,margin:"9px 10px 0 10px"}},r.a.createElement("p",{style:{lineHeight:"32px"}},r.a.createElement(St,{value:t,format:i})," - ",r.a.createElement(St,{value:a,format:i})))},n.onChangeToggleFrom=function(e){var t=n.props.item;if(S.a.isMoment(e)&&e.isValid()){var a=S()().add(1,"day"),r=ce(t,"from"),i=e.isSame(r,"day")?a:e;n.onChangeFrom(i)}else{var o=ce(t,"originalValue");n.onChangeFrom(o)}},n.confirmSelectedDate=function(e,t){var a=e.format(ee("dateFormat","DD/MM/YYYY")),r={message:"Billing cycle for the date you have chosen is already over.",children:"Are you sure you want to use ".concat(a,"?"),onOk:function(){n.onChangeFrom(e)},onCancel:function(){n.onChangeFrom(t)}};n.props.dispatch(ks(r))},n.dayDateClass=function(e){var t=S()(e),a=n.props,r=a.item,i=a.minFrom,o=a.dangerousFrom,l=ce(r,"originalValue");if(t.isBetween(i,o)&&!t.isSame(l))return"danger-red"},n.renderDateSelectBlock=function(){var e=n.props,t=e.item,a=e.mode,i=e.minFrom,o=["closeandnew","clone","create"].includes(a),l=ce(t,"from"),s=ce(t,"originalValue"),c="create"===a?[S()()]:[s,S()()],u={fieldType:"date",dateFormat:ee("dateFormat","dd/MM/yyyy"),isClearable:!1,placeholder:"Select Date...",minDate:i,highlightDates:c,dayClassName:n.dayDateClass,style:{display:"grid"}};return["closeandnew"].includes(a)?r.a.createElement("div",{className:"inline",style:{width:220,padding:0,margin:"7px 7px 0"}},r.a.createElement(Tn,{fieldType:"toggeledInput",value:l,onChange:n.onChangeToggleFrom,label:"Change From",editable:o,inputProps:u,disabledDisplayValue:s,disabledValue:s,compare:function(e,t){return e.isSame(t,"day")}})):r.a.createElement("div",{className:"inline",style:{width:220,padding:0,margin:7}},r.a.createElement(f.j,{horizontal:!0,style:{marginBottom:0}},r.a.createElement(f.l,{style:{marginBottom:0}},r.a.createElement("div",{className:"inline",style:{verticalAlign:"top",marginRight:15}},r.a.createElement(f.h,null,"From")),r.a.createElement("div",{className:"inline",style:{padding:0,width:200}},r.a.createElement(Tn,{fieldType:"date",value:l,onChange:n.onChangeFrom,editable:o,dateFormat:ee("dateFormat","DD/MM/YYYY"),isClearable:!1,placeholder:"Select Date...",minDate:i,highlightDates:c,dayClassName:n.dayDateClass})))))},n.renderTitle=function(){var e=n.props.mode,t=["clone","create"].includes(e)?" ":"Revisions History";return r.a.createElement("div",{className:"inline",style:{verticalAlign:"top",marginTop:16,width:110}},r.a.createElement("p",null,r.a.createElement("small",null,t)))},n.renderMessage=function(){var e=n.props,t=e.mode,a=e.item;return"view"!==t||"active"!==a.getIn(["revision_info","status"],"")||a.getIn(["revision_info","is_last"],!0)?null:r.a.createElement(f.p,{bsStyle:"warning"},"You cannot edit the current revision because a future revision exists.")},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(kl(["minimum_entity_start_date","system"])),this.initFormDate()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=this.props.item;ue(t)!==ue(n)&&(this.hideManageRevisions(),this.initFormDate())}},{key:"render",value:function(){var e=this.props,t=e.mode,n=e.item.getIn(["revision_info","early_expiration"],!1);return r.a.createElement("div",{className:"entity-revision-edit"},r.a.createElement("div",null,this.renderTitle(),"view"===t||n?this.renderDateViewBlock():this.renderDateSelectBlock(),this.renderRevisionsBlock(),this.renderVerisionList()),this.renderMessage())}}]),t}(a.Component);Od.defaultProps={revisionItemsInTimeLine:3,revisions:g.c.List(),item:g.c.Map(),mode:"view",minFrom:S()(0),dangerousFrom:S()(0),onChangeFrom:function(){},backToList:function(){},reLoadItem:function(){},clearRevisions:function(){},clearList:function(){}};var Sd=Object(s.f)(Object(l.connect)(function(e,t){return{minFrom:ko(e,t),dangerousFrom:ua(e,t),timezone:e.settings.getIn(["billrun","timezone"])}})(Od)),Td={height:29,marginTop:8},kd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).initDefaultValues=function(){var e=n.props,t=e.field,a=e.entity,r=e.fieldPath;if([null,void 0].includes(a.getIn(r,null))){var i=n.getNoDefaultValueVal(),o=t.get("default_value",i);null!==o&&n.props.onChange(r,o)}},n.getNoDefaultValueVal=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=n.props,a=t.field,r=t.isFieldBoolean,i=t.isFieldTags,o=t.isFieldSelect,l=t.isFieldRanges,s=t.isFieldDateRange,c=t.isFieldJson;return!r&&(c?void 0:l||s?g.c.List():e?i||o&&a.get("multiple",!1)?[]:"":null)},n.pasteSplit=function(e){return e.split(new RegExp([",",";","\\(","\\)","\\*","/",":","\\?","\n","\r","\t"].join("|"))).map(function(e){return e.trim()})},n.getFieldOptios=function(e){var t=e.get("select_options","");return("string"===typeof t?t.split(",").filter(function(e){return""!==e}):t).map(fe)},n.onChange=function(e){var t=n.props.fieldPath,a=e.target.value;n.props.onChange(t,a)},n.onChangeSelect=function(e){var t=n.props,a=t.field,r=t.fieldPath;a.get("multiple",!1)?n.props.onChange(r,e.split(",")):n.props.onChange(r,e)},n.onChangeDate=function(e){var t=n.props.fieldPath,a=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"),r=S.a.isMoment(e)&&e.isValid()?e.format(a):"";n.props.onChange(t,r)},n.onChangeRange=function(e){n.onChangeValue(e)},n.onChangeTags=function(e){n.onChangeValue(e)},n.onChangeValue=function(e){var t=n.props.fieldPath;n.props.onChange(t,e)},n.getFieldValue=function(){var e=n.props,t=e.entity,a=e.fieldPath,r=e.isFieldTags,i=e.isFieldBoolean,o=e.isFieldRanges,l=e.isFieldDate,s=e.isFieldDateTime,c=e.isFieldDateRange,u=e.isFieldJson;if(l||s){var p=t.getIn(a,"");return[void 0,null,""].includes(p)?void 0:S()(p)}if(c){var d=t.getIn(a,void 0);return[void 0,null,""].includes(d)?void 0:d}if(u){var m=t.getIn(a,void 0);return g.c.Map.isMap(m)||g.c.List.isList(m)||m instanceof Object||Array.isArray(m)?m:void 0}if(o)return t.getIn(a,void 0);if(i){var f=t.getIn(a,"");return""===f?f:[!0,1,"true"].includes(f)}var h=t.getIn(a,[]);return r?g.c.List.isList(h)?h.toArray():h:Array.isArray(h)||g.c.List.isList(h)?h.join(","):h},n.onClickRemoveInput=function(){var e=n.props.fieldPath;n.props.onRemove(e)},n.renderRemovableField=function(e){var t=n.props.field;return r.a.createElement(f.o,null,e,r.a.createElement(f.o.Button,null,r.a.createElement(f.c,{onClick:n.onClickRemoveInput},r.a.createElement("i",{className:"fa fa-fw fa-trash-o danger-red",title:"Remove ".concat(t.get("title",t.get("field_name",""))," field")}))))},n.renderField=function(){var e=n.props,t=e.editable,a=e.field,i=e.disabled,o=e.isFieldTags,l=e.isFieldSelect,s=e.isFieldBoolean,c=e.isFieldRanges,u=e.isFieldDate,p=e.isFieldDateTime,d=e.isFieldDateRange,m=e.isFieldJson,g=n.getFieldValue();if(c){var f=a.get("multiple",!1);return r.a.createElement(Tn,{fieldType:"ranges",onChange:n.onChangeRange,value:g,multi:f,editable:t,label:a.get("title",a.get("field_name","")),disabled:i})}if(s)return r.a.createElement(Tn,{fieldType:"checkbox",onChange:n.onChange,value:g,editable:t,style:Td,disabled:i});if(d){var h=a.get("multiple",!1);return r.a.createElement(Tn,{fieldType:"ranges",onChange:n.onChangeRange,value:g,multi:h,editable:t,label:a.get("title",a.get("field_name","")),disabled:i,inputProps:{fieldType:"date",isClearable:!0},inputFromProps:{selectsStart:!0,endDate:"@valueTo@"},inputToProps:{selectsEnd:!0,startDate:"@valueFrom@",endDate:"@valueTo@",minDate:"@valueFrom@"}})}if(u||p){var v=a.get("mandatory",!1);return r.a.createElement(Tn,{fieldType:u?"date":"datetime",value:g,onChange:n.onChangeDate,editable:t,isClearable:!v,dateFormat:a.get("date_format",void 0),timeFormat:a.get("time_format",void 0)})}if(l){var y=a.get("multiple",!1),b=n.getFieldOptios(a);return r.a.createElement(Tn,{fieldType:"select",multi:y,value:g,onChange:n.onChangeSelect,options:b,disabled:i,editable:t})}if(o)return r.a.createElement(Tn,{fieldType:"tags",value:g,onChange:n.onChangeTags,addOnPaste:!0,pasteSplit:n.pasteSplit,disabled:i,editable:t,inputProps:{fieldType:a.get("type",void 0)}});if(m)return r.a.createElement(Tn,{fieldType:"json",value:g,onChange:n.onChangeValue,disabled:i});var E=""===a.get("type","")?"text":a.get("type","");return r.a.createElement(Tn,{fieldType:E,onChange:n.onChange,value:g,editable:t,disabled:i,preffix:a.get("preffix"),suffix:a.get("suffix")})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initDefaultValues()}},{key:"render",value:function(){var e=this.props,t=e.field,n=e.editable,a=e.error,i=e.onlyInput,o=e.isRemoveField,l=this.renderField();if(i)return l;var s=t.get("field_name",""),c=t.get("help",""),u=t.get("description","");return r.a.createElement(f.l,{controlId:s,validationState:a?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},t.get("title",s),t.get("mandatory",!1)&&r.a.createElement("span",{className:"danger-red"}," *"),""!==u&&r.a.createElement(Ao,{contents:u})),r.a.createElement(f.g,{sm:8,lg:9},o&&n&&!t.get("mandatory",!1)?this.renderRemovableField(l):l,a&&r.a.createElement(f.n,null,r.a.createElement("small",null,a)),""!==c&&r.a.createElement(f.n,null,r.a.createElement("small",null,c))))}}]),t}(a.Component);kd.defaultProps={entity:g.c.Map(),field:g.c.Map(),editable:!0,disabled:!1,onlyInput:!1,isFieldTags:!1,isFieldSelect:!1,isFieldBoolean:!1,isFieldRanges:!1,isFieldDate:!1,isFieldDateTime:!1,isFieldDateRange:!1,isFieldJson:!1,fieldPath:[],error:"",onChange:function(){},onRemove:function(){}};var jd=kd,Id=["password"],wd=Object(l.connect)(function(e,t){return{isFieldTags:t.field&&t.field.get("multiple",!1)&&!t.field.get("select_list",!1)&&!Id.includes(t.field.get("type","")),isFieldSelect:t.field&&t.field.get("select_list",!1),isFieldBoolean:t.field&&"boolean"===t.field.get("type",""),isFieldRanges:t.field&&"ranges"===t.field.get("type",""),isFieldDate:t.field&&"date"===t.field.get("type",""),isFieldDateTime:t.field&&"datetime"===t.field.get("type",""),isFieldDateRange:t.field&&"daterange"===t.field.get("type",""),isFieldJson:t.field&&"json"===t.field.get("type",""),isRemoveField:t.field&&(["params"].includes(t.field.get("field_name","").split(".")[0])||t.field.get("nullable",!1))&&Qe(t.field,!0,"delete"),fieldPath:t.field?t.field.get("field_name","").split("."):[]}},function(e,t){return{}})(jd),Nd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getParamsOptions=function(){var e=n.props,t=e.fields,a=e.fieldsFilter,r=e.highlightParams,i=null!==a?a:n.filterPrintableFields;return t.filter(i).filter(function(e){return!n.filterParamsFields(e)}).map(function(e){return{label:Object(D.titleCase)(e.get("title","")),value:e.get("field_name","")}}).sortBy(function(e){return e.label}).sortBy(function(e){return null!==r&&r.includes("params.".concat(e.value))?0:1})},n.onAddParam=function(e){var t=Array.isArray(e)?e:e.split(".");n.props.onChangeField(t,void 0)},n.filterPrintableFields=function(e){return!1!==e.get("display",!1)&&"tariff_category"!==e.get("field_name","")&&"play"!==e.get("field_name","")},n.filterParamsFields=function(e){var t=n.props.entity,a=e.get("field_name","").split(".");return!(("params"===a[0]||e.get("nullable",!1))&&!t.hasIn(a))||e.get("mandatory",!1)},n.filterPlayFields=function(e){var t=n.props,a=t.entity;if(!t.isPlaysEnabled)return!0;var r=a.get("play",""),i=g.c.List("function"===typeof r.split?r.split(","):r),o=e.get("plays","all");return"all"===o||i.some(function(e){return o.indexOf(e)>-1})},n.renderField=function(e,t){var a=n.props,i=a.entity,o=a.editable,l=a.onChangeField,s=a.onRemoveField,c=a.errors,u=o&&e.get("editable",!1);return r.a.createElement(wd,{key:"key_".concat(e.get("field_name",t)),field:e,entity:i,editable:u,onChange:l,onRemove:s,error:c.get(e.get("field_name",""),!1)})},n.renderFields=function(){var e=n.props,t=e.fields,a=e.fieldsFilter,r=null!==a?a:n.filterPrintableFields;return t.filter(n.filterPlayFields).filter(r).filter(n.filterParamsFields).map(n.renderField)},n.renderAddParamButton=function(e){var t=n.props.highlightParams,a=null===t,i=e.map(function(e){var i=a||t.includes("params.".concat(e.value)),o=k()({"disable-label":!i});return r.a.createElement(f.q,{key:e.value,eventKey:e.value,onSelect:function(){n.onAddParam(e.value)}},r.a.createElement("span",{className:o},e.label))});return r.a.createElement(f.i,{id:"add-param-input",componentClass:f.o.Button,className:"btn-primary btn btn-xs btn-default",title:"Add parameter"},i)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.entityName,a=t.fields,r=t.entity;a.isEmpty()&&this.props.dispatch(kl(n));var i=[];a.forEach(function(t){var n=t.get("field_name","").split(".");if(n.pop(),n.length){var a=[];n.forEach(function(t){a.push(t);var n=a.join("."),o=!i.includes(n),l=r.hasIn(a),s=g.c.is(r.getIn(a,g.c.List()),g.c.List());o&&l&&s&&(i.push(n),e.props.onChangeField(a,g.c.Map()))})}})}},{key:"componentDidUpdate",value:function(e,t){var n=this,a=this.props,r=a.fields,i=a.entity,o=e.entity;(r.find(function(e){return"play"===e.get("field_name","")},null,g.c.Map()).get("multiple",!1)?!g.c.is(i.get("play",g.c.List()),o.get("play",g.c.List())):i.get("play","")!==o.get("play",""))&&r.forEach(function(e){n.filterPlayFields(e)||n.props.onRemoveField(e.get("field_name","").split("."))})}},{key:"render",value:function(){var e=this.props.editable,t=this.renderFields(),n=this.getParamsOptions();return t.isEmpty()&&n.isEmpty()?null:r.a.createElement("div",{className:"EntityFields"},t,!n.isEmpty()&&e&&this.renderAddParamButton(n))}}]),t}(a.Component);Nd.defaultProps={entity:g.c.Map(),fields:g.c.List(),errors:g.c.Map(),highlightParams:null,fieldsFilter:null,editable:!0,isPlaysEnabled:!1,onChangeField:function(){},onRemoveField:function(){console.error("Please implement onRemoveField function for EntityFields")}};var Fd=Object(l.connect)(function(e,t){return{fields:t.fields||ya(e,t),isPlaysEnabled:oa(e,t)}})(Nd),xd=function(e){return function(t){t(jr());var n=function(e){return{api:"credit",params:e}}(e);return ei(n).then(function(e){return t(Wr(e,"Success crediting"))}).catch(function(e){return t(Jr(e,"Error crediting"))})}},Rd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={validationErrors:Object(g.b)({aprice:"required",usagev:"",rate:"required",subscriber:"required"}),helperMsg:Object(g.b)({aprice:""}),paramKeyError:"",rateBy:"fix",aprice:"",usagev:1,rate:"",progress:!1,subscriber:""},n.onChangeValue=function(e,t){var a=n.state.validationErrors,r={};r[e]=t,0===t.length?r.validationErrors=a.set(e,"required"):r.validationErrors=a.set(e,""),n.setState(r)},n.updateChargingMessage=function(e,t){var a=n.props.currency,r=n.state,i=r.helperMsg;if("fix"===r.rateBy){var o=""!==e?e*t:t,l="".concat(Math.abs(o)).concat(vd()(a)),s=o>=0?"Subscriber will be charged by ".concat(l):"".concat(l," will be refunded to the subscriber");n.setState({helperMsg:i.set("aprice",s)})}},n.onChangeCreditUsagevValue=function(e){var t=e.target.value,a=n.state.aprice;n.onChangeValue("usagev",t),n.updateChargingMessage(t,a)},n.onChangeCreditApriceValue=function(e){var t=e.target.value,a=n.state.usagev;n.onChangeValue("aprice",t),n.updateChargingMessage(a,t)},n.onChangeRateValue=function(e){n.onChangeValue("rate",e)},n.onChangeSubscriberValue=function(e){n.onChangeValue("subscriber",e)},n.onChangeCreditBy=function(e){var t,a=e.target.value,r=n.state,i=r.validationErrors,o=r.helperMsg;t="fix"===a?{rateBy:a,usagev:1,validationErrors:i.set("aprice","required").set("usagev",""),helperMsg:o.set("aprice","")}:{rateBy:a,aprice:"",usagev:"",validationErrors:i.set("aprice","").set("usagev","required"),helperMsg:o.set("aprice","The refund amount will be calculated based on the volume")},n.setState(t)},n.onCreditCharge=function(){var e=n.props,t=e.aid,a=e.propertyTypes,r=e.usageTypesData,i=n.state,o=i.rateBy,l=i.aprice,s=i.usagev,c=i.rate,u=i.validationErrors,p=i.subscriber;if(!u.valueSeq().includes("required")){var d=[{aid:t},{sid:"account_level"===p?0:p},{rate:c},{credit_time:S()().toISOString()}];if("fix"===o)d=[].concat(Object(N.a)(d),[{aprice:l},{usagev:s}]);else{var m=n.getSelectedRate(c),g=Oe(m),f=Se(m,g);d=[].concat(Object(N.a)(d),[{usagev:Ie(a,r,g,f,s)}])}n.setState({progress:!0}),n.props.dispatch(xd(d)).then(n.afterCharge)}},n.afterCharge=function(e){n.setState({progress:!1}),e.status&&n.props.onClose()},n.getAvailableRates=function(){return n.props.allRates.map(function(e){return{value:e.get("key"),label:e.get("key")}}).toArray()},n.getSubscribersBySid=function(){var e=n.props.subscribers.map(function(e){return{value:e.get("sid"),label:e.get("sid").toString()}}).toArray();return[{value:"account_level",label:"account level"}].concat(Object(N.a)(e))},n.getSelectedRate=function(e){return _e(n.props.allRates,e)},n.getRateUnitLabel=function(e){var t=n.props,a=t.propertyTypes,r=t.usageTypesData,i=n.getSelectedRate(e),o=Oe(i),l=Se(i,o),s=je(a,r,o,l);return""!==s?"(".concat(s,")"):""},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.aid;this.props.dispatch(eo("all_retail_rates",Si())),this.props.dispatch(kl("usage_types")),this.props.dispatch(eo("subscribers_for_aid",function(e){return{action:"get",entity:"subscribers",params:[{query:JSON.stringify({aid:e,type:"subscriber"})}]}}(e)))}},{key:"render",value:function(){var e=this.state,t=e.rateBy,n=e.aprice,a=e.usagev,i=e.rate,o=e.validationErrors,l=e.helperMsg,s=e.progress,c=e.subscriber,u=this.getAvailableRates(),p=this.getSubscribersBySid();return r.a.createElement(it,{show:!0,progress:s,labelProgress:"Processing...",labelOk:"Apply",title:"Manual charge / refund",onOk:this.onCreditCharge,onCancel:this.props.onClose},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Rate By"),r.a.createElement(f.g,{sm:10},r.a.createElement(f.g,{sm:3},r.a.createElement(Tn,{fieldType:"radio",name:"rate-by",id:"rate-by-fix",value:"fix",checked:"fix"===t,onChange:this.onChangeCreditBy,label:"Fixed price"})),r.a.createElement(f.g,{sm:3},r.a.createElement(Tn,{fieldType:"radio",name:"rate-by",id:"rate-by-usagev",value:"usagev",checked:"usagev"===t,onChange:this.onChangeCreditBy,label:"Volume"})))),r.a.createElement(f.l,{validationState:o.get("subscriber","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Subscriber"),r.a.createElement(f.g,{sm:10},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeSubscriberValue,value:c,options:p}),o.get("subscriber","").length>0?r.a.createElement(f.n,null,o.get("subscriber","")):"")),r.a.createElement(f.l,{validationState:o.get("aprice","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Charge"),r.a.createElement(f.g,{sm:10},r.a.createElement(Tn,{onChange:this.onChangeCreditApriceValue,value:n,fieldType:"price",disabled:"fix"!==t}),r.a.createElement(f.n,null,o.get("aprice","").length>0?o.get("aprice",""):l.get("aprice","")))),r.a.createElement(f.l,{validationState:o.get("usagev","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"usagev"===t?"Volume ".concat(this.getRateUnitLabel(i)):"Quantity"),r.a.createElement(f.g,{sm:10},r.a.createElement(Tn,{onChange:this.onChangeCreditUsagevValue,value:a,fieldType:"number"}),o.get("usagev","").length>0?r.a.createElement(f.n,null,o.get("usagev","")):"")),r.a.createElement(f.l,{validationState:o.get("rate","").length>0?"error":null},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Product"),r.a.createElement(f.g,{sm:10},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeRateValue,value:i,options:u}),o.get("rate","").length>0?r.a.createElement(f.n,null,o.get("rate","")):""))))}}]),t}(a.Component);Rd.defaultProps={allRates:Object(g.a)(),currency:"",usageTypesData:Object(g.a)(),propertyTypes:Object(g.a)(),subscribers:Object(g.a)()};var Md=Object(l.connect)(function(e,t){return{usageTypes:ga(e,t),currency:pa(e,t),usageTypesData:ha(e,t),propertyTypes:va(e,t),allRates:e.list.get("all_retail_rates"),subscribers:e.list.get("subscribers_for_aid")}})(Rd),Pd=function(e){return function(e,t,n){return function(a){var r=yi(t,n);return a(Zl(e,r))}}("customer","accounts",e)},Ad=function(e){return function(t){t(jr());var n=yi("subscribers",e);return ei(n).then(function(e){var n=e.data[0].data.details[0];return n.originalValue=n.from,t(Yl("subscription",n)),t(Wr(e))}).catch(function(e){return t(Jr(e,"Error retrieving subscriber"))})}},Dd=function(e,t){return $l("accounts",e,t)},Ld=function(){return Kl("subscription","subscription")},Ud=function(e,t){return function(n){return n($l("subscribers",e,t)).then(function(n){return Object.assign(n,{subscription:e,action:t})})}},Vd=function(e,t){return zl("customer",e,t)},Bd=function(e){return Hl("customer",e)},qd=function(e,t){return function(n){n(jr());var a=[],r=!0,i=!1,o=void 0;try{for(var l,s=t.split(",")[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var c=l.value;a.push(Ai(e,c))}}catch(u){i=!0,o=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return ei(a).then(function(e){return n(Wr(e,"Customer rebalance request sent"))}).catch(function(e){return n(Jr(e,"Error rebalancing customer"))})}},zd=function(e){return function(t){t(jr());var n=function(e){return{api:"bill",params:[{aid:e}]}}(e);return ei(n).then(function(e){return t(Wr(e))}).catch(function(e){return t(Jr(e))})}},Hd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showRebalanceConfirmation:!1,showOfflinePayement:!1,debt:null,selectedCyclesNames:"",expectedCyclesNames:"",showCreditCharge:!1},n.initDebt=function(){var e=n.props.customer.get("aid",null);n.props.dispatch(zd(e)).then(function(e){e.status&&e.data&&e.data.balance&&n.setState({debt:e.data.balance.total})})},n.onRemovePaymentGateway=function(){n.props.onChange(["payment_gateway","active"],g.c.Map())},n.renderPaymentGatewayLabel=function(){var e=n.props,t=e.customer,a=e.supportedGateways,i=t.getIn(["payment_gateway","active","name"],""),o=a.filter(function(e){return i===e.get("name")});return!o.isEmpty()&&o.get(0).get("image_url","").length>0?r.a.createElement("img",{src:"".concat(ee(["env","serverApiUrl"],""),"/").concat(o.get(0).get("image_url","")),height:"30",alt:o.get(0).get("name","")}):i},n.getPaymentGatewaysActions=function(){var e=n.props,t=e.customer,a=e.payment_gateways,r=!t.getIn(["payment_gateway","active"],g.c.Map()).isEmpty();return[{type:"add",label:"Add ",onClick:n.props.onChangePaymentGateway,show:!r,actionStyle:"primary",actionSize:"xsmall",enable:!a.isEmpty()},{type:"edit",label:"Change",onClick:n.props.onChangePaymentGateway,actionStyle:"primary",actionSize:"xsmall",show:r},{type:"remove",label:"Remove",onClick:n.onClickRemovePaymentGateway,actionStyle:"danger",actionSize:"xsmall",show:r&&!1}]},n.onClickRemovePaymentGateway=function(e){var t=e.getIn(["payment_gateway","active","name"],"payment gateway"),a={message:"Are you sure you want to remove ".concat(t),onOk:n.onRemovePaymentGateway,type:"delete",labelOk:"Remove"};n.props.dispatch(ks(a))},n.renderChangePaymentGateway=function(){var e=n.props.customer,t=!e.getIn(["payment_gateway","active"],g.c.Map()).isEmpty()?n.renderPaymentGatewayLabel():"None";return r.a.createElement(f.l,{controlId:"payment_gateway"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Payment Gateway"),r.a.createElement(f.g,{sm:8,lg:9},t,r.a.createElement("div",{className:"inline ml10"},r.a.createElement(vt,{actions:n.getPaymentGatewaysActions(),data:e}))))},n.renderDebt=function(){var e=n.props.currency,t=n.state.debt,a=k()("non-editable-field",{"danger-red":t>0});return null!==t&&r.a.createElement(f.l,{controlId:"total_debt"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Total Debt"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("div",{className:a},t,vd()(e))))},n.renderInCollection=function(){var e=n.props.customer,t=ee("dateFormat","DD/MM/YYYY");if(!0===e.get("in_collection",!1)||1===e.get("in_collection",0)){var a=S()(e.get("in_collection_from","")).format(t);return r.a.createElement("p",{className:"danger-red"},"In collection from ",a)}return null},n.onClickRebalance=function(){n.setState({showRebalanceConfirmation:!0})},n.onRebalanceConfirmationClose=function(){n.setState({showRebalanceConfirmation:!1,selectedCyclesNames:""})},n.onRebalanceConfirmationOk=function(){var e=n.props.customer,t=n.state.selectedCyclesNames;n.props.dispatch(qd(e.get("aid"),t)),n.onRebalanceConfirmationClose()},n.onClickOfflinePayment=function(){n.setState({showOfflinePayement:!0})},n.onCloseOfflinePayment=function(){n.setState({showOfflinePayement:!1}),n.initDebt()},n.onChangeSelectedCycle=function(e){n.setState({selectedCyclesNames:e})},n.onChangeExpectedCycle=function(e){n.setState({expectedCyclesNames:e})},n.onClickExpectedInvoice=function(){var e=n.props.customer,t=n.state.expectedCyclesNames,a=Hi(e.get("aid"),t);window.open(Zr(a))},n.renderRebalanceButton=function(){var e=n.props.customer,t=n.state,a=t.showRebalanceConfirmation,i=t.selectedCyclesNames,o="Are you sure you want to rebalance account ".concat(e.get("aid"),"?");return r.a.createElement("div",null,r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onClickRebalance},"Rebalance"),r.a.createElement(lt,{onOk:n.onRebalanceConfirmationOk,onCancel:n.onRebalanceConfirmationClose,show:a,message:o,labelOk:"Yes"},r.a.createElement(f.l,null,r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:12,lg:12},"Rebalance operation will send all customer billing lines for recalculation price and bundles options. It can take few hours to finish the recalculations. Meanwhile lines pricing properties will be empty.",r.a.createElement("br",null),"This operation is useful when an update is required with reference data (plans, products, services, etc) that raised non-desired pricing results. After fixing the reference data, the operation will recalculate the billing lines.",r.a.createElement("br",null),r.a.createElement("br",null))),r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h,className:"non-editable-field"},"Select cycle/s"),r.a.createElement(f.g,{sm:9,lg:8},r.a.createElement(_d,{onChange:n.onChangeSelectedCycle,statusesToDisplay:g.c.List(["current","to_run"]),selectedCycles:i,multi:!0}))))))},n.renderOfflinePaymentsButton=function(){var e=n.props.customer,t=n.state,a=t.showOfflinePayement,i=t.debt,o="".concat(e.get("firstname","")," ").concat(e.get("lastname",""));return r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:8,lg:9,smOffset:3,lgOffset:2},r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",style:{marginTop:12},onClick:n.onClickOfflinePayment},"Offline Payment"),a&&r.a.createElement(Ed,{aid:e.get("aid"),payerName:o,debt:i,onClose:n.onCloseOfflinePayment})))},n.renderExpectedInvoiceButton=function(){var e=n.state.expectedCyclesNames,t=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");return r.a.createElement("span",{className:"inline"},", Or generate expected invoices for :",r.a.createElement("span",{className:"inline",style:{verticalAlign:"middle",minWidth:290,marginLeft:5,marginRight:5}},r.a.createElement(_d,{className:"inline",onChange:n.onChangeExpectedCycle,statusesToDisplay:g.c.List(["current","to_run","future"]),selectedCycles:e,multi:!1,from:S()().subtract(6,"month").format(t),to:S()().add(6,"month").format(t),newestFirst:!1})),r.a.createElement(f.c,{bsSize:"small",className:"btn-primary inline",disabled:!e,onClick:n.onClickExpectedInvoice},"Generate expected invoice"))},n.renderCreditCharge=function(){var e=n.props.customer,t=n.state.showCreditCharge,a=e.get("aid",null);return r.a.createElement("div",null,r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onShowCreditCharge},"Manual charge / refund"),t&&r.a.createElement(Md,{aid:a,onClose:n.onCloseCreditCharge}))},n.onShowCreditCharge=function(){n.setState({showCreditCharge:!0})},n.onCloseCreditCharge=function(){n.setState({showCreditCharge:!1})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){"create"!==this.props.action&&this.initDebt(),this.props.dispatch(kl("payment_gateways"))}},{key:"render",value:function(){var e=this.props,t=e.customer,n=e.action;return"create"!==n&&"undefined"===typeof t.getIn(["_id","$id"])?r.a.createElement("div",null," ",r.a.createElement("p",null,"Loading...")," "):r.a.createElement("div",{className:"Customer"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(Fd,{entityName:["subscribers","account"],entity:t,onChangeField:this.props.onChange,onRemoveField:this.props.onRemoveField}),"create"!==n&&this.renderChangePaymentGateway(),"create"!==n&&this.renderOfflinePaymentsButton(),"create"!==n&&this.renderDebt()),"create"!==n&&r.a.createElement("div",null,r.a.createElement("hr",null),this.renderInCollection(),r.a.createElement("div",null,"See Customer ",r.a.createElement(s.b,{to:'/usage?base={"aid": '.concat(t.get("aid"),"}")},"Usage")),r.a.createElement("div",null,"See Customer ",r.a.createElement(s.b,{to:'/invoices?base={"aid": '.concat(t.get("aid"),"}")},"Invoices")," ",this.renderExpectedInvoiceButton()),this.renderRebalanceButton(),r.a.createElement("hr",null),this.renderCreditCharge()))}}]),t}(a.Component);Hd.defaultProps={action:"create",currency:"",customer:g.c.Map(),supportedGateways:g.c.List(),payment_gateways:void 0};var Yd=Object(l.connect)(function(e,t){return{currency:pa(e,t),payment_gateways:Ya(e,t)}})(Hd),Gd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).planActivationParser=function(e){var t=ce(e,"plan_activation",!1);return t?t.format(ee("dateFormat","DD/MM/YYYY")):""},n.servicesParser=function(e){return(e.get("services",g.c.List())||g.c.List()).map(function(e){return null!==e.get("quantity",null)?"".concat(e.get("name","")," (").concat(e.get("quantity",""),")"):e.get("name","")}).join(", ")},n.addressParser=function(e){return e.get("country","").length>0?"".concat(e.get("address","")," ,").concat(e.get("country","")):e.get("address","")},n.onClickNew=function(e){var t=n.props.aid;n.props.onNew(t,e)},n.filterPlayField=function(e){var t=n.props.isPlaysEnabled;return"play"!==e.get("field_name","")||t},n.getFields=function(){var e=n.props,t=e.settings,a=e.defaultListFields;return t.filter(n.filterPlayField).filter(function(e){return e.get("show_in_list",!1)||a.includes(e.get("field_name",""))}).map(function(e){var t=e.get("field_name");switch(t){case"plan_activation":return{id:t,parser:n.planActivationParser,cssClass:"long-date text-center"};case"services":return{id:t,parser:n.servicesParser};case"address":return{id:t,parser:n.addressParser};case"sid":return{id:t,title:"ID",type:"number",sort:!0};case"play":return{id:t,sort:!0};default:var a=t;return"firstname"===t?a="first name":"lastname"===t&&(a="last name"),{id:t,title:L.a.sentenceCase(a)}}}).toArray()},n.getActions=function(){return[{type:"edit",helpText:"Edit",onClick:n.props.onClickEdit,onClickColumn:"sid"}]},n.getListActions=function(){return[{type:"add",onClick:n.onClickNew},{type:"refresh"}]},n.onActionEdit=function(e){n.props.onClickEdit(e)},n.onActionClone=function(e){n.props.onClickEdit(e,"subscription","clone")},n.filterFields=function(){return[{id:"sid",placeholder:"ID",type:"number"},{id:"firstname",placeholder:"First Name"},{id:"lastname",placeholder:"Last Name"}]},n.getSubsctiptionListProject=function(){var e=n.props,t=e.settings,a=e.defaultListFields;return g.c.Map().withMutations(function(e){e.set("from",1),e.set("to",1),e.set("revision_info",1),e.set("aid",1),a.forEach(function(t){e.set(t,1)}),t.filter(function(e){return e.get("show_in_list",!1)}).forEach(function(t){e.set(t.get("field_name",""),1)})}).toJS()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.aid,t=this.getFields(),n=this.getActions(),a=this.getListActions(),i=this.getSubsctiptionListProject(),o={aid:e,type:"subscriber"};return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(Tp,{itemsType:"subscribers",itemType:"subscription",filterFields:this.filterFields(),tableFields:t,projectFields:i,showRevisionBy:!0,actions:n,listActions:a,baseFilter:o,allowManageRevisions:!1})))}}]),t}(a.Component);Gd.defaultProps={settings:g.c.List(),defaultListFields:[],isPlaysEnabled:!1,aid:""};var Kd=Object(l.connect)(function(e,t){return{isPlaysEnabled:oa(e,t)}})(Gd),Wd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangePeriodStartDate=function(e,t){t&&n.props.onChangeService(e,"from",t.format("YYYY-MM-DD"))},n.onClickRemoveCloneService=function(e){-1!==e&&n.props.onRemoveService(e)},n.onClickAddPeriodService=function(e){n.props.onAddService(e)},n.onChangeServiceQuantity=function(e,t){var a=n.props,r=a.subscriptionFrom,i=a.originSubscriptionServices,o=a.subscriptionServices,l=t.target.value,s=l>1?Number(l):1,c=o.get(e,null);if(c){var u=i.find(function(e){return e.get("name","")===c.get("name","")}),p=u&&u.get("quantity","")===s?u.get("from",""):r.format("YYYY-MM-DD");n.props.onChangeService(e,"quantity",s),n.props.onChangeService(e,"from",p)}},n.filterServiceStartDate=function(e,t){var a=n.props.subscriptionFrom;return e&&t.isSame(S()(e),"days")||t.isSameOrAfter(a)},n.renderServiceBadge=function(e,t){var a=n.props.originSubscriptionServices;if(!e.hasIn(["ui_flags","serviceId"]))return r.a.createElement(f.b,null,"new");var i=a.find(function(t){return t.getIn(["ui_flags","serviceId"],"")===e.getIn(["ui_flags","serviceId"],"")});return"byPeriod"!==t||S()(i.get("from","")).isSame(S()(e.get("from","")),"days")?"quantity"===t&&i.get("quantity","")!==e.get("quantity","")?r.a.createElement(f.b,null,"updated"):"":r.a.createElement(f.b,null,"updated")},n.renderServicesQuentity=function(e){var t=n.props,a=t.servicesOptions;return t.subscriptionServices.map(function(e,t){return e.set("index",t)}).filter(function(e){return null!==e.get("quantity",null)}).map(function(t,i){var o=a.find(function(e){return e.get("name","")===t.get("name","")},null,g.c.Map()).get("description",t.get("name","")),l=t.get("index",""),s=n.renderServiceBadge(t,"quantity"),c=e?{}:{display:"inline-block"};return r.a.createElement("tr",{key:"quentity_".concat(i)},r.a.createElement("td",{style:{verticalAlign:"middle",width:"30%",textAlign:"right",paddingRight:20,paddingBottom:5}},o),r.a.createElement("td",{style:{width:"70%",paddingBottom:5}},r.a.createElement(f.o,{style:{width:"100%"}},e?r.a.createElement(f.o.Addon,null,"Quantity ",s):"Quantity: ",r.a.createElement(Tn,{fieldType:"number",min:1,value:t.get("quantity",""),onChange:function(e){n.onChangeServiceQuantity(l,e)},editable:e,style:c}))))}).toArray()},n.renderServicesByPeriod=function(e){var t=n.props,a=t.servicesOptions;return t.subscriptionServices.map(function(e,t){return e.set("index",t)}).filter(function(e){return e.getIn(["ui_flags","balance_period"],!1)}).reduce(function(e,t){return e.has(t.get("name",""))?e.update(t.get("name",""),function(e){return e.push(t)}):e.set(t.get("name",""),g.c.List([t]))},g.c.Map()).map(function(t,i){var o=t.last(),l=a.find(function(e){return e.get("name","")===o.get("name","")},null,g.c.Map()).get("description",o.get("name","")),s=e?{verticalAlign:"middle",paddingBottom:47,width:"30%",textAlign:"right",paddingRight:20}:{verticalAlign:"middle",textAlign:"right",paddingRight:20};return r.a.createElement("tr",{key:"byPeriod_".concat(i)},r.a.createElement("td",{style:s},l),r.a.createElement("td",{style:{width:"70%"}},t.map(function(t,a){return n.renderPeriods(t,a,e)}),e&&r.a.createElement(ct,{buttonStyle:{marginTop:5,marginBottom:10},onClick:function(e){n.onClickAddPeriodService(o.get("name",""),e)},label:"Add start date"})))}).toList().toArray()},n.renderPeriods=function(e,t,a){var i=n.props,o=i.subscriptionFrom,l=i.originSubscriptionServices;if(!a)return r.a.createElement("div",{key:"byPeriod_".concat(t,"_").concat(e.get("name","no-name"))},t+1,". Start Date:\xa0",r.a.createElement(Tn,{style:{display:"inline-block"},fieldType:"date",value:S()(e.get("from","")),editable:a}));var s=e.get("index",""),c=l.find(function(t){return t.get("name","")===e.get("name","")}),u=e.hasIn(["ui_flags","serviceId"])&&c?c.get("from",null):null,p=n.renderServiceBadge(e,"byPeriod");return r.a.createElement(f.o,{key:"byPeriod_".concat(t,"_").concat(e.get("name","no-name")),style:{width:"100%",marginTop:5}},r.a.createElement(f.o.Addon,null,t+1,". Start Date ",p),r.a.createElement(Tn,{style:{width:"100%"},fieldType:"date",filterDate:function(e){return n.filterServiceStartDate(u,e)},value:S()(e.get("from","")),onChange:function(e){n.onChangePeriodStartDate(s,e)},editable:a,highlightDates:[o]}),r.a.createElement(f.o.Addon,{onClick:function(e){n.onClickRemoveCloneService(s,e)}},r.a.createElement("i",{className:"fa fa-trash-o text-danger"})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.editable,t=this.renderServicesQuentity(e),n=this.renderServicesByPeriod(e);return t.length+n.length>0?r.a.createElement(f.v,{header:"Services Details"},r.a.createElement("table",{style:{width:"100%"}},r.a.createElement("tbody",null,t)),t.length>0&&n.length>0&&r.a.createElement("hr",null),r.a.createElement("table",{style:{width:"100%"}},r.a.createElement("tbody",null,n))):r.a.createElement("hr",null)}}]),t}(a.Component);Wd.defaultProps={editable:!0,originSubscriptionServices:g.c.List(),subscriptionServices:g.c.List(),subscriptionFrom:null,servicesOptions:g.c.List()};var Jd=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showAdvancedEdit:!1},n.onChangeValue=function(e){var t=e.target.value,a=n.props,r=a.name,i=a.service.set("value",t);n.props.onChange(r,i)},n.onChangeSequential=function(e){var t=e.target.value,a=n.props,r=a.name,i=a.service.set("sequential",t);n.props.onChange(r,i)},n.onChangeAmount=function(e){var t=n.props,a=t.service,r=t.name;if(null!==e&&""!==e){var i=x()(e)?parseFloat(e):e;i=Number.isInteger(i)?i:"";var o=g.c.Map({name:"quantity",value:i}),l=g.c.Map({name:"recurring_by_quantity",params:g.c.List([o])}),s=a.get("operations",g.c.List()),c=s.findIndex(function(e){return"recurring_by_quantity"===e.get("name")});if(-1!==c){var u=s.getIn([c,"params"],g.c.List()).findIndex(function(e){return"quantity"===e.get("name","")});if(-1!==u){var p=a.updateIn(["operations",c,"params",u],g.c.Map(),function(e){return e.set("value",i)});n.props.onChange(r,p)}else{var d=a.updateIn(["operations",c,"params"],g.c.List(),function(e){return e.push(o)});n.props.onChange(r,d)}}else{var m=a.updateIn(["operations"],g.c.List(),function(e){return e.push(l)});n.props.onChange(r,m)}}else n.props.onChange(r,n.removeQuantity(a))},n.onCloseModal=function(){n.setState({showAdvancedEdit:!1})},n.onOpenModal=function(){n.setState({showAdvancedEdit:!0})},n.removeQuantity=function(e){var t=["operations"],n=e.getIn(t,g.c.List()).findIndex(function(e){return"recurring_by_quantity"===e.get("name","")}),a=[].concat(t,[n,"params"]),r=-1===n?-1:e.getIn(a).findIndex(function(e){return"quantity"===e.get("name","")}),i=[].concat(Object(N.a)(a),[r]),o=-1!==r?e.deleteIn(i):e,l=o.getIn(a,g.c.Map()).isEmpty(),s=-1!==n&&l?o.deleteIn(a):o,c=s.getIn(a,g.c.Map()).size,u=-1!==n&&c<2?s.deleteIn([].concat(t,[n])):s;return u.getIn(t,g.c.Map()).isEmpty()?u.deleteIn(t):u},n.getDiscountDisplayValue=function(){var e=n.props,t=e.service,a=e.isPercentage,r=e.currency,i=t.get("value","");return a&&x()(i)&&(i="".concat(i*=100,"%")),!a&&x()(i)&&(i="".concat(i).concat(vd()(r))),i},n.getDiscountAmount=function(){return n.props.service.get("operations",g.c.List()).find(function(e){return"recurring_by_quantity"===e.get("name")},null,g.c.Map()).get("params",g.c.List()).find(function(e){return"quantity"===e.get("name","")},null,g.c.Map()).get("value","")},n.getActions=function(){var e=n.props,t=e.mode,a=e.isQuantitative,r=e.service.get("value","");return[{type:"settings",onClick:n.onOpenModal,show:"view"!==t&&a,actionSize:"small",enable:![null,""].includes(r),helpText:"Advanced Options"}]},n.renderAdvancedEdit=function(){var e=n.state.showAdvancedEdit,t=n.props,a=t.label,i=t.mode,o=t.isQuantitative;if(!e)return null;var l="Edit ".concat(a," service value options"),s="view"!==i;return r.a.createElement(it,{show:!0,onOk:n.onCloseModal,title:l},r.a.createElement(f.j,{horizontal:!0},o&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:11,smOffset:1},r.a.createElement(Tn,{fieldType:"toggeledInput",value:n.getDiscountAmount(),disabledDisplayValue:"",disabledValue:"",onChange:n.onChangeAmount,label:"Apply discount value ".concat(n.getDiscountDisplayValue()," for every"),editable:s,suffix:"units",style:{width:300},inputProps:{fieldType:"number",style:{width:85},min:1}})))))},n.renderQuantitativeDescription=function(){var e=n.getDiscountAmount(),t=n.getDiscountDisplayValue();return["",null].includes(e)&&t?r.a.createElement(f.n,null,"Amount will be multiplied by the subscriber's service quantity"):["",null].includes(t)?null:r.a.createElement(f.n,null,"Apply discount value ",t," for every ",e," units")},n.renderSuffix=function(){var e=n.props,t=e.isPercentage,a=e.currency;return t?void 0:vd()(a)},n.renderSequentialLabel=function(){return r.a.createElement("span",null,te("sequential","discount"),r.a.createElement(Ao,{contents:Bo.sequential}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.label,a=e.mode,i=e.service,o=e.isQuantitative,l=e.isPercentage;if(""===t)return null;var s="view"!==a,c=this.getDiscountDisplayValue();if(!s&&null===c)return null;var u=this.getActions(),p=u.reduce(function(e,t){return!1!==t.show||e},!1),d=l&&!o;return r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},n),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(f.o,{className:"full-width"},r.a.createElement(Tn,{value:i.get("value",""),onChange:this.onChangeValue,fieldType:l?"percentage":"number",editable:s,suffix:this.renderSuffix()}),p&&r.a.createElement(f.o.Addon,{className:"input-group-space pr0 pl5"}," "),p&&r.a.createElement(f.o.Addon,{className:"not-left-border"},r.a.createElement(vt,{actions:u,data:i})),d&&r.a.createElement(f.o.Addon,{className:"input-group-space pr0 pl5"}," "),d&&r.a.createElement(f.o.Addon,null,r.a.createElement(Tn,{value:i.get("sequential",""),onChange:this.onChangeSequential,fieldType:"checkbox",label:this.renderSequentialLabel()}))),o&&this.renderQuantitativeDescription(),this.renderAdvancedEdit()))}}]),t}(a.Component);Jd.defaultProps={name:"",label:"",service:g.c.Map(),isQuantitative:!1,isPercentage:!1,currency:""};var $d=Jd,Qd=n(106),Zd=function(e){var t=e.conditions,n=e.path,i=e.editable,o=e.fields,l=e.operators,s=e.valueOptions,c=e.errors,u=e.onChangeField,p=e.onChangeOp,d=e.onChangeValue,m=e.onAdd,f=e.onRemove,h=Object(a.useCallback)(function(e,t){u(n,e,t)},[u,n]),v=Object(a.useCallback)(function(e,t){p(n,e,t)},[p,n]),y=Object(a.useCallback)(function(e,t){d(n,e,t)},[d,n]),b=Object(a.useCallback)(function(e){m(n,e)},[m,n]),E=Object(a.useCallback)(function(e){f(n,e)},[f,n]),C=c.reduce(function(e,t,a){var r=a.split("."),i=r.pop();return n.join(".")===r.join(".")?e.set(i,t):e},g.c.Map());return r.a.createElement(Pl,{conditions:t,editable:i,fields:o,operators:l,customValueOptions:s,errors:C,onChangeField:h,onChangeOperator:v,onChangeValue:y,onAdd:b,onRemove:E})};Zd.defaultProps={conditions:g.c.List(),editable:!0,fields:g.c.List(),operators:g.c.List(),valueOptions:g.c.List(),errors:g.c.Map()};var Xd=Object(a.memo)(Zd),em=function(e,t,n){return ee(["discount","conditions","fields",n],g.c.List())},tm=function(e,t,n){return n},nm=function(e){return e?e.map(function(e){return g.c.Map({id:e.get("field_name",""),title:e.get("title",""),type:e.get("type","string"),inputConfig:e.get("select_list",!1)?g.c.Map({inputType:"select",options:Ye(e.get("select_options","").split(",").filter(function(e){return""!==e})).filter(function(e){return""!==e})}):null})}):g.c.List()},am=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=nm(e),i=g.c.Map({});return g.c.List().withMutations(function(e){r.forEach(function(t){e.push(t)}),t.forEach(function(t){var n=e.findIndex(function(e){return e.get("id","")===t.get("id","")});-1===n?e.push(i.merge(t)):e.update(n,g.c.Map(),function(e){return e.merge(t)})}),e.forEach(function(t,a){if(!t.has("title")){var r=te(t.get("id",""),ne(n),Object(D.sentenceCase)(t.get("id","")));e.setIn([a,"title"],r)}})}).filter(function(e){return"play"!==e.get("id")||"play"===e.get("id")&&a}).filter(function(e){return e.get("show",!0)}).sort(Ge)},rm=Object(Nn.a)(Oa,em,tm,oa,am),im=Object(Nn.a)(ba,em,tm,oa,am),om=Object(Nn.a)(function(){return g.c.List()},em,tm,function(){return!0},am),lm={marginTop:0},sm=g.c.Map(),cm=g.c.Map({fields:g.c.List([sm])}),um=g.c.Map({field:"",op:"",value:""}),pm=function(e){var t=e.discount,n=e.editable,i=e.errors,o=e.conditionsOperators,l=e.valueOptions,s=e.onChangeConditionField,c=e.onChangeConditionOp,u=e.onChangeConditionValue,p=e.addCondition,d=e.removeCondition,m=e.conditionsPath,h=e.accountConditionsPath,v=e.subscriberConditionsPath,y=e.servicesConditionsPath,b=e.servicesAnyConditionsPath,E=e.subscriberConditionFields,C=e.accountConditionFields,_=e.subscriberServicesConditionFields,O=e.dispatch,S=Object(a.useCallback)(function(e,n){var a=Object(Qd.a)(e),r=a[0],o=a[1],l=a[2],s=(a.slice(3),t.getIn(e,g.c.List()).size);if(s>0){var c=t.getIn(e,g.c.List()).last(g.c.Map());if(c.isEmpty()||c.some(function(e){return"".includes(e)})||c.has("fields")&&(c.get("fields",g.c.List()).isEmpty()||c.get("fields",g.c.List()).last(g.c.Map()).isEmpty()||c.get("fields",g.c.List()).last(g.c.Map()).some(function(e){return"".includes(e)})))return O(Is([].concat(Object(N.a)(e),[s-1]).join("."),"Conditions can not be empty")),!1}p(e,n);var u=[r,o,l].join(".");i.has(u)&&O(Is(u))},[p,t,i,O]),T=Object(a.useCallback)(function(e){S(m,e)},[S,m]),k=Object(a.useCallback)(function(e){S([].concat(Object(N.a)(m),[e],Object(N.a)(h)),um)},[S,m,h]),j=Object(a.useCallback)(function(e){S([].concat(Object(N.a)(m),[e],Object(N.a)(v)),um)},[S,m,v]),I=Object(a.useCallback)(function(e){var t=[].concat(Object(N.a)(m),[e],Object(N.a)(y));S(t,cm)},[S,m,y]),w=Object(a.useCallback)(function(e,t,n){s(e,t,n),O(Is([].concat(Object(N.a)(e),[t]).join(".")))},[s,O]),F=Object(a.useCallback)(function(e,t,n){c(e,t,n),O(Is([].concat(Object(N.a)(e),[t]).join(".")))},[c,O]),x=Object(a.useCallback)(function(e,t,n){u(e,t,n),O(Is([].concat(Object(N.a)(e),[t]).join(".")))},[u,O]),R=Object(a.useCallback)(function(e,t,n){w(e,t,n);var a=Object(N.a)(e).splice(0,e.length-b.length);O(Is(a.join(".")))},[w,b,O]),M=Object(a.useCallback)(function(e,t,n){F(e,t,n);var a=Object(N.a)(e).splice(0,e.length-b.length);O(Is(a.join(".")))},[F,b,O]),P=Object(a.useCallback)(function(e,t,n){x(e,t,n);var a=Object(N.a)(e).splice(0,e.length-b.length);O(Is(a.join(".")))},[x,b,O]),A=Object(a.useCallback)(function(e,t){d(e,t);var n=[].concat(Object(N.a)(e),[t]).join(".");i.filter(function(e,t){return t.startsWith(n)}).forEach(function(e,t){O(Is(t))})},[d,i,O]),D=Object(a.useCallback)(function(e){var n=e.idx,a=e.anyIdx,r=[].concat(Object(N.a)(m),[n],Object(N.a)(y)),i=function(){A(r,a),O(Is())};if(t.getIn(r,g.c.List()).every(function(e){return e.getIn(b,g.c.List()).isEmpty()}))i();else{var o={message:"Are you sure you want to remove service conditions set ".concat(a+1," from condition set ").concat(n+1," ?"),onOk:i,labelOk:"Delete",type:"delete"};O(ks(o))}},[t,A,m,y,b,O]),L=Object(a.useCallback)(function(e,n){if(1===t.getIn(e,g.c.List()).size){var a=Object(N.a)(e);a.pop();var r=a.pop();A(a,r)}else A(e,n)},[A,t]),U=Object(a.useCallback)(function(e){var n=[].concat(Object(N.a)(m),[e]),a=t.getIn([].concat(Object(N.a)(n),Object(N.a)(h)),g.c.List()).isEmpty(),r=t.getIn([].concat(Object(N.a)(n),Object(N.a)(v)),g.c.List()).isEmpty(),i=t.getIn([].concat(Object(N.a)(n),Object(N.a)(y)),g.c.List()).isEmpty();if(a&&r&&i)A(m,e);else{var o={message:"Are you sure you want to remove conditions set ".concat(e+1," ?"),onOk:function(){return A(m,e)},labelOk:"Delete",type:"delete"};O(ks(o))}},[t,A,m,h,v,y,O]),V=Object(a.useMemo)(function(){return[{type:"add",label:"Customer",showIcon:!1,onClick:k},{type:"add",label:"Subscriber",showIcon:!1,onClick:j},{type:"add",label:"Service",showIcon:!1,onClick:I}]},[k,j,I]),B=Object(a.useMemo)(function(){return[{type:"add",label:"Add Customer condition(s)",actionSize:"xsmall",actionStyle:"primary",onClick:k},{type:"add",label:"Add Subscriber condition(s)",actionSize:"xsmall",actionStyle:"primary",onClick:j},{type:"add",label:"Add Service condition(s) set",actionSize:"xsmall",actionStyle:"primary",onClick:I}]},[k,j,I]),q=function(e){return"Remove conditions set ".concat(e+1)},z=Object(a.useMemo)(function(){return[{type:"remove",helpText:q,showIcon:!0,actionStyle:"danger",actionSize:"xsmall",onClick:U}]},[U]),H=function(e){var t=e.idx,n=e.anyIdx;return"Remove Service set ".concat(n+1," from condition set ").concat(t+1)},Y=Object(a.useMemo)(function(){return[{type:"remove",helpText:H,showIcon:!0,actionStyle:"danger",actionSize:"xsmall",onClick:D}]},[D]),G=Object(a.useMemo)(function(){return[{type:"add",label:"Add Service condition(s) set",showIcon:!0,actionStyle:"primary",actionSize:"xsmall",onClick:I}]},[I]),K=Object(a.useMemo)(function(){return!t.getIn(m,g.c.List()).every(function(e){return!e.getIn(h,g.c.List()).isEmpty()&&!e.getIn(v,g.c.List()).isEmpty()&&!e.getIn(y,g.c.List()).isEmpty()})},[t,m,h,v,y]),W=Object(a.useCallback)(function(e){return r.a.createElement("div",null,"Condition Set ".concat(e+1),r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:V,data:e,type:"dropdown",doropDownLabel:"Add condition(s)"}),r.a.createElement("div",{className:"inline ml5"},r.a.createElement(vt,{actions:z,data:e}))))},[V,z]),J=Object(a.useCallback)(function(e){return r.a.createElement("div",null,"Services",r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:G,data:e})))},[G]),$=Object(a.useCallback)(function(e){var t=e.idx,n=e.anyIdx;return r.a.createElement("div",null,"Service ".concat(n+1),r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:Y,data:{idx:t,anyIdx:n}})))},[Y]),Q=Object(a.useMemo)(function(){return r.a.createElement(ct,{onClick:T,data:sm,label:"Add conditions set",buttonStyle:lm})},[T]),Z=Object(a.useMemo)(function(){return K?"At least one set of conditions must be fulfilled":"No conditions"},[K]),X=Object(a.useMemo)(function(){return r.a.createElement("div",null,r.a.createElement("h4",{className:"inline mt0 mb0"},"Conditions",r.a.createElement("small",null," | ",Z)),r.a.createElement("div",{className:"pull-right"},Q))},[Q,Z]);return r.a.createElement(f.v,{header:X},t.getIn(m,g.c.List()).map(function(e,t){return r.a.createElement(f.v,{header:W(t),key:t,bsStyle:i.has([].concat(Object(N.a)(m),[t]).join("."))?"danger":void 0},e.getIn(h,g.c.List()).isEmpty()&&e.getIn(v,g.c.List()).isEmpty()&&e.getIn(y,g.c.List()).isEmpty()&&r.a.createElement("div",{className:"text-center"},r.a.createElement(vt,{actions:B,data:t}),""!==i.get([].concat(Object(N.a)(m),[t]).join("."),"")&&r.a.createElement(f.n,{className:"danger-red"},r.a.createElement("small",null,i.get([].concat(Object(N.a)(m),[t]).join("."),"")))),!e.getIn(h,g.c.List()).isEmpty()&&r.a.createElement(f.v,{header:"Customer"},r.a.createElement(Xd,{path:[].concat(Object(N.a)(m),[t],Object(N.a)(h)),conditions:e.getIn(h,g.c.List()),editable:n,fields:C,operators:o,valueOptions:l,onChangeField:w,onChangeOp:F,onChangeValue:x,onAdd:S,onRemove:A,errors:i})),!e.getIn(v,g.c.List()).isEmpty()&&r.a.createElement(f.v,{header:"Subscriber"},r.a.createElement(Xd,{path:[].concat(Object(N.a)(m),[t],Object(N.a)(v)),conditions:e.getIn(v,g.c.List()),editable:n,fields:E,operators:o,valueOptions:l,onChangeField:w,onChangeOp:F,onChangeValue:x,onAdd:S,onRemove:A,errors:i})),!e.getIn(y,g.c.List()).isEmpty()&&r.a.createElement(f.v,{header:J(t)},e.getIn(y,g.c.List()).map(function(e,a){return r.a.createElement(f.v,{header:$({idx:t,anyIdx:a}),key:"service_condition_".concat(t,"_any_").concat(a),bsStyle:i.has([].concat(Object(N.a)(m),[t],Object(N.a)(y),[a]).join("."))?"danger":void 0},!e.getIn(b,g.c.List()).isEmpty()&&r.a.createElement(Xd,{path:[].concat(Object(N.a)(m),[t],Object(N.a)(y),[a],Object(N.a)(b)),conditions:e.getIn(b,g.c.List()),editable:n,fields:_,operators:o,onChangeField:R,onChangeOp:M,onChangeValue:P,onAdd:S,onRemove:L,errors:i}))})))}),!t.getIn(m,g.c.List()).isEmpty()&&Q)};pm.defaultProps={discount:g.c.Map(),errors:g.c.Map(),editable:!0,conditionsPath:["params","conditions"],accountConditionsPath:["account","fields"],subscriberConditionsPath:["subscriber",0,"fields"],servicesConditionsPath:["subscriber",0,"service","any"],servicesAnyConditionsPath:["fields"],conditionsOperators:ee(["discount","conditions","operators"],g.c.List()),valueOptions:ee(["discount","conditions","valueOptions"],g.c.List()),subscriberConditionFields:g.c.List(),accountConditionFields:g.c.List(),subscriberServicesConditionFields:g.c.List()};var dm=Object(l.connect)(function(e,t){return{subscriberConditionFields:rm(e,t,"subscriber"),accountConditionFields:im(e,t,"account"),subscriberServicesConditionFields:om(e,t,"subscriber_services")}})(Object(a.memo)(pm)),mm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeSequential=function(e){var t=n.props,a=t.name,r=t.plan,i=e.target.value;n.props.onChange(a,r.set("sequential",i))},n.onChangeValue=function(e){var t=n.props,a=t.name,r=t.plan,i=e.target.value;n.props.onChange(a,r.set("value",i))},n.getValue=function(){return n.props.plan.get("value","")},n.getSuffix=function(){var e=n.props,t=e.isPercentage,a=e.currency;return t?void 0:vd()(a)},n.renderSequentialLabel=function(){return r.a.createElement("span",null,te("sequential","discount"),r.a.createElement(Ao,{contents:Bo.sequential}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.label,a=e.mode,i=e.plan,o=e.isPercentage;if(""===t)return null;var l="view"!==a,s=this.getValue();if(!l&&null===s)return null;var c=o;return r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},n),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(f.o,{className:"full-width"},r.a.createElement(Tn,{value:s,onChange:this.onChangeValue,fieldType:o?"percentage":"number",editable:l,suffix:this.getSuffix()}),c&&r.a.createElement(f.o.Addon,{className:"input-group-space pr0 pl5"}," "),c&&r.a.createElement(f.o.Addon,null,r.a.createElement(Tn,{value:i.get("sequential",!1),onChange:this.onChangeSequential,fieldType:"checkbox",label:this.renderSequentialLabel()})))))}}]),t}(a.Component);mm.defaultProps={name:"",label:"",plan:g.c.Map(),isPercentage:!1,currency:""};var gm=mm,fm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={errors:{name:""}},n.onChangeFiled=function(e,t){switch(e.join(".")){case"limit":case"params.cycles":""!==t?n.props.onFieldUpdate(e,t):n.props.onFieldRemove(e);break;case"key":var a=t.toUpperCase();if(""!==t){var r=n.props.errorMessages.name.allowedCharacters,i=n.state.errors,o=ee("keyUppercaseRegex",/./).test(a)?"":r;n.setState({errors:Object.assign({},i,{name:o})})}n.props.onFieldUpdate(e,a);break;default:n.props.onFieldUpdate(e,t)}},n.onChangeCycles=function(e){n.props.dispatch(Is("params.cycles"));var t=x()(e)?parseFloat(e):e;n.onChangeFiled(["params","cycles"],t)},n.onChangeLimit=function(e){var t=x()(e)?parseFloat(e):e;n.onChangeFiled(["limit"],t)},n.onChangeDiscountType=function(e){var t=e.target.value;n.onChangeFiled(["type"],t)},n.onChangeAdditionalField=function(e,t){n.onChangeFiled(e,t)},n.onRemoveAdditionalField=function(e){n.props.onFieldRemove(e)},n.onChangeExcludes=function(e){var t=g.c.List(e.length?e.split(","):[]);t.isEmpty()?n.props.onFieldRemove(["excludes"]):n.onChangeFiled(["excludes"],t)},n.onChangeService=function(e){var t=n.props.discount,a=g.c.List(e.length?e.split(","):[]),r=g.c.Map({value:""});if(a.isEmpty())n.props.onFieldRemove(["subject","service"]),n.props.onFieldRemove(["subject","matched_services"]);else{var i=t.getIn(["subject","service"],g.c.Map()),o=g.c.Map().withMutations(function(e){a.forEach(function(t){"matched_services"!==t&&e.set(t,i.get(t,r))})});o.isEmpty()?n.props.onFieldRemove(["subject","service"]):n.onChangeFiled(["subject","service"],o),a.includes("matched_services")?n.onChangeFiled(["subject","matched_services"],t.getIn(["subject","matched_services"],r)):n.props.onFieldRemove(["subject","matched_services"])}},n.onChangePlan=function(e){var t=n.props.discount,a=g.c.List(e.length?e.split(","):[]),r=g.c.Map({value:""});if(a.isEmpty())n.props.onFieldRemove(["subject","plan"]),n.props.onFieldRemove(["subject","matched_plans"]),n.props.onFieldRemove(["subject","monthly_fees"]);else{var i=n.getSelectedPlans(),o=g.c.Map().withMutations(function(e){a.forEach(function(t){["matched_plans","monthly_fees"].includes(t)||e.set(t,i.get(t,r))})});o.isEmpty()?n.props.onFieldRemove(["subject","plan"]):n.onChangeFiled(["subject","plan"],o),a.includes("matched_plans")?n.onChangeFiled(["subject","matched_plans"],t.getIn(["subject","matched_plans"],r)):n.props.onFieldRemove(["subject","matched_plans"]),a.includes("monthly_fees")?n.onChangeFiled(["subject","monthly_fees"],t.getIn(["subject","monthly_fees"],r)):n.props.onFieldRemove(["subject","monthly_fees"])}},n.onChangePlanDiscount=function(e,t){var a=["matched_plans","monthly_fees"].includes(e)?["subject",e]:["subject","plan",e];n.onChangeFiled(a,t)},n.onChangeServiceDiscountValue=function(e,t){[e].includes("matched_services")?n.onChangeFiled(["subject",e],t):n.onChangeFiled(["subject","service",e],t)},n.onChangeConditionField=function(e,t,a){n.onChangeFiled([].concat(Object(N.a)(e),[t,"field"]),a)},n.onChangeConditionOp=function(e,t,a){n.onChangeFiled([].concat(Object(N.a)(e),[t,"op"]),a)},n.onChangeConditionValue=function(e,t,a){n.onChangeFiled([].concat(Object(N.a)(e),[t,"value"]),a)},n.onAddCondition=function(e,t){var a=n.props.discount.getIn(e,g.c.List());n.onChangeFiled(e,a.push(t))},n.onRemoveCondition=function(e,t){var a=n.props.discount.getIn(e,g.c.List());n.onChangeFiled(e,a.delete(t))},n.createPlansOptions=function(){return n.props.availableEntities.get("plan",g.c.List()).push(g.c.Map({name:"matched_plans",description:te("matched_plans","discount")})).push(g.c.Map({name:"monthly_fees",description:te("monthly_fees","discount")})).map(n.createOption).toArray()},n.createExcludeDiscountOptions=function(){var e=n.props,t=e.discount;return e.availableEntities.get("discount",g.c.List()).filter(function(e){return e.get("key","")!==t.get("key","")}).map(n.createOption).toArray()},n.createServicesOptions=function(){return n.props.availableEntities.get("service",g.c.List()).push(g.c.Map({name:"matched_services",description:te("matched_services","discount")})).map(n.createOption).toArray()},n.createOption=function(e){return{value:e.get("name",e.get("key","")),label:e.get("description","")}},n.getLabel=function(e,t){return["matched_services","matched_plans","monthly_fees"].includes(t)?te(t,"discount"):e.find(function(e){return e.get("name")===t},null,g.c.Map()).get("description",t)},n.getSelectedServices=function(){var e=n.props.discount,t=g.c.Map({value:""}),a=e.getIn(["subject","service"],g.c.Map());return e.hasIn(["subject","matched_services"])&&(a=a.set("matched_services",e.getIn(["subject","matched_services"],t))),a},n.getSelectedPlans=function(){var e=n.props.discount,t=g.c.Map({value:""}),a=e.getIn(["subject","plan"],g.c.Map());return e.hasIn(["subject","matched_plans"])&&(a=a.set("matched_plans",e.getIn(["subject","matched_plans"],t))),e.hasIn(["subject","monthly_fees"])&&(a=a.set("monthly_fees",e.getIn(["subject","monthly_fees"],t))),a},n.isServiceQuantitative=function(e){return-1!==n.props.availableEntities.get("service",g.c.List()).findIndex(function(t){return t.get("name","")===e&&!0===t.get("quantitative",!1)})},n.isPercentage=function(){return"percentage"===n.props.discount.get("type","")},n.renderServivesDiscountValues=function(){var e=n.props,t=e.availableEntities,a=e.mode,i=e.currency,o=n.getSelectedServices();if(o.isEmpty())return null;var l=n.isPercentage();return o.map(function(e,o){var s=n.getLabel(t.get("service",g.c.List()),o),c=n.isServiceQuantitative(o);return r.a.createElement($d,{key:"".concat(Object(D.paramCase)(o),"-discount-value"),mode:a,service:e,name:o,label:s,isQuantitative:c,isPercentage:l,currency:i,onChange:n.onChangeServiceDiscountValue})}).toList().toArray()},n.renderPlanDiscountValue=function(){var e=n.props,t=e.availableEntities,a=e.mode,i=e.currency,o=n.getSelectedPlans();if(o.isEmpty())return null;var l="view"!==a,s=n.isPercentage();return o.filter(function(e){return l||!l&&g.c.Map.isMap(e)&&""!==e.get("value","")}).map(function(e,o){return r.a.createElement(gm,{key:"".concat(Object(D.paramCase)(o),"-discount-value"),name:o,label:n.getLabel(t.get("plan",g.c.List()),o),plan:e,isPercentage:s,mode:a,currency:i,onChange:n.onChangePlanDiscount})}).toList().toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(kl(["subscribers.subscriber","subscribers.account"])),this.props.dispatch(no(["discount","plan","service"]))}},{key:"componentWillUnmount",value:function(){this.props.dispatch(ao(["discount","plan","service"]))}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.discount,a=t.mode,i=t.currency,o=t.fields,l=t.hideFields,s=t.errors,c="view"!==a,u=this.createPlansOptions(),p=this.createServicesOptions(),d=n.get("excludes",g.c.List()).join(","),m=this.createExcludeDiscountOptions(),h=this.getSelectedServices().keySeq().toList().join(","),v=this.getSelectedPlans().keySeq().toList().join(","),y=te("type_percentage","discount");return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,null,r.a.createElement(wd,{field:o.get("description"),entity:n,onChange:this.onChangeFiled,editable:c,error:s.get("description",e.description)}),["clone","create"].includes(a)&&!l.includes("key")&&r.a.createElement(wd,{field:o.get("key"),entity:n,onChange:this.onChangeFiled,editable:c,disabled:!["clone","create"].includes(a),error:s.get("key",e.name)}),!l.includes("type")&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("type","discount")),r.a.createElement(f.g,{sm:8,lg:9},c?r.a.createElement("span",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeDiscountType,name:"type",value:"monetary",label:te("type_monetary","discount"),checked:"monetary"===n.get("type","")})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeDiscountType,name:"type",value:"percentage",label:y,checked:"percentage"===n.get("type","")}))):r.a.createElement("div",{className:"non-editable-field"},Object(D.titleCase)(n.get("type",""))))),!l.includes("params.cycles")&&r.a.createElement(f.l,{validationState:s.has("params.cycles")?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("cycles","discount")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.getIn(["params","cycles"],""),onChange:this.onChangeCycles,fieldType:"unlimited",unlimitedValue:"",unlimitedLabel:"Infinite",editable:c}),s.has("params.cycles")&&r.a.createElement(f.n,null,r.a.createElement("small",null,s.get("params.cycles",""))))),!l.includes("proration")&&r.a.createElement(wd,{field:o.get("proration"),entity:n,onChange:this.onChangeFiled,editable:c,error:s.get("proration",e.proration)}),!l.includes("priority")&&r.a.createElement(wd,{field:o.get("priority"),entity:n,onChange:this.onChangeFiled,editable:c,error:s.get("priority",e.priority)}),!l.includes("limit")&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("discount_overall_limit","discount")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{suffix:vd()(i),value:n.get("limit",""),onChange:this.onChangeLimit,fieldType:"unlimited",unlimitedValue:"",editable:c}))),!l.includes("params.min_subscribers")&&r.a.createElement(wd,{field:o.get("paramsMinSubscribers"),entity:n,onChange:this.onChangeFiled,editable:c,error:s.get("params.min_subscribers",e.paramsMinSubscribers)}),!l.includes("params.max_subscribers")&&r.a.createElement(wd,{field:o.get("paramsMaxSubscribers"),entity:n,onChange:this.onChangeFiled,editable:c,error:s.get("params.max_subscribers",e.paramsMaxSubscribers)}),!l.includes("excludes")&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Excludes"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:d,options:m,onChange:this.onChangeExcludes,editable:c}))),r.a.createElement(Fd,{entityName:"discounts",entity:n,onChangeField:this.onChangeAdditionalField,onRemoveField:this.onRemoveAdditionalField,editable:c,errors:s})),r.a.createElement(dm,{discount:n,editable:c,onChangeConditionField:this.onChangeConditionField,onChangeConditionOp:this.onChangeConditionOp,onChangeConditionValue:this.onChangeConditionValue,addCondition:this.onAddCondition,removeCondition:this.onRemoveCondition,errors:s}),!l.includes("subject.plan")&&r.a.createElement(f.v,{header:r.a.createElement("h3",null,te("panel_plan_discount","discount"))},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("select_plans","discount")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:v,options:u,onChange:this.onChangePlan,editable:c}))),!this.getSelectedPlans().isEmpty()&&r.a.createElement("hr",null),this.renderPlanDiscountValue()),!l.includes("subject.service")&&r.a.createElement(f.v,{header:r.a.createElement("h3",null,te("panel_service_discount","discount"))},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("select_services","discount")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:h,options:p,onChange:this.onChangeService,editable:c}))),!this.getSelectedServices().isEmpty()&&r.a.createElement("hr",null),this.renderServivesDiscountValues()))))}}]),t}(a.Component);fm.defaultProps={discount:g.c.Map(),errors:g.c.Map(),fields:g.c.Map({description:g.c.Map({title:te("description","discount"),field_name:"description",mandatory:!0,description:Bo.description}),key:g.c.Map({title:te("key","discount"),field_name:"key",mandatory:!0,description:Bo.key}),priority:g.c.Map({title:te("priority","discount"),field_name:"priority",system:!0,type:"number"}),paramsMinSubscribers:g.c.Map({title:te("min_subscribers","discount"),field_name:"params.min_subscribers",system:!0,type:"number"}),paramsMaxSubscribers:g.c.Map({title:te("max_subscribers","discount"),field_name:"params.max_subscribers",system:!0,type:"number"}),proration:g.c.Map({field_name:"proration",title:te("proration","discount"),select_list:!0,select_options:[g.c.Map({value:"inherited",label:te("proration_inherited","discount")}),g.c.Map({value:"no",label:te("proration_no","discount")})],default_value:"inherited"})}),currency:"",hideFields:[],availableEntities:g.c.Map(),errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var hm=Object(l.connect)(function(e,t){var n="undefined"!==typeof t.errors?t.errors:g.c.Map(),a=Vs(e)||g.c.Map();return{availableEntities:or(e,t,["discount","plan","service"]),errors:g.c.merge(n,a)}})(fm),vm=function(){return Kl("discount","discount")},ym=function(e,t){return $l("discounts",e,t)},bm=function(e,t){return zl("discount",e,t)},Em=function(e){return Hl("discount",e)},Cm=function(e){return Xl("discount",function(e){return yi("discounts",e)}(e))},_m=function(e,t,n){return function(a){var r=t.map(function(e){return"to"!==e.get("field_name","")||["saveInSubscriber"].includes(n)?e:e.set("mandatory",!1)});return g.c.Map().withMutations(function(t){(function(e,t){var n=!1,a=!1,r=["subscriber.plan","subscriber.plan_activation","subscriber.plan_deactivation"],i=e.getIn(["params","cycles"],""),o=["params","conditions"];return e.getIn(o,g.c.List()).forEach(function(e,l){e.forEach(function(e,s){"account"===s?e.get("fields",g.c.List()).forEach(function(e,a){if(e.isEmpty()||e.some(function(e){return"".includes(e)})){var r=[].concat(o,[l,s,"fields",a]);t(Is(r.join("."),"Conditions can not be empty")),n=!0}}):e.forEach(function(e,c){e.forEach(function(e,u){"fields"===u?e.forEach(function(e,u){if(e.isEmpty()||e.some(function(e){return"".includes(e)})){var p=[].concat(o,[l,s,c,"fields",u]);t(Is(p.join("."),"Conditions can not be empty")),n=!0}""!==i&&(a=r.includes("subscriber.".concat(e.get("field",""))))}):"service"===u&&e.get("any",g.c.List()).forEach(function(e,r){e.forEach(function(e){e.forEach(function(e,i){if(a=!0,e.isEmpty()||e.some(function(e){return"".includes(e)})){var p=[].concat(o,[l,s,c,u,"any",r,"fields",i]);t(Is(p.join("."),"Conditions can not be empty")),n=!0}})})})})})})}),""===i||a?t(Is("params.cycles")):(n=!0,t(Is("params.cycles","When limiting by cycles, please include at least one condition on Plan or Service"))),n})(e,a)&&t.set("conditions",!0),r.forEach(function(n){var a=n.get("field_name",""),r=e.getIn(a.split(".")),i=rs(r,n);!0!==i&&t.set(a,i)})})}},Om=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:g.c.Map(),progress:!1},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t||"closeandnew"===t&&ce(a,"from").isBefore(S()())){var r=S()().add(1,"days").toISOString();n.onChangeFieldValue(["from"],r)}null===a.get("type",null)&&n.onChangeFieldValue(["type"],"monetary"),"clone"===t&&n.props.dispatch(vm())},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&ue(t,!1)){var a=t.get("key","");n.props.dispatch(dp("discounts","key",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Cm(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("key","");n.props.dispatch(sp("discounts",e))},n.clearItemsList=function(){var e=ee(["systemItems","discount","itemsType"],"");n.props.dispatch(up(e))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onRemoveFieldValue=function(e){n.props.dispatch(Em(e))},n.onChangeFieldValue=function(e,t){var a=n.state.errors,r=e.join(".");n.setState(function(){return{errors:a.delete(r)}}),n.props.dispatch(bm(e,t))},n.afterSave=function(e){n.setState({progress:!1});var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Ur("The discount was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.validate()&&(n.setState({progress:!0}),n.props.dispatch(ym(t,a)).then(n.afterSave))},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=ee(["systemItems","discount","itemsType"],"");e&&n.clearItemsList(),n.props.router.push("/".concat(t))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n.validate=function(){var e=n.props,t=e.item,a=e.fields,r=e.mode,i=n.props.dispatch(_m(t,a,r));return n.setState(function(){return{errors:i}}),!!i.isEmpty()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if("create"===e){var t=se(e,"discount");this.props.dispatch(bs(t))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||ue(t)!==ue(i)){var s=se(n,"discount",t);this.props.dispatch(bs(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Wl("discount"))}},{key:"render",value:function(){var e=this.state,t=e.progress,n=e.errors,a=this.props,i=a.item,o=a.mode,l=a.revisions,s=a.currency;if("loading"===o)return r.a.createElement(_,{onClick:this.handleBack});var c="view"!==o;return r.a.createElement("div",{className:"discount-setup"},r.a.createElement(f.v,null,r.a.createElement(Sd,{itemName:"discount",revisions:l,item:i,mode:o,onChangeFrom:this.onChangeFieldValue,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.v,null,r.a.createElement(hm,{discount:i,mode:o,currency:s,onFieldUpdate:this.onChangeFieldValue,onFieldRemove:this.onRemoveFieldValue,errors:n})),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!c,cancelLabel:c?void 0:"Back",progress:t}))}}]),t}(a.Component);Om.defaultProps={item:g.c.Map(),currency:"",revisions:g.c.List(),fields:g.c.List()};var Sm=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,"discount"),item:bo(e,t,"discount"),mode:Co(e,t,"discount"),revisions:po(e,t,"discount"),currency:pa(e,t)||void 0,fields:Fa(e,t)}})(Om)),Tm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onRemoveFieldValue=function(e){var t=e.join(".");n.props.setError(t),n.props.removeField(e)},n.onChangeFieldValue=function(e,t){var a=e.join(".");n.props.setError(a),n.props.updateField(e,t)},n.onChangeFromTo=function(e){n.props.setError("from"),n.props.setError("to"),g.c.Map.isMap(e)?(n.props.updateField(["from"],e.get("from","")),n.props.updateField(["to"],e.get("to",""))):(n.props.updateField(["from"],""),n.props.updateField(["to"],""))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.item,a=t.mode,r=t.hideFields,i=t.currency,o=t.errors;return!g.c.is(n,e.item)||!g.c.is(o,e.errors)||a!==e.mode||r!==e.hideFields||i!==e.currency}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.mode,a=e.currency,i=e.hideFields,o=e.errors,l=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"),s=g.c.Map({from:ce(t,"from").format(l),to:ce(t,"to").format(l)}),c=!["view"].includes(n),u=o.get("from",o.get("to",!1));return r.a.createElement("div",{className:"discount-setup"},r.a.createElement(f.l,{className:"form-inner-edit-row mr0 ml0 text-center",validationState:u?"error":null},r.a.createElement(f.o,{className:"full-width"},r.a.createElement(Tn,{fieldType:"range",value:s,onChange:this.onChangeFromTo,editable:c,inputProps:{fieldType:"date",isClearable:!0},inputFromProps:{selectsStart:!0,endDate:"@valueTo@"},inputToProps:{selectsEnd:!0,startDate:"@valueFrom@",endDate:"@valueTo@",minDate:"@valueFrom@"}})),u&&r.a.createElement(f.n,{className:"text-left"},r.a.createElement("small",null,u))),r.a.createElement(hm,{discount:t,mode:n,hideFields:i,currency:a,onFieldUpdate:this.onChangeFieldValue,onFieldRemove:this.onRemoveFieldValue,errors:o}))}}]),t}(a.Component);Tm.defaultProps={item:g.c.Map(),errors:g.c.Map(),hideFields:!1,currency:""};var km=Object(l.connect)(function(e,t){return{currency:pa(e,t)||void 0}})(Tm),jm=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).initService=function(e){var t=n.props.subscription,a=n.state.subscription,r=n.getServiceType(e),i=ce(a,"from").format("YYYY-MM-DD"),o=ce(a,"to",S()().add(100,"years")).toISOString(),l=g.c.Map({name:e,from:i,to:o}),s=(t.get("services",g.c.List())||g.c.List()).find(function(t){return t.get("name","")===e});switch(r){case"quantitative":return s&&1===s.get("quantity","")?s:l.set("quantity",1);case"balance_period":return l.setIn(["ui_flags","balance_period"],!0);default:return s||l}},n.onSave=function(){var e=n.state.subscription,t=n.props.mode,a=Object(vp.d)(n.removeServiceUiFlags)(e);n.props.onSave(a,t)},n.onChangeFrom=function(e,t){var a=n.state.subscription,r=n.updateServicesDates(a.setIn(e,t));n.setState({subscription:r})},n.onChangePlan=function(e){n.updateSubscriptionField(["plan"],e)},n.onChangePlay=function(e){n.updateSubscriptionField(["play"],e),n.filterSubscriptionServicesByPlay(e),n.filterSubscriptionPlanByPlay(e)},n.onChangeServiceDetails=function(e,t,a){var r=Array.isArray(t)?t:[t];n.updateSubscriptionField(["services",e].concat(Object(N.a)(r)),a)},n.onRemoveService=function(e){var t=(n.state.subscription.get("services",g.c.List())||g.c.List()).delete(e);n.updateSubscriptionField(["services"],t)},n.onAddService=function(e){var t=n.state.subscription,a=n.initService(e),r=(t.get("services",g.c.List())||g.c.List()).push(a);n.updateSubscriptionField(["services"],r)},n.onChangeService=function(e){var t=n.state.subscription;if(e.length){var a=g.c.Set(e.split(",")),r=t.get("services",g.c.List())||g.c.List(),i=g.c.Set(r.map(function(e){return e.get("name","")})),o=a.filter(function(e){return!i.has(e)}),l=i.filter(function(e){return!a.has(e)});o.size&&o.forEach(function(e){n.onAddService(e)}),l.size&&l.forEach(function(e){r.forEach(function(t,a){t.get("name","")===e&&n.onRemoveService(a)})})}else n.updateSubscriptionField(["services"],g.c.List())},n.getDiscountActions=function(){var e="view"!==n.props.mode;return[{type:"view",helpText:"view discount",onClick:n.onDiscountEditForm,show:!e,actionClass:"pl0 pr0"},{type:"edit",helpText:"Edit discount",onClick:n.onDiscountEditForm,show:e,actionClass:"pl0 pr0"},{type:"remove",helpText:"Remove discount",onClick:n.onRemoveDiscount,show:e,actionClass:"pl0 pr0"}]},n.onDiscountEditForm=function(e){var t=n.props,a=t.dispatch,r=t.mode,i=t.discountFields,o=n.state,l=o.subscription,s=o.discountsHiddenFields,c=l.get("discounts",g.c.List())||g.c.List(),u=null===e,p=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"),d=c.get(e,g.c.Map({key:"SUBSCRIBER_DISCOUNT_".concat(Zt.a.v4().replace(/-/g,"")),type:"monetary",from:l.get("from",S()().format(p)),to:l.get("to",S()().add(100,"years").format(p))})),m={title:u?"Create discount":"Edit ".concat(d.get("description","discount")),onOk:function(t){n.props.dispatch(Is());var r=a(_m(t,i,"saveInSubscriber"));if(!r.isEmpty())return r.forEach(function(e,t){n.props.dispatch(Is(t,e))}),!1;var o=u?c.push(t):c.set(e,t);return n.updateSubscriptionField(["discounts"],o),!0},mode:r,hideFields:s};return a(js(d,km,m))},n.onRemoveDiscount=function(e){var t=n.props.dispatch,a=n.state.subscription.get("discounts",g.c.List())||g.c.List(),r=a.get(e,null);if(null===r)return!1;var i={message:'Are you sure you want to remove discount "'.concat(r.get("description",""),'"?'),onOk:function(){var t=a.delete(e);n.updateSubscriptionField(["discounts"],t)},labelOk:"Delete",type:"delete"};return t(ks(i))},n.filterCustomFields=function(e){var t=!["plan","services","play"].includes(e.get("field_name")),n=e.get("editable",!1),a=e.get("mandatory",!1),r=e.get("display",!0);return t&&(n||a)&&r},n.filterSubscriptionPlanByPlay=function(e){var t=n.state.subscription,a=n.props.allPlans.find(function(e){return e.get("name","")===t.get("plan","")},null,g.c.Map()).get("play",g.c.List());a.isEmpty()||a.includes(e)||n.updateSubscriptionField(["plan"],"")},n.filterSubscriptionServicesByPlay=function(e){var t=n.props.allServices,a=(n.state.subscription.get("services",g.c.List())||g.c.List()).filter(function(n){var a=t.find(function(e){return e.get("name","")===n.get("name","")},null,g.c.Map()).get("play",g.c.List());return a.isEmpty()||a.includes(e)});n.updateSubscriptionField(["services"],a)},n.updateSubscriptionField=function(e,t){n.setState(function(n){return{subscription:n.subscription.setIn(e,t)}})},n.updateServicesDates=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=n.props.subscription,r=a.get("services",g.c.List())||g.c.List(),i=t||ce(e,"from").toISOString();return e.update("services",g.c.List(),function(e){return e?e.map(function(e){var t=n.getServiceType(e),a=r.find(function(t){return t.getIn(["ui_flags","serviceId"],"")===e.getIn(["ui_flags","serviceId"],"")}),o=""===e.getIn(["ui_flags","serviceId"],"");switch(t){case"normal":return o?e.set("from",i):e;case"quantitative":var l=a&&a.get("quantity","")!==e.get("quantity","");return o||l?e.set("from",i):e;case"balance_period":var s=a&&!S()(a.get("from","")).isSame(S()(e.get("from","")),"days"),c=S()(e.get("from","")).isBefore(i,"days");return(o||s)&&c?e.set("from",i):e;default:return e}}):g.c.List()})},n.removeSubscriptionField=function(e,t){n.setState(function(n){return{subscription:n.subscription.deleteIn(e,t)}})},n.getServiceType=function(e){var t=n.props.allServices,a=g.c.Map.isMap(e)?e.get("name",""):e,r=t.find(function(e){return e.get("name","")===a});return r?r.get("quantitative",!1)?"quantitative":"default"!==r.get("balance_period","default")?"balance_period":"normal":null},n.formatSelectOptions=function(e){return e.map(function(e){return{value:e.get("name",""),label:e.get("description",e.get("name",""))}})},n.getAvailablePlans=function(){var e=n.state.subscription,t=n.props.allPlans,a=e.get("play",!1);return[!1,""].includes(a)?n.formatSelectOptions(t):n.formatSelectOptions(t.filter(function(e){return e.get("play",g.c.List()).isEmpty()||e.get("play",g.c.List()).includes(a)}))},n.getPlanIncludedServices=function(e){if(""===e)return"-";var t=n.props.allPlans.find(function(t){return t.get("name","")===e},null,g.c.Map()).getIn(["include","services"],g.c.List());return t.size?t.join(", "):"-"},n.getAvailableServices=function(){var e=n.state.subscription,t=n.props.allServices,a=e.get("play",!1);return[!1,""].includes(a)?n.formatSelectOptions(t):n.formatSelectOptions(t.filter(function(e){return e.get("play",g.c.List()).isEmpty()||e.get("play",g.c.List()).includes(a)}))},n.getActions=function(){return[{type:"back",label:"Back To List",onClick:n.props.onCancel,actionStyle:"primary",actionSize:"xsmall"}]},n.fetchItem=function(){var e=n.state.subscription;n.props.getSubscription(e)},n.clearRevisions=function(){var e=n.state.subscription;n.props.clearRevisions(e),n.clearItemsList()},n.clearItemsList=function(){n.props.clearList()},n.removeServiceUiFlags=function(e){return e.update("services",g.c.List(),function(e){return e?e.map(function(e){return e.delete("ui_flags")}):g.c.List()})},n.renderDiscountRow=function(e,t){var a=ee("dateFormat","DD/MM/YYYY");return r.a.createElement("tr",{className:"List",key:e.get("key",t)},r.a.createElement("td",{className:"td-ellipsis"},e.get("description","")),r.a.createElement("td",{className:"td-ellipsi text-center"},ce(e,"from").format(a)),r.a.createElement("td",{className:"td-ellipsis text-center"},ce(e,"to").format(a)),r.a.createElement("td",{className:"td-ellipsis text-center"},te("type_".concat(e.get("type","monetary")),"discount")),r.a.createElement("td",{className:"td-ellipsis text-center"},e.get("cycles","Infinite")),r.a.createElement("td",{className:"td-ellipsis text-center"},e.get("priority","-")),r.a.createElement("td",{className:"text-right row pr0 pl0"},r.a.createElement(vt,{actions:n.getDiscountActions(),data:t})))},n.renderSystemFields=function(e){var t=n.state.subscription,a=n.props.mode,i=n.getAvailablePlans().toJS(),o=n.getAvailableServices().toJS(),l=t.get("services",g.c.List())||g.c.List(),s=g.c.Set(l.map(function(e){return e.get("name","")})).join(","),c=t.get("plan","");return[r.a.createElement(Fp,{key:"plays-selector",entity:t,editable:e&&"create"===a,mandatory:!0,onChange:n.onChangePlay}),r.a.createElement(f.l,{key:"plan"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Plan ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",options:i,value:c,onChange:n.onChangePlan,editable:e}))),r.a.createElement(f.l,{key:"includedServices"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Included Services"),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{value:n.getPlanIncludedServices(c),editable:!1}))),r.a.createElement(f.l,{key:"services"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Services"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:s,options:o,onChange:n.onChangeService,clearable:!1,editable:e})))]},n.renderPanelTitle=function(){var e=n.props,t=e.mode,a=e.subscription,i=se(t,"subscription",a);return r.a.createElement("div",null,i,r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:n.getActions()})))},n.state={subscription:e.subscription,progress:!1,discountsHiddenFields:["key","params.min_subscribers","params.max_subscribers"]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){g.c.is(this.props.subscription,e.subscription)||this.setState({subscription:e.subscription})}},{key:"render",value:function(){var e=this.state,t=e.progress,n=e.subscription,a=this.props,i=a.revisions,o=a.mode,l=a.allServices,s=a.subscription,c=["update","clone","closeandnew","create"].includes(o),u=n.get("services",g.c.List())||g.c.List(),p=ce(n,"from"),d=s.get("services",g.c.List())||g.c.List();return r.a.createElement("div",{className:"Subscription"},r.a.createElement(f.v,{header:this.renderPanelTitle()},r.a.createElement(Sd,{itemName:"subscription",revisions:i,item:n,mode:o,onChangeFrom:this.onChangeFrom,backToList:this.props.onCancel,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,onActionEdit:this.props.getSubscription,onActionClone:this.props.getSubscription,clearList:this.clearItemsList}),r.a.createElement("hr",null),r.a.createElement(f.j,{horizontal:!0},this.renderSystemFields(c),r.a.createElement(Wd,{subscriptionServices:u,originSubscriptionServices:d,servicesOptions:l,editable:c,subscriptionFrom:p,onChangeService:this.onChangeServiceDetails,onRemoveService:this.onRemoveService,onAddService:this.onAddService}),r.a.createElement(Fd,{entityName:["subscribers","subscriber"],entity:n,onChangeField:this.updateSubscriptionField,onRemoveField:this.removeSubscriptionField,fieldsFilter:this.filterCustomFields,editable:c})),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Discounts")},n.get("discounts",g.c.List()).isEmpty()&&r.a.createElement("p",null,r.a.createElement("small",null,"No Discounts")),!n.get("discounts",g.c.List()).isEmpty()&&r.a.createElement(f.A,{style:{tableLayout:"fixed"},className:"mb0"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,te("description","discount")),r.a.createElement("th",{className:"text-center"},te("from","discount")),r.a.createElement("th",{className:"text-center"},te("to","discount")),r.a.createElement("th",{className:"text-center"},te("type","discount")),r.a.createElement("th",{className:"text-center"},te("cycles","discount")),r.a.createElement("th",{className:"text-center"},te("priority","discount")),r.a.createElement("th",null))),r.a.createElement("tbody",null,n.get("discounts",g.c.List()).map(this.renderDiscountRow).toList().toArray())),c&&r.a.createElement(ct,{buttonStyle:{},onClick:this.onDiscountEditForm,action:"Add",label:"",type:"Discount"}))),r.a.createElement(v,{onClickCancel:this.props.onCancel,onClickSave:this.onSave,hideSave:!c,cancelLabel:c?void 0:"Back",progress:t}))}}]),t}(a.Component);jm.defaultProps={subscription:g.c.Map(),mode:"create",revisions:g.c.List(),settings:g.c.List(),discountFields:g.c.List(),allPlans:g.c.List(),allServices:g.c.List()};var Im=Object(l.connect)(function(e,t){var n=t.subscription,a=ee(["systemItems","subscription","collection"],""),r=Ye(ee(["systemItems","subscription","uniqueField"],"")).map(function(e){return n.get(e,"")}).join("_"),i=e.entityList.revisions.getIn([a,r]),o=n&&ue(n,!1)?me(n):"create";return{discountFields:Fa(e,t),revisions:i,mode:o}})(jm),wm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={subscription:null},n.fetchSubscription=function(e,t,a){var r=n.props.allServices,i=ue(e,null);null!==i&&n.props.getSubscription(i,a).then(function(e){var t=e.update("services",g.c.List(),function(e){return e?e.map(function(e){var t="default"!==r.find(function(t){return t.get("name","")===e.get("name","")},null,g.c.Map()).get("balance_period","default"),n=g.c.Map({balance_period:t,serviceId:Zt.a.v4()});return e.set("ui_flags",n)}):g.c.List()});n.setState({subscription:t})})},n.onClickNew=function(e){n.setState({subscription:g.c.Map({aid:e})})},n.onClickCancel=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0===e&&n.props.clearList(),n.setState({subscription:null})},n.onClickSave=function(e,t){n.props.onSaveSubscription(e,t).then(n.afterSave)},n.afterSave=function(e){e&&n.setState({subscription:null})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.aid,n=e.settings,a=e.allPlans,i=e.allServices,o=e.defaultListFields,l=this.state.subscription;return l?r.a.createElement(Im,{subscription:l,settings:n,allPlans:a,allServices:i,clearRevisions:this.props.clearRevisions,clearList:this.props.clearList,getSubscription:this.fetchSubscription,onSave:this.onClickSave,onCancel:this.onClickCancel}):r.a.createElement(Kd,{settings:n,aid:t,onNew:this.onClickNew,onClickEdit:this.fetchSubscription,defaultListFields:o})}}]),t}(a.Component);wm.defaultProps={settings:g.c.List(),allPlans:g.c.List(),allServices:g.c.List(),defaultListFields:[]};var Nm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={allSubscriptions:g.c.Map(),allAccounts:g.c.Map()},n.loadNames=function(e,t,a){var r=e.get("allowances",g.c.List()),i=r.map(function(e){return e.get("sid","")}).reduce(function(e,n){return t.keySeq().includes(n)?e:e.push(n)},g.c.List());if(!i.isEmpty()){var o={sid:{$in:i}};n.props.dispatch(is("subscribers",o,{sid:1,firstname:1,lastname:1})).then(function(e){var t=!1===e?i.reduce(function(e,t){return e.set(t,"")},g.c.Map()):n.formatNames(g.c.fromJS(e),"sid");n.setState(function(e){return{allSubscriptions:e.allSubscriptions.merge(t)}})})}var l=r.map(function(e){return e.get("aid","")}).reduce(function(e,t){return a.keySeq().includes(t)?e:e.push(t)},g.c.List());if(!l.isEmpty()){var s={aid:{$in:l}};n.props.dispatch(is("accounts",s,{aid:1,firstname:1,lastname:1})).then(function(e){var t=!1===e?l.reduce(function(e,t){return e.set(t,"")},g.c.Map()):n.formatNames(g.c.fromJS(e),"aid");n.setState(function(e){return{allAccounts:e.allAccounts.merge(t)}})}).catch(function(){})}},n.onAskDeleteSid=function(e){var t=n.props.customer,a=n.state.allSubscriptions.get(e,""),r={message:"Are you sure you want to delete  allowance for subscriber '".concat(a,"' ID ").concat(e,"?"),onOk:function(){var a=t.get("allowances",g.c.List()).filter(function(t){return t.get("sid","")!==e});return n.props.onChange("allowances",a)},labelOk:"Delete",type:"delete"};n.props.dispatch(ks(r))},n.onAskDeleteAisSids=function(e){var t=n.props.customer,a=n.state.allAccounts.get(e,""),r={message:"Are you sure you want to delete all allowances for customer '".concat(a,"' ID ").concat(e," ?"),onOk:function(){var a=t.get("allowances",g.c.List()).filter(function(t){return t.get("aid","")!==e});return n.props.onChange("allowances",a)},labelOk:"Delete",type:"delete"};n.props.dispatch(ks(r))},n.getAidGroupActions=function(){return[{type:"remove",showIcon:!0,actionStyle:"danger",actionSize:"xsmall",onClick:n.onAskDeleteAisSids}]},n.getSidActions=function(){return[{type:"remove",showIcon:!0,actionStyle:"link",actionSize:"xsmall",onClick:n.onAskDeleteSid}]},n.formatNames=function(e,t){return e.reduce(function(e,n){var a=[re(n),ie(n)].map(function(e){return e.trim()}).filter(function(e){return""!==e}).join(" ");return e.set(n.get(t,""),a)},g.c.Map())},n.createSubscriptionsSelectOption=function(e){var t=[re(e),ie(e)].map(function(e){return e.trim()}).filter(function(e){return""!==e}).join(" ");return{value:"".concat(e.get("sid","")),label:"".concat(t," (Subscriber ID: ").concat(e.get("sid",""),", Customer ID: ").concat(e.get("aid",""),")"),aid:e.get("aid",""),name:t}},n.subscriptionsSelectOptions=function(e,t,a){return e.filter(function(e){return e.get("aid","")!==t}).filter(function(e){return!a.includes(e.get("sid",""))}).map(n.createSubscriptionsSelectOption).toList().toArray()},n.renderGroupHeader=function(e,t){return r.a.createElement("div",null,r.a.createElement("small",null,"".concat(t," (Customer ID: ").concat(e,")")),r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:n.getAidGroupActions(),data:e})))},n.onChangeSubscriptions=function(e,t){var a=t.option,r=n.props.customer.get("allowances",g.c.List()),i=x()(a.aid)?parseFloat(a.aid):a.aid,o=x()(e)?parseFloat(e):e,l=g.c.Map({sid:o,aid:i,allowance:""});return n.setState(function(e){return{allSubscriptions:e.allSubscriptions.set(o,a.name)}}),n.props.onChange("allowances",r.push(l))},n.onChangeAllowanceValue=function(e){var t=n.props.customer,a=e.target,r=a.id,i=a.value,o=x()(r)?parseFloat(r):r,l=t.get("allowances",g.c.List()),s=l.findIndex(function(e){return e.get("sid","")===o},null,g.c.Map());if(-1!==s){var c=x()(i)?Math.abs(parseFloat(i)):i;return n.props.onChange("allowances",l.setIn([s,"allowance"],c))}},n.findSubscribers=function(e,t){var a=n.props.customer;if(""===e)return t([]);var r={firstname:{$regex:e,$options:"i"},lastname:{$regex:e,$options:"i"},aid:parseFloat(e),sid:parseFloat(e)},i={or_fields:Object.keys(r)},o=a.get("allowances",g.c.List()).map(function(e){return e.get("sid","")});return n.props.dispatch(is("subscribers",r,{sid:1,aid:1,firstname:1,lastname:1},{aid:1,sid:1,firstname:1,lastname:1},i)).then(function(e){return t(n.subscriptionsSelectOptions(g.c.fromJS(e),a.get("aid",""),o))}).catch(function(){return t([])})},n.renderAllowancesValue=function(){var e=n.props,t=e.customer,a=e.editable,i=e.currency,o=n.state,l=o.allAccounts,s=o.allSubscriptions;return t.get("allowances",g.c.List()).groupBy(function(e){return e.get("aid","")}).sort().map(function(e,t){var o=l.get(t,"");return r.a.createElement(f.v,{header:n.renderGroupHeader(t,o),key:"aid-".concat(t)},e.map(function(e){var t=e.get("sid",""),o=s.get(t,"");return r.a.createElement(f.l,{key:"sid-".concat(t)},r.a.createElement(f.g,{componentClass:f.h,xs:12,sm:5,smOffset:1,className:"pt5"},o,r.a.createElement("br",null),"(Subscriber ID: ".concat(t,")")),r.a.createElement(f.g,{xs:10,sm:5},r.a.createElement(Tn,{id:t,value:e.get("allowance",""),onChange:n.onChangeAllowanceValue,fieldType:"number",min:0,editable:a,suffix:vd()(i)})),r.a.createElement(f.g,{xs:2,sm:1,className:"input-min-line-height pr0 pl0"},r.a.createElement(vt,{actions:n.getSidActions(),data:t})))}))}).toList().toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.customer,t=this.state,n=t.allSubscriptions,a=t.allAccounts;this.loadNames(e,n,a)}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.customer,a=this.state,r=a.allSubscriptions,i=a.allAccounts;this.loadNames(n,r,i)}},{key:"render",value:function(){var e=this,t=this.props,n=t.customer,a=t.editable,i=Object(Al.a)(500,function(t,n){e.findSubscribers(t,n)});return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:te("Search Subscribers","Customer")},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:10,smOffset:1},r.a.createElement(Tn,{fieldType:"select",value:"",onChange:this.onChangeSubscriptions,editable:a,clearable:!1,isAsync:!0,cacheOptions:!0,placeholder:"Search for allowance...",loadAsyncOptions:i,noResultsText:"Type to search"})))),n.get("allowances",g.c.List()).size>0&&r.a.createElement(f.v,{header:te("Allowances","Customer")},this.renderAllowancesValue()))))}}]),t}(a.Component);Nm.defaultProps={customer:g.c.Map(),currency:"",editable:!0};var Fm=Object(l.connect)(null)(Nm),xm=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onClearFilter=function(){n.setState({filter_by:[],string:""},function(){n.onClickFilterBtn()})},n.onChangeFilterString=n.onChangeFilterString.bind(Object(Po.a)(n)),n.onSelectFilterField=n.onSelectFilterField.bind(Object(Po.a)(n)),n.onClickFilterBtn=n.onClickFilterBtn.bind(Object(Po.a)(n)),n.buildQueryString=n.buildQueryString.bind(Object(Po.a)(n)),n.filterCond=n.filterCond.bind(Object(Po.a)(n)),n.state={string:"",filter_by:[]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.onClickFilterBtn()}},{key:"onChangeFilterString",value:function(e){var t=e.target.value;this.setState({string:t})}},{key:"filterCond",value:function(e,t){var n=this.props.fields.find(function(t){return t.id===e});if(!n)return{$regex:t,$options:"i"};switch(n.type){case"number":return parseInt(t);case"datetime":return t;case"text":default:return{$regex:t,$options:"i"}}}},{key:"buildQueryString",value:function(){var e=this,t=this.state,n=t.string,a=t.filter_by,r=this.props.base,i=g.c.fromJS(r).reduce(function(t,n,a){return t.set(a,e.filterCond(a,n))},g.c.Map()).toJS();return n.replace(/\s/gi,"")?a.reduce(function(t,a){return Object.assign({},t,Object(ti.a)({},a,e.filterCond(a,n)))},i):i}},{key:"onClickFilterBtn",value:function(){(0,this.props.onFilter)(this.buildQueryString())}},{key:"onSelectFilterField",value:function(e,t){var n=e.val(),a=this.state.filter_by,r=a.includes(n);if(!t||!r)return!t&&r?this.setState({filter_by:a.filter(function(e){return e!==n})}):this.setState({filter_by:a.concat(n)})}},{key:"render",value:function(){var e=this.props.fields,t=void 0===e?[]:e,n=this.state,a=n.filter_by,i=n.string,o=t.filter(function(e){return!1!==e.showFilter}).map(function(e,t){var n=a.includes(e.id);return{value:e.id,label:e.placeholder,selected:n}});return r.a.createElement("div",{className:"Filter row",style:{marginBottom:10}},r.a.createElement("div",{className:"filter-warp"},r.a.createElement("div",{className:"pull-left"},r.a.createElement("input",{id:"filter-string",placeholder:"Search for...",onChange:this.onChangeFilterString,value:i,className:"form-control"})),r.a.createElement("div",{className:"pull-left"},r.a.createElement(Fu.a,{data:o,multiple:!0,onChange:this.onSelectFilterField,buttonWidth:"100%",nonSelectedText:"Search in fields"})),r.a.createElement("div",{className:"search-button pull-left"},r.a.createElement("button",{className:"btn btn-default search-btn",onClick:this.onClickFilterBtn,type:"submit",disabled:i&&0===a.length||!i&&0===a.length},r.a.createElement("i",{className:"fa fa-search"}))),r.a.createElement("div",{className:"search-button pull-left"},r.a.createElement("button",{className:"btn btn-default search-btn",onClick:this.onClearFilter,type:"button"},r.a.createElement("i",{className:"fa fa-eraser"})))))}}]),t}(a.Component);xm.defaultProps={base:{}};var Rm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={filters:g.c.Map()},n.onChangeInput=function(e){var t=e.target,a=t.id,r=t.value;n.onChange(a,r)},n.onChangeDate=function(e,t){var a=t?t.toJSON():"";n.onChange("urt",a)},n.onChangeDateFrom=function(e,t){var a=t?t.toJSON():"",r=n.state.filters.get(e,{});r.from=a,n.onChange(e,r)},n.onChangeDateTo=function(e,t){var a=t?t.toJSON():"",r=n.state.filters.get(e,{});r.to=a,n.onChange(e,r)},n.onChange=function(e,t){var a=n.state.filters;t?n.setState({filters:a.set(e,t)}):n.setState({filters:a.delete(e)})},n.onClear=function(){var e=g.c.Map();n.setState({filters:e}),n.props.onFilter(e.toJS())},n.onApplay=function(){var e=n.state.filters;n.props.onFilter(e.toJS())},n.getFilterInput=function(e){var t=n.state.filters.get(e.id,"");switch(e.type){case"select":var a=e.options.map(function(e,t){var n,a;return e&&e.key&&e.val?(n=e.val,a=e.key):a=n=e,r.a.createElement("option",{key:t,value:a},n)});return r.a.createElement("select",{id:e.id,className:"form-control",value:t,onChange:n.onChangeInput},"[",r.a.createElement("option",{key:"select",value:""},"Select..."),", ...",a,"]");case"date":return r.a.createElement(Dt.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:t.length?S()(t):null,onChange:n.onChangeDate.bind(Object(Po.a)(n),e.id),isClearable:!0,placeholderText:"Select Date..."});case"date-range":var i=t?t.from:"";i=i?S()(i):null;var o=t?t.to:"";return o=o?S()(o):null,r.a.createElement("div",{style:{width:"100%"}},r.a.createElement("div",{className:"pull-left",style:{width:"48%"}},r.a.createElement(Dt.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:i,selectsStart:!0,startDate:i,endDate:o,onChange:n.onChangeDateFrom.bind(Object(Po.a)(n),e.id),isClearable:!0,placeholderText:"Select Start Date..."})),r.a.createElement("div",{className:"pull-right",style:{width:"48%"}},r.a.createElement(Dt.a,{className:"form-control",dateFormat:"DD/MM/YYYY",selected:o,selectsEnd:!0,startDate:i,endDate:o,onChange:n.onChangeDateTo.bind(Object(Po.a)(n),e.id),isClearable:!0,placeholderText:"Select End Date..."})));default:return r.a.createElement("input",{id:e.id,onChange:n.onChangeInput,value:t,placeholder:"Search...",className:"form-control"})}},n.renderTitles=function(e,t,n){return r.a.createElement("th",{style:{width:"".concat(100/(0===n.length?1:n.length),"%")},key:t},e.title)},n.renderInputs=function(e,t,a){var i=n.getFilterInput(e),o=k()({pl0:0===t,pr0:t===a.length-1});return r.a.createElement("td",{className:o,key:t},i)},n.renderActions=function(){var e=n.props.fields;return[r.a.createElement("td",{colSpan:e.length-1,className:"pl0",key:"search"},r.a.createElement(f.c,{bsStyle:"primary",onClick:n.onApplay,className:"full-width mr10"},r.a.createElement("i",{className:"fa fa-search"}),"\xa0Search")),r.a.createElement("td",{className:"pr0",key:"reset"},r.a.createElement(f.c,{onClick:n.onClear,className:"full-width"},r.a.createElement("i",{className:"fa fa-eraser danger-red"}),"\xa0Reset"))]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.fields,t=e.map(this.renderTitles),n=e.map(this.renderInputs),a=this.renderActions();return r.a.createElement("div",{className:"AdvancedFilter"},r.a.createElement(f.A,{responsive:!0,className:"mb0"},r.a.createElement("thead",null,r.a.createElement("tr",null,t)),r.a.createElement("tbody",null,r.a.createElement("tr",null,n),r.a.createElement("tr",null,a))))}}]),t}(a.Component);Rm.defaultProps={fields:[]};var Mm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={page:0},n.handlePageClick=function(e){e.preventDefault();var t=n.props.pager,a=e.target.id,r=n.state.page;if("next"===a&&t.get("nextPage",!0))r+=1;else{if(!("previous"===a&&r>0))return;r-=1}n.setState({page:r}),n.props.onClick(r)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.size,n=e.count,a=e.pager,i=this.state.page,o=i*t,l="previous".concat(0===this.state.page?" disabled":""),s="next".concat(a.get("nextPage")?"":" disabled "),c=0===n?0:"".concat(o+1," to ").concat(o+n),u="Page ".concat(i+1);return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("ul",{className:"pagination"},r.a.createElement("li",{id:"previous",className:l},r.a.createElement("a",{id:"previous",onClick:this.handlePageClick},r.a.createElement("i",{id:"previous",className:"fa fa-chevron-left"}))),r.a.createElement("span",{className:"detalis",style:{padding:"0 10px"}},u,0!==c&&" | ".concat(c)),r.a.createElement("li",{id:"next",className:s},r.a.createElement("a",{id:"next",onClick:this.handlePageClick},r.a.createElement("i",{id:"next",className:"fa fa-chevron-right"}))))))}}]),t}(a.Component),Pm=Object(l.connect)(function(e){return{pager:e.pager}})(Mm),Am=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={page:0,size:10,sort:g.c.Map({sid:1}),filter:{}},n.buildQuery=function(){var e=n.state,t=e.size,a=e.page,r=e.sort,i=e.filter;return mi(i,a,r,t)},n.fetchItems=function(){n.props.dispatch(eo("postpaid_balances",n.buildQuery()))},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.parseTotalCost=function(e){return e.getIn(["balance","cost"],0).toFixed(2)},n.getTableFields=function(){var e=n.props.usageTypes.map(function(e){return{id:e,placeholder:L.a.titleCase(e),showFilter:!1,parser:function(t){return t.getIn(["balance","totals",e,"usagev"],"")}}}).toJS();return[{id:"aid",placeholder:"Customer",type:"number",sort:!0,showFilter:!1,display:!1},{id:"sid",placeholder:"Subscriber",type:"number",sort:!0},{id:"plan_description",placeholder:"Plan"},{id:"balance.cost",placeholder:"Total Cost",type:"number",showFilter:!1,parser:n.parseTotalCost}].concat(Object(N.a)(e),[{id:"from",placeholder:"From",showFilter:!1,type:"datetime"},{id:"to",placeholder:"To",showFilter:!1,type:"datetime"}])},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.usageTypes.isEmpty()&&this.props.dispatch(kl(["usage_types"]))}},{key:"render",value:function(){var e=this.props,t=e.items,n=e.aid,a=this.state.sort,i=this.getTableFields(),o={aid:n,connection_type:"postpaid"};return r.a.createElement("div",{className:"Postpaid-Balances"},r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(xm,{fields:i,onFilter:this.onFilter,base:o}),r.a.createElement(ju,{items:t,fields:i,onSort:this.onSort,sort:a}))),r.a.createElement(Pm,{onClick:this.handlePageClick,size:this.state.size,count:t.size}))}}]),t}(a.Component);Am.defaultProps={items:g.c.List(),usageTypes:g.c.List()};var Dm=Object(l.connect)(function(e,t){return{items:e.list.get("postpaid_balances"),usageTypes:ga(e,t)}})(Am),Lm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={size:10,page:0,sort:g.c.Map({sid:1}),filter:{}},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.fetchItems=function(){n.props.dispatch(eo("prepaid_balances",n.buildQuery()))},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.buildQuery=function(){var e=n.state,t=e.size,a=e.page,r=e.sort,i=e.filter;return di(i,a,r,t)},n.parserUsageTypeName=function(e){return L.a.titleCase(e.get("charging_by_usaget",""))},n.parserUsageTypeValue=function(e){var t=e.get("charging_by_usaget"),n=e.get("charging_by"),a="total_cost"===t?["cost"]:["totals",t,n];return e.getIn(["balance"].concat(a),0).toFixed(2)},n.getTableFields=function(){return[{id:"aid",placeholder:"Customer",type:"number",sort:!0,showFilter:!1,display:!1},{id:"sid",placeholder:"Subscriber",type:"number",sort:!0},{id:"pp_includes_name",placeholder:"Bucket",sort:!0},{id:"charging_by_usaget",placeholder:"Usage Type Name",sort:!0,showFilter:!1,parser:n.parserUsageTypeName},{id:"usaget_type_value",placeholder:"Usage Type Value",sort:!0,showFilter:!1,parser:n.parserUsageTypeValue},{id:"from",placeholder:"From",showFilter:!1,type:"datetime"},{id:"to",placeholder:"To",showFilter:!1,type:"datetime"}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.aid,n=e.items,a=this.state.sort,i={aid:t,connection_type:"prepaid"},o=this.getTableFields();return r.a.createElement("div",{className:"Prepaid-Balances"},r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(xm,{fields:o,onFilter:this.onFilter,base:i}),r.a.createElement(ju,{items:n,fields:o,onSort:this.onSort,sort:a}))),r.a.createElement(Pm,{onClick:this.handlePageClick,size:this.state.size,count:n.size}))}}]),t}(a.Component);Lm.defaultProps={items:g.c.List()};var Um=Object(l.connect)(function(e){return{items:e.list.get("prepaid_balances")}})(Lm),Vm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Pd(e)).then(n.afterItemReceived)},n.afterItemReceived=function(e){e.status||n.handleBack()},n.onChangeCustomerField=function(e,t){n.props.dispatch(Vd(e,t))},n.onRemoveCustomerField=function(e){n.props.dispatch(Bd(e))},n.afterSaveCustomer=function(e){var t=n.props,a=t.mode,r=t.customer;if(e.status){n.props.dispatch(up("customers"));var i=["clone","create"].includes(a)?"created":"updated";n.props.dispatch(Ur("The customer was ".concat(i))),"create"===a&&n.handleBack();var o=se(a,"customer",r);n.props.dispatch(bs(o))}},n.onSaveCustomer=function(){var e=n.props,t=e.customer,a=e.mode;n.props.dispatch(Dd(t,a)).then(n.afterSaveCustomer)},n.onClickChangePaymentGateway=function(e){var t=e.get("aid",null),a="return_url=".concat(encodeURIComponent(n.getReturnUrl())),r="aid=".concat(encodeURIComponent(t)),i="action=".concat(encodeURIComponent("updatePaymentGateway"));window.location="".concat(ee(["env","serverApiUrl"],""),"/internalpaypage?").concat(r,"&").concat(a,"&").concat(i)},n.onSaveSubscription=function(e,t){return n.props.dispatch(Ud(e,t)).then(n.afterSaveSubscription)},n.afterSaveSubscription=function(e){if(e.status){var t=["clone","create"].includes(e.action)?"created":"updated";return n.props.dispatch(Ur("The subscription was ".concat(t))),n.clearSubscriptionRevisions(e.subscription),n.clearSubscriptions(),!0}return!1},n.clearSubscriptionRevisions=function(e){var t=e.get("sid",""),a=e.get("aid","");n.props.dispatch(sp("subscribers",[t,a]))},n.clearSubscriptions=function(){n.props.dispatch(cp("subscribers"))},n.handleBack=function(){var e=ee(["systemItems","customer","itemsType"],"");n.props.router.push("/".concat(e))},n.getSubscription=function(e,t){return n.props.dispatch(Ad(e)).then(function(e){if(e.status){if("clone"===t)return n.props.dispatch(Ld()),n.props.subscription;var a=n.props.subscription.get("sid",""),r=n.props.subscription.get("aid","");return n.props.dispatch(dp("subscribers",["sid","aid"],[a,r])),n.props.subscription}return null})},n.getReturnUrl=function(){var e=n.props.itemId;return"".concat(window.location.origin,"/#/customers/customer/").concat(e,"?tab=1")},n.handleSelectTab=function(e){var t=n.props.location,a=t.pathname,r=t.query;n.props.router.push({pathname:a,query:Object.assign({},r,{tab:e})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props,t=e.mode,n=e.message,a=e.allowancesEnabled;if(this.props.dispatch(kl(["subscribers"])),n&&this.props.dispatch(Lr(n.content,n.type)),["clone","create"].includes(t)){var r=se(t,"customer");this.props.dispatch(bs(r))}else this.props.dispatch(eo("available_gateways",{api:"paymentgateways",action:"list"})),this.props.dispatch(eo("available_plans",Ti({name:1,play:1,description:1,"include.services":1}))),this.props.dispatch(eo("available_services",Ci()));a&&(this.props.dispatch(eo("available_subscriptions",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{aid:1,sid:1,firstname:1,lastname:1};return bi("subscribers",e,{type:"subscriber"})}())),this.props.dispatch(eo("available_accounts",Ei())))}},{key:"componentWillReceiveProps",value:function(e){var t=e.customer,n=e.mode,a=e.itemId,r=this.props,i=r.customer,o=r.itemId,l=r.mode,s=n!==l,c=ue(t)!==ue(i);if(s||c){var u=se(n,"customer",t);this.props.dispatch(bs(u))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.customer,a=e.customer.getIn(["payment_gateway","active"],g.c.List()),r=n.getIn(["payment_gateway","active"],g.c.List());!a.isEmpty()&&r.isEmpty()&&this.onSaveCustomer()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Wl("customer")),this.clearSubscriptions()}},{key:"render",value:function(){var e=this.props,t=e.customer,n=e.defaultSubsctiptionListFields,a=e.settings,i=e.plans,o=e.services,l=e.currency,s=e.gateways,c=e.mode,u=e.aid,p=e.activeTab,d=e.allowancesEnabled,m=[1,5].includes(p);if("loading"===c)return r.a.createElement(_,{onClick:this.handleBack});var h=a.getIn(["account","fields"],g.c.List()),y=a.getIn(["subscriber","fields"],g.c.List());return r.a.createElement("div",{className:"CustomerSetup"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(f.B,{defaultActiveKey:p,animation:!1,id:"CustomerEditTabs",onSelect:this.handleSelectTab},!h.isEmpty()&&r.a.createElement(f.z,{title:"Customer Details",eventKey:1,key:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Yd,{customer:t,action:c,supportedGateways:s,onChange:this.onChangeCustomerField,onRemoveField:this.onRemoveCustomerField,onChangePaymentGateway:this.onClickChangePaymentGateway}))),"create"!==c&&!y.isEmpty()&&r.a.createElement(f.z,{title:"Subscribers",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(wm,{aid:u,settings:y,allPlans:i,allServices:o,onSaveSubscription:this.onSaveSubscription,defaultListFields:n,getSubscription:this.getSubscription,clearRevisions:this.clearSubscriptionRevisions,clearList:this.clearSubscriptions}))),"create"!==c&&r.a.createElement(f.z,{title:"Postpaid Counters",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Dm,{aid:u}))),"create"!==c&&r.a.createElement(f.z,{title:"Prepaid Counters",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Um,{aid:u}))),d&&r.a.createElement(f.z,{title:"Allowances",eventKey:5},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Fm,{customer:t,currency:l,onChange:this.onChangeCustomerField})))))),m&&r.a.createElement(v,{onClickSave:this.onSaveCustomer,onClickCancel:this.handleBack}))}}]),t}(a.Component);Vm.defaultProps={activeTab:1,customer:g.c.Map(),subscription:g.c.Map(),settings:g.c.Map(),gateways:g.c.List(),plans:g.c.List(),services:g.c.List(),currency:"",defaultSubsctiptionListFields:["sid","firstname","lastname","plan","plan_activation","services","address"],allowancesEnabled:!1};var Bm=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,"customer"),customer:bo(e,t,"customer"),subscription:bo(e,t,"subscription"),mode:Co(e,t,"customer"),activeTab:mo(e,t),aid:e.entity.getIn(["customer","aid"])||void 0,settings:e.settings.get("subscribers")||void 0,allowancesEnabled:e.settings.getIn(["billrun","allowances","enabled"])||void 0,plans:e.list.get("available_plans")||void 0,services:e.list.get("available_services")||void 0,gateways:e.list.get("available_gateways")||void 0,currency:pa(e,t)||void 0,message:vo(e,t)}})(Vm)),qm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).parserUsegt=function(e){var t=e.get("rates",g.c.Map()).keySeq().first();return"undefined"!==typeof t?t:""},n.filterPlayField=function(e){var t=n.props.isPlaysEnabled;return"play"!==e.get("field_name","")||t},n.getProjectFields=function(){var e=n.props,t=e.fields,a=e.defaultListFields;return t.filter(function(e){return e.get("show_in_list",!1)||a.includes(e.get("field_name",""))}).reduce(function(e,t){return e.set(t.get("field_name"),1)},g.c.Map({})).toJS()},n.getFields=function(){var e=n.props,t=e.fields,a=e.defaultListFields;return t.filter(n.filterPlayField).filter(function(e){return e.get("show_in_list",!1)||a.includes(e.get("field_name",""))}).map(function(e){var t=e.get("field_name");switch(t){case"rates":return{id:"unit_type",parser:n.parserUsegt};case"description":return{id:t,title:"Title",sort:!0};case"key":return{id:t,title:"Key",sort:!0};default:var a=e.get("title",e.get("field_name",""));return{id:t,title:L.a.sentenceCase(a)}}}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(kl("rates.fields"))}},{key:"render",value:function(){return null===this.props.fields?r.a.createElement(_,null):r.a.createElement(Tp,{collection:"rates",itemType:"product",itemsType:"products",filterFields:t.filterFields,tableFields:this.getFields(),projectFields:this.getProjectFields(),showRevisionBy:"key",actions:t.rowActions})}}]),t}(a.Component);qm.defaultProps={fields:null,isPlaysEnabled:!1,defaultListFields:["description","key","rates"]},qm.rowActions=[{type:"edit"},{type:"view"}],qm.filterFields=[{id:"key",placeholder:"Key"},{id:"description",placeholder:"Title"}];var zm=Object(s.f)(Object(l.connect)(function(e,t){return{fields:e.settings.getIn(["rates","fields"])||void 0,isPlaysEnabled:oa(e,t)}})(qm)),Hm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={fromError:"",toError:"",intervalError:"",priceError:""},n.onEditFrom=function(e){var t=n.props.index,a=e.target.value,r="";""===a?r="Required":Number.isInteger(Number(a))&&Number(a)>0?a=Number(a):r="Must be a positive integer",n.setState({fromError:r}),n.props.onProductEditRate(t,"from",a)},n.onEditTo=function(e){var t=n.props,a=t.index,r=t.productUnlimitedValue,i=t.item,o=e.target.value,l="";""===o?l="Required":r!==o&&Number.isInteger(Number(o))&&Number(o)>0?(o=Number(o))<=i.get("from",0)&&(l='Must be greater than "From"'):l="Must be a positive integer",n.setState({toError:l}),n.props.onProductEditRate(a,"to",o)},n.onEditInterval=function(e){var t=n.props.index,a=e.target.value,r="";""===a?r="Required":Number.isInteger(Number(a))&&Number(a)>0?a=Number(a):r="Must be a positive integer",n.setState({intervalError:r}),n.props.onProductEditRate(t,"interval",a)},n.onEditPrice=function(e){var t=n.props.index,a=e.target.value,r="";""===a?r="Required":x()(a)||(r="Must be number"),n.setState({priceError:r});var i=x()(a)?parseFloat(a):a;n.props.onProductEditRate(t,"price",i)},n.onRemoveItem=function(){var e=n.props.index;n.props.onProductRemoveRate(e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,a=n.item,r=n.mode,i=n.unit,o=r!==e.mode,l=i!==e.unit;return!g.c.is(a,e.item)||o||l}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.index,a=e.count,i=e.productUnlimitedValue,o=e.mode,l=e.unit,s=0===n,c=0===a||a-1===n,u=Number(t.get("from",0)),p=t.get("to",""),d=p===i?"Infinite":p,m="view"!==o,g=""!==l?"(".concat(l,")"):"";return r.a.createElement(f.y,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:2,xs:6,className:"col-xs-pr5"},r.a.createElement(f.l,{validationState:this.state.fromError.length>0?"error":null,style:{margin:0}},s&&r.a.createElement(f.h,null,"From ".concat(g)),r.a.createElement(Tn,{value:u,disabled:!0,editable:m}),this.state.fromError.length>0?r.a.createElement(f.n,null,this.state.fromError):"")),r.a.createElement(f.g,{sm:2,xs:6},r.a.createElement(f.l,{validationState:this.state.toError.length>0?"error":null,style:{margin:0}},s&&r.a.createElement(f.h,null,"To ".concat(g)),p===i?r.a.createElement(Tn,{value:d,disabled:!0,editable:m}):r.a.createElement(Tn,{value:d,onChange:this.onEditTo,fieldType:"number",min:0,editable:m}),this.state.toError.length>0?r.a.createElement(f.n,null,this.state.toError):"")),r.a.createElement(f.g,{sm:3,xs:6,className:"col-xs-pr5"},r.a.createElement(f.l,{validationState:this.state.intervalError.length>0?"error":null,style:{margin:0}},s&&r.a.createElement(f.h,null,"Interval ".concat(g)),r.a.createElement(Tn,{value:t.get("interval",""),onChange:this.onEditInterval,fieldType:"number",min:0,editable:m}),this.state.intervalError.length>0?r.a.createElement(f.n,null,this.state.intervalError):"")),r.a.createElement(f.g,{sm:3,xs:6},r.a.createElement(f.l,{validationState:this.state.priceError.length>0?"error":null,style:{margin:0}},s&&r.a.createElement(f.h,null,"Price Per Interval"),r.a.createElement(Tn,{value:t.get("price",""),onChange:this.onEditPrice,fieldType:"price",editable:m}),this.state.priceError.length>0?r.a.createElement(f.n,null,this.state.priceError):"")),r.a.createElement(f.g,{xs:2,className:"text-left actions"},n>0&&c&&m&&r.a.createElement(f.c,{onClick:this.onRemoveItem,bsSize:"small"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"})," \xa0Remove")),!c&&r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,xs:12},r.a.createElement("hr",{style:{marginTop:8,marginBottom:8}})))}}]),t}(a.Component);Hm.defaultProps={productUnlimitedValue:ee("productUnlimitedValue","UNLIMITED"),mode:"create",unit:""};var Ym=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={errors:{name:""},newProductParam:!1,unit:null},n.onChangeName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=ee("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.onFieldUpdate(["key"],r)},n.onChangePlay=function(e){n.props.onFieldUpdate(["play"],e)},n.onChangeDescription=function(e){var t=e.target.value;n.props.onFieldUpdate(["description"],t)},n.onChangeAddToRetail=function(e){var t=e.target.value;n.props.onFieldUpdate(["add_to_retail"],t)},n.onChangeUsaget=function(e){var t=n.props.usaget;n.props.onUsagetUpdate(["rates"],t,e)},n.onChangeUnit=function(e,t){var a=n.props,r=a.product,i=a.planName,o=a.usaget,l=["rates",t||o,i,"rate"],s=r.getIn(l,g.c.List());n.setState({unit:e}),s.forEach(function(t,a){var r=[].concat(l,[a,"uom_display","range"]),i=[].concat(l,[a,"uom_display","interval"]);n.props.onFieldUpdate(r,e),n.props.onFieldUpdate(i,e)})},n.onChangePricingMethod=function(e){var t=e.target.value;n.props.onFieldUpdate(["pricing_method"],t)},n.onProductRateUpdate=function(e,t,a){var r=n.props,i=r.planName,o=r.usaget;switch(t){case"to":var l=["rates",o,i,"rate"];n.props.onToUpdate(l,e,a);break;default:var s=["rates",o,i,"rate",e,t];n.props.onFieldUpdate(s,a)}},n.onProductRateAdd=function(){var e=n.props,t=e.planName,a=["rates",e.usaget,t,"rate"];n.props.onProductRateAdd(a)},n.onProductRateRemove=function(e){var t=n.props,a=t.planName,r=["rates",t.usaget,a,"rate"];n.props.onProductRateRemove(r,e)},n.onChangeTariffCategory=function(e,t){n.isRetailRate(t)?n.setRetailRate():n.setRetailRate(!1),n.onChangeAdditionalField(e,t)},n.onChangeAdditionalField=function(e,t){n.props.onFieldUpdate(e,t)},n.onRemoveAdditionalField=function(e){n.props.onFieldRemove(e)},n.isRetailRate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=n.props.product,a=null===e?t.get("tariff_category"):e;return"retail"===a},n.setRetailRate=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n.onChangeAddToRetail({target:{value:e}})},n.filterCustomFields=function(e){return function(t){var n=t.get("field_name",""),a=e.includes(n);return(!n.startsWith("params.")&&"tariff_category"!==t.get("field_name","")||a)&&!1!==t.get("display",!1)&&!1!==t.get("editable",!1)}},n.filterTariffCategory=function(e){return"tariff_category"===e.get("field_name","")&&!1!==e.get("display",!1)&&!1!==e.get("editable",!1)},n.renderPrices=function(){var e=n.props,t=e.product,a=e.planName,i=e.usaget,o=e.mode,l=["rates",i,a,"rate"],s=t.getIn(l,g.c.List());return s.map(function(e,t){return r.a.createElement(Hm,{mode:o,count:s.size,index:t,item:e,key:t,unit:n.getUnitLabel(),onProductEditRate:n.onProductRateUpdate,onProductRemoveRate:n.onProductRateRemove})})},n.getUnit=function(){var e=n.props,t=e.product,a=e.usaget,r=n.state.unit;return null===r?t.getIn(["rates",a,"BASE","rate",0,"uom_display","range"],""):r},n.getUnitLabel=function(){var e=n.props,t=e.propertyTypes,a=e.usageTypesData,r=e.usaget;return je(t,a,r,n.getUnit())},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.product,n=e.planName,a=["rates",e.usaget,n,"rate"];0===t.getIn(a,g.c.List()).size&&this.props.onProductRateAdd(a)}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.product,a=t.usaget,i=t.mode,o=t.ratingParams,l=this.getUnit(),s=n.get("pricing_method",""),c="view"!==i;return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,null,r.a.createElement(Fp,{entity:n,editable:c&&"create"===i,onChange:this.onChangePlay}),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("description",ne("service"),Object(D.sentenceCase)("title")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ao,{contents:Vo.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{onChange:this.onChangeDescription,value:n.get("description",""),editable:c}))),["clone","create"].includes(i)&&r.a.createElement(f.l,{validationState:e.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("key",ne("service"),Object(D.sentenceCase)("key")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ao,{contents:Vo.key})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{onChange:this.onChangeName,value:n.get("key",""),disabled:!["clone","create"].includes(i),editable:c}),e.name.length>0&&r.a.createElement(f.n,null,e.name))),r.a.createElement(Fd,{entityName:"rates",entity:n,onChangeField:this.onChangeTariffCategory,onRemoveField:this.onRemoveAdditionalField,fieldsFilter:this.filterTariffCategory,editable:c}),!this.isRetailRate()&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("add_to_retail",ne("product"),Object(D.sentenceCase)("add to retail")),r.a.createElement(Ao,{contents:Vo.addToRetail})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"checkbox",onChange:this.onChangeAddToRetail,value:n.get("add_to_retail",!1),editable:c}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("usage_type",ne("product"),"Unit Type"),r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},c&&["clone","create"].includes(i)?r.a.createElement(Dp,{usaget:a,unit:l,onChangeUsaget:this.onChangeUsaget,onChangeUnit:this.onChangeUnit}):r.a.createElement("div",null,r.a.createElement(f.g,{sm:3,style:{paddingTop:7}},a),r.a.createElement(f.g,{sm:4,componentClass:f.h,className:"pr0 pl0"},"Units of Measure"),r.a.createElement(f.g,{sm:5,className:"pr0"},r.a.createElement(Dp,{usaget:a,unit:l,onChangeUsaget:this.onChangeUsaget,onChangeUnit:this.onChangeUnit,showSelectTypes:!1,editable:"view"!==i}))))),r.a.createElement(Fd,{entityName:"rates",entity:n,onChangeField:this.onChangeAdditionalField,onRemoveField:this.onRemoveAdditionalField,highlightParams:o,editable:c})),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Pricing")},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},c?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"inline mr10"},r.a.createElement(Tn,{fieldType:"radio",name:"pricing-method",id:"pricing-method-tiered",value:"tiered",checked:"tiered"===s,onChange:this.onChangePricingMethod,label:"Tiered pricing",className:"inline"}),"\xa0",r.a.createElement(Ao,{contents:Vo.tieredPricing})),r.a.createElement("div",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",name:"pricing-method",id:"pricing-method-volume",value:"volume",checked:"volume"===s,onChange:this.onChangePricingMethod,label:"Volume pricing",className:"inline"}),"\xa0",r.a.createElement(Ao,{contents:Vo.volumePricing}))):r.a.createElement("div",{className:"non-editable-field"},"tiered"===s?"Tiered pricing":"Volume pricing"))),r.a.createElement(f.g,{sm:12},this.renderPrices()),c&&r.a.createElement(ct,{onClick:this.onProductRateAdd,label:"Add New"})))))}}]),t}(a.Component);Ym.defaultProps={usageTypesData:g.c.List(),propertyTypes:g.c.List(),ratingParams:g.c.List(),planName:"BASE",product:g.c.Map(),usaget:void 0,errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var Gm=Object(l.connect)(function(e,t){return{usageTypesData:ha(e,t),propertyTypes:va(e,t)}})(Ym),Km=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getFilterFields=function(){return[{id:"description",placeholder:"Title"},{id:"key",placeholder:"Key"}]},n.filterPlayField=function(e){var t=n.props.isPlaysEnabled;return"play"!==e.get("field_name","")||t},n.getFields=function(){var e=n.props,t=e.fields,a=e.defaultListFields;return t.filter(n.filterPlayField).filter(function(e){return e.get("show_in_list",!1)||a.includes(e.get("field_name",""))}).map(function(e){var t=e.get("field_name");switch(t){case"description":return{id:t,title:"Title",sort:!0};case"rate":return{id:t,title:"Rate",sort:!0,type:"percentage"};case"key":return{id:t,title:"Key",sort:!0};default:var n=e.get("title",e.get("field_name",""));return{id:t,title:L.a.sentenceCase(n)}}}).toArray()},n.getProjectFields=function(){var e=n.props,t=e.fields,a=e.defaultListFields;return t.filter(function(e){return e.get("show_in_list",!1)||a.includes(e.get("field_name",""))}).reduce(function(e,t){return e.set(t.get("field_name"),1)},g.c.Map({})).toJS()},n.getActions=function(){return[{type:"edit"}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(kl("taxes.fields"))}},{key:"render",value:function(){return null===this.props.fields?r.a.createElement(_,null):r.a.createElement(Tp,{itemsType:ee(["systemItems","tax","itemsType"],""),itemType:ee(["systemItems","tax","itemType"],""),filterFields:this.getFilterFields(),tableFields:this.getFields(),projectFields:this.getProjectFields(),showRevisionBy:"key",actions:this.getActions()})}}]),t}(a.Component);Km.defaultProps={defaultListFields:["key","description","rate"],fields:null,isPlaysEnabled:!1};var Wm=Object(l.connect)(function(e,t){return{fields:e.settings.getIn(["taxes","fields"])||void 0,isPlaysEnabled:oa(e,t)}})(Km),Jm=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:{key:""}},n.onChangeKey=function(e){var t=n.props.errorMessages.key.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=ee("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{key:i})}),n.props.onFieldUpdate(["key"],r)},n.onChangeDescription=function(e){var t=e.target.value;n.props.onFieldUpdate(["description"],t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,e.item)||this.props.mode!==e.mode}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.item,a=t.mode,i="view"!==a;return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("description",ne("tax"),Object(D.sentenceCase)("title")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ao,{contents:Ho.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.get("description",""),onChange:this.onChangeDescription,editable:i}))),["clone","create"].includes(a)&&r.a.createElement(f.l,{validationState:e.key.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("key",ne("tax"),Object(D.sentenceCase)("key")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ao,{contents:Ho.key})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.get("key",""),onChange:this.onChangeKey,editable:i}),e.key.length>0&&r.a.createElement(f.n,null,e.key))),r.a.createElement(Fd,{entityName:"taxes",entity:n,onChangeField:this.props.onFieldUpdate,onRemoveField:this.props.onFieldRemove,editable:i}))}}]),t}(a.Component);Jm.defaultProps={errorMessages:{key:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var $m=Jm,Qm=function(e){return Xl("tax",function(e){return yi("taxes",e)}(e))},Zm=function(e,t){return $l("taxes",e,t)},Xm=function(e,t){return zl("tax",e,t)},eg=function(){return Kl("tax","tax")},tg=function(e){return Hl("tax",e)},ng=function(){return up("taxes")},ag=function(e){return dp("taxes","key",e)},rg=function(e){return sp("taxes",e)},ig=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={progress:!1},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t||"closeandnew"===t&&ce(a,"from").isBefore(S()())){var r=S()().add(1,"days").toISOString();n.onChangeFieldValue(["from"],r)}"clone"===t&&n.props.dispatch(eg())},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&ue(t,!1)){var a=t.get("key","");n.props.dispatch(ag(a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Qm(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("key","");n.props.dispatch(rg(e))},n.clearItemsList=function(){var e=ee(["systemItems","tax","itemsType"],"");n.props.dispatch(ng(e))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onRemoveFieldValue=function(e){n.props.dispatch(tg(e))},n.onChangeFieldValue=function(e,t){var a=n.props,r=a.deletePathOnEmptyValue,i=a.deletePathOnNullValue,o=Array.isArray(e)?e.join("."):e;""===t&&r.includes(o)?n.props.dispatch(tg(e)):null===t&&i.includes(o)?n.props.dispatch(tg(e)):n.props.dispatch(Xm(e,t))},n.afterSave=function(e){n.setState({progress:!1});var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Ur("The tax was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.setState({progress:!0}),n.props.dispatch(Zm(t,a)).then(n.afterSave)},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=ee(["systemItems","tax","itemsType"],"");e&&n.clearItemsList(),n.props.router.push("/".concat(t))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.mode;if(this.fetchItem(),"create"===e){var t=se(e,"tax");this.props.dispatch(bs(t))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||ue(t)!==ue(i)){var s=se(n,"tax",t);this.props.dispatch(bs(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Wl("tax"))}},{key:"render",value:function(){var e=this.state.progress,t=this.props,n=t.item,a=t.mode,i=t.revisions;if("loading"===a)return r.a.createElement(_,{onClick:this.handleBack});var o="view"!==a;return r.a.createElement("div",{className:"tax-setup"},r.a.createElement(f.v,null,r.a.createElement(Sd,{itemName:"tax",revisions:i,item:n,mode:a,onChangeFrom:this.onChangeFieldValue,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.v,null,r.a.createElement($m,{item:n,mode:a,onFieldUpdate:this.onChangeFieldValue,onFieldRemove:this.onRemoveFieldValue})),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!o,cancelLabel:o?void 0:"Back",progress:e}))}}]),t}(a.Component);ig.defaultProps={item:g.c.Map(),revisions:g.c.List(),deletePathOnEmptyValue:[],deletePathOnNullValue:[]};var og=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,"tax"),item:bo(e,t,"tax"),mode:Co(e,t,"tax"),revisions:po(e,t,"tax")}})(ig)),lg=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={dirty:!1,progress:!1},n.removePriorityUIFlags=function(){var e=n.props.taxMapping.withMutations(function(e){e.forEach(function(t,n){t.get("priorities",Object(g.a)()).forEach(function(t,a){t.has("uiFlag")&&e.deleteIn([n,"priorities",a,"uiFlag"])})})});n.props.dispatch(yl("taxation",["mapping"],e))},n.setPageTitle=function(e){if(1===e.size){var a="".concat(t.pageTitle," | ").concat(Object(D.titleCase)(e.keySeq().first("Priorities")));n.props.dispatch(bs(a))}else n.props.dispatch(bs(t.pageTitle))},n.afterSave=function(e){!0===e||[1,2].includes(e.status)?n.setState(function(){return{progress:!1,dirty:!1}}):n.setState(function(){return{progress:!1}})},n.onSave=function(){n.state.dirty&&(n.setState(function(){return{progress:!0}}),n.removePriorityUIFlags(),n.props.dispatch(Tl("taxation.mapping")).then(n.afterSave))},n.onCancel=function(){n.state.dirty&&(n.setState(function(){return{progress:!0,dirty:!1}}),n.props.dispatch(kl("taxation.mapping")).then(n.afterSave))},n.onUpdate=function(e,t){n.setState(function(){return{dirty:!0}}),n.props.dispatch(yl("taxation",["mapping"].concat(Object(N.a)(e)),t))},n.onAdd=function(e,t){n.setState(function(){return{dirty:!0}}),n.props.dispatch(bl("taxation",t,["mapping"].concat(Object(N.a)(e))))},n.onRemove=function(e){n.setState(function(){return{dirty:!0}}),n.props.dispatch(El("taxation",["mapping"].concat(Object(N.a)(e))))},n.renderPriority=function(e,t){var a=n.props,i=a.type,o=a.lineKeyOptions,l=a.taxParamsKeyOptions,s=a.conditionFieldsOptions,c=a.valueWhenOptions;return r.a.createElement(il,{type:i,category:e,priorities:t,lineKeyOptions:o,paramsKeyOptions:l,conditionFieldsOptions:s,valueWhenOptions:c,onAdd:n.onAdd,onRemove:n.onRemove,onUpdate:n.onUpdate})},n.renderTabs=function(){var e=n.props,t=e.taxMapping,a=e.location;if(t.size<1)return r.a.createElement("p",null,"No Tax mapping categories");if(1===t.size){var i=t.keySeq().first(""),o=t.first(Object(g.b)());return n.renderPriority(i,o)}return r.a.createElement(No,{id:"TaxTabs",location:a},t.map(function(e,t){return r.a.createElement(f.z,{title:Object(D.titleCase)(t),eventKey:t},"this.renderPriority(category, priorities);")}).toArray())},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.taxMapping;this.props.dispatch(kl(["taxation.mapping","taxes.fields","lines.fields"])),this.setPageTitle(e)}},{key:"componentDidUpdate",value:function(e){var t=this.props.taxMapping;t.size!==e.taxMapping.size&&this.setPageTitle(t)}},{key:"componentWillUnmount",value:function(){this.state.dirty&&this.props.dispatch(kl("tax"))}},{key:"render",value:function(){var e=this.state,t=e.dirty,n=e.progress,a=this.renderTabs();return r.a.createElement(r.a.Fragment,null,a,r.a.createElement("hr",null),r.a.createElement(v,{onClickCancel:this.onCancel,disableCancel:!t,onClickSave:this.onSave,disableSave:!t,progress:n,disabled:!t}))}}]),t}(a.PureComponent);lg.defaultProps={type:"tax",taxMapping:Object(g.b)(),lineKeyOptions:[],conditionFieldsOptions:[],valueWhenOptions:[]},lg.pageTitle="Global Tax Mapping Rules";var sg=Object(l.connect)(function(e,t){return{lineKeyOptions:Qa(e,t),taxParamsKeyOptions:Wa(e,t),conditionFieldsOptions:Ja(e,t),valueWhenOptions:$a(e,t),taxMapping:$n(e,t)}})(lg),cg=function(e){var t=e.tax,n=e.disabled,i=e.itemName,o=e.typeOptions,l=e.taxRateOptions,s=e.onUpdate,c=Object(a.useCallback)(function(e){s(["custom_tax"],e)},[s]),u=Object(a.useCallback)(function(e){var n=e.target.value;"custom"===n&&""===t.get("custom_logic","")&&s(["custom_logic"],"override"),s(["taxation"],n)},[s,t]),p=Object(a.useCallback)(function(e){var t=e.target.value;s(["custom_logic"],t)},[s]),d=Object(a.useMemo)(function(){return o.map(he).toArray()},[o]),m=Object(a.useMemo)(function(){return l.map(function(e){return{label:e.get("description",""),value:e.get("key","")}}).toArray()},[l]),g=Object(a.useMemo)(function(){return ee(["systemItems",i,"itemName"],"")},[i]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("type",ne(i),Object(D.sentenceCase)("type"))),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",value:t.get("type",""),onChange:c,options:d,disabled:n,editable:!1}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2}),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"radio",onChange:u,checked:"no"===t.get("taxation",""),value:"no",label:"".concat(Object(D.titleCase)(g)," isn't subject to taxation"),disabled:n}),r.a.createElement(Tn,{fieldType:"radio",onChange:u,checked:"global"===t.get("taxation",""),value:"global",label:"Use global mapping rules",disabled:n}),r.a.createElement("div",{className:"clearfix"},r.a.createElement(Tn,{fieldType:"radio",onChange:u,checked:"custom"===t.get("taxation",""),value:"custom",label:"".concat(Object(D.titleCase)(g)," implies a specific tax rate").concat("custom"===t.get("taxation","")||""!==t.get("custom_tax","")?": ":""),className:"pull-left mr5",disabled:n}),r.a.createElement(Tn,{fieldType:"select",value:t.get("custom_tax",""),onChange:c,options:m,editable:"custom"===t.get("taxation","")&&!n})),"custom"===t.get("taxation","")&&r.a.createElement(f.l,{className:"mb0"},r.a.createElement(f.g,{smOffset:2,xsOffset:1},r.a.createElement(Tn,{fieldType:"radio",onChange:p,checked:"override"===t.get("custom_logic",""),value:"override",label:"Override global mapping rules",disabled:n}),r.a.createElement(Tn,{fieldType:"radio",onChange:p,checked:"fallback"===t.get("custom_logic",""),value:"fallback",label:"Apply if tax rate not found via global mapping rules",disabled:n}))),r.a.createElement(Tn,{fieldType:"radio",onChange:u,checked:"default"===t.get("taxation",""),value:"default",label:"Use default tax rate",disabled:n}))))};cg.defaultProps={tax:Object(g.b)(),disabled:!1,itemName:"",typeOptions:Object(g.a)([Object(g.b)({id:"vat",title:"Vat"})]),taxRateOptions:Object(g.a)()};var ug=cg,pg=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).initDefaultValues=function(){n.props.tax.isEmpty()&&n.props.onFieldUpdate(["tax"],Object(g.a)([t.defaultTax]))},n.onUpdateTax=function(e,t){n.props.onFieldUpdate(["tax",0].concat(Object(N.a)(e)),t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.loadRates(),this.initDefaultValues()}},{key:"componentWillUnmount",value:function(){this.props.clearRates()}},{key:"render",value:function(){var e=this,t=this.props,n=t.tax,a=t.mode,i=t.itemName,o=t.typeOptions,l=t.taxRateOptions,s="view"===a;return r.a.createElement(f.j,{horizontal:!0},n.map(function(t,n){return r.a.createElement(ug,{key:n,tax:t,itemName:i,typeOptions:o,taxRateOptions:l,disabled:s,onUpdate:e.onUpdateTax})}))}}]),t}(a.PureComponent);pg.defaultProps={tax:Object(g.a)(),mode:"",itemName:"",typeOptions:Object(g.a)([Object(g.b)({id:"vat",title:"Vat"})]),taxRateOptions:Object(g.a)()},pg.defaultTax=Object(g.b)({type:"vat",taxation:"global"});var dg=Object(l.connect)(function(e,t){return{taxRateOptions:e.list.get("available_taxRates")}},function(e){return{loadRates:function(){return e(eo("available_taxRates",bi("taxes",{key:1,description:1})))},clearRates:function(){return e(Xi("available_taxRates"))}}})(pg),mg=function(e,t){return{type:"PRODUCT_UPDATE_FIELD_VALUE",path:e,value:t}},gg=function(e){return{type:"PRODUCT_DELETE_FIELD",path:e}},fg=function(e,t,n){return{type:"PRODUCT_UPDATE_TO_VALUE",path:e,index:t,value:n}},hg=function(e,t,n){return{type:"PRODUCT_UPDATE_USAGET_VALUE",path:e,oldUsaget:t,newUsaget:n}},vg=function(e){return{type:"PRODUCT_ADD_RATE",path:e}},yg=function(e,t){return{type:"PRODUCT_REMOVE_RATE",path:e,index:t}},bg=function(){return{type:"PRODUCT_CLONE_RESET",uniquefields:["key"]}},Eg=function(e,t){return function(n,a){var r=a(),i=ha(r),o=va(r),l=Ne(o,i,e,!0),s=e.withMutations(function(e){l.isEmpty()||e.set("rates",l)});return n($l("rates",s,t))}},Cg=function(e){return function(t,n){t(jr());var a=function(e){return yi("rates",e)}(e);return ei(a).then(function(e){var a=e.data[0].data.details[0];a.originalValue=a.from;var r=n(),i=ha(r),o=va(r),l=g.c.fromJS(a),s=Ne(o,i,l,!1),c=l.withMutations(function(e){s.isEmpty()||e.set("rates",s)}).toJS();return t(function(e){return{type:"PRODUCT_GOT",product:e}}(c)),t(Wr(e))}).catch(function(e){return t(Jr(e,"Error retrieving product"))})}},_g=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab)},n.initDefaultValues=function(){var e=n.props,t=e.mode;if(null===e.item.get("pricing_method",null)&&n.props.dispatch(mg(["pricing_method"],"tiered")),"create"===t){var a=S()().add(1,"days").toISOString();n.props.dispatch(mg(["from"],a))}"clone"===t&&n.props.dispatch(bg())},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&t.getIn(["_id","$id"],!1)){var a=t.get("key","");n.props.dispatch(dp("rates","key",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Cg(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("key","");n.props.dispatch(sp("rates",e))},n.clearItemsList=function(){n.props.dispatch(up("products"))},n.onFieldUpdate=function(e,t){n.props.dispatch(mg(e,t))},n.onFieldRemove=function(e){n.props.dispatch(gg(e))},n.onToUpdate=function(e,t,a){n.props.dispatch(fg(e,t,a))},n.onUsagetUpdate=function(e,t,a){n.props.dispatch(hg(e,t,a))},n.onProductRateAdd=function(e){n.props.dispatch(vg(e))},n.onProductRateRemove=function(e,t){n.props.dispatch(yg(e,t))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.afterSave=function(e){var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Ur("The product was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.props.dispatch(Eg(t,a)).then(n.afterSave)},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&n.clearItemsList();var a=ee(["systemItems",t.entityName,"itemsType"],"");n.props.router.push("/".concat(a))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if(this.props.dispatch(kl(["usage_types","file_types","property_types","subscribers.subscriber.fields","rates.fields"])),["clone","create"].includes(e)){var n=se(e,t.entityName);this.props.dispatch(bs(n))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var n=e.item,a=e.mode,r=e.itemId,i=this.props,o=i.item,l=i.itemId,s=i.mode;if(a!==s||ue(n)!==ue(o)){var c=se(a,t.entityName,n);this.props.dispatch(bs(c))}(r!==l||a!==s&&"clone"===a)&&this.fetchItem(r)}},{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,t.item)||!g.c.is(this.props.revisions,t.revisions)||this.props.activeTab!==e.activeTab||this.props.itemId!==e.itemId||this.props.mode!==e.mode}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"PRODUCT_CLEAR"})}},{key:"render",value:function(){var e=this.props,n=e.item,a=e.ratingParams,i=e.mode,o=e.revisions;if("loading"===i)return r.a.createElement(_,{onClick:this.handleBack});var l="view"!==i,s=Oe(n);return r.a.createElement("div",{className:"ProductSetup"},r.a.createElement(f.v,null,r.a.createElement(Sd,{revisions:o,item:n,mode:i,onChangeFrom:this.onFieldUpdate,itemName:"product",backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.v,null,r.a.createElement(Gm,{mode:i,onFieldUpdate:this.onFieldUpdate,onFieldRemove:this.onFieldRemove,onToUpdate:this.onToUpdate,onProductRateAdd:this.onProductRateAdd,onProductRateRemove:this.onProductRateRemove,onUsagetUpdate:this.onUsagetUpdate,planName:"BASE",product:n,usaget:s,ratingParams:a}),r.a.createElement(f.v,{header:"Tax"},r.a.createElement(dg,{tax:n.get("tax"),mode:i,itemName:t.entityName,onFieldUpdate:this.onFieldUpdate,onFieldRemove:this.onFieldRemove}))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!l,cancelLabel:l?void 0:"Back"}))}}]),t}(a.Component);_g.defaultProps={item:g.c.Map(),revisions:g.c.List(),ratingParams:g.c.List(),activeTab:1},_g.entityName="product";var Og=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,_g.entityName),item:bo(e,t,_g.entityName),mode:Co(e,t,_g.entityName),activeTab:mo(e,t,_g.entityName),revisions:po(e,t,_g.entityName),ratingParams:Jn(e,t)}})(_g)),Sg={SIMPLE:0,GROPED:1},Tg=function(){return{type:ql,collection:"reports",uniquefields:["key","user","creation_time"]}},kg=function(){return Wl("reports")},jg=function(e,t){return $l("reports",e,t)},Ig=function(e){return es("reports",e)},wg=function(e,t){return zl("reports",e,t)},Ng=function(e){return Hl("reports",e)},Fg=function(e){return function(t){t(jr());var n=function(e){return yi("reports",e)}(e);return ei(n).then(function(e){var n=e.data[0].data.details[0],a=ee(["reports","outputFormats"],g.c.List());if(n.formats){var r=n.formats.map(function(e){return a.find(function(t){return t.get("id")===e.op},null,g.c.Map()).has("valueTypes")?{field:e.field,op:e.op,value:e.value.substr(0,e.value.indexOf(" ")),type:e.value.substr(e.value.indexOf(" ")+1)}:e});n.formats=r}return t(Yl("reports",n)),t(Gl("reports",n)),t(Wr(e))}).catch(function(e){return t(Jr(e,"Error retrieving report"))})}},xg=function(e){return pp("reportData",function(e){var t=e.report,n=e.page,a=void 0===n?0:n,r=e.size,i=void 0===r?10:r;return{api:"report",params:[{action:"generateReport"},{report:JSON.stringify(t)},{page:a},{size:i}]}}(e))},Rg=function(){return up("reportData")},Mg=function(e){return op("reportData",e)},Pg=function(e){return rp("reportData",e)},Ag=function(){return eo("cycles_list",Di())},Dg=function(){return eo("available_plans",Ti())},Lg=function(){return eo("available_services",Ci())},Ug=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();if(e.isEmpty())return eo("all_rates",Oi());var t=qe(e);return eo(t,Oi({key:1,description:1},e))},Vg=function(){return function(e){return e(kl("usage_types"))}},Bg=function(){return eo("pp_includes",_i())},qg=function(){return function(e){return e(kl("file_types"))}},zg=function(){return function(e){return e(kl("events"))}},Hg=function(){return function(e){return e(kl("plays"))}},Yg=function(){return eo("available_taxRates",bi("taxes",{key:1,description:1}))},Gg=function(){return function(e){return ei(ji()).then(function(t){try{return e($i("available_groups",t.data[0].data.details)),e(Qi("available_groups",t.data[1].data.details)),e(Wr(t))}catch(n){throw new Error("Error retrieving list")}}).catch(function(t){return e(Jr(t,"Network error - please refresh and try again"))})}},Kg=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={itemToDelete:null,refreshString:""},n.parseEntityName=function(e){return Object(D.titleCase)(ee(["systemItems",e.get("entity",""),"itemName"],"entity"))},n.parseEntityType=function(e){return te("report_type_".concat(e.get("type")),"report")},n.parseUserName=function(e){return Object(D.titleCase)(e.get("user","-"))},n.getFilterFields=function(){return[{id:"key",placeholder:"Name"},{id:"user",placeholder:"User"}]},n.getTableFields=function(){return[{id:"key",title:"Name",sort:!0},{id:"entity",title:"Entity",sort:!0,parser:n.parseEntityName},{id:"type",title:"Type",sort:!0,parser:n.parseEntityType},{id:"user",title:"User",sort:!0,parser:n.parseUserName},{id:"from",title:"Modified",type:"date",cssClass:"short-date",sort:!0}]},n.getProjectFields=function(){return{key:1,entity:1,user:1,from:1,type:1}},n.onAskDelete=function(e){var t={message:'Are you sure you want to delete "'.concat(e.get("key",""),'" report ?'),onOk:n.onDeleteOk,labelOk:"Delete",type:"delete",onCancel:n.onDeleteClose};n.props.dispatch(ks(t)),n.setState({itemToDelete:e})},n.onDeleteClose=function(){n.setState({itemToDelete:null})},n.onDeleteOk=function(){var e=n.state.itemToDelete;n.props.dispatch(Ig(e)).then(n.afterDelete)},n.afterDelete=function(e){n.onDeleteClose(),e.status&&(n.props.dispatch(Ur("The report was deleted")),n.setState({refreshString:S()().format()}))},n.onClone=function(e){var t=ue(e,""),a=ee(["systemItems","report","itemType"],""),r=ee(["systemItems","report","itemsType"],"");n.props.router.push({pathname:"".concat(r,"/").concat(a,"/").concat(t),query:{action:"clone"}})},n.getActions=function(){return[{type:"view",onClickColumn:null},{type:"edit"},{type:"clone",showIcon:!0,onClick:n.onClone,helpText:"Clone"},{type:"remove",showIcon:!0,onClick:n.onAskDelete,helpText:"Remove"}]},n.getDefaultSort=function(){return g.c.Map({creation_time:-1})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.refreshString,t=this.getFilterFields(),n=this.getTableFields(),a=this.getActions(),i=this.getProjectFields(),o=this.getDefaultSort();return r.a.createElement(Tp,{collection:"reports",itemType:"report",itemsType:"reports",api:"get",filterFields:t,tableFields:n,projectFields:i,actions:a,refreshString:e,defaultSort:o})}}]),t}(a.Component);Kg.defaultProps={};var Wg=Object(s.f)(Object(l.connect)()(Kg)),Jg=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeTitle=function(e){var t=e.target.value;n.props.onChangeKey(t)},n.onChangeEntity=function(e){n.props.onChangeEntity(e)},n.getEntityOptions=function(){return n.props.entities.map(function(e){return g.c.Map({value:e,label:Object(D.upperCaseFirst)(ee(["systemItems",e,"itemName"],e))})}).map(fe).toArray()},n.onChangeTypeGrouped=function(){n.props.onChangeType(Sg.GROPED)},n.onChangeTypeSimple=function(){n.props.onChangeType(Sg.SIMPLE)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.title,a=t.entity,r=t.mode,i=t.type;return n!==e.title||a!==e.entity||r!==e.mode||i!==e.type}},{key:"render",value:function(){var e=this.props,t=e.title,n=e.entity,a=e.type,i="view"===e.mode,o=this.getEntityOptions(),l=a===Sg.GROPED;return r.a.createElement("div",null,r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Name"),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{onChange:this.onChangeTitle,value:t,disabled:i})))),r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Entity"),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{fieldType:"select",options:o,value:n,onChange:this.onChangeEntity,disabled:i})))),r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Report Type"),r.a.createElement(f.g,{sm:3,key:"pricing-method-1"},r.a.createElement("div",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",name:"report-method",id:"report-method-simple",value:"simple",checked:!l,onChange:this.onChangeTypeSimple,label:te("report_type_".concat(Sg.SIMPLE),"report")})),"\xa0",r.a.createElement(Ao,{contents:qo.method_simple})),r.a.createElement(f.g,{sm:3,key:"pricing-method-2"},r.a.createElement("div",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",name:"report-method",id:"report-method-grouped",value:"grouped",checked:l,onChange:this.onChangeTypeGrouped,label:te("report_type_".concat(Sg.GROPED),"report")})),"\xa0",r.a.createElement(Ao,{contents:qo.method_grouped})))))}}]),t}(a.Component);Jg.defaultProps={title:"",entity:"",entities:g.c.List(),type:0,mode:"update",onChangeKey:function(){},onChangeEntity:function(){},onChangeType:function(){}};var $g=Jg,Qg=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).initFieldOptions=function(e,t){if(e.hasIn(["inputConfig","callback"])&&t.isEmpty())switch(e.getIn(["inputConfig","callback"])){case"getCyclesOptions":n.props.dispatch(Ag());break;case"getPlansOptions":n.props.dispatch(Dg());break;case"getProductsOptions":n.props.dispatch(Ug(e.getIn(["inputConfig","callbackArgument"],g.c.Map())));break;case"getServicesOptions":n.props.dispatch(Lg());break;case"getGroupsOptions":n.props.dispatch(Gg());break;case"getUsageTypesOptions":n.props.dispatch(Vg());break;case"getBucketsOptions":case"getBucketsExternalIdsOptions":n.props.dispatch(Bg());break;case"getFileTypeOptions":n.props.dispatch(qg());break;case"getPlayTypeOptions":n.props.dispatch(Hg());break;case"getEventCodeOptions":n.props.dispatch(zg());break;case"getTaxesOptions":n.props.dispatch(Yg());break;default:console.log("unsupported select options callback")}},n.onChangeText=function(e){var t=e.target.value;n.props.onChange(t)},n.onChangeSelect=function(e){n.props.onChange(e)},n.onChangeBoolean=function(e){var t=""===e?"":[1,"1","true",!0,"yes","on"].includes(e);n.props.onChange(t)},n.onChangeNumber=function(e){var t=e.target.value,a=Number(t);isNaN(a)?n.props.onChange(t):n.props.onChange(a)},n.onChangeMultiValues=function(e){Array.isArray(e)?n.props.onChange(e.join(",")):n.props.onChange("")},n.onChangeDate=function(e){if(S.a.isMoment(e)&&e.isValid()){var t=ee("apiDateTimeFormat","YYYY-MM-DD");n.props.onChange(e.format(t))}else n.props.onChange(null)},n.onChangeDateTime=function(e){if(S.a.isMoment(e)&&e.isValid()){var t=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");n.props.onChange(e.format(t))}else n.props.onChange(null)},n.getOptionsValues=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return n.props.operator.get("options",e).map(fe).toArray()},n.formatValueTagDateTime=function(e){return S()(e).format(ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"))},n.formatValueTagDate=function(e){return S()(e).format(ee("dateFormat","DD/MM/YYYY"))},n.renderCustomInputDate=function(e){var t=e.addTag,n=e.disabled,a=ee("apiDateTimeFormat","YYYY-MM-DD");return r.a.createElement("span",{className:"custom-field-input"},r.a.createElement(Tn,{fieldType:"date",value:null,onChange:function(e){t(e.format(a))},disabled:n}))},n.renderCustomInputDateTime=function(e){var t=e.addTag,n=e.disabled,a=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");return r.a.createElement("span",{className:"custom-field-input"},r.a.createElement(Tn,{fieldType:"datetime",value:null,onChange:function(e){t(e.format(a))},disabled:n}))},n.renderCustomInputNumber=function(e){e.addTag;var t=e.onChange,n=e.value,a=Object(mt.a)(e,["addTag","onChange","value"]);return r.a.createElement("input",Object.assign({type:"number",onChange:t,value:n},a))},n.renderInputBoolean=function(){var e=n.props,t=e.field,a=e.disabled,i="";!0===t.get("value",!1)?i="yes":!1===t.get("value",!0)&&(i="no");var o=n.getOptionsValues(g.c.List(["yes","no"]));return r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:o,value:i,onChange:n.onChangeBoolean,disabled:a})},n.renderInputSelect=function(){var e=n.props,t=e.field,a=e.disabled,i=e.config,o=e.selectOptions,l=e.operator,s=g.c.List().withMutations(function(e){i.hasIn(["inputConfig","callback"])&&o.forEach(function(t){e.push(t)}),i.hasIn(["inputConfig","options"])&&i.getIn(["inputConfig","options"],g.c.List()).forEach(function(t){e.push(t)}),l.has("options")&&l.get("options",g.c.List()).forEach(function(t){e.push(t)})}).map(fe).toArray(),c=["nin","in"].includes(t.get("op",""));return r.a.createElement(Tn,{fieldType:"select",clearable:!1,multi:c,options:s,value:t.get("value",""),onChange:n.onChangeSelect,disabled:a})},n.renderInputNumber=function(){var e=n.props,t=e.field,a=e.disabled;if(["nin","in"].includes(t.get("op",""))){var i=t.get("value","").split(",").filter(function(e){return""!==e});return r.a.createElement(Tn,{fieldType:"tags",value:i,onChange:n.onChangeMultiValues,disabled:a,renderInput:n.renderCustomInputNumber})}return r.a.createElement(Tn,{fieldType:"number",value:t.get("value",""),onChange:n.onChangeNumber,disabled:a})},n.renderInputDate=function(){var e=n.props,t=e.field,a=e.disabled;if(["nin","in"].includes(t.get("op",""))){var i=t.get("value","").split(",").filter(function(e){return""!==e});return r.a.createElement(Tn,{fieldType:"tags",value:i,onChange:n.onChangeMultiValues,disabled:a,renderInput:n.renderCustomInputDate,getTagDisplayValue:n.formatValueTagDate})}var o=S()(t.get("value",null));return r.a.createElement(Tn,{fieldType:"date",value:o,onChange:n.onChangeDateTime,disabled:a})},n.renderInputDateTime=function(){var e=n.props,t=e.field,a=e.disabled;if(["nin","in"].includes(t.get("op",""))){var i=t.get("value","").split(",").filter(function(e){return""!==e});return r.a.createElement(Tn,{fieldType:"tags",value:i,onChange:n.onChangeMultiValues,disabled:a,renderInput:n.renderCustomInputDateTime,getTagDisplayValue:n.formatValueTagDateTime})}var o=S()(t.get("value",null)).utc();return r.a.createElement(Tn,{fieldType:"datetime",value:o,onChange:n.onChangeDateTime,disabled:a})},n.renderInputString=function(){var e=n.props,t=e.field,a=e.disabled;if(["nin","in"].includes(t.get("op",""))){var i=t.get("value","").split(",").filter(function(e){return""!==e});return r.a.createElement(Tn,{fieldType:"tags",value:i,onChange:n.onChangeMultiValues,disabled:a})}return r.a.createElement(Tn,{value:t.get("value",""),onChange:n.onChangeText,disabled:a})},n.renderInput=function(){var e=n.props,t=e.field,a=e.config,r=e.operator;return[a.get("type",""),r.get("type","")].includes("boolean")?n.renderInputBoolean():[a.get("type","string"),r.get("type","")].includes("string")&&("select"===a.getIn(["inputConfig","inputType"])||r.has("options"))&&["eq","ne","nin","in"].includes(t.get("op",""))?n.renderInputSelect():[a.get("type",""),r.get("type","")].includes("number")?n.renderInputNumber():[a.get("type",""),r.get("type","")].includes("date")||[a.get("type",""),r.get("type","")].includes("daterange")?n.renderInputDate():[a.get("type",""),r.get("type","")].includes("datetime")?n.renderInputDateTime():n.renderInputString()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.config,n=e.selectOptions;this.initFieldOptions(t,n)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.config;g.c.is(t,e.config)||this.initFieldOptions(e.config,e.selectOptions)}},{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.field,a=t.config,r=t.operator,i=t.selectOptions,o=t.disabled;return!g.c.is(n,e.field)||!g.c.is(a,e.config)||!g.c.is(i,e.selectOptions)||!g.c.is(r,e.operator)||o!==e.disabled}},{key:"render",value:function(){var e=this.props.operator,t=this.renderInput();return e.has("prefix")?r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,e.get("prefix","")),t):e.has("suffix")?r.a.createElement(f.o,null,t,r.a.createElement(f.o.Addon,null,e.get("suffix",""))):t}}]),t}(a.Component);Qg.defaultProps={field:g.c.Map(),config:g.c.Map(),operator:g.c.Map(),selectOptions:g.c.List(),disabled:!1,onChange:function(){}};var Zg=Object(l.connect)(function(e,t){return{selectOptions:ol(e,t)}})(Qg),Xg=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeField=function(e){var t=n.props.index;n.props.onChangeField(t,e)},n.onChangeOperator=function(e){var t=n.props.index;n.props.onChangeOperator(t,e)},n.onChangeValue=function(e){var t=n.props.index;n.props.onChangeValue(t,e)},n.onRemove=function(e){var t=n.props.index;n.props.onRemove(t,e)},n.getConfig=function(){var e=n.props,t=e.item;return e.fieldsConfig.find(function(e){return e.get("id","")===t.get("field","")},null,g.c.Map())},n.getOperator=function(){var e=n.props,t=e.item;return e.operators.find(function(e){return e.get("id","")===t.get("op","")},null,g.c.Map())},n.getFieldOptions=function(){return n.props.fieldsConfig.filter(function(e){return e.get("filter",!0)}).map(he).toArray()},n.isInBlackList=function(e,t){var n=e.get("exclude",g.c.List()),a="fieldid:".concat(t.get("id","")),r=t.get("type","string");return n.includes(a)||n.includes(r)},n.isInWhiteList=function(e,t){var n=e.get("include",g.c.List()),a="fieldid:".concat(t.get("id","")),r=t.get("type","string");return n.includes(r)||n.includes(a)},n.getOpOptions=function(){var e=n.props.operators,t=n.getConfig();return e.filter(function(e){return!n.isInBlackList(e,t)&&n.isInWhiteList(e,t)}).map(he).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.item,a=t.index,r=t.disabled,i=t.fieldsConfig,o=t.operators;return!g.c.is(n,e.item)||!g.c.is(i,e.fieldsConfig)||!g.c.is(o,e.operators)||a!==e.index||r!==e.disabled}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,a=n.item,r=n.index,i=this.getOpOptions()||[];1===i.length&&""===a.get("op","")&&this.props.onChangeOperator(r,i[0].value)}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.disabled,a=this.getConfig(),i=this.getOperator(),o=this.getFieldOptions(),l=this.getOpOptions(),s=n||""===t.get("field",""),c=n||""===t.get("op","")||s;return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:4,className:"pl0"},r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:o,value:t.get("field",""),onChange:this.onChangeField,disabled:n})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},"Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:l,value:t.get("op",""),onChange:this.onChangeOperator,disabled:s})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Value")),r.a.createElement(f.g,{sm:4},r.a.createElement(Zg,{field:t,config:a,operator:i,disabled:c,onChange:this.onChangeValue})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:this.onRemove,bsSize:"small",className:"pull-left",disabled:n},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))}}]),t}(a.Component);Xg.defaultProps={item:g.c.Map(),index:0,disabled:!1,fieldsConfig:g.c.List(),operators:g.c.List(),onChangeField:function(){},onChangeOperator:function(){},onChangeValue:function(){},onRemove:function(){}};var ef=Xg,tf=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).renderRow=function(e,t){var a=n.props,i=a.mode,o=a.operators,l=a.fieldsOptions,s="view"===i;return r.a.createElement(ef,{key:t,item:e,index:t,fieldsConfig:l,operators:o,disabled:s,onChangeField:n.props.onChangeField,onChangeOperator:n.props.onChangeOperator,onChangeValue:n.props.onChangeValue,onRemove:n.props.onRemove})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.conditions,a=t.fieldsOptions,r=t.mode,i=t.operators;return!g.c.is(n,e.conditions)||!g.c.is(a,e.fieldsOptions)||!g.c.is(i,e.operators)||r!==e.mode}},{key:"render",value:function(){var e=this.props,t=e.conditions,n=e.mode,a=e.fieldsOptions,i=t.map(this.renderRow),o=a.isEmpty(),l=o?qo.add_conditions_disabled_no_entity:"";return r.a.createElement("div",{className:"report-editor-conditions"},r.a.createElement(f.g,{sm:12},i.isEmpty()?r.a.createElement(f.n,null,qo.block_conditions):r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},"Operator")),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Value")))),r.a.createElement(f.g,{sm:12},i),"view"!==n&&r.a.createElement(f.g,{sm:12,className:"pl0 pr0"},r.a.createElement(ct,{onClick:this.props.onAdd,label:"Add Condition",disabled:o,title:l})))}}]),t}(a.Component);tf.defaultProps={conditions:g.c.List(),fieldsOptions:g.c.List(),operators:g.c.List(),mode:"update",onChangeField:function(){},onChangeOperator:function(){},onChangeValue:function(){},onAdd:function(){},onRemove:function(){}};var nf=tf,af=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeLabel=function(e){var t=e.target.value,a=n.props.idx;n.props.onChangeLabel(a,t)},n.onChangeField=function(e){var t=n.props.idx;n.props.onChangeField(t,e)},n.onChangeOperator=function(e){var t=n.props.idx;n.props.onChangeOperator(t,e)},n.onRemove=function(){var e=n.props.idx;n.props.onRemove(e)},n.getConfig=function(){var e=n.props,t=e.item;return e.fieldsConfig.find(function(e){return e.get("id","")===t.get("field_name","")},null,g.c.Map())},n.isInBlackList=function(e,t){var n=e.get("exclude",g.c.List()),a="fieldid:".concat(t.get("id","")),r=t.get("type","string");return n.includes(a)||n.includes(r)},n.isInWhiteList=function(e,t){var n=e.get("include",g.c.List()),a="fieldid:".concat(t.get("id","")),r=t.get("type","string");return n.includes(r)||n.includes(a)},n.getoperators=function(){var e=n.props.operators,t=n.getConfig();return e.filter(function(e){return!n.isInBlackList(e,t)&&n.isInWhiteList(e,t)}).map(he).toArray()},n.getfieldsConfig=function(){return n.props.fieldsConfig.filter(function(e){return e.get("columnable",!0)}).map(he).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.item,a=t.idx,r=t.disabled,i=t.fieldsConfig,o=t.operators,l=t.type;return!g.c.is(n,e.item)||!g.c.is(i,e.fieldsConfig)||!g.c.is(o,e.operators)||a!==e.idx||r!==e.disabled||l!==e.type}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.disabled,a=e.type,i=e.isCountColumn,o=this.getfieldsConfig(),l=this.getoperators(),s=n||i,c=n||""===t.get("field_name",""),u=n||""===t.get("field_name","");return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1,className:"text-center"},r.a.createElement(_t,null)),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:4},!i&&r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:o,value:t.get("field_name",""),onChange:this.onChangeField,disabled:s,allowCreate:!0})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},a!==Sg.SIMPLE&&r.a.createElement("label",{htmlFor:"operator_field"},"Function")),r.a.createElement(f.g,{sm:3},a!==Sg.SIMPLE&&r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:l,value:t.get("op",""),onChange:this.onChangeOperator,disabled:c})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"label_field"},"Label")),r.a.createElement(f.g,{sm:3},r.a.createElement(Tn,{value:t.get("label",""),onChange:this.onChangeLabel,disabled:u})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:this.onRemove,bsSize:"small",className:"pull-left",disabled:n},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))}}]),t}(a.Component);af.defaultProps={item:g.c.Map(),idx:0,disabled:!1,isCountColumn:!1,type:Sg.SIMPLE,fieldsConfig:g.c.List(),operators:g.c.List(),onChangeField:function(){},onChangeOperator:function(){},onChangeLabel:function(){},onRemove:function(){}};var rf=Object(yt.SortableElement)(af),of=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onMoveEnd=function(e){var t=e.oldIndex,a=e.newIndex;n.props.onMove(t,a)},n.getFieldsOptions=function(e){return e.filter(function(e){return e.get("aggregatable",!0)})},n.getColumnFieldsOptions=function(){var e=n.getCountColumnKey();return g.c.Map({aggregatable:!0,searchable:!0,id:e,title:te(e,"report")})},n.isCountColumn=function(e){return e.get("key","")===n.getCountColumnKey()},n.getCountColumnKey=function(){return"count_group"},n.isCountColumnExist=function(e){return e.findIndex(function(e){return e.get("key","")===n.getCountColumnKey()})>-1},n.onAddCount=function(){var e=n.getCountColumnKey(),t=g.c.Map({key:e,field_name:e,label:te(e,"report"),op:"count"});n.props.onAdd(t)},n.onAdd=function(e){n.props.onAdd()},n.renderRows=function(){var e=n.props,t=e.mode,a=e.columns,i=e.fieldsConfig,o=e.aggregateOperators,l=e.type,s="view"===t,c=n.getFieldsOptions(i);return a.map(function(e,t){var a=n.isCountColumn(e),i=a?c.push(n.getColumnFieldsOptions()):c;return r.a.createElement(rf,{key:e.get("key",t),item:e,idx:t,index:t,disabled:s,type:l,isCountColumn:a,fieldsConfig:i,operators:o,onChangeField:n.props.onChangeField,onChangeOperator:n.props.onChangeOperator,onChangeLabel:n.props.onChangeLabel,onRemove:n.props.onRemove})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.mode,a=t.columns,r=t.fieldsConfig,i=t.aggregateOperators,o=t.type;return!g.c.is(a,e.columns)||!g.c.is(r,e.fieldsConfig)||!g.c.is(i,e.aggregateOperators)||n!==e.mode||o!==e.type}},{key:"render",value:function(){var e=this.props,t=e.mode,n=e.type,a=e.fieldsConfig,i=e.columns,o=this.renderRows(),l=a.isEmpty(),s=n===Sg.GROPED?qo.block_columns_grouped:qo.block_columns_simple,c=l?qo.add_columns_disabled_no_entity:"";return r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:12},o.isEmpty()?r.a.createElement(f.n,null,s):r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1,xsHidden:!0},"\xa0"),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},n!==Sg.SIMPLE&&"Function")),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Label")))),r.a.createElement(f.g,{sm:12},r.a.createElement(Et,{lockAxis:"y",helperClass:"draggable-row",useDragHandle:!0,items:o.toArray(),onSortEnd:this.onMoveEnd})),"view"!==t&&r.a.createElement(f.g,{sm:12},r.a.createElement(ct,{onClick:this.onAdd,label:"Add Column",disabled:l,title:c}),n!==Sg.SIMPLE&&r.a.createElement("span",{style:{marginLeft:10}},r.a.createElement(ct,{onClick:this.onAddCount,label:"Add Count Column",disabled:this.isCountColumnExist(i),title:"Add Column to count group fields"}))))}}]),t}(a.Component);of.defaultProps={columns:g.c.List(),fieldsConfig:g.c.List(),aggregateOperators:g.c.List(),mode:"update",type:0,onChangeField:function(){},onChangeOperator:function(){},onChangeLabel:function(){},onAdd:function(){},onRemove:function(){},onMove:function(){},onAddCount:function(){}};var lf=of,sf=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onRemove=function(e){var t=n.props.idx;n.props.onRemove(t,e)},n.onChangeField=function(e){var t=n.props.idx;n.props.onChangeField(t,e)},n.onChangeOperator=function(e){var t=n.props.idx;n.props.onChangeOperator(t,e)},n.getFieldOptions=function(){return n.props.options.map(fe).toArray()},n.getOpOptions=function(){return n.props.sortOperators.map(fe).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.item,a=t.idx,r=t.disabled,i=t.options,o=t.sortOperators;return!g.c.is(n,e.item)||!g.c.is(i,e.options)||!g.c.is(o,e.sortOperators)||a!==e.idx||r!==e.disabled}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.disabled,a=this.getFieldOptions(),i=this.getOpOptions(),o=n||""===t.get("field","");return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1,className:"text-center"},r.a.createElement(_t,null)),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:a,value:t.get("field",""),onChange:this.onChangeField,disabled:n})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"order_field"},"Order")),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:i,value:t.get("op",""),onChange:this.onChangeOperator,disabled:o})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:this.onRemove,bsSize:"small",className:"pull-left",disabled:n},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))}}]),t}(a.Component);sf.defaultProps={item:g.c.Map(),idx:0,disabled:!1,options:g.c.List(),sortOperators:g.c.List(),onChangeField:function(){},onChangeOperator:function(){},onRemove:function(){}};var cf=Object(yt.SortableElement)(sf),uf=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getUsedOptions=function(){return n.props.sorts.filter(function(e){return""!==e.get("field","")}).map(function(e){return e.get("field","")})},n.renderSortRow=function(e,t){var a=n.props,i=a.options,o=a.mode,l=a.sortOperators,s="view"===o,c=n.getUsedOptions(),u=i.filter(function(t){return!c.includes(t.get("key",""))||e.get("field","")===t.get("key","")}).map(function(e){return g.c.Map({value:e.get("key",""),label:e.get("label","")})});return r.a.createElement(cf,{key:t,item:e,index:t,idx:t,disabled:s,options:u,sortOperators:l,onChangeField:n.props.onChangeField,onChangeOperator:n.props.onChangeOperator,onRemove:n.props.onRemove})},n.onMoveEnd=function(e){var t=e.oldIndex,a=e.newIndex;n.props.onMove(t,a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.sorts,a=t.options,r=t.mode,i=t.sortOperators;return!g.c.is(n,e.sorts)||!g.c.is(a,e.options)||!g.c.is(i,e.sortOperators)||r!==e.mode}},{key:"render",value:function(){var e=this.props,t=e.sorts,n=e.options,a=e.mode,i="view"===a||n.isEmpty(),o=i&&n.isEmpty()?qo.add_sort_disabled_no_fields:"",l=t.map(this.renderSortRow);return r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:12},l.isEmpty()?r.a.createElement(f.n,null,qo.block_sort):r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1,xsHidden:!0},"\xa0"),r.a.createElement(f.g,{sm:5,xsHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:5,xsHidden:!0},r.a.createElement("label",{htmlFor:"order_field"},"Order")))),r.a.createElement(f.g,{sm:12},r.a.createElement(Et,{lockAxis:"y",helperClass:"draggable-row",useDragHandle:!0,items:l.toArray(),onSortEnd:this.onMoveEnd})),"view"!==a&&r.a.createElement(f.g,{sm:12},r.a.createElement(ct,{onClick:this.props.onAdd,label:"Add Sort",disabled:i,title:o})))}}]),t}(a.Component);uf.defaultProps={sorts:g.c.List(),options:g.c.List(),sortOperators:g.c.List(),mode:"update",onChangeField:function(){},onChangeOperator:function(){},onMove:function(){},onRemove:function(){},onAdd:function(){}};var pf=uf,df=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeText=function(e){var t=e.target.value;n.props.onChange(t)},n.onChangeSelect=function(e){n.props.onChange(e)},n.onSelectOptionType=function(e){n.props.onChangeValueType(e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.field;if(e.config.has("options","")&&""===t.get("value","")){var n=e.config.get("options",g.c.List()).map(fe).first().value||"";this.props.onChange(n)}}},{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.field,a=t.config,r=t.disabled;return!g.c.is(n,e.field)||!g.c.is(a,e.config)||r!==e.disabled}},{key:"render",value:function(){var e=this,t=this.props,n=t.field,a=t.disabled,i=t.config,o=a||i.isEmpty();if(i.has("valueTypes")){var l=i.get("valueTypes",g.c.List()).find(function(e){return e.get("value","")===n.get("type","")},null,g.c.Map({})).get("label","Select unit..."),s=i.get("valueTypes",g.c.List()).map(function(t){return r.a.createElement(f.q,{eventKey:t.get("value","-"),key:t.get("value","-"),onSelect:e.onSelectOptionType},t.get("label","-"))}).toArray();return r.a.createElement(f.o,null,r.a.createElement(Tn,{fieldType:i.get("type","text"),value:n.get("value",""),onChange:this.onChangeText,disabled:o}),r.a.createElement(f.i,{id:"balance-period-unit",componentClass:f.o.Button,title:l,disabled:o},s))}if(i.has("options")){if(!1===i.get("options",""))return null;var c=i.get("options",g.c.List()).map(fe).toArray();return r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:c,value:n.get("value",""),onChange:this.onChangeSelect,disabled:o,allowCreate:i.get("addOption",!1)})}return r.a.createElement(Tn,{value:n.get("value",""),onChange:this.onChangeText,disabled:o})}}]),t}(a.Component);df.defaultProps={field:g.c.Map(),config:g.c.Map(),disabled:!1,onChange:function(){},onChangeValueType:function(){}};var mf=df,gf=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onRemove=function(e){var t=n.props.idx;n.props.onRemove(t,e)},n.onChangeField=function(e){var t=n.props.idx;n.props.onChangeField(t,e)},n.onChangeOperator=function(e){var t=n.props.idx;n.props.onChangeOperator(t,e)},n.onChangeValue=function(e){var t=n.props.idx;n.props.onChangeValue(t,e)},n.onChangeValueType=function(e){var t=n.props.idx;n.props.onChangeValueType(t,e)},n.getFieldOptions=function(){return n.props.options.map(function(e){return{value:e.get("key",""),label:e.get("label","")}}).toArray()},n.getOpOptions=function(){return n.props.operators.map(he).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.item,a=t.idx,r=t.disabled,i=t.options,o=t.operators;return!g.c.is(n,e.item)||!g.c.is(i,e.options)||!g.c.is(o,e.operators)||a!==e.idx||r!==e.disabled}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.disabled,a=e.operators,i=this.getFieldOptions(),o=this.getOpOptions(),l=n||""===t.get("field",""),s=a.find(function(e){return e.get("id","")===t.get("op","")});return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1,className:"text-center"},r.a.createElement(_t,null)),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:i,value:t.get("field",""),onChange:this.onChangeField,disabled:n})),r.a.createElement(f.g,{sm:3},r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:o,value:t.get("op",""),onChange:this.onChangeOperator,disabled:l})),r.a.createElement(f.g,{sm:3},r.a.createElement(mf,{onChange:this.onChangeValue,onChangeValueType:this.onChangeValueType,field:t,config:s})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:this.onRemove,bsSize:"small",className:"pull-left",disabled:n},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))}}]),t}(a.Component);gf.defaultProps={item:g.c.Map(),idx:0,disabled:!1,options:g.c.List(),operators:g.c.List(),onChangeField:function(){},onChangeOperator:function(){},onChangeValue:function(){},onChangeValueType:function(){},onRemove:function(){}};var ff=Object(yt.SortableElement)(gf),hf=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getUsedOptions=function(){return n.props.formats},n.renderformaterRow=function(e,t){var a=n.props,i=a.options,o=a.mode,l=a.formatOperators,s="view"===o,c=n.getUsedOptions(),u=i.filter(function(t){return!c.includes(t.get("key",""))||e.get("field","")===t.get("key","")});return r.a.createElement(ff,{key:t,item:e,index:t,idx:t,disabled:s,options:u,operators:l,onChangeField:n.props.onChangeField,onChangeOperator:n.props.onChangeOperator,onChangeValue:n.props.onChangeValue,onChangeValueType:n.props.onChangeValueType,onRemove:n.props.onRemove})},n.onMoveEnd=function(e){var t=e.oldIndex,a=e.newIndex;n.props.onMove(t,a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.formats,a=t.options,r=t.mode,i=t.formatOperators;return!g.c.is(n,e.formats)||!g.c.is(a,e.options)||!g.c.is(i,e.formatOperators)||r!==e.mode}},{key:"render",value:function(){var e=this.props,t=e.formats,n=e.options,a=e.mode,i="view"===a||n.isEmpty(),o=i&&n.isEmpty()?qo.add_formatter_disabled_no_fields:"",l=t.map(this.renderformaterRow),s=t.findIndex(function(e){return"date_override"===e.get("op","")})>-1;return r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:12},l.isEmpty()?r.a.createElement(f.n,null,qo.block_formatter):r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:1},"\xa0"),r.a.createElement(f.g,{sm:4},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:3},r.a.createElement("label",{htmlFor:"operator_field"},"Type / Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement("label",{htmlFor:"value_field"},"Format / Value")))),r.a.createElement(f.g,{sm:12},r.a.createElement(Et,{lockAxis:"y",helperClass:"draggable-row",useDragHandle:!0,items:l.toArray(),onSortEnd:this.onMoveEnd})),"view"!==a&&r.a.createElement(f.g,{sm:12},r.a.createElement(ct,{onClick:this.props.onAdd,label:"Add Formatting Style",disabled:i,title:o})),s&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.p,{bsStyle:"warning"},"* Subtract / Add time styling should be applied before other format")))}}]),t}(a.Component);hf.defaultProps={formats:g.c.List(),options:g.c.List(),formatOperators:g.c.List(),mode:"update",onChangeField:function(){},onChangeOperator:function(){},onChangeValue:function(){},onChangeValueType:function(){},onMove:function(){},onRemove:function(){},onAdd:function(){}};var vf=hf,yf=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onPreview=function(){n.props.onFilter()},n.updateReport=function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n.props.onUpdate(e,t,a)},n.onChangeReportEntity=function(e){n.updateReport("entity",e),n.updateReport("conditions",g.c.List()),n.updateReport("columns",g.c.List()),n.updateReport("sorts",g.c.List())},n.onChangeReportType=function(e){n.updateReport("type",e),n.updateColumnsByReportType(e),n.updateSortByReportType(e)},n.onChangeReportKey=function(e){n.updateReport("key",e)},n.onChangeConditionField=function(e,t){var a=n.props.report,r=n.getEntityFields().find(function(e){return e.get("id","")===t},null,g.c.Map()),i=g.c.Map({field:t,op:"",value:"",type:r.get("type","string"),entity:r.get("entity",a.get("entity",""))}),o=a.get("conditions",g.c.List()).set(e,i);n.updateReport("conditions",o)},n.onChangeConditionOperator=function(e,t){var a=n.props,r=a.report,i=a.conditionsOperators,o=r.getIn(["conditions",e,"op"],""),l=i.find(function(e){return e.get("id","")===o},null,g.c.Map()),s=i.find(function(e){return e.get("id","")===t},null,g.c.Map()),c=r.get("conditions",g.c.List()).update(e,g.c.Map(),function(e){return l.get("type","")===s.get("type","")&&g.c.is(l.get("options",g.c.List()),s.get("options",g.c.List()))?e.set("op",t):e.set("op",t).set("value","")});n.updateReport("conditions",c)},n.onChangeConditionValue=function(e,t){var a=n.props.report.get("conditions",g.c.List()).setIn([e,"value"],t);n.updateReport("conditions",a)},n.onRemoveCondition=function(e){var t=n.props.report.get("conditions",g.c.List()).delete(e);n.updateReport("conditions",t)},n.onAddCondition=function(){var e=n.props.report.get("conditions",g.c.List()).push(g.c.Map({field:"",op:"",value:""}));n.updateReport("conditions",e)},n.onChangeSortOperator=function(e,t){var a=n.props.report.get("sorts",g.c.List()).setIn([e,"op"],t);n.updateReport("sorts",a)},n.onChangeSortField=function(e,t){var a=n.props.report.get("sorts",g.c.List()).setIn([e,"field"],t).setIn([e,"op"],"");n.updateReport("sorts",a)},n.onMoveSort=function(e,t){var a=n.props.report,r=a.getIn(["sorts",e]),i=a.get("sorts",g.c.List()).delete(e).insert(t,r);n.updateReport("sorts",i)},n.onRemoveSort=function(e){var t=n.props.report.get("sorts",g.c.List()).delete(e);n.updateReport("sorts",t)},n.onRemoveSortByKey=function(e){var t=n.props.report.get("sorts",g.c.List()),a=t.findIndex(function(t){return t.get("field","")===e});a>-1&&n.updateReport("sorts",t.delete(a))},n.onAddSort=function(){var e=n.props.report.get("sorts",g.c.List()).push(g.c.Map({field:"",op:""}));n.updateReport("sorts",e)},n.onChangeFormatField=function(e,t){var a=n.props.report.get("formats",g.c.List()).setIn([e,"field"],t).setIn([e,"op"],"").setIn([e,"value"],"");n.updateReport("formats",a)},n.onChangeFormatOperator=function(e,t){var a=n.props.report.get("formats",g.c.List()).setIn([e,"op"],t).setIn([e,"value"],"");n.updateReport("formats",a)},n.onChangeFormatValue=function(e,t){var a=n.props.report.get("formats",g.c.List()).setIn([e,"value"],t);n.updateReport("formats",a)},n.onChangeFormatValueType=function(e,t){var a=n.props.report.get("formats",g.c.List()).setIn([e,"type"],t);n.updateReport("formats",a)},n.onRemoveFormat=function(e){var t=n.props.report.get("formats",g.c.List()).delete(e);n.updateReport("formats",t)},n.onRemoveFormatByKey=function(e){var t=n.props.report.get("formats",g.c.List()),a=t.filter(function(t){return t.get("field","")!==e});g.c.is(a,t)||n.updateReport("formats",a)},n.onAddFormat=function(){var e=n.props.report.get("formats",g.c.List()).push(g.c.Map({field:"",op:"",value:""}));n.updateReport("formats",e)},n.onMoveFormat=function(e,t){var a=n.props.report,r=a.getIn(["formats",e]),i=a.get("formats",g.c.List()).delete(e).insert(t,r);n.updateReport("formats",i)},n.onChangeColumnField=function(e,t){var a=n.props.report,r=n.getEntityFields().find(function(e){return e.get("id","")===t},null,g.c.Map()),i=a.get("columns",g.c.List()).update(e,g.c.Map(),function(e){var i=e.get("label",""),o=e.get("field_name",""),l=e.get("op",""),s=n.getColumnNewLabel(i,o,l,t,l);return e.withMutations(function(e){return e.set("field_name",t).set("label",s).set("entity",r.get("entity",a.get("entity","")))})});n.updateReport("columns",i)},n.onChangeColumnOperator=function(e,t){var a=n.props.report.get("columns",g.c.List()).update(e,g.c.Map(),function(e){var a=e.get("label",""),r=e.get("field_name",""),i=e.get("op",""),o=n.getColumnNewLabel(a,r,i,r,t);return e.withMutations(function(e){return e.set("op",t).set("label",o)})});n.updateReport("columns",a)},n.onChangeColumnLabel=function(e,t){var a=n.props.report.get("columns",g.c.List()).setIn([e,"label"],t);n.updateReport("columns",a,!1)},n.updateColumnsByReportType=function(e){var t=n.props.report.get("columns",g.c.List()).map(function(t){var a=t.get("label",""),r=t.get("field_name",""),i=t.get("op",""),o=e===Sg.GROPED?"":i,l=e===Sg.GROPED?i:"",s=n.getColumnNewLabel(a,r,o,r,l);return t.set("label",s)}).update(function(t){return e===Sg.SIMPLE?t.filter(function(e){return"count_group"!==e.get("key","")}):t});n.updateReport("columns",t)},n.updateSortByReportType=function(e){var t=n.props.report.get("sorts",g.c.List()).update(function(t){return e===Sg.SIMPLE?t.filter(function(e){return"count_group"!==e.get("field","")}):t});n.updateReport("sorts",t)},n.onMoveColumn=function(e,t){var a=n.props.report,r=a.getIn(["columns",e]),i=a.get("columns",g.c.List()).delete(e).insert(t,r);n.updateReport("columns",i)},n.onAddColumn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=n.props.report,a=e||g.c.Map({key:Zt.a.v4(),field_name:"",label:"",op:""}),r=t.get("columns",g.c.List()).push(a);n.updateReport("columns",r)},n.onRemoveColumn=function(e){var t=n.props.report,a=t.getIn(["columns",e,"key"],"");n.onRemoveSortByKey(a),n.onRemoveFormatByKey(a);var r=t.get("columns",g.c.List()).delete(e);n.updateReport("columns",r,!1)},n.getColumnNewLabel=function(e,t,a,r,i){var o=n.props.aggregateOperators,l=n.getEntityFields();return be(e,l,o,t,a,r,i)},n.getEntityFields=function(){var e=n.props,t=e.report;return e.reportFileds.get(t.get("entity",""),g.c.List())},n.getOutputFormats=function(){var e=n.props,t=e.taxType,a=e.outputFormats;return"vat"===t?a:a.filter(function(e){return"vat_format"!==e.get("id","")})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.mode,n=e.report,a=e.aggregateOperators,i=e.conditionsOperators,o=e.sortOperators,l=e.entities,s=e.progress,c=this.getEntityFields(),u=n.get("columns",g.c.List()),p=r.a.createElement("span",{className:"danger-red"}," *"),d=this.getOutputFormats(),m=k()("fa",{"fa-search":!s,"fa-spinner fa-pulse":s});return r.a.createElement("div",{className:"ReportEditor"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("span",null,"Basic Details"),collapsible:"update"===t,className:"collapsible"},r.a.createElement($g,{mode:t,title:n.get("key",""),entity:n.get("entity",""),entities:l,type:n.get("type",Sg.SIMPLE),onChangeKey:this.onChangeReportKey,onChangeEntity:this.onChangeReportEntity,onChangeType:this.onChangeReportType})),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Columns ",p)},r.a.createElement(lf,{mode:t,columns:u,fieldsConfig:c,type:n.get("type",Sg.SIMPLE),aggregateOperators:a,onChangeField:this.onChangeColumnField,onChangeOperator:this.onChangeColumnOperator,onChangeLabel:this.onChangeColumnLabel,onAdd:this.onAddColumn,onRemove:this.onRemoveColumn,onMove:this.onMoveColumn})),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Conditions"),collapsible:!0,className:"collapsible"},r.a.createElement(nf,{mode:t,conditions:n.get("conditions",g.c.List()),fieldsOptions:c,operators:i,onRemove:this.onRemoveCondition,onAdd:this.onAddCondition,onChangeField:this.onChangeConditionField,onChangeOperator:this.onChangeConditionOperator,onChangeValue:this.onChangeConditionValue})),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Sort"),collapsible:!0,className:"collapsible"},r.a.createElement(pf,{mode:t,sorts:n.get("sorts",g.c.List()),options:u,sortOperators:o,onChangeField:this.onChangeSortField,onChangeOperator:this.onChangeSortOperator,onRemove:this.onRemoveSort,onAdd:this.onAddSort,onMove:this.onMoveSort})),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Formatting Style"),collapsible:!0,className:"collapsible"},r.a.createElement(vf,{mode:t,formats:n.get("formats",g.c.List()),options:u,formatOperators:d,onChangeField:this.onChangeFormatField,onChangeOperator:this.onChangeFormatOperator,onChangeValue:this.onChangeFormatValue,onChangeValueType:this.onChangeFormatValueType,onRemove:this.onRemoveFormat,onAdd:this.onAddFormat,onMove:this.onMoveFormat}))),r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:12},r.a.createElement(f.c,{bsStyle:"primary",onClick:this.onPreview,block:!0,disabled:s},r.a.createElement("i",{className:m}),"\xa0Preview")),r.a.createElement(f.g,{sm:12},"\xa0")))}}]),t}(a.Component);yf.defaultProps={report:g.c.Map(),mode:"update",taxType:"vat",progress:!1,reportFileds:g.c.Map(),aggregateOperators:ee(["reports","aggregateOperators"],g.c.List()),conditionsOperators:ee(["reports","conditionsOperators"],g.c.List()),entities:g.c.List(),sortOperators:g.c.List([g.c.Map({value:1,label:"Ascending"}),g.c.Map({value:-1,label:"Descending"})]),outputFormats:ee(["reports","outputFormats"],g.c.List()),onFilter:function(){},onUpdate:function(){}};var bf=yf,Ef=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.items,a=t.fields,r=t.page,i=t.nextPage,o=t.size,l=t.onlyHeaders;return!g.c.is(n,e.items)||!g.c.is(a,e.fields)||o!==e.size||r!==e.page||i!==e.nextPage||l!==e.onlyHeaders}},{key:"render",value:function(){var e=this.props,t=e.items,n=e.size,a=e.page,i=e.nextPage,o=e.fields,l=e.onlyHeaders;return r.a.createElement("div",{className:"report-list"},r.a.createElement(ju,{items:l?null:t,fields:o.toJS()}),!l&&r.a.createElement(wu,{page:a,size:n,count:t.size,nextPage:i,onChangePage:this.props.onChangePage,onChangeSize:this.props.onChangeSize}),l&&r.a.createElement(f.n,null,qo.block_preview))}}]),t}(a.Component);Ef.defaultProps={items:g.c.List(),fields:g.c.List(),size:ee("listDefaultItems",10),page:0,nextPage:!1,onlyHeaders:!1,onChangePage:function(){},onChangeSize:function(){}};var Cf=Ef,_f=function(e){return ee(["reports","fields",e],g.c.List())},Of=function(e){if(e)return e.map(function(e){return g.c.Map({id:e.get("field_name",""),title:e.get("title",""),type:e.get("type","string"),aggregatable:!0,searchable:e.get("searchable",!0),inputConfig:e.get("inputConfig",null)})})},Sf=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.Map();return e?e.filter(function(e){return!n.get("currentEntity",g.c.List()).includes(e.get("id",""))}).withMutations(function(e){t.forEach(function(t,a){var r=Object(D.sentenceCase)(ee(["systemItems",a,"itemName"],a));t.isEmpty()||t.forEach(function(t){if(!n.get(a,g.c.List()).includes(t.get("id",""))){var i="$".concat(a,".").concat(t.get("id","")),o="".concat(r,": ").concat(t.get("title",t.get("id",""))),l=t.withMutations(function(e){return e.set("id",i).set("title",o).set("entity",a)});e.push(l)}})})}):g.c.List()},Tf=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a="queue"===t?e:Of(e),r=g.c.Map({searchable:!0,aggregatable:!0});return g.c.List().withMutations(function(e){a.forEach(function(t){e.push(t)}),_f(t).forEach(function(t){var n=e.findIndex(function(e){return e.get("id","")===t.get("id","")});-1===n?e.push(r.merge(t)):e.update(n,g.c.Map(),function(e){return e.merge(t)})}),e.forEach(function(n,a){if(!n.has("title")){var r=te(n.get("id",""),ne(t)),i=r===n.get("id","")?Object(D.sentenceCase)(r):r;e.setIn([a,"title"],i)}})}).filter(function(e){return!["play","subscriber.play"].includes(e.get("id",""))||"play"===e.get("id","")&&n||"subscriber.play"===e.get("id","")&&n&&"usage"===t}).filter(function(e){return e.get("show",!0)}).sort(Ge)},kf=Object(Nn.a)(Kn,Wn,Sa,Ia,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.List(),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.c.List();return g.c.List().withMutations(function(r){e.forEach(function(e){r.push(g.c.Map({field_name:"uf.".concat(e),title:"".concat(te(e,"lines",Object(D.sentenceCase)(e))," (User field)")}))}),t.forEach(function(e){r.push(g.c.Map({field_name:"cf.".concat(e),title:"".concat(te(e,"lines",Object(D.sentenceCase)(e))," (Calculated field)")}))}),a.forEach(function(e){var t=te(e,"lines",Object(D.sentenceCase)(e)),n=te("charge","lines",Object(D.sentenceCase)("charge")),a=te("product_key","lines",Object(D.sentenceCase)("product_key")),i="rates.tariff_category.".concat(e);r.push(g.c.Map({field_name:"".concat(i,".pricing.charge"),title:"".concat(t," ").concat(n),type:"number"})),r.push(g.c.Map({field_name:"".concat(i,".key"),title:"".concat(t," ").concat(a),inputConfig:g.c.Map({inputType:"select",callback:"getProductsOptions",callbackArgument:g.c.Map({tariff_category:e})})}))}),n.forEach(function(e){r.push(e)})})}),jf=Object(Nn.a)(Oa,function(){return"subscribers"},oa,Tf),If=Object(Nn.a)(ba,function(){return"account"},oa,Tf),wf=Object(Nn.a)(function(){return g.c.List()},function(){return"logFile"},oa,Tf),Nf=Object(Nn.a)(function(){return g.c.List()},function(){return"paymentsTransactionsRequest"},function(){return!0},Tf),Ff=Object(Nn.a)(function(){return g.c.List()},function(){return"paymentsTransactionsResponse"},function(){return!0},Tf),xf=Object(Nn.a)(function(){return g.c.List()},function(){return"paymentDenials"},function(){return!0},Tf),Rf=Object(Nn.a)(function(){return g.c.List()},function(){return"paymentsFiles"},function(){return!0},Tf),Mf=Object(Nn.a)(function(){return g.c.List()},function(){return"event"},oa,Tf),Pf=Object(Nn.a)(kf,function(){return"usage"},oa,Tf),Af=Object(Nn.a)(Pf,function(){return"queue"},oa,Tf),Df=Object(Nn.a)(Ta,ka,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List();return g.c.List().withMutations(function(n){t.forEach(function(e){n.push(g.c.Map({field_name:"pg_request.".concat(e.get("field_name","")),title:"".concat(e.get("payment_gateway"),": ").concat(te(e.get("field_name",""),"bills")),type:e.getIn(["type"],"text"),payment_gateway:e.get("payment_gateway")}))}),e.forEach(function(e){n.push(e)})})}),Lf=Object(Nn.a)(Df,function(){return"bills"},oa,Tf),Uf=Object(Nn.a)(function(){return ee(["reports","entities"],g.c.List())},function(e){return e}),Vf=Object(Nn.a)(jf,If,Pf,wf,Nf,Ff,xf,Rf,Af,Mf,Lf,function(e,t,n,a,r,i,o,l,s,c,u){var p=g.c.Map({subscription:g.c.List(["sid","aid"]),customer:g.c.List(["aid"]),currentEntity:g.c.List(["firstname","lastname"])}),d=Sf(n,g.c.Map({subscription:e,customer:t}),p),m=g.c.Map({customer:g.c.List(["aid","type"]),usage:g.c.List(["firstname","lastname","sid","aid","plan"]),currentEntity:g.c.List([])}),f=Sf(e,g.c.Map({customer:t,usage:n}),m),h=t;return g.c.Map({usage:d,usage_archive:d,subscription:f,customer:h,logFile:a,paymentsTransactionsRequest:r,paymentsTransactionsResponse:i,paymentDenials:o,paymentsFiles:l,queue:s,event:c,bills:u})}),Bf=Object(Nn.a)(function(e,t,n){return e.entityList.items.get(n)},function(e){return e}),qf=Object(Nn.a)(function(e,t,n){return e.entityList.page.get(n)},function(e){return e}),zf=Object(Nn.a)(function(e,t,n){return e.entityList.nextPage.get(n)},function(e){return e}),Hf=Object(Nn.a)(function(e,t,n){return e.entityList.size.get(n)},function(e){return e}),Yf=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).initDefaultValues=function(){var e=n.props,t=e.mode,a=e.userName,r=S()().toISOString();"create"===t&&n.onChangeReportValue(["type"],Sg.SIMPLE),"clone"===t&&n.props.dispatch(Tg()),n.onChangeReportValue(["user"],a),n.onChangeReportValue(["from"],r)},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&(n.setState({progress:!0}),n.props.dispatch(Fg(e)).then(n.afterItemReceived))},n.afterItemReceived=function(e){var t=n.props.mode;n.setState({progress:!1}),e.status?(n.initDefaultValues(),"view"===t&&n.getReportData()):n.handleBack()},n.getReportData=function(){var e=n.props,t=e.item,a=e.size,r=e.page,i=n.preperReport(t);n.setState({progress:!0}),n.props.dispatch(xg({report:i,page:r,size:a})).then(n.afterReportDataReceived)},n.afterReportDataReceived=function(){n.setState({progress:!1})},n.onChangeReportValue=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a&&(n.props.dispatch(Mg(0)),n.props.dispatch(Rg()),n.setState({showPreview:!1}));var r=Array.isArray(e)?e.join("."):e,i=[],o=[];""===t&&i.includes(r)?n.props.dispatch(Ng(e)):null===t&&o.includes(r)?n.props.dispatch(Ng(e)):n.props.dispatch(wg(e,t))},n.handleDelete=function(){var e=n.props.item;n.setState({progress:!0}),n.props.dispatch(Ig(e)).then(n.afterDelete)},n.afterDelete=function(e){if(n.setState({progress:!1}),e.status){var t=ee(["systemItems","report","itemsType"],"");n.props.dispatch(Ur("The report was deleted")),n.props.dispatch(up(t)),n.handleBack()}},n.afterSave=function(e){var t=n.props,a=t.item,r=t.mode;if(n.setState({progress:!1}),e.status){var i=["clone","create"].includes(r)?"created":"updated",o=ee(["systemItems","report","itemsType"],"");if(n.props.dispatch(Ur("The report was ".concat(i))),n.props.dispatch(up(o)),"update"===r){var l=a.getIn(["_id","$id"]),s=ee(["systemItems","report","itemType"],"");n.fetchItem(),n.props.router.push("".concat(o,"/").concat(s,"/").concat(l))}else n.handleBack()}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;if(n.validate()){n.setState({progress:!0});var r=n.preperReport(t);n.props.dispatch(jg(r,a)).then(n.afterSave)}},n.handleEdit=function(){var e=n.props.location,t=e.pathname,a=e.query;n.props.router.push({pathname:t,query:Object.assign({},a,{action:"update"})})},n.handleClone=function(){var e=n.props.location,t=e.pathname,a=e.query;n.props.router.push({pathname:t,query:Object.assign({},a,{action:"clone"})})},n.handleBack=function(){var e=ee(["systemItems","report","itemsType"],"");n.props.router.push("/".concat(e))},n.validateEmptyAggregateOp=function(e){return""!==e.get("field_name","")&&""===e.get("op","")},n.validate=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=n.props.item;return e||""!==t.get("key","")?""===t.get("entity","")?(n.props.dispatch(Br("Please select entity")),!1):t.get("columns",g.c.List()).filter(n.filterColumnsEmptyRows).isEmpty()?(n.props.dispatch(Br("Please select at least one column")),!1):t.get("type",Sg.SIMPLE)!==Sg.GROPED||!t.get("columns",g.c.List()).some(n.validateEmptyAggregateOp)||(n.props.dispatch(Br("Please select column function")),!1):(n.props.dispatch(Br("Please enter name")),!1)},n.preperReport=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.withMutations(function(t){t.set("conditions",e.get("conditions",g.c.List()).filter(n.filterConditionsEmptyRows)).set("columns",e.get("columns",g.c.List()).filter(n.filterColumnsEmptyRows).update(function(t){return e.get("type",Sg.SIMPLE)===Sg.SIMPLE?t.map(function(e){return e.set("op","")}):t})).set("sorts",e.get("sorts",g.c.List()).filter(n.filterSortEmptyRows)).set("formats",e.get("formats",g.c.List()).filter(n.filterFormatsEmptyRows).map(function(e){return e.has("type")?g.c.Map({field:e.get("field"),op:e.get("op"),value:"".concat(e.get("value")," ").concat(e.get("type"))}):e}))})},n.filterConditionsEmptyRows=function(e){return[e.get("field",""),e.get("op",""),e.get("value","")].every(function(e){return""!==e})},n.filterSortEmptyRows=function(e){return[e.get("op",""),e.get("field","")].every(function(e){return""!==e})},n.filterFormatsEmptyRows=function(e){return[e.get("field",""),e.get("op",""),e.get("value","")].every(function(e){return""!==e})},n.filterColumnsEmptyRows=function(e){return[e.get("field_name","")].every(function(e){return""!==e})},n.applyFilter=function(){n.validate(!0)&&(n.setState({showPreview:!0}),n.getReportData())},n.isReportChanged=function(){var e=n.props,t=e.item,a=e.itemSource;return g.c.is(t.delete("from").delete("user"),a.delete("from").delete("user"))},n.isExportEnable=function(){var e=n.props.itemId,t=n.props.location.query.type;return"predefined"===(void 0!==t&&t)||!(!e||""===e)&&n.isReportChanged()},n.getExportReportHelpText=function(){return n.isExportEnable()?"Export Report to CSV":"Reports was changed, please save report before export."},n.onClickExportCSV=function(){var e=n.props.item,t=n.props.location.query.type;if("predefined"===(void 0!==t&&t)){var a=qi({report:e,page:0,size:99999});Qr(a)}else{var r=zi(e.get("key",""));window.open(Zr(r))}},n.onPageChange=function(e){n.props.dispatch(Mg(e))},n.onSizeChange=function(e){n.props.dispatch(Mg(0)),n.props.dispatch(Pg(e))},n.onAskDelete=function(){var e=n.props.item,t={message:'Are you sure you want to delete "'.concat(e.get("key",""),'" report ?'),onOk:n.onDeleteOk,labelOk:"Delete",type:"delete"};n.props.dispatch(ks(t))},n.onDeleteOk=function(){n.handleDelete()},n.onAskReset=function(){var e=n.props.mode,t={message:"Are you sure you want to ".concat("create"===e?"reset report":"revert report changes"," ?"),onOk:n.onResetOk,labelOk:"Yes"};n.props.dispatch(ks(t))},n.onResetOk=function(){"create"===n.props.mode?(n.props.dispatch(kg()),n.initDefaultValues()):n.fetchItem()},n.getTableFields=function(){return g.c.List().withMutations(function(e){n.props.item.get("columns",g.c.List()).filter(n.filterColumnsEmptyRows).forEach(function(t){e.push(g.c.Map({id:t.get("key",""),title:t.get("label","")}))})})},n.getListActions=function(){return[{type:"export_csv",label:"Export",helpText:"Export Report to CSV",showIcon:!0,onClick:n.onClickExportCSV,actionStyle:"primary",actionSize:"xsmall"},{type:"remove",label:"Delete",helpText:"Delete Report",showIcon:!0,onClick:n.onAskDelete,actionStyle:"danger",actionSize:"xsmall"},{type:"clone",label:"Clone",helpText:"Clone Report",showIcon:!0,onClick:n.handleClone,actionStyle:"primary",actionSize:"xsmall"},{type:"edit",label:"Edit",helpText:"Edit Report",showIcon:!0,onClick:n.handleEdit,actionStyle:"primary",actionSize:"xsmall"}]},n.getEditActions=function(){var e=n.props.mode;return[{type:"export_csv",label:"Export",helpText:n.getExportReportHelpText,showIcon:!0,onClick:n.onClickExportCSV,actionStyle:"primary",actionSize:"xsmall",enable:n.isExportEnable},{type:"reset",label:"create"===e?"Reset":"Revert Changes",actionStyle:"primary",showIcon:!1,onClick:n.onAskReset,actionSize:"xsmall"}]},n.renderPanelHeader=function(){var e=n.state,t=e.listActions,a=e.editActions,i=n.props.mode,o=n.isReportChanged();return r.a.createElement("div",null,"\xa0",r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:"view"===i?t:a,data:o})))},n.state={showPreview:!1,progress:!1,listActions:n.getListActions(),editActions:n.getEditActions()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem(),this.props.dispatch(kl(["file_types","subscribers.subscriber","subscribers.account","taxation.tax_type","lines","bills.fields","rates.fields","payment_gateways"]))}},{key:"componentDidMount",value:function(){var e=this.props.mode,t=this.props.location.query.type;if("create"===e&&"predefined"!==(void 0!==t&&t)){var n=se(e,"report");this.props.dispatch(bs(n))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||ue(t)!==ue(i)){var s=se(n,"report",t);this.props.dispatch(bs(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.page,a=t.size,r=t.mode,i=e.page,o=e.size,l=e.mode;(n!==i||a!==o||r!==l&&"view"===r)&&this.getReportData()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(kg())}},{key:"render",value:function(){var e=this.state,t=e.progress,n=e.showPreview,a=this.props,i=a.item,o=a.mode,l=a.reportFileds,s=a.reportEntities,c=a.reportData,u=a.size,p=a.page,d=a.nextPage,m=a.taxType;if("loading"===o)return r.a.createElement(_,{onClick:this.handleBack});var g="view"!==o,h=this.getTableFields(),y=g&&(!n||h.isEmpty());return r.a.createElement("div",{className:"report-setup"},r.a.createElement(f.v,{header:this.renderPanelHeader()},g&&r.a.createElement(bf,{report:i,reportFileds:l,entities:s,mode:o,taxType:m,onUpdate:this.onChangeReportValue,onFilter:this.applyFilter,progress:t}),r.a.createElement(Cf,{items:c,fields:h,page:p,size:u,onlyHeaders:y,nextPage:d,onChangePage:this.onPageChange,onChangeSize:this.onSizeChange}),r.a.createElement("div",{className:"clearfix"}),r.a.createElement("hr",{className:"mb0"}),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!g,progress:t,disableCancel:t})))}}]),t}(a.Component);Yf.defaultProps={item:g.c.Map(),itemSource:g.c.Map(),reportFileds:g.c.Map(),reportData:g.c.List(),reportEntities:g.c.List(),userName:"Unknown",mode:"loading",page:0,size:ee("listDefaultItems",10),taxType:"vat",nextPage:!1};var Gf=Object(s.f)(Object(l.connect)(function(e,t){return{userName:e.user.get("name"),itemId:Eo(e,t,"reports"),item:bo(e,t,"reports"),itemSource:yo(e,t,"reports"),mode:So(e,t,"reports"),reportFileds:Vf(e,t),reportEntities:Uf(e,t),reportData:Bf(e,t,"reportData"),page:qf(e,t,"reportData"),nextPage:zf(e,t,"reportData"),size:Hf(e,t,"reportData"),taxType:ta(e,t)}})(Yf)),Kf=function(e){var t=[{id:"description",title:"Title",sort:!0},{id:"name",title:"Key",sort:!0},{title:"Trial",parser:function(e){return e.getIn(["price",0,"trial"])?"".concat(e.getIn(["price",0,"to"])," ").concat(e.getIn(["recurrence","periodicity"])):""}},{id:"recurrence_charges",title:"Recurring Charges",parser:function(e){var t=e.getIn(["price",0,"trial"])?1:0,n=e.get("price",g.c.List()).size-t;return"".concat(n," cycles")}},{id:"recurrence_frequency",title:"Billing Frequency",parser:function(e){var t=e.getIn(["recurrence","periodicity"],"");return t?"".concat(L.a.upperCaseFirst(t),"ly"):""}},{id:"charging_mode",title:"Charging Mode",parser:function(e){return e.get("upfront")?"Upfront":"Arrears"}},{id:"connection_type",display:!1,showFilter:!1},{id:"play",title:"Play",display:e.isPlaysEnabled,parser:function(e){return e.get("play",g.c.List()).join(", ")}}];return r.a.createElement(Tp,{itemType:"plan",itemsType:"plans",filterFields:[{id:"name",placeholder:"Key"},{id:"description",placeholder:"Title"}],baseFilter:{connection_type:{$regex:"^postpaid$"}},tableFields:t,projectFields:{recurrence_frequency:1,recurrence_charges:1,connection_type:1,charging_mode:1,description:1,recurrence:1,upfront:1,price:1,play:1,name:1},showRevisionBy:"key",actions:[{type:"edit"}]})};Kf.defaultProps={isPlaysEnabled:!1};var Wf=Object(l.connect)(function(e,t){return{isPlaysEnabled:oa(e,t)}})(Kf),Jf=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={cycleError:"",priceError:""},n.onCycleUpdateValue=function(e){var t=n.props.index,a="",r=e;"undefined"===typeof e||null===e||""===e?(a="Cycle is required",r=0):!isNaN(e)&&Math.sign(e)>0||(a="Value must be positive number",r=0),n.props.onPlanCycleUpdate(t,r),n.setState({cycleError:a})},n.onCycleUpdateEvent=function(e){n.onCycleUpdateValue(e.target.value)},n.onPlanPriceUpdate=function(e){var t=n.props.index,a=e.target.value,r="";"undefined"===typeof a||null===a||""===a?r="Price is required":!isNaN(a)&&Math.sign(a)>=0||(r="Value must be positive number"),n.setState({priceError:r}),n.props.onPlanPriceUpdate(t,a)},n.onPlanTariffRemove=function(){var e=n.props.index;n.props.onPlanTariffRemove(e)},n.getCycleDisplayValue=function(){var e=n.props,t=e.item,a=e.planCycleUnlimitedValue,r=t.get("to",""),i=t.get("from","");switch(r){case a:return"Infinite";case"":return"";default:return r-i}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,a=n.count,r=n.index,i=n.mode,o=this.state,l=o.cycleError,s=o.priceError,c=a<e.count&&r===a-1,u=a>e.count&&r===a-2,p=t.cycleError!==l||t.priceError!==s;return!g.c.is(this.props.item,e.item)||r!==e.index||i!==e.mode||c||u||p}},{key:"render",value:function(){var e=this.state,t=e.cycleError,n=e.priceError,a=this.props,i=a.item,o=a.index,l=a.count,s=a.isTrialExist,c=a.planCycleUnlimitedValue,u=a.mode,p=i.get("price",""),d=i.get("trial",!1),m=i.get("to",""),g=this.getCycleDisplayValue(),h=0===o||s&&1===o,v=d||(0===l||l-1===o),y="view"!==u;return r.a.createElement(f.g,{sm:12,className:"form-inner-edit-row mb0"},r.a.createElement(f.g,{sm:2,className:"text-center"},h&&r.a.createElement(f.h,{className:"mb5"},"Period"),r.a.createElement("p",{className:"non-editable-field mb0"},o+1)),r.a.createElement(f.g,{sm:3,className:"pr0"},r.a.createElement(f.l,{validationState:t.length?"error":null,className:"ml0 mr0"},h&&r.a.createElement(f.h,{className:"mb5"},"Cycles"),m===c?r.a.createElement(Tn,{value:g,disabled:!0,editable:y}):r.a.createElement(Tn,{value:g,onChange:this.onCycleUpdateEvent,fieldType:"number",min:0,editable:y}),t.length>0&&r.a.createElement(f.n,null,t,"."))),r.a.createElement(f.g,{sm:3,className:"pr0"},r.a.createElement(f.l,{validationState:n.length?"error":null,className:"ml0 mr0"},h&&r.a.createElement(f.h,{className:"mb5"},"Price"),r.a.createElement(Tn,{onChange:this.onPlanPriceUpdate,value:p,editable:y,fieldType:"price"}),n.length>0&&r.a.createElement(f.n,null,n,"."))),r.a.createElement(f.g,{sm:4},v&&y&&r.a.createElement(f.l,{className:"actions ml0 mr0"},h&&r.a.createElement(f.h,{className:"mb5"},"\xa0"),r.a.createElement("div",{className:"text-left"},r.a.createElement(f.c,{onClick:this.onPlanTariffRemove,bsSize:"small"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))))}}]),t}(a.Component);Jf.defaultProps={planCycleUnlimitedValue:ee("planCycleUnlimitedValue","UNLIMITED"),mode:"create"};var $f=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={errors:{name:""}},n.onPlanTrailTariffInit=function(e){n.props.onPlanTariffAdd(!0)},n.onPlanTariffInit=function(e){n.props.onPlanTariffAdd()},n.onChangePlanName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=ee("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.onChangeFieldValue(["name"],r)},n.onChangeProrated=function(e){var t=e.target,a=t.value,r=t.id;n.props.onChangeFieldValue([r],a)},n.onChangePlanDescription=function(e){var t=e.target.value;n.props.onChangeFieldValue(["description"],t)},n.onChangePlays=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=""===e?[]:e.split(",");n.props.onChangeFieldValue(["play"],g.c.List(a)),t&&(n.props.onChangeFieldValue(["rates"],g.c.Map()),n.props.onChangeFieldValue(["include","groups"],g.c.Map()),n.props.onChangeFieldValue(["include","services"],g.c.List()))},n.onChangePlanEach=function(e){var t=parseInt(e.target.value);t=isNaN(t)?"":t,n.props.onChangeFieldValue(["recurrence","unit"],t)},n.onChangePeriodicity=function(e){n.props.onChangeFieldValue(["recurrence","periodicity"],e)},n.onPlanPriceUpdate=function(e,t){var a=x()(t)?parseFloat(t):t;n.props.onChangeFieldValue(["price",e,"price"],a)},n.onChangeUpfront=function(e){"TRUE"===e.toUpperCase()?e=!0:"FALSE"===e.toUpperCase()&&(e=!1),n.props.onChangeFieldValue(["upfront"],e)},n.onChangeAdditionalField=function(e,t){n.props.onChangeFieldValue(e,t)},n.onRemoveAdditionalField=function(e){n.props.onRemoveField(e)},n.getAddPriceButton=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?n.onPlanTrailTariffInit:n.onPlanTariffInit;return r.a.createElement(ct,{onClick:t,label:"Add New"})},n.getTrialPrice=function(){var e=n.props,t=e.plan,a=e.mode,i="view"!==a,o=!0===t.getIn(["price",0,"trial"])?t.getIn(["price",0]):null;return o?r.a.createElement(Jf,{index:0,count:t.get("price",g.c.List()).size,item:o,mode:a,isTrialExist:!0,onPlanPriceUpdate:n.onPlanPriceUpdate,onPlanCycleUpdate:n.props.onPlanCycleUpdate,onPlanTariffAdd:n.props.onPlanTariffAdd,onPlanTariffRemove:n.props.onPlanTariffRemove}):i?n.getAddPriceButton(!0):null},n.getPrices=function(){var e=n.props,t=e.plan,a=e.mode,i=!0===t.getIn(["price",0,"trial"])||"true"===t.getIn(["price",0,"trial"]),o=t.get("price",g.c.List()).size,l=[];return t.get("price",g.c.List()).forEach(function(e,t){!0!==e.get("trial")&&l.push(r.a.createElement(Jf,{key:t,index:t,count:o,item:e,mode:a,isTrialExist:i,onPlanPriceUpdate:n.onPlanPriceUpdate,onPlanCycleUpdate:n.props.onPlanCycleUpdate,onPlanTariffRemove:n.props.onPlanTariffRemove}))}),l},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){0===this.props.plan.get("price",g.c.List()).size&&this.props.onPlanTariffAdd()}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.plan,a=t.mode,i=t.periodicityOptions,o=t.chargingModeOptions,l=n.getIn(["recurrence","periodicity"])||"",s="boolean"!==typeof n.get("upfront")?"":n.get("upfront","").toString(),c="view"!==a;return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,null,r.a.createElement(Fp,{entity:n,editable:c&&"create"===a,multi:!0,onChange:this.onChangePlays}),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("description",ne("service"),Object(D.sentenceCase)("title")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ao,{contents:Do.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.get("description",""),onChange:this.onChangePlanDescription,editable:c}))),["clone","create"].includes(a)&&r.a.createElement(f.l,{validationState:e.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("name",ne("service"),Object(D.sentenceCase)("key")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ao,{contents:Do.name})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{id:"PlanName",onChange:this.onChangePlanName,value:n.get("name",""),required:!0,editable:c}),e.name.length>0&&r.a.createElement(f.n,null,e.name))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Billing Frequency",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{fieldType:"select",options:i,onChange:this.onChangePeriodicity,value:l,editable:c}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Charging Mode",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{fieldType:"select",options:o,onChange:this.onChangeUpfront,value:s,editable:c}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Proration\u200e"),r.a.createElement(f.g,{sm:8,lg:9,className:"pt5"},r.a.createElement(Tn,{fieldType:"checkbox",value:n.get("prorated_start",""),onChange:this.onChangeProrated,className:"mr10 inline",label:"Prorated start",editable:c,id:"prorated_start"}),r.a.createElement(Tn,{fieldType:"checkbox",value:n.get("prorated_end",""),onChange:this.onChangeProrated,className:"mr10 inline",label:"Prorate old plan charge on plan change",editable:c,id:"prorated_end"}),r.a.createElement(Tn,{fieldType:"checkbox",value:n.get("prorated_termination",""),onChange:this.onChangeProrated,className:"inline",label:"Prorate charge on termination",editable:c,id:"prorated_termination"}))),r.a.createElement(Fd,{entityName:"plans",entity:n,onChangeField:this.onChangeAdditionalField,onRemoveField:this.onRemoveAdditionalField,editable:c})),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Trial Period")},this.getTrialPrice()),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Recurring Charges")},this.getPrices(),r.a.createElement("br",null),c&&this.getAddPriceButton(!1)))))}}]),t}(a.Component);$f.defaultProps={periodicityOptions:[{value:"month",label:"Monthly"},{value:"year",label:"Yearly"}],chargingModeOptions:[{value:"true",label:"Upfront"},{value:"false",label:"Arrears"}],errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var Qf=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).addDefaultPriceIfNoPrice=function(e,t,a,r){var i=null!==r;if(0===a.size&&!i){var o=["rates",e.get("key",""),t,"rate"];n.props.onProductInitRate(e,o)}},n.onProductEditRate=function(e,t,a){var r=n.props,i=r.item,o=r.usaget,l=i.get("key");switch(t){case"to":var s=["rates",l,o,"rate"];n.props.onProductEditRateTo(s,e,a);break;default:var c=["rates",l,o,"rate",e,t];n.props.onProductEditRate(c,a)}},n.onProductAddRate=function(){var e=n.props,t=e.item,a=e.usaget,r=["rates",t.get("key"),a,"rate"];n.props.onProductAddRate(r)},n.onProductRemoveRate=function(e){var t=n.props,a=t.item,r=t.usaget,i=["rates",a.get("key"),r,"rate"];n.props.onProductRemoveRate(i,e)},n.onProductRemove=function(){var e=n.props.item.get("key");n.props.onProductRemove(["rates"],e)},n.onProductRestore=function(){var e=n.props,t=e.item,a=e.usaget,r=["rates",t.get("key",""),a,"rate"];n.props.onProductRestore(t,r)},n.onChangeOverrideType=function(e){var t=n.props,a=t.item,r=t.usaget,i=a.get("key");if("percentage"===e.target.value){var o=g.c.Map(Object(ti.a)({},r,g.c.Map({percentage:100}))),l=["rates",i];n.props.onProductEditRate(l,o)}else{var s=g.c.Map(Object(ti.a)({},r,g.c.Map({rate:g.c.List()}))),c=["rates",i];n.props.onProductEditRate(c,s)}},n.onChangePercentage=function(e){var t=e.target.value,a=n.props,r=a.item,i=a.usaget,o=x()(t)?parseFloat(t):t,l=["rates",r.get("key"),i,"percentage"];n.props.onProductEditRate(l,o)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.item,n=e.usaget,a=e.prices,r=e.percentage;this.addDefaultPriceIfNoPrice(t,n,a,r)}},{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,a=n.prices,r=n.mode,i=n.usageTypes,o=n.propertyTypes,l=n.percentage;return!g.c.is(a,e.prices)||r!==e.mode||l!==e.percentage||!g.c.is(a,e.prices)||!g.c.is(i,e.usageTypes)||!g.c.is(o,e.propertyTypes)}},{key:"componentWillUpdate",value:function(e,t){var n=e.item,a=e.usaget,r=e.prices,i=e.percentage;this.addDefaultPriceIfNoPrice(n,a,r,i)}},{key:"render",value:function(){var e=this,t=this.props,n=t.item,a=t.prices,i=t.usaget,o=t.mode,l=t.propertyTypes,s=t.usageTypes,c=t.percentage,u=a.getIn([0,"uom_display","range"],""),p="view"!==o,d=a.size,m=null!==c,g="volume"===n.get("pricing_method","Tiered")?"Volume":"Tiered",h=r.a.createElement("h3",null,"".concat(n.get("key")," (").concat(i,") ")," ",r.a.createElement("i",null,n.get("code","")),r.a.createElement(Ao,{contents:n.get("description","")}),p&&r.a.createElement(f.c,{onClick:this.onProductRemove,bsSize:"xsmall",className:"pull-right",style:{minWidth:80}},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove"),p&&r.a.createElement(f.c,{onClick:this.onProductRestore,bsSize:"xsmall",className:"pull-right",style:{marginRight:10,minWidth:80}},r.a.createElement("i",{className:"fa fa-undo fa-lg"})," \xa0Undo Changes "));return r.a.createElement(f.v,{header:h},p&&r.a.createElement(f.l,{className:"mb0"},r.a.createElement("span",{className:"inline mr10"},r.a.createElement(Tn,{fieldType:"radio",value:"no",onChange:this.onChangeOverrideType,name:"".concat(n.get("key"),"-override-type"),label:"Override with specific prices",checked:!m})),r.a.createElement("span",{className:"inline"},r.a.createElement(Tn,{className:"inline mr10",fieldType:"radio",value:"percentage",onChange:this.onChangeOverrideType,name:"".concat(n.get("key"),"-override-type"),label:"Override by percentage of the original price",checked:m}),m&&r.a.createElement(Tn,{style:{display:"inline-block",width:115,verticalAlign:"middle"},fieldType:"number",onChange:this.onChangePercentage,value:c,editable:p,suffix:"%",max:100,min:0,step:1}))),m&&!p&&r.a.createElement(f.l,{className:"mb0"},r.a.createElement("span",null,"Original price overridden by: "),r.a.createElement(Tn,{style:{display:"inline-block",width:115,verticalAlign:"middle"},fieldType:"number",value:c,editable:!1,suffix:"%"})),!m&&r.a.createElement(f.l,{style:{margin:3}},r.a.createElement(f.h,null,"".concat(g," Pricing"))),!m&&a.map(function(t,a){return r.a.createElement(f.g,{sm:12,key:"".concat(n.get("key",a),"_").concat(a)},r.a.createElement(Hm,{item:t,index:a,mode:o,count:d,unit:je(l,s,i,u),onProductEditRate:e.onProductEditRate,onProductRemoveRate:e.onProductRemoveRate}))}),!m&&p&&r.a.createElement(f.l,{style:{margin:0}},r.a.createElement(ct,{onClick:this.onProductAddRate,label:"Add New",buttonStyle:{marginTop:0}})))}}]),t}(a.Component);Qf.defaultProps={item:g.c.Map(),prices:g.c.List(),usageTypes:g.c.List(),propertyTypes:g.c.List(),mode:"create",percentage:null};var Zf=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onProductUndoRemove=function(){var e=n.props.item.get("key");n.props.onProductUndoRemove(e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.usaget,a=r.a.createElement("h3",{className:"product-removed"},t.get("key","")," (",n,") ",r.a.createElement("i",null,t.get("code","")),r.a.createElement(Ao,{contents:t.get("description","")}),r.a.createElement(f.c,{onClick:this.onProductUndoRemove,bsSize:"xsmall",className:"pull-right",style:{minWidth:80}},r.a.createElement("i",{className:"fa fa-mail-reply"}),"\xa0Undo"));return r.a.createElement(f.v,{header:a})}}]),t}(a.Component);Zf.defaultProps={item:g.c.Map()};var Xf=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={val:"",rates:[]},n.onSelectProduct=function(e){e&&n.props.onSelectProduct(e),n.setState({val:""})},n.getProducts=function(){return ei(n.props.searchFunction).then(function(e){var t=e.data[0].data.details.map(function(e){return{value:e.key,label:"".concat(e.key," (").concat(e.description,")"),play:e.play}});n.setState({rates:t})}).catch(function(){n.setState({options:[]})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.getProducts()}},{key:"render",value:function(){var e=this.state,t=e.val,n=e.rates.filter(this.props.filterFunction);return r.a.createElement(Tn,{fieldType:"select",value:t,options:n,onChange:this.onSelectProduct,placeholder:"Search by product key or title...",noResultsText:"No products found, please try another key"})}}]),t}(a.Component);Xf.defaultProps={searchFunction:Oi({key:1,description:1}),filterFunction:function(){return!0}};var eh=function(e,t,n){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_REMOVE"),path:t,name:n}},th=function(e,t,n){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_RATE_INIT"),product:t,path:n}},nh=function(e,t){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_RATE_ADD"),path:t}},ah=function(e,t,n){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_RATE_REMOVE"),path:t,index:n}},rh=function(e,t,n){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_RATE_UPDATE"),path:t,value:n}},ih=function(e,t,n,a){return{type:"".concat(e.toUpperCase(),"_PRODUCTS_RATE_UPDATE_TO"),path:t,index:n,value:a}},oh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).addNewProductToPlan=function(e){var t=n.props,a=t.products,r=t.propertyTypes,i=t.usageTypesData,o=t.itemName;e.forEach(function(e){var t=a.find(function(t){return t.get("key","")===e.key});if(t){var l=t.get("rates",g.c.Map()).keySeq().first(),s=["rates",t.get("key",""),l,"rate"],c=Ne(r,i,t,!1),u=c.isEmpty()?t:t.set("rates",c);n.props.dispatch(th(o,u,s))}})},n.onSelectProduct=function(e){n.props.planRates.has(e)?n.props.dispatch(Vr("Price of product ".concat(e," already overridden"))):n.props.dispatch(to("plan_products",Fi(e))).then(function(e){e.status&&n.addNewProductToPlan(e.data)})},n.onProductRestore=function(e,t){var a=n.props,r=a.originalRates,i=a.itemName,o=e.get("key");if(r.keySeq().includes(o)){var l=r.get(o,g.c.Map());n.props.onChangeFieldValue(["rates",o],l),n.props.dispatch(qr("Product ".concat(o," prices for this plan restored to origin state")))}else n.props.dispatch(th(i,e,t)),n.props.dispatch(qr("Product ".concat(o," prices for this plan restored to BASE state")))},n.onProductRemove=function(e,t){var a=n.props.itemName;n.props.dispatch(eh(a,e,t))},n.onProductUndoRemove=function(e){var t=n.props.originalRates.get(e,g.c.Map());n.props.onChangeFieldValue(["rates",e],t),n.props.dispatch(Ur("Product ".concat(e," prices restored")))},n.onProductRemoveRate=function(e,t){var a=n.props.itemName;n.props.dispatch(ah(a,e,t))},n.onProductEditRate=function(e,t){var a=n.props.itemName;n.props.dispatch(rh(a,e,t))},n.onProductEditRateTo=function(e,t,a){var r=n.props.itemName;n.props.dispatch(ih(r,e,t,a))},n.onProductAddRate=function(e){var t=n.props.itemName;n.props.dispatch(nh(t,e))},n.onProductInitRate=function(e,t){var a=n.props.itemName;n.props.dispatch(th(a,e,t))},n.renderNoItems=function(){return r.a.createElement(f.g,{lg:12}," No overridden prices for this plan ")},n.getRemovedProductKeys=function(){var e=n.props,t=e.planRates,a=e.originalRates,r=t.map(function(e,t){return t});return a.reduce(function(e,t,n){return r.includes(n)?e:e.push(n)},g.c.List())},n.renderRemovedItems=function(){var e=n.props,t=e.products,a=e.originalRates;return n.getRemovedProductKeys().map(function(e){var i=t.find(function(t){return t.get("key","")===e},null,g.c.Map({key:e})),o=a.get(e).keySeq().first();return r.a.createElement(Zf,{key:i.getIn(["_id","$id"],i.get("key",e)),usaget:o,item:i,onProductUndoRemove:n.onProductUndoRemove})})},n.renderItems=function(){var e=n.props,t=e.products,a=e.planRates,i=e.usageTypesData,o=e.propertyTypes,l=e.mode;return a.reverse().map(function(e,a){var s=e.keySeq().first(),c=e.getIn([s,"rate"],g.c.List()),u=e.getIn([s,"percentage"],null),p=t.find(function(e){return e.get("key","")===a},null,g.c.Map({key:a}));return r.a.createElement(Qf,{key:p.getIn(["_id","$id"],p.get("key")),item:p,prices:c,percentage:u,usaget:s,mode:l,onProductInitRate:n.onProductInitRate,onProductRemoveRate:n.onProductRemoveRate,onProductAddRate:n.onProductAddRate,onProductEditRate:n.onProductEditRate,onProductEditRateTo:n.onProductEditRateTo,onProductRemove:n.onProductRemove,onProductRestore:n.onProductRestore,usageTypes:i,propertyTypes:o})}).toList().toArray()},n.filterByPlay=function(e){var t=n.props.plays;return""===t||!e.play||t.split(",").includes(e.play)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.planRates;if(!e.isEmpty()){var t=e.keySeq();this.props.dispatch(eo("plan_products",Pi(t.toArray())))}}},{key:"componentWillReceiveProps",value:function(e){var t=e.planRates,n=e.products,a=this.props.planRates;if(!g.c.is(t,a)){var r=t.keySeq().filter(function(e){return-1===n.findIndex(function(t){return t.get("key","")===e})});r.isEmpty()||this.props.dispatch(to("plan_products",Pi(r.toArray())))}}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Xi("plan_products"))}},{key:"render",value:function(){var e=this.props,t=e.planRates,n="view"!==e.mode,a=r.a.createElement("h3",null,"Select Products to Override Price ",r.a.createElement(Ao,{contents:Do.add_product}));return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,null,n&&r.a.createElement(f.v,{header:a},r.a.createElement(Xf,{onSelectProduct:this.onSelectProduct,searchFunction:Oi({key:1,description:1,play:1}),filterFunction:this.filterByPlay})),this.renderRemovedItems(),this.renderItems(),t.isEmpty()&&this.renderNoItems())))}}]),t}(a.Component);oh.defaultProps={planRates:g.c.Map(),usageTypesData:g.c.List(),propertyTypes:g.c.List(),plays:"",mode:"create",originalRates:g.c.Map(),products:g.c.List()};var lh=Object(l.connect)(function(e,t){return{originalRates:Io(e,t,t.itemName),products:e.list.get("plan_products"),usageTypesData:ha(e,t),propertyTypes:va(e,t)}})(oh),sh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={options:[]},n.onChangeGroupRates=function(e){var t=e.length?e.split(","):[];n.props.onChangeGroupRates(g.c.List(t))},n.loadOptions=function(){var e=n.props,t=e.usages,a=e.existingProducts,r=e.plays,i=a.toArray(),o=ni(t.toArray(),i,r);return ei(o).then(function(e){var t=Object(N.a)(new Set(e.data[0].data.details.map(function(e){return e.key}))).map(function(e){return{value:e,label:e}});n.setState({options:t})}).catch(function(){n.setState({options:[]})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.loadOptions()}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.usages,a=e.products,i=this.state.options;return"undefined"===typeof n?null:r.a.createElement(Tn,{fieldType:"select",multi:!0,value:a.join(","),options:i,onChange:this.onChangeGroupRates,disabled:t,placeholder:"Add product...",noResultsText:"No products found.",searchPromptText:"Type product key to search"})}}]),t}(a.Component);sh.defaultProps={disabled:!1,existingProducts:g.c.List(),products:g.c.List(),usages:g.c.List(),plays:""};var ch=function(e){return ee("keyUppercaseRegex",/./).test(e)},uh=function(e){return"UNLIMITED"===e||function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?/^[+]?\d+$/.test(e):/^[+-]?\d+$/.test(e)}(e,!0)},ph=function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?/^[+]?\d+(\.\d+)?$/.test(e):/^[+-]?\d+(\.\d+)?$/.test(e)}(e,!0)},dh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={isEditMode:!1,showConfirm:!1,errorInclude:"",errorUoM:"",unit:""},n.errors={include:{required:"Include is required",allowedCharacters:"Include must be positive number or Unlimited",allowedCharactersMonetary:"Include must be positive number"},products:{required:"Products is required"},uom:{required:"Units are required"}},n.isMonetaryBased=function(){return"cost"===n.props.usages.get(0,"")},n.onChangeInclud=function(e){var t=n.props.name,a="";""===e?a=n.errors.include.required:n.isMonetaryBased()&&!ph(e)?a=n.errors.include.allowedCharactersMonetary:n.isMonetaryBased()||uh(e)||(a=n.errors.include.allowedCharacters);var r=n.isMonetaryBased()?"cost":"value",i=x()(e)?parseFloat(e):e;n.props.onChangeFieldValue(["include","groups",t,r],i),n.setState({errorInclude:a})},n.onChangeIncludeMonetaryBased=function(e){var t=e.target.value;n.onChangeInclud(t)},n.onChangeShared=function(e){var t=e.target.checked,a=n.props.name;n.props.onChangeFieldValue(["include","groups",a,"account_shared"],t),t||(n.props.onChangeFieldValue(["include","groups",a,"account_pool"],!1),n.props.onChangeFieldValue(["include","groups",a,"quantity_affected"],!1))},n.onChangePooled=function(e){var t=e.target.checked,a=n.props.name;n.props.onChangeFieldValue(["include","groups",a,"account_pool"],t),t||n.props.onChangeFieldValue(["include","groups",a,"quantity_affected"],!1)},n.onChangeQuantityAffected=function(e){var t=e.target.checked,a=n.props.name;n.props.onChangeFieldValue(["include","groups",a,"quantity_affected"],t)},n.onChangeGroupRates=function(e){var t=n.props.name;n.props.onChangeGroupProducts(t,e)},n.onChangeUnit=function(e){var t=n.props,a=t.name,r=t.usageTypes,i=""===e?n.errors.uom.required:"";n.setState({unit:e,errorUoM:i}),r.forEach(function(t){return n.props.onChangeFieldValue(["include","groups",a,"usage_types",t,"unit"],e)})},n.onGroupRemoveAsk=function(){n.setState({showConfirm:!0})},n.onGroupRemoveOk=function(){var e=n.props,t=e.name,a=e.products;n.props.onGroupRemove(t,a),n.setState({showConfirm:!1})},n.onGroupRemoveCancel=function(){n.setState({showConfirm:!1})},n.toggleBoby=function(){var e=n.state,t=e.errorInclude,a=e.errorUoM;""===t&&""===a&&n.setState({isEditMode:!n.state.isEditMode})},n.getListActions=function(){var e="view"!==n.props.mode;return[{type:"edit",helpText:"Edit group",onClick:n.toggleBoby,enable:e,actionClass:"pl0 pr0"},{type:"remove",helpText:"Remove Group",onClick:n.onGroupRemoveAsk,enable:e,actionClass:"pl0 pr0"}]},n.renderProductsTooltip=function(e){return r.a.createElement(f.C,{id:e},e)},n.renderEdit=function(){var e=n.props,t=e.name,a=e.value,i=e.usages,o=e.shared,l=e.pooled,s=e.quantityAffected,c=e.products,u=e.usedProducts,p=e.usaget,d=e.unit,m=e.type,g=e.plays,h=n.state,v=h.isEditMode,y=h.errorInclude,b=h.errorUoM;return r.a.createElement(f.r,{show:v,bsSize:"large"},r.a.createElement(f.r.Header,{closeButton:!1},r.a.createElement(f.r.Title,null,"Edit ",t," ",r.a.createElement("i",null,i.join(", ")))),r.a.createElement(f.r.Body,null,r.a.createElement(f.j,{horizontal:!0,className:"mb0"},r.a.createElement(f.l,{validationState:y.length>0||b.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:2},"Include"),r.a.createElement(f.g,{sm:5},n.isMonetaryBased()?r.a.createElement(Tn,{onChange:n.onChangeIncludeMonetaryBased,value:a,fieldType:"text"}):r.a.createElement(Tn,{onChange:n.onChangeInclud,value:a,fieldType:"unlimited"}),y.length>0&&r.a.createElement(f.n,null,y)),!n.isMonetaryBased()&&r.a.createElement(f.g,{sm:3},r.a.createElement(Dp,{showSelectTypes:!1,showUnits:!0,enabled:!0,usaget:p,onChangeUnit:n.onChangeUnit,unit:d}),b.length>0&&r.a.createElement(f.n,null,b))),r.a.createElement(f.l,null,r.a.createElement(f.g,{smOffset:2,sm:9},r.a.createElement(f.f,{checked:o,onChange:n.onChangeShared},"Share with all account's subscribers",r.a.createElement(Ao,{contents:Uo.shared_desc})))),r.a.createElement(f.l,null,r.a.createElement(f.g,{smOffset:2,sm:9},r.a.createElement(f.f,{disabled:!o,checked:l,onChange:n.onChangePooled},"Includes is pooled?",r.a.createElement(Ao,{contents:Uo.pooled_desc})))),"service"===m&&r.a.createElement(f.l,null,r.a.createElement(f.g,{smOffset:2,sm:9},r.a.createElement(f.f,{checked:s,onChange:n.onChangeQuantityAffected},"Multiply by Service Quantity",r.a.createElement(Ao,{contents:Uo.quantityAffected_desc})))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:2},"Products"),r.a.createElement(f.g,{sm:9},r.a.createElement("div",{style:{marginTop:10,minWidth:250,width:"100%",minHeight:42}},r.a.createElement(sh,{products:c,usages:i,existingProducts:u.toList(),onChangeGroupRates:n.onChangeGroupRates,plays:g})))))),r.a.createElement(f.r.Footer,null,r.a.createElement(f.c,{onClick:n.toggleBoby,bsStyle:"primary",bsSize:"small",style:{minWidth:90}},"OK")))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.value,a=e.usages,i=e.shared,o=e.pooled,l=e.quantityAffected,s=e.products,c=e.unit,u=this.state.showConfirm,p="Are you sure you want to remove ".concat(t," group?"),d=i?"Yes":"No",m=o?"Yes":"No",g=l?"Yes":"No",h=s.join(", "),v=L.a.titleCase(n),y=this.renderProductsTooltip(h),b=this.getListActions();return r.a.createElement("tr",{className:"List"},r.a.createElement("td",{className:"td-ellipsis"},t),r.a.createElement("td",{className:"td-ellipsis"},a.join(", ")),r.a.createElement("td",{className:"td-ellipsis"},v),r.a.createElement("td",{className:"td-ellipsis"},c),r.a.createElement("td",{className:"td-ellipsis"},r.a.createElement(f.t,{placement:"left",overlay:y},r.a.createElement("span",null,h))),r.a.createElement("td",{className:"td-ellipsis text-center"},d),r.a.createElement("td",{className:"td-ellipsis text-center"},m),r.a.createElement("td",{className:"td-ellipsis text-center"},g),r.a.createElement("td",{className:"text-right row pr0 pl0"},r.a.createElement(vt,{actions:b}),r.a.createElement(lt,{onOk:this.onGroupRemoveOk,onCancel:this.onGroupRemoveCancel,show:u,message:p,labelOk:"Yes"}),this.renderEdit()))}}]),t}(a.Component);dh.defaultProps={products:g.c.List(),usedProducts:g.c.List(),shared:!1,pooled:!1,quantityAffected:!1,mode:"create",plays:"",unit:"",usaget:"",usageTypes:g.c.List(),type:""};var mh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state=Object.assign({},t.defaultState),n.errors={name:{required:"Group name is required",exist:"Group name already exists",allowedCharacters:"Group name contains illegal characters, name should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"},usage:{required:"Usage type is required",exist:"Group with same name and usage type already exists"},unit:{required:"Unit is required"},include:{required:"Include is required",allowedCharacters:"Include must be positive number or Unlimited",allowedCharactersMonetary:"Include must be positive number"},products:{required:"Products is required",exist:"Product(s) already exist in another group : "}},n.validateStep=function(e){var t=n.state.steps;switch(e){case t.get("SetNameAndType",{index:-1}).index:var a=n.props.existinGrousNames,r=n.errors.name,i=n.state.name;return""===i?(n.setState({error:r.required}),!1):a.includes(i)?(n.setState({error:r.exist}),!1):!!ch(i)||(n.setState({error:r.allowedCharacters}),!1);case t.get("SetUsageType",{index:-1}).index:var o=n.errors,l=o.usage,s=o.unit,c=n.state,u=c.usages,p=c.unit;return u.includes("")?(n.setState({error:l.required}),!1):""!==p||(n.setState({error:s.required}),!1);case t.get("SetIncludes",{index:-1}).index:var d=n.errors.include,m=n.state.include;return""===m?(n.setState({error:d.required}),!1):!!uh(m)||(n.setState({error:d.allowedCharacters}),!1);case t.get("SetProducts",{index:-1}).index:var g=n.props.usedProducts,f=n.errors.products,h=n.state.products;if(h.size<1)return n.setState({error:f.required}),!1;var v=h.filter(function(e){return g.includes(e)});return!v.size||(n.setState({error:f.exist+v.join(", ")}),!1);default:return!0}},n.onChangeGroupName=function(e){var t=e.target.value.toUpperCase(),a=t.length&&!ch(t)?n.errors.name.allowedCharacters:"";n.setState({name:t,error:a})},n.onChangeShared=function(e){var t=e.target.checked;t?n.setState({shared:t}):n.setState({shared:t,pooled:!1})},n.onChangePooled=function(e){var t=e.target.checked;n.setState({pooled:t})},n.onChangeQuantityAffected=function(e){var t=e.target.checked;n.setState({quantityAffected:t})},n.onChangeUnit=function(e){n.setState({unit:e,error:""})},n.onChangeInclud=function(e){var t=uh(e)?"":n.errors.include.allowedCharacters,a=x()(e)?parseFloat(e):e;n.setState({include:a,error:t})},n.onChangeIncludeMonetaryBased=function(e){var t=e.target.value,a=ph(t)?"":n.errors.include.allowedCharactersMonetary,r=x()(t)?parseFloat(t):t;n.setState({include:r,error:a})},n.onChangeGroupRates=function(e){n.setState({products:g.c.List(e),error:""})},n.handlePrev=function(){var e=n.state.stepIndex;e>0&&n.setState({stepIndex:e-1,error:""})},n.handleNext=function(){var e=n.state.stepIndex;n.validateStep(e)&&n.setState({stepIndex:e+1})},n.resetState=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n.setState(Object.assign({},t.defaultState,{open:e}))},n.handleCancel=function(){n.resetState(!1)},n.handleFinish=function(){var e=n.state,t=e.stepIndex,a=e.name,r=e.usages,i=e.unit,o=e.include,l=e.products,s=e.shared,c=e.pooled,u=e.quantityAffected;n.validateStep(t)&&(n.props.addGroup(a,r,i,o,s,c,u,l),n.resetState(!1))},n.handleReset=function(){n.resetState()},n.handleToggleBoby=function(){n.setState({open:!n.state.open})},n.noMoreOptions=function(){var e=n.state,t=e.usagesPropertyType,a=e.usages,r=n.props.usageTypesData.filter(function(e){return t===e.get("property_type","")});return a.size>=r.size},n.onChangeBasedOn=function(e){var t,a=n.props.usageTypesData,r="monetary"===e.target.value,i="";r?(i="cost",t=g.c.Map({SetNameAndType:{index:0,label:"Set Name & Type"},SetIncludes:{index:1,label:"Set Includes"},SetProducts:{index:2,label:"Set Products"}})):t=g.c.Map({SetNameAndType:{index:0,label:"Set Name & Type"},SetUsageType:{index:1,label:"Set Usage Type"},SetIncludes:{index:2,label:"Set Includes"},SetProducts:{index:3,label:"Set Products"}}),n.setState({monetaryBased:r,steps:t,usages:g.c.List([i]),usagesPropertyType:ke(a,i),unit:"",products:g.c.List(),error:""})},n.onClickAddUnitType=function(){var e=n.state.usages;n.setState({usages:e.push("")})},n.onRemoveUnitType=function(e){return function(){var t=n.state.usages;n.setState({usages:t.delete(e)})}},n.onChangeUnitType=function(e){return function(t){var a=n.props.usageTypesData,r=n.state.usages;if(0===e){var i=ke(a,t);n.setState({usages:g.c.List([t]),usagesPropertyType:i,unit:"",products:g.c.List(),error:""})}else n.setState({usages:r.set(e,t),error:""})}},n.filterUsageTypes=function(e){return function(t){var a=n.state,r=a.usages,i=a.usagesPropertyType;return[-1,e].includes(r.findIndex(function(e){return e===t.get("usage_type","")}))&&(""===i||t.get("property_type","")===i)}},n.getUsagesLabel=function(){return n.state.usages.map(function(e){return L.a.sentenceCase(e)}).join(", ")},n.getStepContent=function(e){var t=n.props,a=t.usedProducts,i=t.currency,o=t.propertyTypes,l=t.usageTypesData,s=t.type,c=t.plays,u=n.state,p=u.name,d=u.products,m=u.include,g=u.usages,h=u.unit,v=u.shared,y=u.pooled,b=u.quantityAffected,E=u.error,C=u.monetaryBased,_=u.steps,O=a.push.apply(a,Object(N.a)(d)),S=C?"Total ".concat(vd()(i)," included"):r.a.createElement(r.a.Fragment,null,je(o,l,g.get(0,""),h)," includes",r.a.createElement("br",null)," (",n.getUsagesLabel(),")");switch(e){case _.get("SetNameAndType",{index:-1}).index:return[r.a.createElement(f.l,{key:"group_name",validationState:E.length>0?"error":null,className:"mb10"},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Name",r.a.createElement(Ao,{contents:Uo.name})),r.a.createElement(f.g,{sm:8},r.a.createElement(f.k,{type:"text",placeholder:"Enter Group Name..",value:p,onChange:n.onChangeGroupName}),E.length>0&&r.a.createElement(f.n,null,E))),r.a.createElement(f.l,{key:"group_type",validationState:E.length>0?"error":null,style:{marginBottom:8}},r.a.createElement(f.g,{smOffset:3,sm:8},r.a.createElement(Tn,{fieldType:"radio",name:"based-on",id:"usage-based",value:"usage",onChange:n.onChangeBasedOn,checked:!C,label:"\xa0Usage based"}),r.a.createElement(Tn,{fieldType:"radio",name:"based-on",id:"monetary-based",value:"monetary",checked:C,onChange:n.onChangeBasedOn,label:"\xa0Monetary based"})))];case _.get("SetUsageType",{index:-1}).index:return r.a.createElement("div",null,g.map(function(e,t){return r.a.createElement(f.l,{validationState:E.length>0?"error":null,key:"usages_".concat(e,"_").concat(t)},r.a.createElement(f.g,{componentClass:f.h,sm:3},0===t?"Unit Type/s":""),r.a.createElement(f.g,{sm:8},r.a.createElement(Dp,{usaget:e,unit:h,onChangeUsaget:n.onChangeUnitType(t),onChangeUnit:n.onChangeUnit,showUnits:0===t,showAddButton:0===t,usagetFilter:n.filterUsageTypes(t)})),0!==t&&r.a.createElement(f.g,{sm:1,className:"pr0 pl0"},r.a.createElement(f.c,{onClick:n.onRemoveUnitType(t),bsStyle:"link",className:"pl0"},r.a.createElement("i",{className:"fa fa-fw danger-red fa-trash-o"}))))}),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3}),r.a.createElement(f.g,{sm:8},r.a.createElement(ct,{onClick:n.onClickAddUnitType,label:"Additional",disabled:""===g.get(0,"")||n.noMoreOptions()}))));case _.get("SetIncludes",{index:-1}).index:return[r.a.createElement(f.l,{validationState:E.length>0?"error":null,key:"".concat(g.get(0,""),"_includes"),className:"mb10"},r.a.createElement(f.g,{componentClass:f.h,sm:3},S),r.a.createElement(f.g,{sm:7},C?r.a.createElement(Tn,{onChange:n.onChangeIncludeMonetaryBased,value:m,fieldType:"text"}):r.a.createElement(Tn,{onChange:n.onChangeInclud,value:m,fieldType:"unlimited"}),E.length>0&&r.a.createElement(f.n,null,E))),r.a.createElement(f.l,{key:"".concat(g.get(0,""),"_shared"),className:"mb10"},r.a.createElement(f.g,{smOffset:3,sm:8},r.a.createElement(f.f,{checked:v,onChange:n.onChangeShared},"Share with all account's subscribers",r.a.createElement(Ao,{contents:Uo.shared_desc}))),r.a.createElement(f.g,{smOffset:3,sm:8},r.a.createElement(f.f,{disabled:!v,checked:y,onChange:n.onChangePooled},"Includes is pooled?",r.a.createElement(Ao,{contents:Uo.pooled_desc}))),"service"===s&&r.a.createElement(f.g,{smOffset:3,sm:8},r.a.createElement(f.f,{checked:b,onChange:n.onChangeQuantityAffected},"Multiply by Service Quantity",r.a.createElement(Ao,{contents:Uo.quantityAffected_desc}))))];case _.get("SetProducts",{index:-1}).index:return r.a.createElement(f.l,{validationState:E.length>0?"error":null},C?r.a.createElement(f.g,{componentClass:f.h,sm:3},"Products"):r.a.createElement(f.g,{componentClass:f.h,sm:3,style:{paddingTop:2}},"Products of type/s ",r.a.createElement(Ao,{contents:Uo.products}),r.a.createElement("br",null),"(",n.getUsagesLabel(),")"),r.a.createElement(f.g,{sm:8},r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(sh,{products:d,usages:g,onChangeGroupRates:n.onChangeGroupRates,existingProducts:O,plays:c})),E.length>0&&r.a.createElement(f.n,null,E)));default:return"..."}},n.getSteps=function(){return n.state.steps.sort(function(e){return e.index}).map(function(e){return{title:e.label}}).toList().toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.stepIndex,n=e.open,a=e.name,i=e.steps,o=this.props.modalTitle;return a.length&&(o+=" - ".concat(a)),r.a.createElement("div",null,r.a.createElement(ct,{onClick:this.handleToggleBoby,type:"Group",label:"Create New"}),r.a.createElement(f.r,{show:n,keyboard:!1,bsSize:"large"},r.a.createElement(f.r.Header,{closeButton:!0,onHide:this.handleCancel},r.a.createElement(f.r.Title,null,o)),r.a.createElement(f.r.Body,{style:{minHeight:235}},r.a.createElement(Mo,{activeIndex:t,steps:this.getSteps()}),r.a.createElement("hr",{style:{margin:"20px -20px 35px -20px"}}),r.a.createElement(f.j,{horizontal:!0,className:"mb0"},this.getStepContent(t))),r.a.createElement(f.r.Footer,null,r.a.createElement(f.c,{bsSize:"small",onClick:this.handlePrev,style:{marginRight:9,minWidth:90}},r.a.createElement("i",{className:"fa fa-angle-left"}),"\xa0Back"),t===i.count()-1?r.a.createElement(f.c,{bsSize:"small",onClick:this.handleFinish,style:{minWidth:90},bsStyle:"primary"},"Add"):r.a.createElement(f.c,{bsSize:"small",onClick:this.handleNext,style:{minWidth:90}},"Next\xa0",r.a.createElement("i",{className:"fa fa-angle-right"})))))}}]),t}(a.Component);mh.defaultProps={usedProducts:g.c.List(),modalTitle:"Create New Group",allGroupsProductsKeys:g.c.List(),existinGrousNames:g.c.List(),currency:"USD",usageTypesData:g.c.List(),propertyTypes:g.c.List(),type:"",plays:""},mh.defaultState={name:"",usages:g.c.List([""]),usagesPropertyType:"",unit:"",include:"",products:g.c.List(),shared:!1,pooled:!1,quantityAffected:!1,error:"",stepIndex:0,open:!1,monetaryBased:!1,steps:g.c.Map({SetNameAndType:{index:0,label:"Set Name & Type"},SetUsageType:{index:1,label:"Set Usage Type"},SetIncludes:{index:2,label:"Set Includes"},SetProducts:{index:3,label:"Set Products"}})};var gh=Object(l.connect)(function(e,t){return{currency:pa(e,t),usageTypesData:ha(e,t),propertyTypes:va(e,t)}})(mh),fh=function(e){return{type:"PLAN_GOT",plan:e}},hh=function(e){return{type:"REMOVE_GROUP_PLAN",groupName:e}},vh=function(e,t,n,a,r,i,o,l){return{type:"ADD_GROUP_PLAN",groupName:e,usages:t,unit:n,value:a,shared:r,pooled:i,quantityAffected:o,products:l}},yh=function(e,t){return{type:"PLAN_UPDATE_FIELD_VALUE",path:e,value:t}},bh=function(e){return{type:"PLAN_REMOVE_FIELD",path:e}},Eh=function(e,t){return{type:"PLAN_UPDATE_PLAN_CYCLE",index:e,value:t}},Ch=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{type:"PLAN_ADD_TARIFF",trial:e}},_h=function(e){return{type:"PLAN_REMOVE_TARIFF",index:e}},Oh=function(){return{type:"PLAN_CLONE_RESET",uniquefields:["name"]}},Sh=function(e,t,n){return{type:"ADD_USAGET_INCLUDE",ppIncludesName:e,ppIncludesExternalId:t,unitLabel:n}},Th=function(e,t,n){var a="prepaid"===t.get("connection_type",""),r=e(),i=ha(r),o=va(r),l=r.list.get("pp_includes",g.c.List()),s=Fe(o,i,t,n),c=a?function(e,t,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=a.get("pp_threshold",g.c.Map()).withMutations(function(a){a.forEach(function(i,o){var l=n.find(function(e){return e.get("external_id","")===parseInt(o)})||g.c.Map(),s=l.get("charging_by_usaget_unit",!1);if(s){var c=l.get("charging_by_usaget",""),u=Ie(e,t,c,s,i,r);a.set(o,parseFloat(u))}})});return i.isEmpty()?g.c.Map():i}(o,i,l,t,n):null,u=a?function(e,t,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=a.get("notifications_threshold",g.c.Map()).withMutations(function(a){a.forEach(function(i,o){var l=n.find(function(e){return e.get("external_id","")===parseInt(o)})||g.c.Map(),s=l.get("charging_by_usaget_unit",!1);if(s){var c=l.get("charging_by_usaget","");i.forEach(function(n,i){var l=n.get("value",""),u=Ie(e,t,c,s,l,r);a.setIn([o,i,"value"],parseFloat(u))})}})});return i.isEmpty()?g.c.Map():i}(o,i,l,t,n):null,p=a?null:Le(o,i,t,n);return t.withMutations(function(e){e.set("rates",s),a?(c.isEmpty()||e.set("pp_threshold",c),u.isEmpty()||e.set("notifications_threshold",u)):p.isEmpty()||e.set("include",p)})},kh=function(e,t,n){var a=e(),r=ha(a),i=function(e,t,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=a.get("include",g.c.Map()).withMutations(function(a){a.forEach(function(i,o){var l=i.get("pp_includes_external_id",""),s=n.find(function(e){return e.get("external_id","")===parseInt(l)})||g.c.Map(),c=s.get("charging_by_usaget_unit",!1);if(c){var u=s.get("charging_by_usaget",""),p=i.get("usagev"),d=Ie(e,t,u,c,p,r);a.setIn([o,"usagev"],parseFloat(d))}})});return i.isEmpty()?g.c.Map():i}(va(a),r,a.list.get("pp_includes",g.c.List()),t,n);return t.withMutations(function(e){i.isEmpty()||e.set("include",i)})},jh=function(e,t){return function(n,a){var r=Th(a,e,!0);return n($l("plans",r,t))}},Ih=function(e,t){return function(n,a){var r=kh(a,e,!0);return n($l("prepaidgroups",r,t))}},wh=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n,a){n(jr());var r=Ni(e);return ei(r).then(function(e){var r=e.data[0].data.details[0];r.originalValue=r.from;var i=g.c.fromJS(r),o=Th(a,i,!1).toJS();return n(fh(o)),t&&n(Gl("plan",o)),n(Wr(e))}).catch(function(e){return n(Jr(e,"Error retrieving plan"))})}},Nh=function(e){return function(t,n){t(jr());var a=function(e){return yi("prepaidgroups",e)}(e);return ei(a).then(function(e){var a=e.data[0].data.details[0];a.originalValue=a.from;var r=g.c.fromJS(a),i=kh(n,r,!1).toJS();return t(fh(i)),t(Wr(e))}).catch(function(e){return t(Jr(e,"Error retrieving prepaid group"))})}},Fh=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onGroupAdd=function(e,t,a,r,i,o,l,s){var c=n.state,u=c.usedProducts,p=c.existingGroups;n.setState({usedProducts:u.push.apply(u,Object(N.a)(s)),existingGroups:p.push(e)}),n.props.onGroupAdd(e,t,a,r,i,o,l,s)},n.onGroupRemove=function(e,t){var a=n.state,r=a.usedProducts,i=a.existingGroups;n.setState({usedProducts:r.filter(function(e){return!t.includes(e)}),existingGroups:i.filter(function(t){return t!==e})}),n.props.onGroupRemove(e)},n.onChangeGroupProducts=function(e,t){var a=n.state.usedProducts;n.setState({usedProducts:a.push.apply(a,Object(N.a)(t))});var r=["include","groups",e,"rates"];n.props.onChangeFieldValue(r,t)},n.renderGroups=function(){var e=n.state.usedProducts,t=n.props,a=t.includeGroups,i=t.mode,o=t.usageTypesData,l=t.propertyTypes;return a.isEmpty()?r.a.createElement("tr",null,r.a.createElement("td",{colSpan:"10",className:"text-center"},"No Groups")):a.map(function(t,a){var s=n.props.plays,c=t.get("account_shared",!1),u=t.get("account_pool",!1),p=t.get("quantity_affected",!1),d=t.get("rates",g.c.List()),m=Ae(t),f=je(l,o,xe(t),De(t)),h=Pe(t),v=Re(t),y=xe(t);return r.a.createElement(dh,{key:a,mode:i,name:a,value:h,usages:m,unit:f,shared:c,pooled:u,quantityAffected:p,products:d,usedProducts:e.toList(),onChangeFieldValue:n.props.onChangeFieldValue,onGroupRemove:n.onGroupRemove,onChangeGroupProducts:n.onChangeGroupProducts,usaget:y,usageTypes:v,type:n.props.type,plays:s})}).toList().toArray()},n.renderHeader=function(){return r.a.createElement("tr",null,r.a.createElement("th",{style:{width:150}},"Name"),r.a.createElement("th",{style:{width:100}},"Unit Type/s"),r.a.createElement("th",{style:{width:100}},"Include"),r.a.createElement("th",{style:{width:100}},"Unit"),r.a.createElement("th",null,"Products"),r.a.createElement("th",{className:"text-center",style:{width:80}},"Shared"),r.a.createElement("th",{className:"text-center",style:{width:80}},"Pooled"),r.a.createElement("th",{className:"text-center",style:{width:80}},"Quantitative"),r.a.createElement("th",{style:{width:60}}))};var a=g.c.Set().withMutations(function(t){e.includeGroups.forEach(function(e){t.union(e.get("rates",g.c.List()))})}).toList();return n.state={existingGroups:g.c.List(),usedProducts:a},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.usageTypes.isEmpty()&&this.props.dispatch(kl("usage_types")),ei(ji()).then(function(t){var n=g.c.Set().withMutations(function(e){t.data.forEach(function(t){t.data.details.forEach(function(t){t.include&&t.include.groups&&e.union(Object.keys(t.include.groups))})})}).toList();e.setState({existingGroups:n})})}},{key:"render",value:function(){var e=this.props,t=e.mode,n=e.plays,a=this.state,i=a.existingGroups,o=a.usedProducts,l="view"!==t;return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Groups ",r.a.createElement(Ao,{contents:Do.include_groups}))},r.a.createElement(f.A,{style:{tableLayout:"fixed"}},r.a.createElement("thead",null,this.renderHeader()),r.a.createElement("tbody",null,this.renderGroups()))),l&&r.a.createElement(gh,{existinGrousNames:i,usedProducts:o,addGroup:this.onGroupAdd,type:this.props.type,plays:n})))}}]),t}(a.Component);Fh.defaultProps={includeGroups:g.c.Map(),usageTypes:g.c.List(),usageTypesData:g.c.List(),propertyTypes:g.c.List(),mode:"create",type:"",plays:""};var xh=Object(l.connect)(function(e,t){return{includeGroups:t.includeGroups||void 0,usageTypes:ga(e,t),propertyTypes:va(e,t),usageTypesData:ha(e,t)}})(Fh),Rh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeServices=function(e){var t=e.length?e.split(","):[];n.props.onChangeFieldValue(["include","services"],Object(g.a)(t))},n.filterByPlay=function(e){var t=n.props.plays,a=e.get("play",Object(g.a)());return!(t&&!t.isEmpty()&&!a.isEmpty())||!t.filter(function(e){return a.includes(e)}).isEmpty()},n.getServicesOptions=function(){return n.props.services.filter(n.filterByPlay).map(function(e){return{value:e.get("name",""),label:e.get("name","")}}).toArray()},n.renderEditableServices=function(){var e=n.props.includedServices,t=r.a.createElement("h3",null,"Select included services ",r.a.createElement(Ao,{contents:Do.included_services}));return r.a.createElement(f.v,{header:t},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:e.join(","),onChange:n.onChangeServices,options:n.getServicesOptions()}))},n.renderNonEditableServices=function(){var e=n.props.includedServices,t=r.a.createElement("h3",null,"Services ",r.a.createElement(Ao,{contents:Do.included_services}));return r.a.createElement(f.v,{header:t},r.a.createElement("div",null,e.size?e.join(", "):"No included services"))},n.renderServices=function(){return"view"!==n.props.mode?n.renderEditableServices():n.renderNonEditableServices()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(eo("services_keys",bi("services",{name:1,play:1},{quantitative:{$ne:!0},balance_period:{$exists:!1}})))}},{key:"render",value:function(){return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,null,this.renderServices())))}}]),t}(a.Component);Rh.defaultProps={includedServices:Object(g.a)(),mode:"create",services:Object(g.a)(),plays:Object(g.a)()};var Mh=Object(l.connect)(function(e){return{services:e.list.get("services_keys")}})(Rh),Ph=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab),progress:!1},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t){var r=S()().add(1,"days").toISOString();n.props.dispatch(yh(["from"],r)),n.props.dispatch(yh(["connection_type"],"postpaid"))}"clone"===t&&(n.props.dispatch(Oh()),n.handleSelectTab(1)),null===a.get("prorated_start",null)&&n.props.dispatch(yh(["prorated_start"],!0)),null===a.get("prorated_end",null)&&n.props.dispatch(yh(["prorated_end"],!0)),null===a.get("prorated_termination",null)&&n.props.dispatch(yh(["prorated_termination"],!0))},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&ue(t,!1)){var a=t.get("name","");n.props.dispatch(dp("plans","name",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(wh(e,!0)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("name","");n.props.dispatch(sp("plans",e))},n.clearItemsList=function(){n.props.dispatch(up("plans"))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onChangeFieldValue=function(e,t){n.props.dispatch(yh(e,t))},n.onRemoveFieldValue=function(e){n.props.dispatch(bh(e))},n.onDeleteField=function(e,t){n.props.dispatch(yh(e,t))},n.onPlanCycleUpdate=function(e,t){n.props.dispatch(Eh(e,t))},n.onPlanTariffAdd=function(e){n.props.dispatch(Ch(e))},n.onPlanTariffRemove=function(e){n.props.dispatch(_h(e))},n.onGroupAdd=function(e,t,a,r,i,o,l,s){n.props.dispatch(vh(e,t,a,r,i,o,l,s))},n.onGroupRemove=function(e){n.props.dispatch(hh(e))},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.setState({progress:!0}),n.props.dispatch(jh(t,a)).then(n.afterSave)},n.afterSave=function(e){var t=n.props.mode;if(n.setState({progress:!1}),e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Ur("The plan was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&n.clearItemsList();var a=ee(["systemItems",t.entityName,"itemsType"],"");n.props.router.push("/".concat(a))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if(["clone","create"].includes(e)){var n=se(e,t.entityName);this.props.dispatch(bs(n))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var n=e.item,a=e.itemId,r=e.mode,i=this.props,o=i.item,l=i.itemId,s=i.mode;if(r!==s||ue(n)!==ue(o)){var c=se(r,t.entityName,n);this.props.dispatch(bs(c))}(a!==l||r!==s&&"clone"===r)&&this.fetchItem(a)}},{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,t.item)||!g.c.is(this.props.revisions,t.revisions)||this.props.activeTab!==e.activeTab||this.props.itemId!==e.itemId||this.props.mode!==e.mode}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"PLAN_CLEAR"})}},{key:"render",value:function(){var e=this.state,n=e.progress,a=e.activeTab,i=this.props,o=i.item,l=i.mode,s=i.revisions;if("loading"===l)return r.a.createElement(_,{onClick:this.handleBack});var c="view"!==l,u=o.get("rates",g.c.Map()),p=o.getIn(["include","services"],g.c.List()),d=o.getIn(["include","groups"],g.c.Map()),m=o.get("play",g.c.List());return r.a.createElement("div",{className:"PlanSetup"},r.a.createElement(f.v,null,r.a.createElement(Sd,{itemName:"plan",revisions:s,item:o,mode:l,onChangeFrom:this.onChangeFieldValue,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.B,{activeKey:a,animation:!1,id:"PlanTab",onSelect:this.handleSelectTab},r.a.createElement(f.z,{title:"Details",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement($f,{mode:l,plan:o,onChangeFieldValue:this.onChangeFieldValue,onRemoveField:this.onRemoveFieldValue,onPlanCycleUpdate:this.onPlanCycleUpdate,onPlanTariffAdd:this.onPlanTariffAdd,onPlanTariffRemove:this.onPlanTariffRemove}))),r.a.createElement(f.z,{title:"Override Product Price",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(lh,{itemName:"plan",mode:l,planRates:u,onChangeFieldValue:this.onChangeFieldValue,plays:m.join(",")}))),r.a.createElement(f.z,{title:"Included Products",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(xh,{mode:l,plays:m.join(","),includeGroups:d,onChangeFieldValue:this.onChangeFieldValue,onGroupAdd:this.onGroupAdd,onGroupRemove:this.onGroupRemove}))),r.a.createElement(f.z,{title:"Included Services",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Mh,{mode:l,plays:m,includedServices:p,onChangeFieldValue:this.onChangeFieldValue}))),r.a.createElement(f.z,{title:"Tax",eventKey:5},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(dg,{tax:o.get("tax"),mode:l,itemName:t.entityName,onFieldUpdate:this.onChangeFieldValue,onFieldRemove:this.onRemoveFieldValue})))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!c,cancelLabel:c?void 0:"Back",progress:n}))}}]),t}(a.Component);Ph.defaultProps={item:g.c.Map(),revisions:g.c.List(),activeTab:1},Ph.entityName="plan";var Ah=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,Ph.entityName),item:bo(e,t,Ph.entityName),mode:Co(e,t,Ph.entityName),activeTab:mo(e,t,Ph.entityName),revisions:po(e,t,Ph.entityName)}})(Ph)),Dh=[{id:"description",placeholder:"Title"},{id:"key",placeholder:"Key"}],Lh={key:1,description:1,type:1},Uh=[{id:"description",title:"Title",sort:!0},{id:"key",title:"Key",sort:!0},{id:"type",title:"Type",sort:!0,parser:function(e){return"percentage"===e.get("type","")?te("type_percentage","discount"):te("type_monetary","discount")}}],Vh=[{type:"edit"}],Bh=function(){return r.a.createElement(Tp,{entityKey:"discount",filterFields:Dh,tableFields:Uh,projectFields:Lh,actions:Vh})},qh=[{id:"description",placeholder:"Title"},{id:"key",placeholder:"Key"}],zh=[{id:"description",title:"Title",sort:!0},{id:"key",title:"Key",sort:!0},{id:"type",title:"Type",sort:!0,parser:function(e){return"percentage"===e.get("type","")?te("type_percentage","charge"):te("type_monetary","charge")}}],Hh={key:1,description:1,type:1},Yh=[{type:"edit"}],Gh=function(){return r.a.createElement(Tp,{entityKey:"charge",filterFields:qh,tableFields:zh,projectFields:Hh,actions:Yh})},Kh=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={errors:{name:""}},n.onChangeFiled=function(e,t){switch(e.join(".")){case"params.cycles":""!==t?n.props.onFieldUpdate(e,t):n.props.onFieldRemove(e);break;case"type":n.props.onFieldUpdate(e,t);break;case"subject.general.value":null!==t?n.props.onFieldUpdate(e,t):n.props.onFieldRemove(e);break;case"key":var a=t.toUpperCase();if(""!==t){var r=n.props.errorMessages.name.allowedCharacters,i=n.state.errors,o=ee("keyUppercaseRegex",/./).test(a)?"":r;n.setState({errors:Object.assign({},i,{name:o})})}n.props.onFieldUpdate(e,a);break;default:n.props.onFieldUpdate(e,t)}},n.onChangeCycles=function(e){n.props.dispatch(Is("params.cycles"));var t=x()(e)?parseFloat(e):e;n.onChangeFiled(["params","cycles"],t)},n.onChangeSubjectGeneral=function(e){var t=x()(e)?parseFloat(e):e;n.onChangeFiled(["subject","general","value"],t)},n.onChangeDiscountType=function(e){var t=e.target.value;n.onChangeFiled(["type"],t)},n.onChangeAdditionalField=function(e,t){n.onChangeFiled(e,t)},n.onChangeExcludes=function(e){var t=g.c.List(e.length?e.split(","):[]);t.isEmpty()?n.props.onFieldRemove(["excludes"]):n.onChangeFiled(["excludes"],t)},n.onChangeService=function(e){var t=n.props.charge,a=g.c.List(e.length?e.split(","):[]),r=g.c.Map({value:""});if(a.isEmpty())n.props.onFieldRemove(["subject","service"]),n.props.onFieldRemove(["subject","matched_services"]);else{var i=t.getIn(["subject","service"],g.c.Map()),o=g.c.Map().withMutations(function(e){a.forEach(function(t){"matched_services"!==t&&e.set(t,i.get(t,r))})});o.isEmpty()?n.props.onFieldRemove(["subject","service"]):n.onChangeFiled(["subject","service"],o),a.includes("matched_services")?n.onChangeFiled(["subject","matched_services"],t.getIn(["subject","matched_services"],r)):n.props.onFieldRemove(["subject","matched_services"])}},n.onChangePlan=function(e){var t=n.props.charge,a=g.c.List(e.length?e.split(","):[]),r=g.c.Map({value:""});if(a.isEmpty())n.props.onFieldRemove(["subject","plan"]),n.props.onFieldRemove(["subject","matched_plans"]),n.props.onFieldRemove(["subject","monthly_fees"]);else{var i=n.getSelectedPlans(),o=g.c.Map().withMutations(function(e){a.forEach(function(t){["matched_plans","monthly_fees"].includes(t)||e.set(t,i.get(t,r))})});o.isEmpty()?n.props.onFieldRemove(["subject","plan"]):n.onChangeFiled(["subject","plan"],o),a.includes("matched_plans")?n.onChangeFiled(["subject","matched_plans"],t.getIn(["subject","matched_plans"],r)):n.props.onFieldRemove(["subject","matched_plans"]),a.includes("monthly_fees")?n.onChangeFiled(["subject","monthly_fees"],t.getIn(["subject","monthly_fees"],r)):n.props.onFieldRemove(["subject","monthly_fees"])}},n.onChangePlanDiscount=function(e,t){var a=["matched_plans","monthly_fees"].includes(e)?["subject",e]:["subject","plan",e];n.onChangeFiled(a,t)},n.onChangeServiceDiscountValue=function(e,t){[e].includes("matched_services")?n.onChangeFiled(["subject",e],t):n.onChangeFiled(["subject","service",e],t)},n.onChangeConditionField=function(e,t,a){n.onChangeFiled([].concat(Object(N.a)(e),[t,"field"]),a)},n.onChangeConditionOp=function(e,t,a){n.onChangeFiled([].concat(Object(N.a)(e),[t,"op"]),a)},n.onChangeConditionValue=function(e,t,a){n.onChangeFiled([].concat(Object(N.a)(e),[t,"value"]),a)},n.onAddCondition=function(e,t){var a=n.props.charge.getIn(e,g.c.List());n.onChangeFiled(e,a.push(t))},n.onRemoveAdditionalField=function(e){n.props.onFieldRemove(e)},n.onRemoveCondition=function(e,t){var a=n.props.charge.getIn(e,g.c.List());n.onChangeFiled(e,a.delete(t))},n.createPlansOptions=function(){return n.props.availableEntities.get("plan",g.c.List()).push(g.c.Map({name:"matched_plans",description:te("matched_plans","charge")})).push(g.c.Map({name:"monthly_fees",description:te("monthly_fees","charge")})).map(n.createOption).toArray()},n.createExcludeDiscountOptions=function(){var e=n.props,t=e.charge;return e.availableEntities.get("charge",g.c.List()).filter(function(e){return e.get("key","")!==t.get("key","")}).map(n.createOption).toArray()},n.createServicesOptions=function(){return n.props.availableEntities.get("service",g.c.List()).push(g.c.Map({name:"matched_services",description:te("matched_services","charge")})).map(n.createOption).toArray()},n.createOption=function(e){return{value:e.get("name",e.get("key","")),label:e.get("description","")}},n.getLabel=function(e,t){return["matched_services","matched_plans","monthly_fees"].includes(t)?te(t,"charge"):e.find(function(e){return e.get("name")===t},null,g.c.Map()).get("description",t)},n.getSelectedServices=function(){var e=n.props.charge,t=g.c.Map({value:""}),a=e.getIn(["subject","service"],g.c.Map());return e.hasIn(["subject","matched_services"])&&(a=a.set("matched_services",e.getIn(["subject","matched_services"],t))),a},n.getSelectedPlans=function(){var e=n.props.charge,t=g.c.Map({value:""}),a=e.getIn(["subject","plan"],g.c.Map());return e.hasIn(["subject","matched_plans"])&&(a=a.set("matched_plans",e.getIn(["subject","matched_plans"],t))),e.hasIn(["subject","monthly_fees"])&&(a=a.set("monthly_fees",e.getIn(["subject","monthly_fees"],t))),a},n.isServiceQuantitative=function(e){return-1!==n.props.availableEntities.get("service",g.c.List()).findIndex(function(t){return t.get("name","")===e&&!0===t.get("quantitative",!1)})},n.isPercentage=function(){return"percentage"===n.props.charge.get("type","")},n.renderServivesDiscountValues=function(){var e=n.props,t=e.availableEntities,a=e.mode,i=e.currency,o=n.getSelectedServices();if(o.isEmpty())return null;var l=n.isPercentage();return o.map(function(e,o){var s=n.getLabel(t.get("service",g.c.List()),o),c=n.isServiceQuantitative(o);return r.a.createElement($d,{key:"".concat(Object(D.paramCase)(o),"-charge-value"),mode:a,service:e,name:o,label:s,isQuantitative:c,isPercentage:l,currency:i,onChange:n.onChangeServiceDiscountValue})}).toList().toArray()},n.renderPlanDiscountValue=function(){var e=n.props,t=e.availableEntities,a=e.mode,i=e.currency,o=n.getSelectedPlans();if(o.isEmpty())return null;var l="view"!==a,s=n.isPercentage();return o.filter(function(e){return l||!l&&g.c.Map.isMap(e)&&""!==e.get("value","")}).map(function(e,o){return r.a.createElement(gm,{key:"".concat(Object(D.paramCase)(o),"-charge-value"),name:o,label:n.getLabel(t.get("plan",g.c.List()),o),plan:e,isPercentage:s,mode:a,currency:i,onChange:n.onChangePlanDiscount})}).toList().toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(kl(["subscribers.subscriber","subscribers.account"])),this.props.dispatch(no(["charge","plan","service"]))}},{key:"componentWillUnmount",value:function(){this.props.dispatch(ao(["charge","plan","service"]))}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.charge,a=t.mode,i=t.currency,o=t.fields,l=t.errors,s="view"!==a,c=this.isPercentage(),u=this.createPlansOptions(),p=this.createServicesOptions(),d=n.get("excludes",g.c.List()).join(","),m=this.createExcludeDiscountOptions(),h=this.getSelectedServices().keySeq().toList().join(","),v=this.getSelectedPlans().keySeq().toList().join(","),y=c?void 0:vd()(i);return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,null,r.a.createElement(wd,{field:o.get("description"),entity:n,onChange:this.onChangeFiled,editable:s,error:l.get("description",e.description)}),["clone","create"].includes(a)&&r.a.createElement(wd,{field:o.get("key"),entity:n,onChange:this.onChangeFiled,editable:s,disabled:!["clone","create"].includes(a),error:l.get("key",e.name)}),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("type","charge")),r.a.createElement(f.g,{sm:8,lg:9},s?r.a.createElement("span",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeDiscountType,name:"type",value:"monetary",label:te("type_monetary","charge"),checked:!c})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeDiscountType,name:"type",value:"percentage",label:te("type_percentage","charge"),checked:c}))):r.a.createElement("div",{className:"non-editable-field"},Object(D.titleCase)(n.get("type",""))))),r.a.createElement(f.l,{validationState:l.has("params.cycles")?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("cycles","charge")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.getIn(["params","cycles"],""),onChange:this.onChangeCycles,fieldType:"unlimited",unlimitedValue:"",unlimitedLabel:"Infinite",editable:s}),l.has("params.cycles")&&r.a.createElement(f.n,null,r.a.createElement("small",null,l.get("params.cycles",""))))),r.a.createElement(wd,{field:o.get("proration"),entity:n,onChange:this.onChangeFiled,editable:s,error:l.get("proration",e.proration)}),r.a.createElement(wd,{field:o.get("priority"),entity:n,onChange:this.onChangeFiled,editable:s,error:l.get("priority",e.priority)}),r.a.createElement(wd,{field:o.get("paramsMinSubscribers"),entity:n,onChange:this.onChangeFiled,editable:s,error:l.get("params.min_subscribers",e.paramsMinSubscribers)}),r.a.createElement(wd,{field:o.get("paramsMaxSubscribers"),entity:n,onChange:this.onChangeFiled,editable:s,error:l.get("params.max_subscribers",e.paramsMaxSubscribers)}),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Excludes"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:d,options:m,onChange:this.onChangeExcludes,editable:s}))),r.a.createElement(Fd,{entityName:"charges",entity:n,onChangeField:this.onChangeAdditionalField,onRemoveField:this.onRemoveAdditionalField,editable:s,errors:l})),r.a.createElement(dm,{discount:n,editable:s,onChangeConditionField:this.onChangeConditionField,onChangeConditionOp:this.onChangeConditionOp,onChangeConditionValue:this.onChangeConditionValue,addCondition:this.onAddCondition,removeCondition:this.onRemoveCondition,errors:l}),c&&r.a.createElement(f.v,{header:r.a.createElement("h3",null,te("panel_plan_discount","charge"))},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("select_plans","charge")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:v,options:u,onChange:this.onChangePlan,editable:s}))),!this.getSelectedPlans().isEmpty()&&r.a.createElement("hr",null),this.renderPlanDiscountValue()),c&&r.a.createElement(f.v,{header:r.a.createElement("h3",null,te("panel_service_discount","charge"))},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("select_services","charge")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:h,options:p,onChange:this.onChangeService,editable:s}))),!this.getSelectedServices().isEmpty()&&r.a.createElement("hr",null),this.renderServivesDiscountValues()),!c&&r.a.createElement(f.v,{header:r.a.createElement("h3",null,te("charge_values","charge"))},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("subject_general","charge")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"toggeledInput",value:n.getIn(["subject","general","value"],null),onChange:this.onChangeSubjectGeneral,label:"Charge by",editable:s,suffix:y,inputProps:{fieldType:c?"percentage":"number"}})))))))}}]),t}(a.Component);Kh.defaultProps={charge:g.c.Map(),errors:g.c.Map(),fields:g.c.Map({description:g.c.Map({title:te("description","charge"),field_name:"description",mandatory:!0}),key:g.c.Map({title:te("key","charge"),field_name:"key",mandatory:!0}),priority:g.c.Map({title:te("priority","charge"),field_name:"priority",system:!0,type:"number"}),paramsMinSubscribers:g.c.Map({title:te("min_subscribers","charge"),field_name:"params.min_subscribers",system:!0,type:"number"}),paramsMaxSubscribers:g.c.Map({title:te("max_subscribers","charge"),field_name:"params.max_subscribers",system:!0,type:"number"}),proration:g.c.Map({field_name:"proration",title:te("proration","charge"),select_list:!0,select_options:[g.c.Map({value:"inherited",label:te("proration_inherited","charge")}),g.c.Map({value:"no",label:te("proration_no","charge")})],default_value:"inherited"})}),currency:"",availableEntities:g.c.Map(),errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var Wh=Object(l.connect)(function(e,t){var n="undefined"!==typeof t.errors?t.errors:g.c.Map(),a=Vs(e)||g.c.Map();return{availableEntities:or(e,t,["charge","plan","service"]),errors:g.c.merge(n,a)}})(Kh),Jh=function(){return Kl("charge","charge")},$h=function(e,t){return $l("charges",e,t)},Qh=function(e,t){return zl("charge",e,t)},Zh=function(e){return Hl("charge",e)},Xh=function(e){return Xl("charge",function(e){return yi("charges",e)}(e))},ev=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:g.c.Map(),progress:!1},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t||"closeandnew"===t&&ce(a,"from").isBefore(S()())){var r=S()().add(1,"days").toISOString();n.onChangeFieldValue(["from"],r)}null===a.get("type",null)&&n.onChangeFieldValue(["type"],"monetary"),"clone"===t&&n.props.dispatch(Jh())},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&ue(t,!1)){var a=t.get("key","");n.props.dispatch(dp("charges","key",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Xh(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("key","");n.props.dispatch(sp("charges",e))},n.clearItemsList=function(){var e=ee(["systemItems","charge","itemsType"],"");n.props.dispatch(up(e))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onRemoveFieldValue=function(e){n.props.dispatch(Zh(e))},n.onChangeFieldValue=function(e,t){var a=n.state.errors,r=e.join(".");n.setState(function(){return{errors:a.delete(r)}}),n.props.dispatch(Qh(e,t))},n.afterSave=function(e){n.setState({progress:!1});var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Ur("The charge was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.validate()&&(n.setState({progress:!0}),n.props.dispatch($h(t,a)).then(n.afterSave))},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=ee(["systemItems","charge","itemsType"],"");e&&n.clearItemsList(),n.props.router.push("/".concat(t))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n.validate=function(){var e=n.props,t=e.item,a=e.fields,r=e.mode,i=n.props.dispatch(_m(t,a,r));return n.setState(function(){return{errors:i}}),!!i.isEmpty()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if("create"===e){var t=se(e,"charge");this.props.dispatch(bs(t))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||ue(t)!==ue(i)){var s=se(n,"charge",t);this.props.dispatch(bs(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Wl("charge"))}},{key:"render",value:function(){var e=this.state,t=e.progress,n=e.errors,a=this.props,i=a.item,o=a.mode,l=a.revisions,s=a.currency;if("loading"===o)return r.a.createElement(_,{onClick:this.handleBack});var c="view"!==o;return r.a.createElement("div",{className:"charge-setup"},r.a.createElement(f.v,null,r.a.createElement(Sd,{itemName:"charge",revisions:l,item:i,mode:o,onChangeFrom:this.onChangeFieldValue,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.v,null,r.a.createElement(Wh,{charge:i,mode:o,currency:s,onFieldUpdate:this.onChangeFieldValue,onFieldRemove:this.onRemoveFieldValue,errors:n})),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!c,cancelLabel:c?void 0:"Back",progress:t}))}}]),t}(a.Component);ev.defaultProps={item:g.c.Map(),currency:"",revisions:g.c.List(),fields:g.c.List()};var tv=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,"charge"),item:bo(e,t,"charge"),mode:Co(e,t,"charge"),revisions:po(e,t,"charge"),currency:pa(e,t)||void 0,fields:xa(e,t)}})(ev)),nv=function(e){var t=[{id:"description",title:"Title",sort:!0},{id:"name",title:"Key",sort:!0},{title:"Price",parser:function(e){return e.getIn(["price",0,"price"],"")},sort:!0},{title:"Quantitative",parser:function(e){return e.get("quantitative",!1)?"Yes":"No"},sort:!0},{title:"Period",parser:function(e){var t=Ue(e);if("default"===t.type){var n=ee("serviceCycleUnlimitedValue","UNLIMITED"),a=e.getIn(["price",0,"to"],"");return a===n?"Infinite":"".concat(a," ").concat(Object(D.titleCase)(Gp()("cycle",Number(a))))}return"".concat(t.value," ").concat(Object(D.titleCase)(Gp()(t.unit,Number(t.value))))},sort:!0},{id:"play",title:"Play",display:e.isPlaysEnabled,parser:function(e){return e.get("play",g.c.List()).join(", ")}}];return r.a.createElement(Tp,{itemsType:"services",itemType:"service",filterFields:[{id:"description",placeholder:"Title"},{id:"name",placeholder:"Key"}],tableFields:t,projectFields:{description:1,price:1,name:1,balance_period:1,quantitative:1,play:1},showRevisionBy:"name",actions:[{type:"edit"}]})};nv.defaultProps={isPlaysEnabled:!1};var av=Object(l.connect)(function(e,t){return{isPlaysEnabled:oa(e,t)}})(nv),rv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:{name:""}},n.onChangeName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=ee("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.updateItem(["name"],r)},n.onChangePrice=function(e){var t=e.target.value,a=x()(t)?parseFloat(t):t;n.props.updateItem(["price",0,"price"],a)},n.onChangeCycle=function(e){var t=x()(e)?parseFloat(e):e;n.props.updateItem(["price",0,"to"],t)},n.onChangeProrated=function(e){var t=e.target.value;n.props.updateItem(["prorated"],t)},n.onChangeQuantitative=function(e){var t=e.target.value;n.props.updateItem(["quantitative"],t)},n.onChangePlays=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=""===e?[]:e.split(",");n.props.updateItem(["play"],g.c.List(a)),t&&(n.props.updateItem(["rates"],g.c.Map()),n.props.updateItem(["include","groups"],g.c.Map()))},n.onChangeDescription=function(e){var t=e.target.value;n.props.updateItem(["description"],t)},n.onChangeAdditionalField=function(e,t){n.props.updateItem(e,t)},n.onRemoveAdditionalField=function(e){n.props.onFieldRemove(e)},n.onChangeServicePeriodType=function(e){var t=e.target.value;n.props.updateItem(["balance_period","type"],t)},n.onSelectPeriodUnit=function(e){n.props.updateItem(["balance_period","unit"],e)},n.onChangeBalancePeriod=function(e){var t=e.target.value,a=x()(t)?parseFloat(t):t;n.props.updateItem(["balance_period","value"],a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,e.item)||this.props.mode!==e.mode}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.item,a=t.mode,i=ee("serviceCycleUnlimitedValue","UNLIMITED"),o="view"!==a,l=n.getIn(["balance_period","unit"],""),s=""===l?"Select unit...":Object(D.titleCase)(Gp()(l,Number(n.getIn(["balance_period","value"],2)))),c="default"===n.getIn(["balance_period","type"],"default");return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(Fp,{entity:n,editable:o&&"create"===a,multi:!0,onChange:this.onChangePlays}),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("description",ne("service"),Object(D.sentenceCase)("title")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ao,{contents:Lo.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.get("description",""),onChange:this.onChangeDescription,editable:o}))),["clone","create"].includes(a)&&r.a.createElement(f.l,{validationState:e.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("name",ne("service"),Object(D.sentenceCase)("key")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ao,{contents:Lo.name})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.get("name",""),onChange:this.onChangeName,editable:o}),e.name.length>0&&r.a.createElement(f.n,null,e.name))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("price",ne("service"),Object(D.sentenceCase)("price")),r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{value:n.getIn(["price",0,"price"],""),onChange:this.onChangePrice,fieldType:"price",editable:o}))),["clone","create"].includes(a)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te("period_type",ne("service"),"Eligibility Period"),r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("span",{className:"inline mr10"},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeServicePeriodType,name:"service_period_type",value:"default",label:r.a.createElement("span",null,"No. of Cycles",r.a.createElement(Ao,{contents:Lo.service_period_type_cycle})),checked:c})),r.a.createElement("span",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeServicePeriodType,name:"service_period_type",value:"custom_period",label:r.a.createElement("span",null,te("custom_period_type",ne("service"),"Custom"),r.a.createElement(Ao,{contents:Lo.service_period_type_custom_period})),checked:!c})))),!c&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},!["clone","create"].includes(a)&&"Custom Period"),r.a.createElement(f.g,{sm:4},r.a.createElement(f.o,null,r.a.createElement(Tn,{disabled:c,fieldType:"number",min:"1",step:"1",value:n.getIn(["balance_period","value"],""),onChange:this.onChangeBalancePeriod,editable:o,suffix:o?null:" ".concat(s)}),o&&r.a.createElement(f.i,{id:"balance-period-unit",componentClass:f.o.Button,title:s,disabled:c},r.a.createElement(f.q,{eventKey:"days",onSelect:this.onSelectPeriodUnit},"Days"),r.a.createElement(f.q,{eventKey:"weeks",onSelect:this.onSelectPeriodUnit},"Weeks"),r.a.createElement(f.q,{eventKey:"months",onSelect:this.onSelectPeriodUnit},"Months"),r.a.createElement(f.q,{eventKey:"years",onSelect:this.onSelectPeriodUnit},"Years"))))),c&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},!["clone","create"].includes(a)&&"No. of Cycles"),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{disabled:!c,value:n.getIn(["price",0,"to"],""),onChange:this.onChangeCycle,fieldType:"unlimited",unlimitedValue:i,unlimitedLabel:"Infinite",editable:o}))),(["clone","create"].includes(a)||!["clone","create"].includes(a)&&c)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Prorated?"),r.a.createElement(f.g,{sm:4,style:o?{padding:"10px 15px"}:{paddingTop:5}},r.a.createElement(Tn,{fieldType:"checkbox",value:!!c&&n.get("prorated",""),onChange:this.onChangeProrated,editable:o,disabled:!c}))),(["clone","create"].includes(a)||!["clone","create"].includes(a)&&c)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Quantitative?"),r.a.createElement(f.g,{sm:4,style:["clone","create"].includes(a)?{padding:"10px 15px"}:{paddingTop:5}},r.a.createElement(Tn,{fieldType:"checkbox",value:!!c&&n.get("quantitative",""),onChange:this.onChangeQuantitative,editable:["clone","create"].includes(a),disabled:!c}))),r.a.createElement(Fd,{entityName:"services",entity:n,onChangeField:this.onChangeAdditionalField,onRemoveField:this.onRemoveAdditionalField,editable:o}))}}]),t}(a.Component);rv.defaultProps={errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var iv=function(e){return{type:"GOT_SERVICE",item:e}},ov=function(e,t){return{type:"UPDATE_SERVICE",path:e,value:t}},lv=function(e){return{type:"DELETE_SERVICE_FIELD",path:e}},sv=function(e,t,n,a,r,i,o,l){return{type:"ADD_GROUP_SERVICE",groupName:e,usages:t,unit:n,value:a,shared:r,pooled:i,quantityAffected:o,products:l}},cv=function(e){return{type:"REMOVE_GROUP_SERVICE",groupName:e}},uv=function(){return{type:"CLONE_RESET_SERVICE",uniquefields:["name"]}},pv=function(e,t,n,a){var r=e(),i=ha(r),o=va(r),l=Le(o,i,t,n);return t.withMutations(function(e){if(l.isEmpty()||e.set("include",l),a){"custom_period"===e.getIn(["balance_period","type"],"")&&(e.setIn(["price",0,"to"],1),e.set("quantitative",!1),e.set("prorated",!1));var n=function(e){if(["","default"].includes(e.getIn(["balance_period","type"],"default")))return"default";var t=e.getIn(["balance_period","unit"],""),n=e.getIn(["balance_period","value"],1);return"days"===t?"tomorrow +".concat(n-1," days"):"+".concat(n," ").concat(t)}(e);["","default"].includes(n)?e.delete("balance_period"):e.set("balance_period",n)}else{var r=Ue(e);e.set("balance_period",r)}var s=Fe(o,i,t,a);s.isEmpty()||e.set("rates",s)})},dv=function(e,t){return function(n,a){var r=pv(a,e,!0,!0);return n($l("services",r,t))}},mv=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n,a){n(jr());var r=wi(e);return ei(r).then(function(e){var r=e.data[0].data.details[0];"undefined"!==typeof r.price&&Array.isArray(r.price)||(r.price=[{from:0,to:ee("serviceCycleUnlimitedValue","UNLIMITED"),price:"undefined"===typeof r.price?"":r.price}]),r.originalValue=r.from;var i=g.c.fromJS(r),o=pv(a,i,!1,!1).toJS();return n(iv(o)),t&&n(Gl("service",o)),n(Wr(e))}).catch(function(e){return n(Jr(e,"Error retrieving Entity"))})}},gv=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab),progress:!1},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t){var r=S()().add(1,"days").toISOString();n.props.dispatch(ov(["from"],r))}"clone"===t&&(n.props.dispatch(uv()),n.handleSelectTab(1)),null===a.get("prorated",null)&&n.props.dispatch(ov(["prorated"],!0))},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&ue(t,!1)){var a=t.get("name","");n.props.dispatch(dp("services","name",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(mv(e,!0)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("name","");n.props.dispatch(sp("services",e))},n.clearItemsList=function(){n.props.dispatch(up("services"))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onGroupAdd=function(e,t,a,r,i,o,l,s){n.props.dispatch(sv(e,t,a,r,i,o,l,s))},n.onGroupRemove=function(e){n.props.dispatch(cv(e))},n.onUpdateItem=function(e,t){n.props.dispatch(ov(e,t))},n.onRemoveFieldValue=function(e){n.props.dispatch(lv(e))},n.afterSave=function(e){var t=n.props.mode;if(n.setState({progress:!1}),e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Ur("The service was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSelectTab=function(e){n.setState({activeTab:e})},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&n.clearItemsList();var a=ee(["systemItems",t.entityName,"itemsType"],"");n.props.router.push("/".concat(a))},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.setState({progress:!0}),n.props.dispatch(dv(t,a)).then(n.afterSave)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if(["clone","create"].includes(e)){var t=se(e,"service");this.props.dispatch(bs(t))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||ue(t)!==ue(i)){var s=se(n,"service",t);this.props.dispatch(bs(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,t.item)||!g.c.is(this.props.revisions,t.revisions)||this.props.activeTab!==e.activeTab||this.props.itemId!==e.itemId||this.props.mode!==e.mode}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"CLEAR_SERVICE"})}},{key:"render",value:function(){var e=this.state,n=e.progress,a=e.activeTab,i=this.props,o=i.item,l=i.mode,s=i.revisions;if("loading"===l)return r.a.createElement(_,{onClick:this.handleBack});var c="view"!==l,u=o.getIn(["include","groups"],g.c.Map()),p=o.get("rates",g.c.Map()),d=o.get("play",g.c.List());return r.a.createElement("div",{className:"ServiceSetup"},r.a.createElement(f.v,null,r.a.createElement(Sd,{itemName:t.entityName,revisions:s,item:o,mode:l,onChangeFrom:this.onUpdateItem,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.B,{activeKey:a,animation:!1,id:"ServiceTab",onSelect:this.handleSelectTab},r.a.createElement(f.z,{title:"Details",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(rv,{item:o,mode:l,updateItem:this.onUpdateItem,onFieldRemove:this.onRemoveFieldValue}))),r.a.createElement(f.z,{title:"Override Product Price",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(lh,{itemName:t.entityName,mode:l,planRates:p,onChangeFieldValue:this.onUpdateItem,plays:d.join(",")}))),r.a.createElement(f.z,{title:"Service Includes",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(xh,{includeGroups:u,onChangeFieldValue:this.onUpdateItem,onGroupAdd:this.onGroupAdd,onGroupRemove:this.onGroupRemove,mode:l,type:t.entityName,plays:d.join(",")}))),r.a.createElement(f.z,{title:"Tax",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(dg,{tax:o.get("tax"),mode:l,itemName:t.entityName,onFieldUpdate:this.onUpdateItem,onFieldRemove:this.onRemoveFieldValue})))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!c,cancelLabel:c?void 0:"Back",progress:n}))}}]),t}(a.Component);gv.defaultProps={item:g.c.Map(),revisions:g.c.List(),activeTab:1},gv.entityName="service";var fv=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,"service"),item:bo(e,t,"service"),mode:Co(e,t,"service"),activeTab:mo(e,t,"service"),revisions:po(e,t,"service")}})(gv)),hv=n(285),vv=n.n(hv),yv="SET_NAME",bv="SET_DELIMITER_TYPE",Ev="UPDATE_INPUT_PROCESSOR_FIELD",Cv="SET_DELIMITER",_v="SET_HEADERS",Ov="SET_FIELD_MAPPING",Sv="ADD_CSV_FIELD",Tv="ADD_USAGET_MAPPING",kv="ADD_RATE_CATEGORY",jv="REMOVE_RATE_CATEGORY",Iv="SET_RATING_FIELD",wv="ADD_RATING_FIELD",Nv="ADD_RATING_PRIORITY",Fv="REMOVE_RATING_PRIORITY",xv="REMOVE_RATING_FIELD",Rv="SET_CUSETOMER_MAPPING",Mv="SET_PRICING_MAPPING",Pv="ADD_CUSTOMER_MAPPING",Av="REMOVE_CUSTOMER_MAPPING",Dv="SET_RECEIVER_FIELD",Lv="CANCEL_KEY_AUTH",Uv="GOT_PROCESSOR_SETTINGS",Vv="SET_FIELD_WIDTH",Bv="CLEAR_INPUT_PROCESSOR",qv="MAP_USAGET",zv="REMOVE_CSV_FIELD",Hv="REMOVE_USAGET_MAPPING",Yv="SET_USAGET_TYPE",Gv="SET_LINE_KEY",Kv="SET_COMPUTED_LINE_KEY",Wv="UNSET_COMPUTED_LINE_KEY",Jv="REMOVE_ALL_CSV_FIELDS",$v="CHECK_ALL_FIELDS",Qv="SET_STATIC_USAGET",Zv="SET_INPUT_PROCESSOR_TEMPLATE",Xv="MOVE_CSV_FIELD_UP",ey="MOVE_CSV_FIELD_DOWN",ty="CHANGE_CSV_FIELD",ny="UNSET_FIELD",ay="SET_PARSER_SETTING",ry="SET_PROCESSOR_TYPE",iy="SET_REALTIME_FIELD",oy="SET_REALTIME_DEFAULT_FIELD",ly="SET_CHECKED_FIELD",sy="REMOVE_RECEIVER",cy="ADD_RECEIVER";function uy(e){return e.conditions.map(function(e){return function(e){var t=e.op,n=e.pattern,a=e;return"$in"!==t&&"$nin"!==t||"object"!==typeof n||(a.pattern=n.join()),a}(e)})}function py(e){return e.get("conditions").map(function(e){return function(e){var t=e.get("op",!1),n=e.get("pattern",!1),a=e;return"$in"!==t&&"$nin"!==t||"string"!==typeof n||(a=e.set("pattern",n.split(","))),a}(e)})}var dy=function(e){var t=e.parser,n=void 0===t?{}:t,a=e.processor,r=void 0===a?{}:a,i=e.customer_identification_fields,o=void 0===i?{}:i,l=e.rate_calculators,s=void 0===l?{}:l,c=e.pricing,u=void 0===c?{}:c,p=e.receiver,d=void 0===p?{}:p,m=e.realtime,f=void 0===m?{}:m,h=e.response,v=void 0===h?{}:h,y=e.unify,b=void 0===y?{}:y,E=e.enabled,C=void 0===E||E,_=e.filters,O=void 0===_?[]:_,S=d&&d.connections?d.connections:[],T="fixed"===n.type&&n.structure?n.structure.map(function(e){return e.width}):[],k=!vv()(r,"usaget_mapping")||r.usaget_mapping.length<1?"static":"dynamic",j={file_type:e.file_type,delimiter_type:n.type,delimiter:n.separator,csv_has_header:n.csv_has_header,csv_has_footer:n.csv_has_footer,usaget_type:k,type:e.type,unfiltered_fields:n.structure?g.c.List(n.structure).map(function(e){return g.c.Map({name:e.name,checked:"undefined"===typeof e.checked||e.checked})}):g.c.List(),field_widths:T,line_types:n.line_types,customer_identification_fields:o,rate_calculators:s,pricing:u,unify:b,enabled:C,filters:O};if(j.fields=g.c.List(j.unfiltered_fields.filter(function(e){return!0===e.get("checked")}).map(function(e){return e.get("name")})),"realtime"!==e.type?j.receiver=S:(j.realtime=f,j.response=v),r){var I;for(var w in I="dynamic"===k?r.usaget_mapping.map(function(e){return{src_field:e.src_field,stamp_fields:e.stamp_fields,conditions:void 0!==e.conditions?uy(e):[{src_field:e.src_field,pattern:e.pattern}],usaget:e.usaget,pattern:e.pattern,unit:e.unit,volume_type:e.volume_type,volume_src:e.volume_src}}):[],j.processor=Object.assign({},r,{usaget_mapping:I,src_field:"dynamic"===k?r.usaget_mapping[0].src_field:""}),s||(j.rate_calculators="dynamic"===k?r.usaget_mapping.reduce(function(e,t){return e.retail[t.usaget]=[],e},{}):{retail:Object(ti.a)({},r.default_usaget,[])}),o||(j.customer_identification_fields="dynamic"===k?r.usaget_mapping.reduce(function(e,t){return e[t.usaget]=[],e},{}):Object(ti.a)({},r.default_usaget,[])),u||(j.pricing="dynamic"===k?r.usaget_mapping.reduce(function(e,t){return e[t.usaget]={},e},{}):Object(ti.a)({},r.default_usaget,{})),j.pricing){0===j.pricing[w].length&&(j.pricing[w]={})}if(O)for(var N in j.filters){var F=j.filters[N];if("undefined"!==typeof F.conditions)for(var x in F.conditions)"undefined"!==typeof(x=F.conditions[x]).value.regex&&(x.value=new RegExp("".concat(x.value.regex)).toString())}}else j.processor={usaget_mapping:[]};return j};function my(e){var t={api:"settings",params:[{category:"file_types"},{data:JSON.stringify({file_type:e})}]};return function(e){e(jr()),ei(t).then(function(t){var n;e(Ir()),e((n=dy(t.data[0].data.details),{type:Uv,settings:n}))}).catch(function(t){console.log(t),e(Ir()),e(Br("Error loading input processor"))})}}function gy(e){return{type:yv,file_type:e}}function fy(e){return{type:bv,delimiter_type:e}}function hy(e){return{type:_v,fields:e}}function vy(e,t,n){return{type:Dv,field:e,mapping:t,index:n}}var yy=function(e){return function(t){var n=si(e,"unset");return t(jr()),ei(n).then(function(e){return t(Wr(e))}).catch(function(e){return t(Jr(e,"Error occurred while trying to delete input processor"))})}},by=function(e,t){return function(n){var a=t?"enable":"disable",r=si(e,a);return n(jr()),ei(r).then(function(e){return n(Wr(e))}).catch(function(e){return n(Jr(e,"Error occurred while trying to ".concat(a," input processor")))})}};var Ey=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onClickRemove=function(e){n.setState({showConfirmRemove:!0,inputProcessor:e})},n.onClickRemoveCancel=function(){n.setState({showConfirmRemove:!1,inputProcessor:null})},n.onClickRemoveOk=function(){var e=n.state.inputProcessor;n.setState({showConfirmRemove:!1,inputProcessor:null});var t=e.get("file_type","");n.props.dispatch(yy(t)).then(function(e){e.status&&n.props.dispatch(eo("input_processors",n.buildQuery()))})},n.onClickEnabled=function(e){n.setState({showConfirmEnable:!0,inputProcessor:e})},n.onClickEnableCancel=function(){n.setState({showConfirmEnable:!1,inputProcessor:null})},n.onClickEnableOk=function(){var e=n.state.inputProcessor;n.setState({showConfirmEnable:!1,inputProcessor:null}),n.updateEnabled(e,!0)},n.onClickDisabled=function(e){n.setState({showConfirmDisable:!0,inputProcessor:e})},n.onClickDisableCancel=function(){n.setState({showConfirmDisable:!1,inputProcessor:null})},n.onClickDisableOk=function(){var e=n.state.inputProcessor;n.setState({showConfirmDisable:!1,inputProcessor:null}),n.updateEnabled(e,!1)},n.updateEnabled=function(e,t){var a=e.get("file_type","");n.props.dispatch(by(a,t)).then(function(e){e.status&&n.props.dispatch(eo("input_processors",n.buildQuery()))})},n.parseShowEnable=function(e){return!e.get("enabled",!0)},n.parseShowDisable=function(e){return!n.parseShowEnable(e)},n.parseInputProcessorStatus=function(e){return r.a.createElement(I,{status:e.get("enabled",!1)?"active":"expired"})},n.getListActions=function(){return[{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.onClickInputProcessor,show:!0,onClickColumn:"file_type"},{type:"enable",showIcon:!0,helpText:"Enable",onClick:n.onClickEnabled,show:n.parseShowEnable},{type:"disable",showIcon:!0,helpText:"Disable",onClick:n.onClickDisabled,show:n.parseShowDisable},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.onClickRemove,show:!0}]},n.onClickInputProcessor=n.onClickInputProcessor.bind(Object(Po.a)(n)),n.onClickNew=n.onClickNew.bind(Object(Po.a)(n)),n.onSort=n.onSort.bind(Object(Po.a)(n)),n.buildQuery=n.buildQuery.bind(Object(Po.a)(n)),n.state={sort:"",showConfirmRemove:!1,showConfirmEnable:!1,showConfirmDisable:!1,inputProcessor:null},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(eo("input_processors",this.buildQuery()))}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Xi("input_processors"))}},{key:"buildQuery",value:function(){return{api:"settings",params:[{category:"file_types"},{sort:this.state.sort},{data:JSON.stringify({})}]}}},{key:"onClickInputProcessor",value:function(e){var t={file_type:e.get("file_type"),action:"update"};e.get("type")&&(t.type="api",t.format=e.get("type")),this.context.router.push({pathname:"input_processor",query:t})}},{key:"onClickNew",value:function(){this.context.router.push({pathname:"select_input_processor_template",query:{action:"new"}})}},{key:"onSort",value:function(e){var t=this;this.setState({sort:e},function(){t.props.dispatch(eo("input_processors",t.buildQuery()))})}},{key:"render",value:function(){var e=this.props.inputProcessors,t=this.state,n=t.showConfirmRemove,a=t.showConfirmEnable,i=t.showConfirmDisable,o=t.inputProcessor,l=o?o.get("file_type"):"",s='Are you sure you want to remove input processor "'.concat(l,'"?'),c='Are you sure you want to enable input processor "'.concat(l,'"?'),u='Are you sure you want to disable input processor "'.concat(l,'"?'),p=[{id:"active",title:"Status",parser:this.parseInputProcessorStatus,cssClass:"state"},{id:"file_type",title:"Name"}],d=this.getListActions();return r.a.createElement("div",{className:"InputProcessorsList"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},"All available input processors",r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:this.onClickNew},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add New"))),r.a.createElement("div",{className:"panel-body"},r.a.createElement(ju,{items:e,fields:p,onSort:this.onSort,actions:d}),r.a.createElement(lt,{onOk:this.onClickRemoveOk,onCancel:this.onClickRemoveCancel,show:n,message:s,labelOk:"Yes"}),r.a.createElement(lt,{onOk:this.onClickEnableOk,onCancel:this.onClickEnableCancel,show:a,message:c,labelOk:"Yes"}),r.a.createElement(lt,{onOk:this.onClickDisableOk,onCancel:this.onClickDisableCancel,show:i,message:u,labelOk:"Yes"}))))))}}]),t}(a.Component);Ey.contextTypes={router:Vu.a.object.isRequired};var Cy=Object(l.connect)(function(e,t){return{inputProcessors:e.list.get("input_processors")||[]}})(Ey),_y=function(e,t){return{type:"UPDATE_EXPORT_GENERATOR_VALUE",path:e,value:t}},Oy=function(e){return{type:"REMOVE_EXPORT_GENERATOR_VALUE",path:e}},Sy=function(){return function(e){return e(kl("export_generators"))}},Ty=function(e){return function(t){var n=ci(e,"unset");return t(jr()),ei(n).then(function(e){return t(Sy()),t(Wr(e))}).catch(function(n){return t(Jr(n,"Error occurred while trying to delete export generator ".concat(e)))})}},ky=function(e,t){return function(n){var a=t?"enable":"disable",r=ci(e,a);return n(jr()),ei(r).then(function(e){return n(Sy()),n(Wr(e))}).catch(function(t){return n(Jr(t,"Error occurred while trying to ".concat(a," export generator ").concat(e)))})}},jy=function(e){var t=function(e){return ii(e,"export_generators")}(e);return function(e){return e(jr()),ei(t).then(function(t){return e(Wr(t,"Export generator saved successfully"))}).catch(function(t){return e(Jr(t))})}},Iy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onClickRemove=function(e){var t={message:'Are you sure you want to delete export generator "'.concat(e.get("name"),'" ?'),onOk:function(){return n.onRemoveOk(e)},type:"delete",labelOk:"Delete"};n.props.dispatch(ks(t))},n.onRemoveOk=function(e){""!==e.get("name","")&&n.props.dispatch(Ty(e.get("name","")))},n.onClickEnable=function(e){var t=e.get("name","");""!==t&&n.props.dispatch(ky(t,!0))},n.onClickDisable=function(e){var t={message:'Are you sure you want to disable export generator "'.concat(e.get("name"),'" ?'),onOk:function(){return n.onDisableOk(e)},type:"confirm",labelOk:"Yes"};n.props.dispatch(ks(t))},n.onDisableOk=function(e){var t=e.get("name","");""!==t&&n.props.dispatch(ky(t,!1))},n.onClickEdit=function(e){n.props.router.push("/export_generator/".concat(e.get("name")))},n.onClickNew=function(){n.props.router.push("/export_generator")},n.parseShowEnable=function(e){return!e.get("enabled",!0)},n.parseShowDisable=function(e){return!n.parseShowEnable(e)},n.parserStatus=function(e){return r.a.createElement(I,{status:e.get("enabled",!0)?"active":"expired"})},n.getListActions=function(){return[{type:"add",actionStyle:"primary",actionSize:"xsmall",label:"Add new",onClick:n.onClickNew}]},n.getListFields=function(){return[{id:"active",title:"Status",parser:n.parserStatus,cssClass:"state"},{id:"name",title:"Name"}]},n.getRowActions=function(){return[{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.onClickEdit,show:!0,onClickColumn:"name"},{type:"enable",showIcon:!0,helpText:"Enable",onClick:n.onClickEnable,show:n.parseShowEnable},{type:"disable",showIcon:!0,helpText:"Disable",onClick:n.onClickDisable,show:n.parseShowDisable},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.onClickRemove,show:!0}]},n.renderPanelHeader=function(){return r.a.createElement("div",null,"\xa0",r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:n.getListActions()})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Sy())}},{key:"render",value:function(){var e=this.props.exportGenerators,t=this.getListFields(),n=this.getRowActions();return r.a.createElement("div",{className:"ExportGenerators"},r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{header:this.renderPanelHeader()},r.a.createElement(ju,{items:e,fields:t,actions:n}))))}}]),t}(a.Component);Iy.defaultProps={exportGenerators:g.c.List()};var wy=Object(s.f)(Object(l.connect)(function(e,t){return{exportGenerators:Qn(e,t)}})(Iy)),Ny=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={fileNamePlaceholdersOpen:!1},n.onChangeName=function(e){var t=e.target.value;n.props.onChange("name",t)},n.onChangeActive=function(e){var t=e.target.value;n.props.onChange("enabled","yes"===t)},n.onChangeFileName=function(e){var t=e.target.value;n.props.onChange("file_name",t)},n.onChangeType=function(e){n.props.onChange(["generator","type"],e)},n.onChangeRecordTypes=function(e){var t=n.props.data;if(Array.isArray(e)&&e.length>0){var a=t.getIn(["generator","record_type_mapping"],g.c.List()).filter(function(t){return e.includes(t.get("record_type",""))}).withMutations(function(n){var a=t.getIn(["generator","record_type_mapping"],g.c.List()).map(function(e){return e.get("record_type","")});e.forEach(function(e){a.includes(e)||n.push(g.c.Map({record_type:e,conditions:g.c.List()}))})});return n.props.onChange(["generator","record_type_mapping"],a)}n.props.onChange(["generator","record_type_mapping"],g.c.List())},n.onAddCondition=function(e){var a=["generator","record_type_mapping",e,"conditions"],r=n.props.data.getIn(a,g.c.List());n.props.onChange(a,r.push(t.defaultCondition))},n.onRemoveCondition=function(e){return function(t){var a=n.props.data,r=["generator","record_type_mapping",e,"conditions"],i=a.getIn(r,g.c.List());n.props.onChange(r,i.delete(t))}},n.onChangeConditionField=function(e){return function(t,a){var r=["generator","record_type_mapping",e,"conditions"];n.props.onChange([].concat(r,[t,"field"]),a)}},n.onChangeConditionOp=function(e){return function(a,r){var i=n.props.data,o=["generator","record_type_mapping",e,"conditions"],l=[].concat(o,[a,"op"]);n.props.onChange(l,r);var s=i.getIn(l,"");t.conditionsOperators.find(function(e){return e.get("id","")===s},null,g.c.Map()).get("type","")!==t.conditionsOperators.find(function(e){return e.get("id","")===r},null,g.c.Map()).get("type","")&&n.props.onChange([].concat(o,[a,"value"]),"")}},n.onChangeConditionValue=function(e){return function(t,a){var r=["generator","record_type_mapping",e,"conditions"];n.props.onChange([].concat(r,[t,"value"]),a)}},n.onToggleFileNamePlaceHolders=function(){n.setState({fileNamePlaceholdersOpen:!n.state.fileNamePlaceholdersOpen})},n.getListActions=function(){return[{type:"add",actionStyle:"primary",actionSize:"xsmall",label:"Add Condition",onClick:n.onAddCondition}]},n.renderRecordTypesMapping=function(){var e=n.props,a=e.data,i=e.linesFields,o=a.getIn(["generator","record_type_mapping"],g.c.List()).map(function(e,a){var o=e.get("conditions",g.c.List()).isEmpty(),l=e.get("record_type","");return r.a.createElement(f.v,{className:"collapsible",collapsible:!0,header:"Record Type: ".concat(l),key:"".concat(l,"_").concat(a),defaultExpanded:o},!o&&r.a.createElement(Pl,{conditions:e.get("conditions",g.c.List()),fields:i,operators:t.conditionsOperators,onChangeField:n.onChangeConditionField(a),onChangeOperator:n.onChangeConditionOp(a),onChangeValue:n.onChangeConditionValue(a),onRemove:n.onRemoveCondition(a),noConditionsLabel:""}),r.a.createElement("div",{className:"ml15"},r.a.createElement(vt,{actions:n.getListActions(),data:a})))});return r.a.createElement(f.w,{className:"mt5"},o)},n.renderOpenFilenamePlaceholders=function(){return r.a.createElement(f.c,{bsStyle:"link",bsSize:"xsmall",className:"pb0 pt0 pr0 pl0",onClick:n.onToggleFileNamePlaceHolders},"Placeholders")},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(kl(["lines.fields"]))}},{key:"render",value:function(){var e=this.props,n=e.data,a=e.mode,i=n.getIn(["generator","record_type_mapping"],g.c.List()).reduce(function(e,t){return e.push(t.get("record_type",""))},g.c.List()).filter(function(e){return""!==e}).toArray(),o="create"===a;return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("name","export_generator","Name")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.get("name",""),onChange:this.onChangeName,disabled:!o}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("status","export_generator","Status")),r.a.createElement(f.g,{sm:4},r.a.createElement("span",null,r.a.createElement("span",{className:"mr20 inline"},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"yes",label:te("status_active","export_generator","Active"),checked:n.get("enabled",!0)})),r.a.createElement("span",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"no",label:te("status_disabled","export_generator","Not Active"),checked:!n.get("enabled",!0)}))))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("export_file_type","export_generator","Export file Type")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",value:n.getIn(["generator","type"],""),options:t.fileTypesOptions,onChange:this.onChangeType}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("record_type","export_generator","Record Type")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"tags",value:i,onChange:this.onChangeRecordTypes})),r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{header:"Record Type Conditions",className:"mt10"},this.renderRecordTypesMapping()))))}}]),t}(a.Component);Ny.defaultProps={data:g.c.Map(),linesFields:g.c.List(),mode:"create"},Ny.defaultCondition=g.c.Map({field:"",op:"",value:""}),Ny.fileTypesOptions=ee(["exportGenerator","fileTypes"],g.c.List()).map(he).toArray(),Ny.conditionsOperators=et(["exportGenerator","recordTypeConditions"]);var Fy=Object(l.connect)(function(e,t){return{linesFields:Pf(e,t)}})(Ny),xy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeTimeRange=function(e){var a=e.target.value,r=n.props.data.getIn(t.timeRangePath,"-"),i=Xe(r),o=i.prefix,l=i.suffix,s=x()(a)?Math.abs(parseFloat(a)):"";n.props.onChange(t.timeRangePath,"".concat(o).concat(s," ").concat(l))},n.onSelectTimeRangeUnit=function(e){var a=n.props.data.getIn(t.timeRangePath,"-"),r=Xe(a),i=r.prefix,o=r.number;n.props.onChange(t.timeRangePath,"".concat(i).concat(o," ").concat(e))},n.onAddCondition=function(){var e=n.props.data.getIn(t.queryPath,g.c.List());n.props.onChange(t.queryPath,e.push(t.defaultCondition))},n.onRemoveCondition=function(e){var a=n.props.data.getIn(t.queryPath,g.c.List());n.props.onChange(t.queryPath,a.delete(e))},n.onChangeConditionField=function(e,a){n.props.onChange([].concat(Object(N.a)(t.queryPath),[e,"field"]),a)},n.onChangeConditionOp=function(e,a){var r=n.props.data,i=[].concat(Object(N.a)(t.queryPath),[e,"op"]);n.props.onChange(i,a);var o=r.getIn(i,"");t.conditionsOperators.find(function(e){return e.get("id","")===o},null,g.c.Map()).get("type","")!==t.conditionsOperators.find(function(e){return e.get("id","")===a},null,g.c.Map()).get("type","")&&n.props.onChange([].concat(Object(N.a)(t.queryPath),[e,"value"]),"")},n.onChangeConditionValue=function(e,a){n.props.onChange([].concat(Object(N.a)(t.queryPath),[e,"value"]),a)},n.getListActions=function(){return[{type:"add",actionStyle:"primary",actionSize:"xsmall",label:"Add Condition",onClick:n.onAddCondition}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,n=this.props,a=n.data,i=n.linesFields,o=ee(["exportGenerator","timeRangeOptions"],g.c.List()),l=Xe(a.getIn(t.timeRangePath,"-")),s=l.prefix,c=l.number,u=l.suffix,p=""===u?"Select unit...":Object(D.sentenceCase)(Gp()(u,Number(c)));return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("time_range","export_generator","Time Range")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(f.o,{className:"full-width"},r.a.createElement(Tn,{fieldType:"number",min:"1",step:"1",value:c,onChange:this.onChangeTimeRange,preffix:s}),r.a.createElement(f.i,{id:"balance-period-unit",componentClass:f.o.Button,title:p},o.map(function(t,n){return r.a.createElement(f.q,{key:n,eventKey:t,onSelect:e.onSelectTimeRangeUnit},Object(D.sentenceCase)(t))}))))),r.a.createElement(f.v,{header:"Conditions",className:"mb0"},r.a.createElement(f.g,{sm:12},r.a.createElement(Pl,{conditions:a.getIn(t.queryPath,g.c.List()),fields:i,operators:t.conditionsOperators,onChangeField:this.onChangeConditionField,onChangeOperator:this.onChangeConditionOp,onChangeValue:this.onChangeConditionValue,onRemove:this.onRemoveCondition})),r.a.createElement(f.g,{sm:12,className:"mt10 ml15"},r.a.createElement(vt,{actions:this.getListActions()}))))}}]),t}(a.Component);xy.defaultProps={data:g.c.Map(),linesFields:g.c.List()},xy.defaultCondition=g.c.Map({field:"",op:"",value:""}),xy.queryPath=["filtration",0,"query"],xy.timeRangePath=["filtration",0,"time_range"],xy.conditionsOperators=et(["exportGenerator","filtrationConditions"]);var Ry=Object(l.connect)(function(e,t){return{linesFields:Pf(e,t)}})(xy),My=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getValue=function(){var e=n.props.item,t=n.getOp();return"param_name"===t?e.get("param_name",""):"predefined_values"===t?e.get("predefined_values",""):"hard_coded_value"===t?e.get("hard_coded_value",""):"linked_entity"===t?e.getIn(["linked_entity","field_name"],""):""},n.getType=function(){return n.props.item.get("type","string")},n.getOp=function(){var e=n.props.item;return e.has("predefined_values")?"predefined_values":e.has("hard_coded_value")?"hard_coded_value":e.has("param_name")?"param_name":e.has("linked_entity")?"linked_entity":""},n.onRemove=function(){var e=n.props.index;n.props.onRemove(e)},n.onChangeName=function(e){var t=e.target.value,a=n.props.index;n.props.onChange([a,"name"],t)},n.onChangePath=function(e){var t=e.target.value,a=n.props.index;n.props.onChange([a,"path"],t)},n.onChangeType=function(e){var t=n.props,a=t.index,r=t.item;if("autoinc"===e){var i=r.set("type",e).delete("hard_coded_value").delete("param_name").delete("predefined_values").delete("linked_entity").delete("format");n.props.onChange([a],i)}else n.props.onChange([a,"type"],e)},n.onChangeOperator=function(e){var a=n.props,r=a.index,i=a.item.withMutations(function(n){n.delete("hard_coded_value"),n.delete("param_name"),n.delete("predefined_values"),n.delete("linked_entity"),"predefined_values"===e?n.set("predefined_values",""):"hard_coded_value"===e?n.set("hard_coded_value",""):"param_name"===e?n.set("param_name",""):"linked_entity"===e&&n.set("linked_entity",t.defaultLinkedEntity)});n.props.onChange([r],i)},n.onChangeValue=function(e){var t=e.target.value,a=n.props.index,r=n.getOp();n.props.onChange([a,r],t)},n.onChangePredefinedValue=function(e){var t=n.props.index;n.props.onChange([t,"predefined_values"],e)},n.onChangeParamName=function(e){var t=n.props.index;n.props.onChange([t,"param_name"],e)},n.onChangeLinkedEntity=function(e){var t=n.props.index;n.props.onChange([t,"linked_entity","field_name"],e)},n.onChangeFormat=function(e){var t=e.target.value,a=n.props.index;n.props.onChange([a,"format"],t)},n.onChangePaddingDir=function(e){var t=n.props.index;n.props.onChange([t,"padding","direction"],e)},n.onChangePaddingLength=function(e){var t=e.target.value,a=n.props.index;n.props.onChange([a,"padding","length"],t)},n.onChangePaddingChar=function(e){var t=e.target.value,a=n.props.index;n.props.onChange([a,"padding","character"],t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,n=e.item,a=e.isFixed,i=e.linesFields,o=e.exportType,l=e.paramsOptions,s=this.getType(),c=this.getOp(),u=this.getValue(),p=n.getIn(["format"],""),d=n.getIn(["padding","direction"],"left"),m=n.getIn(["padding","length"],""),g=n.getIn(["padding","character"],""),h=["","autoinc"].includes(s),v=[""].includes(c)||h,y="date"!==s,b=i.map(he).toArray(),E=l.map(function(e){return{value:e.get("param",""),label:e.get("param","")}}).toArray();return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.l,{className:"form-inner-edit-row",validationState:null},r.a.createElement(f.g,{sm:12},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"name"},"Field")),r.a.createElement(f.g,{sm:2,className:"pl0"},r.a.createElement(Tn,{value:n.get("name",""),onChange:this.onChangeName})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"type_field"},"Type")),r.a.createElement(f.g,{sm:2,className:"pl0"},r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:t.typeOptions,value:s,onChange:this.onChangeType})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},"Operator")),r.a.createElement(f.g,{sm:2,className:"pl0"},r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:t.opOptions,value:c,disabled:h,onChange:this.onChangeOperator})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Value")),r.a.createElement(f.g,{sm:3,className:"pl0"},"linked_entity"===c&&r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:b,value:u,onChange:this.onChangeLinkedEntity,disabled:v}),"predefined_values"===c&&r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:t.predefinedValueOptions,value:u,onChange:this.onChangePredefinedValue,disabled:v}),"param_name"===c&&r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:E,value:u,onChange:this.onChangeParamName,disabled:v}),!["linked_entity","predefined_values","param_name"].includes(c)&&r.a.createElement(Tn,{value:u,disabled:v,onChange:this.onChangeValue})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"fromat_field"},"Format")),r.a.createElement(f.g,{sm:2,className:"pl0"},r.a.createElement(Tn,{value:p,disabled:y,onChange:this.onChangeFormat})),r.a.createElement(f.g,{sm:1,className:"actions pr0 rl0 action-fix-height"},r.a.createElement(f.c,{onClick:this.onRemove,bsSize:"small",className:"pull-right"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"})))),"xml"===o&&r.a.createElement(f.g,{sm:12,className:"mt5 pl0"},r.a.createElement(Tn,{preffix:"Path",value:n.get("path",""),onChange:this.onChangePath})),a&&r.a.createElement(f.g,{sm:12,className:"mt5 pl0"},r.a.createElement(f.v,{className:"collapsible",collapsible:!0,header:"Padding"},r.a.createElement(f.g,{sm:4,className:"pl0"},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,"Direction"),r.a.createElement(Tn,{fieldType:"select",clearable:!1,options:t.paddingDirOptions,value:d,onChange:this.onChangePaddingDir}))),r.a.createElement(f.g,{sm:4,className:"pl0"},r.a.createElement(Tn,{fieldType:"integer",preffix:"Length",value:m,onChange:this.onChangePaddingLength})),r.a.createElement(f.g,{sm:4,className:"pl0"},r.a.createElement(Tn,{preffix:"Character",value:g,onChange:this.onChangePaddingChar})))),!1),r.a.createElement("hr",null))}}]),t}(a.Component);My.defaultProps={item:g.c.Map(),linesFields:g.c.List(),paramsOptions:g.c.List(),isFixed:!1,exportType:""},My.defaultLinkedEntity=g.c.Map({field_name:"",entity:"line"}),My.opOptions=[{value:"hard_coded_value",label:"Fixed value"},{value:"predefined_values",label:"Dynamic value"},{value:"param_name",label:"Parameter"},{value:"linked_entity",label:"Related field"}],My.typeOptions=[{value:"string",label:"String"},{value:"date",label:"Date"},{value:"int",label:"Integer"}],My.predefinedValueOptions=[{value:"now",label:"Now"},{value:"number_of_data_records",label:"Number Of Data Records"},{value:"number_of_records",label:"Number Of Records"}],My.paddingDirOptions=[{value:"left",label:"Left"},{value:"right",label:"Right"}];var Py=Object(l.connect)(function(e,t){return{linesFields:Pf(e,t)}})(My),Ay=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onAddField=function(e){var a=n.props.data,r=a.getIn(e,g.c.List());if(["separator","fixed"].includes(a.getIn(["generator","type"],""))){var i=r.isEmpty()?0:r.map(function(e){return e.get("path",0)}).max()+1;n.props.onChange(e,r.push(t.defaultField.set("path",i)))}else n.props.onChange(e,r.push(t.defaultField))},n.onRemoveField=function(e){return function(t){var a=n.props.data,r=Array.isArray(t)?t:[t];if(["separator","fixed"].includes(a.getIn(["generator","type"],""))){var i=a.getIn(e,g.c.List()).deleteIn(r).sortBy(function(e){return e.get("path","")}).map(function(e,t){return e.set("path",t+1)});n.props.onChange(e,i)}else n.props.onRemove([].concat(Object(N.a)(e),Object(N.a)(r)))}},n.onUpdateField=function(e){return function(t,a){var r=Array.isArray(t)?t:[t];n.props.onChange([].concat(Object(N.a)(e),Object(N.a)(r)),a)}},n.getRecordsTypes=function(){return n.props.data.getIn(["generator","record_type_mapping"],g.c.List()).reduce(function(e,t){return e.push(t.get("record_type",""))},g.c.List()).filter(function(e){return""!==e})},n.renderRecordTypeBody=function(e,t){var a=n.props.data,i=a.getIn(["generator","data_structure",e],g.c.List()),o=[{type:"add",actionStyle:"primary",actionSize:"xsmall",label:"Add new field",onClick:n.onAddField}],l="fixed"===a.getIn(["generator","type"],""),s=["separator","fixed"].includes(a.getIn(["generator","type"],""))?"csv":"xml",c=a.getIn(["filename_params"],g.c.List()),u=Gp()("field",Number(i.size),!0);return r.a.createElement(f.v,{className:"collapsible",key:"type_block_".concat(t),collapsible:!0,header:"Record Type - ".concat(e," | ").concat(u)},!i.isEmpty()&&n.renderRowsHeader(),i.map(function(a,i){return r.a.createElement(Py,{key:"row_".concat(t,"_").concat(i),item:a,index:i,isFixed:l,exportType:s,paramsOptions:c,onRemove:n.onRemoveField(["generator","data_structure",e]),onChange:n.onUpdateField(["generator","data_structure",e])})}),r.a.createElement(vt,{actions:o,data:["generator","data_structure",e]}))},n.renderBody=function(){var e=n.getRecordsTypes();return e.size>0?r.a.createElement(f.w,{className:"mb0"},e.map(n.renderRecordTypeBody)):r.a.createElement("p",null,r.a.createElement("small",null,"Please add at least one 'Record Type' to add fields"))},n.renderRows=function(e,t){var a=n.props.data,i=a.getIn(["generator",e],g.c.List()),o=[{type:"add",actionStyle:"primary",actionSize:"xsmall",label:"Add new ".concat(t),onClick:n.onAddField}],l="fixed"===a.getIn(["generator","type"],""),s=["separator","fixed"].includes(a.getIn(["generator","type"],""))?"csv":"xml",c=a.getIn(["filename_params"],g.c.List()),u=i.map(function(a,i){return r.a.createElement(Py,{key:"row_".concat(t,"_").concat(i),item:a,index:i,isFixed:l,exportType:s,paramsOptions:c,onRemove:n.onRemoveField(["generator",e]),onChange:n.onUpdateField(["generator",e])})});return r.a.createElement(r.a.Fragment,null,!i.isEmpty()&&n.renderRowsHeader(),u,r.a.createElement(vt,{actions:o,data:["generator",e]}))},n.renderRowsHeader=function(){return r.a.createElement(f.g,{sm:12,className:"form-inner-edit-rows"},r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"field"},"Field")),r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"type"},"Type")),r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"operator"},"Operator")),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"value"},"Value")),r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"value"},"Format"))))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.data,t=e.getIn(["generator","header_structure"],g.c.List()),n=Gp()("field",Number(t.size),!0),a=e.getIn(["generator","trailer_structure"],g.c.List()),i=Gp()("field",Number(a.size),!0);return r.a.createElement(f.w,{className:"mb0"},r.a.createElement(f.v,{collapsible:!0,className:"collapsible",header:"Header | ".concat(n)},this.renderRows("header_structure","header")),r.a.createElement(f.v,{collapsible:!0,className:"collapsible",defaultExpanded:!0,header:"Body"},this.renderBody()),r.a.createElement(f.v,{collapsible:!0,className:"collapsible",header:"Footer | ".concat(i)},this.renderRows("trailer_structure","footer")))}}]),t}(a.Component);Ay.defaultProps={data:g.c.Map()},Ay.defaultField=g.c.Map({name:"",type:"string",hard_coded_value:""});var Dy=Ay,Ly=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeName=function(e){var a=e.target.value;n.props.onChange(t.namePath,a)},n.onChangeHost=function(e){var a=e.target.value;n.props.onChange(t.hostPath,a)},n.onChangeUser=function(e){var a=e.target.value;n.props.onChange(t.userPath,a)},n.onChangePassword=function(e){var a=e.target.value;n.props.onChange(t.passwordPath,a)},n.onChangeDir=function(e){var a=e.target.value;n.props.onChange(t.dirPath,a)},n.onChangePassive=function(e){var a=e.target.value;n.props.onChange(t.passivePath,a)},n.onChangeSenderType=function(e){var a=e.target.value;n.props.onChange(t.senderTypePath,a)},n.renderSenderType=function(e,a){var i=n.props.data;return r.a.createElement(f.g,{sm:3,key:a},r.a.createElement(Tn,{fieldType:"radio",onChange:n.onChangeSenderType,name:"sender-type-".concat(a),value:a,label:e,checked:i.getIn(t.senderTypePath,"")===a}))},n.renderSenderTypes=function(){return t.senderTypes.map(n.renderSenderType).toList().toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.data;return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("sender_type","export_generator","Sender Type")),r.a.createElement(f.g,{sm:8,lg:9},this.renderSenderTypes())),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("name","export_generator","Name")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:e.getIn(t.namePath,""),onChange:this.onChangeName}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("host","export_generator","Host")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:e.getIn(t.hostPath,""),onChange:this.onChangeHost}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("user","export_generator","User")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:e.getIn(t.userPath,""),onChange:this.onChangeUser}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("password","export_generator","Password")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"password",value:e.getIn(t.passwordPath,""),onChange:this.onChangePassword}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("dir","export_generator","Remote Directory")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:e.getIn(t.dirPath,""),onChange:this.onChangeDir}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},te("passive","export_generator","Passive")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"checkbox",onChange:this.onChangePassive,value:e.getIn(t.passivePath,""),className:"input-checkbox-fix-height"}))))}}]),t}(a.Component);Ly.defaultProps={data:g.c.Map()},Ly.basePath=["senders","connections",0],Ly.namePath=[].concat(Object(N.a)(Ly.basePath),["name"]),Ly.hostPath=[].concat(Object(N.a)(Ly.basePath),["host"]),Ly.userPath=[].concat(Object(N.a)(Ly.basePath),["user"]),Ly.passwordPath=[].concat(Object(N.a)(Ly.basePath),["password"]),Ly.dirPath=[].concat(Object(N.a)(Ly.basePath),["remote_directory"]),Ly.passivePath=[].concat(Object(N.a)(Ly.basePath),["passive"]),Ly.senderTypePath=[].concat(Object(N.a)(Ly.basePath),["connection_type"]),Ly.senderTypes=ee(["exportGenerator","senderTypes"],g.c.List());var Uy=Ly,Vy=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={stepIndex:0},n.onChangeValue=function(e,t){n.props.dispatch(_y(e,t))},n.onRemoveValue=function(e){n.props.dispatch(Oy(e))},n.onCancel=function(){var e={message:"Are you sure you want to stop editing Export Generator ?",onOk:function(){return n.onCancelOk()},type:"delete",labelOk:"Yes",labelCancel:"No"};n.props.dispatch(ks(e))},n.onCancelOk=function(){n.props.router.push("export_generators")},n.onFinish=function(){var e=n.props.exportGenerator;n.props.dispatch(jy(e)).then(function(){return n.props.router.push("export_generators")})},n.onNextStep=function(){var e=n.state.stepIndex;e<n.getSteps().length-1&&n.setState({stepIndex:e+1})},n.onPrevStep=function(){var e=n.state.stepIndex;e>0&&n.setState({stepIndex:e-1})},n.getSteps=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=[];return t.push({id:"segmentation\u200e",stepData:{title:"Segmentation\u200e"}}),t.push({id:"filtration",stepData:{title:"Filtration"}}),t.push({id:"mapping",stepData:{title:"Field Mapping\u200e"}}),t.push({id:"senders",stepData:{title:"Senders"},okLabel:"Save",okAction:n.onFinish}),null===e?t:t[e]||{}},n.renderStepContent=function(){var e=n.props,t=e.exportGenerator,a=e.exportGeneratorName,i=n.state.stepIndex,o=n.getSteps(i),l=a.length>0?"edit":"create";switch(o.id){case"segmentation\u200e":return r.a.createElement(Fy,{data:t,onChange:n.onChangeValue,onRemove:n.onRemoveValue,mode:l});case"filtration":return r.a.createElement(Ry,{data:t,onChange:n.onChangeValue,onRemove:n.onRemoveValue});case"mapping":return r.a.createElement(Dy,{data:t,onChange:n.onChangeValue,onRemove:n.onRemoveValue});case"senders":return r.a.createElement(Uy,{data:t,onChange:n.onChangeValue,onRemove:n.onRemoveValue});default:return r.a.createElement("p",null,"Not valid Step")}},n.renderStepper=function(){var e=n.state.stepIndex,t=n.getSteps();return r.a.createElement(Mo,{activeIndex:e,steps:t.map(function(e){return e.stepData})})},n.getOkButtonLabel=function(){var e=n.state.stepIndex;return n.getSteps(e).okLabel||"Next"},n.getOkButtonAction=function(){var e=n.state.stepIndex;return n.getSteps(e).okAction||n.onNextStep},n.renderActionButtons=function(){return r.a.createElement("div",{className:"form-actions-controllers"},r.a.createElement("div",{className:"pull-left"},r.a.createElement(v,{hideSave:!0,onClickCancel:n.onCancel})),r.a.createElement("div",{className:"pull-right"},r.a.createElement(v,{cancelLabel:n.getOkButtonLabel(),onClickCancel:n.getOkButtonAction(),saveLabel:"Back",onClickSave:n.onPrevStep,reversed:!0})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e,t=this.props.exportGeneratorName;this.props.dispatch(kl(["file_types","lines.fields","rates.fields"])),this.props.dispatch({type:"CLEAR_EXPORT_GENERATOR"}),t&&this.props.dispatch((e=t,function(t){var n=ci(e,"get");return t(jr()),ei(n).then(function(e){return t({type:"GOT_EXPORT_GENERATOR",generator:e.data[0].data.details}),t(Wr(e))}).catch(function(n){return t(Jr(n,"Error loading export generator ".concat(e)))})}))}},{key:"componentWillUnmount",value:function(e,t){this.props.dispatch({type:"CLEAR_EXPORT_GENERATOR"})}},{key:"render",value:function(){return r.a.createElement("div",{className:"Importer"},r.a.createElement(f.v,{header:this.renderStepper(),className:"mb0"},r.a.createElement(f.j,{horizontal:!0,className:"mb0"},this.renderStepContent())),this.renderActionButtons())}}]),t}(a.Component);Vy.defaultProps={exportGenerator:g.c.Map(),exportGeneratorName:""};var By=Object(l.connect)(function(e,t){return{exportGenerator:e.exportGenerator,exportGeneratorName:t.params.name}})(Vy),qy=n(286),zy=n.n(qy),Hy={Asterisk_CDR:{file_type:"Asterisk_CDR",parser:{type:"separator",separator:"|",structure:[{name:"accountcode"},{name:"src"},{name:"dst"},{name:"dcontext"},{name:"clid"},{name:"channel"},{name:"dstchannel"},{name:"lastapp"},{name:"lastdata"},{name:"start"},{name:"answer"},{name:"end"},{name:"duration"},{name:"billsec"},{name:"disposition"},{name:"amaflags"},{name:"userfield"},{name:"uniqueid"}],custom_keys:["accountcode","src","dst","dcontext","clid","channel","dstchannel","lastapp","lastdata","start","answer","end","duration","billsec","disposition","amaflags","userfield","uniqueid"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"answer",default_volume_type:"field",default_volume_src:["duration"],default_usaget:"call",orphan_files_time:"6 hours"},customer_identification_fields:{call:[{target_key:"sid",clear_regex:"//",src_key:"src"}]},rate_calculators:{retail:{call:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"dst"}]]}},pricing:{call:{}}},UK_Standard_CDR_v3:{file_type:"UK_Standard_CDR_v3",parser:{type:"separator",separator:",",structure:[{name:"call_type"},{name:"call_cause"},{name:"customer_identifier"},{name:"telephone_number_dialled"},{name:"call_date"},{name:"call_time"},{name:"duration"},{name:"bytes_transmitted"},{name:"bytes_received"},{name:"description"},{name:"chargecode"},{name:"time_band"},{name:"salesprice"},{name:"salesprice__pre_bundle_"},{name:"extension"},{name:"ddi"},{name:"grouping_id"},{name:"call_class"},{name:"carrier"},{name:"recording"},{name:"vat"},{name:"country_of_origin"},{name:"network"},{name:"retail_tariff_code"},{name:"remote_network"},{name:"apn"},{name:"diverted_number"},{name:"ring_time"},{name:"recordid"},{name:"currency"},{name:"presentation_number"},{name:"network_access_reference"},{name:"ngcs_access_charge"},{name:"ngcs_service_charge"},{name:"total_bytes_transferred"},{name:"user_id"},{name:"onward_billing_reference"},{name:"contract_name"},{name:"bundle_name"},{name:"bundle_allowance"},{name:"discount_reference"},{name:"routing_code"}],custom_keys:["call_type","call_cause","customer_identifier","telephone_number_dialled","call_date","call_time","duration","bytes_transmitted","bytes_received","description","chargecode","time_band","salesprice","salesprice__pre_bundle_","extension","ddi","grouping_id","call_class","carrier","recording","vat","country_of_origin","network","retail_tariff_code","remote_network","apn","diverted_number","ring_time","recordid","currency","presentation_number","network_access_reference","ngcs_access_charge","ngcs_service_charge","total_bytes_transferred","user_id","onward_billing_reference","contract_name","bundle_name","bundle_allowance","discount_reference","routing_code"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"call_date",usaget_mapping:[{src_field:"call_type",pattern:"/^G$/",usaget:"GPRS_Data",volume_type:"field",volume_src:["duration"]}],orphan_files_time:"6 hours"},customer_identification_fields:{GPRS_Data:[{target_key:"sid",clear_regex:"//",src_key:"customer_identifier"}]},rate_calculators:{retail:{GPRS_Data:[[{type:"match",rate_key:"key",line_key:"apn"}]]}},pricing:{GPRS_Data:{}}},FreeSWITCH_CDR:{file_type:"FreeSWITCH_CDR",parser:{type:"separator",separator:",",structure:[{name:"caller_id_name"},{name:"caller_id_number"},{name:"destination_number"},{name:"context"},{name:"start_stamp"},{name:"answer_stamp"},{name:"end_stamp"},{name:"duration"},{name:"billsec"},{name:"hangup_cause"},{name:"uuid"},{name:"bleg_uuid"},{name:"accountcode"},{name:"read_codec"},{name:"write_codec"}],custom_keys:["caller_id_name","caller_id_number","destination_number","context","start_stamp","answer_stamp","end_stamp","duration","billsec","hangup_cause","uuid","bleg_uuid","accountcode","read_codec","write_codec"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"answer_stamp",default_volume_type:"field",default_volume_src:["billsec"],default_usaget:"call",orphan_files_time:"6 hours"},customer_identification_fields:{call:[{target_key:"sid",clear_regex:"//",src_key:"caller_id_number"}]},rate_calculators:{retail:{call:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"caller_id_number"}]]}},pricing:{call:{}}},Cisco_CDR:{file_type:"Cisco_CDR",parser:{type:"separator",separator:",",structure:[{name:"cdrrecordtype"},{name:"globalcallid_callmanagerid"},{name:"globalcallid_callid"},{name:"origlegcallidentifier"},{name:"datetimeorigination"},{name:"orignodeid"},{name:"origspan"},{name:"origipaddr"},{name:"callingpartynumber"},{name:"callingpartyunicodeloginuserid"},{name:"origcause_location"},{name:"origcause_value"},{name:"origprecedencelevel"},{name:"origmediatransportaddress_ip"},{name:"origmediatransportaddress_port"},{name:"origmediacap_payloadcapability"},{name:"origmediacap_maxframesperpacket"},{name:"origmediacap_g723bitrate"},{name:"origvideocap_codec"},{name:"origvideocap_bandwidth"},{name:"origvideocap_resolution"},{name:"origvideotransportaddress_ip"},{name:"origvideotransportaddress_port"},{name:"origrsvpaudiostat"},{name:"origrsvpvideostat"},{name:"destlegcallidentifier"},{name:"destnodeid"},{name:"destspan"},{name:"destipaddr"},{name:"originalcalledpartynumber"},{name:"finalcalledpartynumber"},{name:"finalcalledpartyunicodeloginuserid"},{name:"destcause_location"},{name:"destcause_value"},{name:"destprecedencelevel"},{name:"destmediatransportaddress_ip"},{name:"destmediatransportaddress_port"},{name:"destmediacap_payloadcapability"},{name:"destmediacap_maxframesperpacket"},{name:"destmediacap_g723bitrate"},{name:"destvideocap_codec"},{name:"destvideocap_bandwidth"},{name:"destvideocap_resolution"},{name:"destvideotransportaddress_ip"},{name:"destvideotransportaddress_port"},{name:"destrsvpaudiostat"},{name:"destrsvpvideostat"},{name:"datetimeconnect"},{name:"datetimedisconnect"},{name:"lastredirectdn"},{name:"pkid"},{name:"originalcalledpartynumberpartition"},{name:"callingpartynumberpartition"},{name:"finalcalledpartynumberpartition"},{name:"lastredirectdnpartition"},{name:"duration"},{name:"origdevicename"},{name:"destdevicename"},{name:"origcallterminationonbehalfof"},{name:"destcallterminationonbehalfof"},{name:"origcalledpartyredirectonbehalfof"},{name:"lastredirectredirectonbehalfof"},{name:"origcalledpartyredirectreason"},{name:"lastredirectredirectreason"},{name:"destconversationid"},{name:"globalcallid_clusterid"},{name:"joinonbehalfof"},{name:"comment"},{name:"authcodedescription"},{name:"authorizationlevel"},{name:"clientmattercode"},{name:"origdtmfmethod"},{name:"destdtmfmethod"},{name:"callsecuredstatus"},{name:"origconversationid"},{name:"origmediacap_bandwidth"},{name:"destmediacap_bandwidth"},{name:"authorizationcodevalue"},{name:"outpulsedcallingpartynumber"},{name:"outpulsedcalledpartynumber"},{name:"origipv4v6addr"},{name:"destipv4v6addr"},{name:"origvideocap_codec_channel2"},{name:"origvideocap_bandwidth_channel2"},{name:"origvideocap_resolution_channel2"},{name:"origvideotransportaddress_ip_channel2"},{name:"origvideotransportaddress_port_channel2"},{name:"origvideochannel_role_channel2"},{name:"destvideocap_codec_channel2"},{name:"destvideocap_bandwidth_channel2"},{name:"destvideocap_resolution_channel2"},{name:"destvideotransportaddress_ip_channel2"},{name:"destvideotransportaddress_port_channel2"},{name:"destvideochannel_role_channel2"},{name:"incomingprotocolid"},{name:"incomingprotocolcallref"},{name:"outgoingprotocolid"},{name:"outgoingprotocolcallref"},{name:"currentroutingreason"},{name:"origroutingreason"},{name:"lastredirectingroutingreason"},{name:"huntpilotdn"},{name:"huntpilotpartition"},{name:"calledpartypatternusage"}],custom_keys:["cdrrecordtype","globalcallid_callmanagerid","globalcallid_callid","origlegcallidentifier","datetimeorigination","orignodeid","origspan","origipaddr","callingpartynumber","callingpartyunicodeloginuserid","origcause_location","origcause_value","origprecedencelevel","origmediatransportaddress_ip","origmediatransportaddress_port","origmediacap_payloadcapability","origmediacap_maxframesperpacket","origmediacap_g723bitrate","origvideocap_codec","origvideocap_bandwidth","origvideocap_resolution","origvideotransportaddress_ip","origvideotransportaddress_port","origrsvpaudiostat","origrsvpvideostat","destlegcallidentifier","destnodeid","destspan","destipaddr","originalcalledpartynumber","finalcalledpartynumber","finalcalledpartyunicodeloginuserid","destcause_location","destcause_value","destprecedencelevel","destmediatransportaddress_ip","destmediatransportaddress_port","destmediacap_payloadcapability","destmediacap_maxframesperpacket","destmediacap_g723bitrate","destvideocap_codec","destvideocap_bandwidth","destvideocap_resolution","destvideotransportaddress_ip","destvideotransportaddress_port","destrsvpaudiostat","destrsvpvideostat","datetimeconnect","datetimedisconnect","lastredirectdn","pkid","originalcalledpartynumberpartition","callingpartynumberpartition","finalcalledpartynumberpartition","lastredirectdnpartition","duration","origdevicename","destdevicename","origcallterminationonbehalfof","destcallterminationonbehalfof","origcalledpartyredirectonbehalfof","lastredirectredirectonbehalfof","origcalledpartyredirectreason","lastredirectredirectreason","destconversationid","globalcallid_clusterid","joinonbehalfof","comment","authcodedescription","authorizationlevel","clientmattercode","origdtmfmethod","destdtmfmethod","callsecuredstatus","origconversationid","origmediacap_bandwidth","destmediacap_bandwidth","authorizationcodevalue","outpulsedcallingpartynumber","outpulsedcalledpartynumber","origipv4v6addr","destipv4v6addr","origvideocap_codec_channel2","origvideocap_bandwidth_channel2","origvideocap_resolution_channel2","origvideotransportaddress_ip_channel2","origvideotransportaddress_port_channel2","origvideochannel_role_channel2","destvideocap_codec_channel2","destvideocap_bandwidth_channel2","destvideocap_resolution_channel2","destvideotransportaddress_ip_channel2","destvideotransportaddress_port_channel2","destvideochannel_role_channel2","incomingprotocolid","incomingprotocolcallref","outgoingprotocolid","outgoingprotocolcallref","currentroutingreason","origroutingreason","lastredirectingroutingreason","huntpilotdn","huntpilotpartition","calledpartypatternusage"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"datetimeconnect",usaget_mapping:[{src_field:"calledpartypatternusage",pattern:"/^NA$/",usaget:"NA",volume_type:"field",volume_src:["duration"]}],orphan_files_time:"6 hours"},customer_identification_fields:{NA:[{target_key:"sid",clear_regex:"//",src_key:"callingpartynumber"}]},rate_calculators:{retail:{NA:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"originalcalledpartynumber"}]]}},pricing:{retail:{}}},Voip_Ms_CDR:{file_type:"Voip_Ms_CDR",parser:{type:"separator",separator:",",structure:[{name:"Date"},{name:"CallerID"},{name:"Originator"},{name:"Destination"},{name:"CallType"},{name:"Duration"},{name:"PricePerMinute"},{name:"FinalCharge"}],csv_has_header:!1,csv_has_footer:!1,custom_keys:["Date","CallerID","Originator","Destination","CallType","Duration","PricePerMinute","FinalCharge"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"Date",usaget_mapping:[{src_field:"CallType",pattern:"/^Inbound*/",usaget:"inbound_call",unit:"seconds",volume_type:"field",volume_src:["Duration"]},{src_field:"CallType",pattern:"/^(?!Inbound).*$/",usaget:"outbound_call",unit:"seconds",volume_type:"field",volume_src:["Duration"]}],date_format:"m/d/Y H:i",orphan_files_time:"6 hours"},customer_identification_fields:{inbound_call:[{target_key:"phone",src_key:"Destination",conditions:[{field:"usaget",regex:"/.*/"}],clear_regex:"//"}],outbound_call:[{target_key:"phone",src_key:"Originator",conditions:[{field:"usaget",regex:"/.*/"}],clear_regex:"/.*<|\\D/"}]},rate_calculators:{retail:{inbound_call:[[{type:"longestPrefix",rate_key:"prefix",line_key:"computed"}]],outbound_call:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"Destination"}]]}},pricing:{inbound_call:{},outbound_call:{}}},Bandwidth_CDR:{file_type:"Bandwidth_CDR",parser:{type:"separator",separator:"|",structure:[{name:"AccountNumber"},{name:"CallStartDateTime"},{name:"CallEndDateTime"},{name:"CallType"},{name:"CallSource"},{name:"CallDestination"},{name:"Duration"},{name:"PerMinRate"},{name:"Amount"},{name:"TierType"},{name:"SourceCountry"},{name:"SourceState"},{name:"SourceLATA"},{name:"SourceRateCenter"},{name:"DestinationCountry"},{name:"DestinationState"},{name:"DestinationLATA"},{name:"DesinationRateCenter"},{name:"CallID"},{name:"BdrID"},{name:"SourceIP"},{name:"DestinationIP"},{name:"RateAttempts"},{name:"LRN"},{name:"LocationID"},{name:"SubAccountID"},{name:"LocationName"},{name:"SubAccountName____"}],csv_has_header:!0,csv_has_footer:!1,custom_keys:["AccountNumber","CallStartDateTime","CallEndDateTime","CallType","CallSource","CallDestination","Duration","PerMinRate","Amount","TierType","SourceCountry","SourceState","SourceLATA","SourceRateCenter","DestinationCountry","DestinationState","DestinationLATA","DesinationRateCenter","CallID","BdrID","SourceIP","DestinationIP","RateAttempts","LRN","LocationID","SubAccountID","LocationName","SubAccountName____"],line_types:{H:"/^none$/",D:"//",T:"/^none$/"}},processor:{type:"Usage",date_field:"CallStartDateTime",usaget_mapping:[{src_field:"CallType",pattern:"WVO",usaget:"inbound_call",unit:"seconds",volume_type:"field",volume_src:["Duration"]},{src_field:"CallType",pattern:"/^(?!WVO).*$/",usaget:"outbound_call",unit:"seconds",volume_type:"field",volume_src:["Duration"]}],date_format:"m/d/Y H:i:s A",orphan_files_time:"6 hours"},customer_identification_fields:{inbound_call:[{target_key:"phone",src_key:"CallDestination",conditions:[{field:"usaget",regex:"/.*/"}],clear_regex:"//"}],outbound_call:[{target_key:"phone",src_key:"CallSource",conditions:[{field:"usaget",regex:"/.*/"}],clear_regex:"//"}]},rate_calculators:{retail:{inbound_call:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"CallSource"}]],outbound_call:[[{type:"longestPrefix",rate_key:"params.prefix",line_key:"CallDestination"}]]}},pricing:{inbound_call:{aprice_field:"Amount"},outbound_call:{aprice_field:"Amount"}}}},Yy=function(e){var t=e.settings,n=e.onSetDelimiterType,a=e.delimiterOptions,i=e.onChangeDelimiter;return r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"delimiter"},"Delimiter")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-addon"},r.a.createElement("input",{type:"radio",name:"delimiter-type",style:{verticalAlign:"middle"},value:"separator",disabled:!t.get("file_type",!1),onChange:n,checked:"separator"===t.get("delimiter_type","")}),r.a.createElement("small",null,"\xa0By delimiter")),r.a.createElement(Tn,{fieldType:"select",className:"delimiter-select",allowCreate:!0,disabled:!t.get("file_type","")||"separator"!==t.get("delimiter_type",""),onChange:function(e){i({target:{value:e}})},options:a,value:t.get("delimiter",""),placeholder:"Select or type...",addLabelText:"{label}"}))),r.a.createElement("div",{className:"col-lg-3",style:{marginTop:10}},r.a.createElement("input",{type:"radio",name:"delimiter-type",style:{verticalAlign:"middle"},value:"fixed",disabled:!t.get("file_type",!1),onChange:n,checked:"fixed"===t.get("delimiter_type","")}),r.a.createElement("label",{htmlFor:"delimiter-type"},"\xa0Fixed width"))))};Yy.defaultProps={settings:Object(g.b)(),delimiterOptions:[{value:"\t",label:"Tab"},{value:" ",label:"Space"},{value:",",label:"Comma"}]};var Gy=Yy,Ky=Object(Nn.a)(function(e){return e.inputProcessor.get("fields",g.c.List())},function(e){return e.inputProcessor.get("unfiltered_fields",g.c.List())},function(e,t){return e.size===t.size}),Wy=Object(Nn.a)(function(e,t){return t.settings.getIn(["customer_identification_fields",t.usaget],g.c.List())},_a,function(e,t){return e.map(function(e){return t.find(function(t){return t.get("field_name","")===e.get("target_key","")},null,g.c.Map()).get("plays",g.c.List())}).reduce(function(e,t){return e.union(t)},g.c.Set())}),Jy=Object(l.connect)()(function(e){var t=e.settings,n=e.onSelectSampleCSV;return r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"sample_csv"},"Select Sample CSV"),r.a.createElement("p",{className:"help-block"},"Notice: Spaces will be convereted to underscores")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("input",{type:"file",id:"sample_csv",accept:".csv",onClick:function(e){e.target.value=null},onChange:n,disabled:!t.get("file_type")||!t.get("delimiter_type")||"separator"!==t.get("delimiter_type")||""===t.get("delimiter")}))))}),$y=Object(l.connect)()(function(e){return r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"sample_csv"},"Select Sample JSON")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("input",{type:"file",id:"sample_csv",onChange:e.onSelectJSON,disabled:!e.settings.get("file_type")}))))}),Qy=function(e){var t=e.index,n=e.field,a=e.fixed,i=e.width,o=e.allowMoveUp,l=e.allowMoveDown,s=e.onCheckedField,c=e.isChecked,u=e.errorMessages.name.allowedCharacters,p=ee("keyRegex","").test(n)?"":u,d=r.a.createElement(f.C,{id:"tooltip"},"Only checked fields will be available in next stages");return r.a.createElement(f.g,{lg:12,md:12},r.a.createElement(f.l,{className:"mb0",validationState:p.length>0?"error":null},r.a.createElement(f.g,{lg:4,md:4},r.a.createElement(f.o,null,r.a.createElement(f.t,{placement:"top",overlay:d},r.a.createElement(f.o.Addon,null,r.a.createElement("input",{type:"checkbox",checked:c,"aria-label":t,onChange:function(e){var a=e.target.checked;s(t,a,n)}}))),r.a.createElement(f.k,{type:"text",onChange:function(n){var a=n.target.value;e.onChange(t,a)},value:n}))),r.a.createElement(f.g,{lg:1,md:1},a&&r.a.createElement("input",{type:"number",className:"form-control","data-field":t,disabled:!a,min:"0",onChange:e.onSetFieldWidth,value:i})),r.a.createElement(f.g,{lg:5,md:5},r.a.createElement(f.c,{bsSize:"small",disabled:!o,onClick:function(){e.onMoveFieldUp(t)}},r.a.createElement("i",{className:"fa fa-arrow-up"})," Move up"),r.a.createElement(f.c,{bsSize:"small",className:"ml10",disabled:!l,onClick:function(){e.onMoveFieldDown(t)}},r.a.createElement("i",{className:"fa fa-arrow-down"})," Move down"),r.a.createElement(f.c,{bsSize:"small",className:"ml10",onClick:function(){e.onRemoveField(t,n)}},r.a.createElement("i",{className:"fa fa-trash-o danger-red"})," Remove")),p.length>0&&r.a.createElement(f.g,{lg:10,md:10},r.a.createElement(f.n,null,p))))};Qy.defaultProps={field:"",index:0,fixed:!1,allowMoveUp:!0,allowMoveDown:!0,width:"",isChecked:!0,errorMessages:{name:{allowedCharacters:"Field name contains illegal characters, name should contain only alphabets, numbers and underscores (A-Z, a-z, 0-9, _)"}},onChange:function(){},onRemoveField:function(){},onMoveFieldUp:function(){},onSetFieldWidth:function(){},onMoveFieldDown:function(){},onCheckedField:function(){}};var Zy=Object(l.connect)()(Qy),Xy=function(e){var t=e.settings,n="fixed"===t.get("delimiter_type",""),a=t.get("unfiltered_fields",g.c.List()).map(function(a,i){return r.a.createElement("div",{key:i},r.a.createElement("div",{className:"form-group"},r.a.createElement(Zy,{index:i,onRemoveField:e.onRemoveField,field:a.get("name",""),onSetFieldWidth:e.onSetFieldWidth,fixed:n,isChecked:a.get("checked",!0),allowMoveUp:0!==i,allowMoveDown:i!==t.get("unfiltered_fields",g.c.List()).size-1,onMoveFieldDown:e.onMoveFieldDown,onMoveFieldUp:e.onMoveFieldUp,onChange:e.onChangeCSVField,width:t.getIn(["field_widths",i],""),onCheckedField:e.onCheckedField})),r.a.createElement("div",{className:"separator"}))});return r.a.createElement("div",null,a)};Xy.defaultProps={settings:g.c.Map(),onRemoveField:function(){},onSetFieldWidth:function(){},onMoveFieldUp:function(){},onMoveFieldDown:function(){},onChangeCSVField:function(){},onCheckedField:function(){}};var eb=Object(l.connect)()(Xy),tb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).initDefaultValues=function(){var e=n.props,t=e.type,a=e.settings;"api"!==t&&(null===a.get("csv_has_footer",null)&&n.props.onChangeInputProcessorField(["csv_has_footer"],!1),null===a.get("csv_has_header",null)&&n.props.onChangeInputProcessorField(["csv_has_header"],!1))},n.removeAllFields=function(){window.confirm("Are you sure you want to remove all fields?")&&n.props.onRemoveAllFields.call(Object(Po.a)(n))},n.toggleCheckAllFields=function(e){var t=e.target.checked,a=n.props.allChecked,r={message:"Are you sure you want to ".concat(a?"uncheck":"check"," all fields?"),onOk:function(){return n.props.checkAllFields(t)},type:"confirm"};n.props.dispatch(ks(r))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initDefaultValues()}},{key:"render",value:function(){var e=this,t=this.props,n=t.settings,a=t.type,i=t.action,o=t.errors,l=t.onChangeName,s=t.onSetDelimiterType,c=t.onChangeDelimiter,u=t.onSelectSampleCSV,p=t.onSelectJSON,d=t.onSetFieldWidth,m=t.onRemoveField,g=t.onMoveFieldUp,h=t.onMoveFieldDown,v=t.onChangeCSVField,y=t.onAddField,b=t.onCheckedField,E=t.allChecked,C=r.a.createElement(eb,{onMoveFieldUp:g,onMoveFieldDown:h,onChangeCSVField:v,onRemoveField:m,settings:n,onSetFieldWidth:d,onCheckedField:b}),_=E?"Uncheck All":"Check All",O=r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},"CDR Fields"),r.a.createElement("div",{className:"panel-body"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("label",null,"\xa0\xa0Field name - Only checked fields will be saved in the system"))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("label",{title:_,className:"btn btn-default btn-sm",style:{borderRadius:3,backgroundColor:"#eeeeee"}},r.a.createElement("input",{type:"checkbox",disabled:n.get("unfiltered_fields",[]).size<1,className:"btn btn-default btn-xs",onChange:this.toggleCheckAllFields,checked:"Uncheck All"===_}))),"fixed"===n.get("delimiter_type")&&r.a.createElement("div",{className:"col-lg-2",style:{marginLeft:35}},r.a.createElement("label",null,"Width")),r.a.createElement("div",{className:"col-lg-3",style:{marginLeft:30}},r.a.createElement("button",{type:"button",disabled:n.get("unfiltered_fields",[]).size<1,className:"btn btn-default btn-sm",onClick:this.removeAllFields},r.a.createElement("i",{className:"fa fa-trash-o danger-red"})," Remove All"))),C,r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-2"},r.a.createElement(ct,{onClick:y,label:"Add Field"}))))),S="api"===a?r.a.createElement("div",null,r.a.createElement($y,{onSelectJSON:p,settings:n})):r.a.createElement("div",null,r.a.createElement(Jy,{onSelectSampleCSV:u,settings:n}));return r.a.createElement("form",{className:"InputProcessor form-horizontal"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"file_type"},"Name")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1 mt10"},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-7".concat(o.get("name","").length>0?" has-error":"")},r.a.createElement(Tn,{id:"file_type",onChange:l,value:n.get("file_type",""),disabled:"new"!==i}),o.get("name","").length>0&&r.a.createElement(f.n,null,o.get("name",""))))),"api"!==a&&r.a.createElement(Gy,{settings:n,onSetDelimiterType:s,onChangeDelimiter:c}),"api"!==a&&r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"file_type"},"Skip CSV header?")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1 mt10"},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-7 mt10"},r.a.createElement(Tn,{id:"csvHeader",value:n.get("csv_has_header",!1),onChange:function(t){var n=t.target.value;e.props.onChangeInputProcessorField(["csv_has_header"],n)},fieldType:"checkbox"})))),"api"!==a&&r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"file_type"},"Skip CSV footer?")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1 mt10"},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-7 mt10"},r.a.createElement(Tn,{id:"csvFooter",value:n.get("csv_has_footer",!1),onChange:function(t){var n=t.target.value;e.props.onChangeInputProcessorField(["csv_has_footer"],n)},fieldType:"checkbox"})))),S,O)}}]),t}(a.Component);tb.defaultProps={type:"",errors:g.c.Map(),allChecked:!1};var nb=Object(l.connect)(function(e,t){return{allChecked:Ky(e,t)}})(tb),ab=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChangeStaticUom=function(e){var t={target:{id:"default_unit",value:e}};n.props.onSetFieldMapping(t)},n.onChangeStaticUsagetVolumeType=function(e){var t={target:{id:"default_volume_type",value:e.target.value}};n.onChangeStaticUsagetVolumeField(""),n.props.onSetFieldMapping(t)},n.onChangeStaticUsagetHardCodedVolume=function(e){n.props.onSetFieldMapping(e)},n.onChangeStaticUsagetVolumeField=function(e){var t={target:{id:"default_volume_src",value:e.length?e.split(","):[]}};n.props.onSetFieldMapping(t)},n.onChangeUom=function(e){n.setState({unit:e})},n.onChangeFieldName=function(e,t){var a=n.state.conditions,r=t.target.value;a[e].src_field=r,n.setState({fieldName:r,conditions:a})},n.onChangeOperator=function(e,t,a){var r,i=n.state.conditions,o=a.target.value;t.forEach(function(e){e.value===o&&(r=e.label)}),i[e].op=o,i[e].op_label=r,n.setState({op:o,conditions:i,pattern:""})},n.onChangeSeparateTime=function(e){e.target.checked||(n.props.unsetField(["processor","time_field"]),n.onChangeTimeFormatExists()),n.setState({separateTime:!n.state.separateTime})},n.onChangeSeparateTimeZone=function(e){e.target.checked||(n.props.unsetField(["processor","timezone_field"]),n.onChangeTimeZoneExists()),n.setState({separateTimeZone:!n.state.separateTimeZone})},n.onChangeDynamicUsagetVolumeType=function(e){var t=e.target.value;n.setState({volumeType:t,volumeHardCodedValue:"",volumeFields:[]})},n.onChangeDynamicUsagetHardCodedVolume=function(e){var t=e.target.value;n.setState({volumeHardCodedValue:t})},n.onChangeDynamicUsagetVolumeField=function(e){var t=e.length?e.split(","):[];n.setState({volumeFields:t})},n.onChangeDateFormat=function(e){n.props.onSetFieldMapping(e)},n.onChangeDateFormatExists=function(){var e={target:{value:void 0,id:"date_format"}};n.onChangeDateFormat(e)},n.onChangeTimeFormat=function(e){n.props.onSetFieldMapping(e)},n.onChangeTimeZoneFormat=function(e){n.props.onSetFieldMapping(e)},n.onChangeTimeFormatExists=function(){var e={target:{value:void 0,id:"time_format"}};n.onChangeTimeFormat(e)},n.onChangeTimeZoneExists=function(){var e={target:{value:void 0,id:"timezone_field"}};n.onChangeTimeZoneFormat(e)},n.getVolumeOptions=function(){return n.props.settings.get("fields",g.c.List()).sortBy(function(e){return e}).map(function(e){return{label:e,value:e}}).toArray()},n.onRemoveCondition=function(e){var t=n.state.conditions;t.splice(e,1),n.setState({conditions:t})},n.onChangeMultiValues=function(e,t){Array.isArray(t)?n.onChangeTagValue(e,t.join(",")):n.onChangeTagValue(e,"")},n.onChangeTagValue=function(e,t){var a=n.state.conditions;a[e].pattern=t,n.setState({pattern:t,conditions:a})},n.onChangePattern=n.onChangePattern.bind(Object(Po.a)(n)),n.onChangeUsaget=n.onChangeUsaget.bind(Object(Po.a)(n)),n.addUsagetMapping=n.addUsagetMapping.bind(Object(Po.a)(n)),n.onChangeUsaget=n.onChangeUsaget.bind(Object(Po.a)(n)),n.onSetType=n.onSetType.bind(Object(Po.a)(n)),n.onChangeStaticUsaget=n.onChangeStaticUsaget.bind(Object(Po.a)(n)),n.addFieldCondition=n.addFieldCondition.bind(Object(Po.a)(n)),n.onChangeFieldName=n.onChangeFieldName.bind(Object(Po.a)(n)),n.onRemoveCondition=n.onRemoveCondition.bind(Object(Po.a)(n)),n.onChangeOperator=n.onChangeOperator.bind(Object(Po.a)(n)),n.onChangeMultiValues=n.onChangeMultiValues.bind(Object(Po.a)(n)),n.state={fieldName:"",op:"",opLabel:"",pattern:"",usaget:"",unit:"",separateTime:!1,separateTimeZone:!1,volumeType:"field",volumeFields:[],volumeHardCodedValue:"",conditions:[]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.settings.getIn(["processor","time_field"])&&this.setState({separateTime:!0});var e=this.props.settings.getIn(["processor","timezone_field"]);this.props.settings.get("fields").includes(e)&&this.setState({separateTimeZone:!0})}},{key:"onChangePattern",value:function(e,t){var n=this.state.conditions,a=t.target.value;n[e].pattern=a,this.setState({pattern:a,conditions:n})}},{key:"changeUsaget",value:function(e,t){this.setState({usaget:e}),t&&this.props.onSetStaticUsaget(e)}},{key:"onChangeUsaget",value:function(e){this.changeUsaget(e,!1)}},{key:"onChangeStaticUsaget",value:function(e){this.changeUsaget(e,!0)}},{key:"addUsagetMapping",value:function(e){var t=this.state,n=t.usaget,a=t.pattern,r=t.unit,i=t.volumeType,o=t.volumeFields,l=t.volumeHardCodedValue,s=t.fieldName,c=t.op,u=t.conditions,p="field"===i?o:l,d=this.props.onError;if(s)if(n&&a&&r&&i&&p&&c){0===u.length&&u.push({src_field:s,pattern:a,op:c});var m={usaget:n,pattern:a,unit:r,volumeType:i,volumeSrc:p,fieldName:s,op:c,conditions:u};this.props.onAddUsagetMapping.call(this,m),this.setState({pattern:"",usaget:"",unit:"",volumeType:"field",volumeFields:[],volumeHardCodedValue:"",fieldName:"",conditions:[],op:""})}else d("Please input a value, usage type, unit and volume field/value");else d("Please select usage type field")}},{key:"addFieldCondition",value:function(e){var t=this.state,n=t.fieldName,a=t.pattern,r=t.conditions,i=t.op,o=this.props.onError;a&&n&&i?(r.push({src_field:"",pattern:"",op:""}),this.setState({conditions:r})):o("Please input a field name, operator and a value")}},{key:"removeUsagetMapping",value:function(e,t){this.props.onRemoveUsagetMapping.call(this,e)}},{key:"onSetType",value:function(e){var t=e.target.value;this.props.setUsagetType(t)}},{key:"render",value:function(){var e=this,t=this.state,n=t.separateTime,a=t.separateTimeZone,i=t.usaget,o=t.unit,l=t.volumeType,s=t.volumeFields,c=t.volumeHardCodedValue,u=t.conditions,p=t.fieldName,d=t.pattern,m=t.op,h=this.props,v=h.settings,y=h.usageTypesData,b=h.propertyTypes,E=h.onSetFieldMapping,C=[r.a.createElement("option",{disabled:!0,value:"",key:-1},"Select Field...")].concat(Object(N.a)(v.get("fields",g.c.List()).sortBy(function(e){return e}).map(function(e,t){return r.a.createElement("option",{value:e,key:t},e)}))),_="static"!==v.get("usaget_type","")?"":v.getIn(["processor","default_usaget"],""),O="static"!==v.get("usaget_type","")?"":v.getIn(["processor","default_unit"],""),S="static"!==v.get("usaget_type","")?"":v.getIn(["processor","default_volume_type"],"field"),T="static"!==v.get("usaget_type","")?"":v.getIn(["processor","default_volume_src"],[]),k=this.getVolumeOptions(),j=[{value:"$eq",label:"Equals"},{value:"$ne",label:"Not Equals"},{value:"$in",label:"In"},{value:"$nin",label:"Not In"},{value:"$regex",label:"Regex"}],I=[r.a.createElement("option",{disabled:!0,value:"",key:-1},"Select Field...")].concat(Object(N.a)(j.map(function(e,t){return r.a.createElement("option",{value:e.value,key:t},e.label)}))),w=v.getIn(["processor","date_format"])||"",F={fieldType:"text",id:"date_format",onChange:this.onChangeDateFormat},x=v.getIn(["processor","time_format"])||"",R={fieldType:"text",id:"time_format",onChange:this.onChangeTimeFormat};return 0===u.length&&u.push({src_field:p,pattern:d,op:m}),r.a.createElement("form",{className:"form-horizontal FieldsMapping"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"date_field"},"Date Time"),r.a.createElement("p",{className:"help-block"},"Date and time of record creation",r.a.createElement("br",null),r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"http://php.net/manual/en/function.date.php#refsect1-function.date-parameters"},"Formatting info"))),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-4 form-inner-edit-row"},r.a.createElement("select",{id:"date_field",className:"form-control",onChange:E,value:v.getIn(["processor","date_field"],"")},C)),r.a.createElement("div",{className:"col-lg-5 form-inner-edit-row"},r.a.createElement(Tn,{fieldType:"toggeledInput",value:w,disabledValue:"",disabled:null===w||void 0===w,onChange:this.onChangeDateFormatExists,label:!0===this.state.separateTime?"Date format":"Date and time format",inputProps:F})),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement(Ao,{contents:"Check to force a custom format. If not checked, default format is mm/dd/yy"}))),r.a.createElement("div",{className:"col-lg-offset-3 col-lg-9"},r.a.createElement("div",{className:"col-lg-offset-1 col-lg-4"},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-addon"},r.a.createElement("input",{type:"checkbox",checked:n,onChange:this.onChangeSeparateTime}),r.a.createElement("small",{style:{verticalAlign:"bottom"}},"\xa0Time in a separate field")),r.a.createElement("select",{id:"time_field",className:"form-control",onChange:E,disabled:!n,value:v.getIn(["processor","time_field"],"")},C))),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement(Tn,{fieldType:"toggeledInput",value:x,disabledValue:"",disabled:!this.state.separateTime||""===w,onChange:this.onChangeTimeFormatExists,label:"Time format",inputProps:R})),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement(Ao,{contents:"To enable, enter date format. For formatting info please check the link on the left"}))),r.a.createElement("div",{className:"col-lg-offset-3 col-lg-9",style:{marginTop:30}},r.a.createElement("div",{className:"col-lg-offset-1 col-lg-4"},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-addon"},r.a.createElement("input",{type:"checkbox",checked:a,onChange:this.onChangeSeparateTimeZone}),r.a.createElement("small",null,"\xa0Timezone in a separate field")),r.a.createElement("select",{id:"timezone_field",className:"form-control",onChange:E,disabled:!a,value:v.getIn(["processor","timezone_field"],"")},C))))),r.a.createElement("div",{className:"separator"}),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",null,"Usage types / volumes")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-4 form-inner-edit-row",style:{marginTop:8}},r.a.createElement("label",{htmlFor:"static"},r.a.createElement("input",{type:"radio",style:{verticalAlign:"top"},name:"usage_types_type",value:"static",checked:"static"===v.get("usaget_type",""),onChange:this.onSetType}),"\xa0Static")),r.a.createElement("div",{className:"col-lg-4 form-inner-edit-row",style:{marginTop:8}},r.a.createElement("label",{htmlFor:"dynamic"},r.a.createElement("input",{type:"radio",style:{verticalAlign:"top"},name:"usage_types_type",value:"dynamic",checked:"dynamic"===v.get("usaget_type",""),onChange:this.onSetType}),"\xa0Dynamic"))),"static"===v.get("usaget_type","")&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.y,{className:"form-inner-edit-row"},r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("strong",null,"Usage Type")),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("strong",null,"Unit"))),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("strong",null,"Volume field / value"))),r.a.createElement(f.y,null,r.a.createElement("div",{className:"col-lg-7"},r.a.createElement(Dp,{usaget:_,unit:O,onChangeUsaget:this.onChangeStaticUsaget,onChangeUnit:this.onChangeStaticUom,enabled:"static"===v.get("usaget_type",""),showDisplayUnits:!0})),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement(Tn,{fieldType:"radio",name:"static-usaget-volume-type",id:"static-usaget-volume-type-field",value:"field",checked:"field"===S,onChange:this.onChangeStaticUsagetVolumeType,label:"By field"}),r.a.createElement(Tn,{fieldType:"radio",name:"static-usaget-volume-type",id:"static-usaget-volume-type-value",value:"value",checked:"value"===S,onChange:this.onChangeStaticUsagetVolumeType,label:"By value"})),r.a.createElement("div",{className:"col-lg-3"},"field"===S?r.a.createElement(Tn,{fieldType:"select",multi:!0,value:T.join(","),options:k,onChange:this.onChangeStaticUsagetVolumeField}):r.a.createElement(Tn,{fieldType:"number",id:"default_volume_src",value:T,onChange:this.onChangeStaticUsagetHardCodedVolume})))),"dynamic"===v.get("usaget_type","")&&r.a.createElement("div",{className:"col-lg-12 form-inner-edit-row"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("strong",null,"Field Name")),r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("strong",null,"Op")),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("strong",null,"Input Value"))),r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("div",{className:"col-lg-6 pl0 pr0"},r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("strong",null,"Usage Type")),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("strong",null,"Unit"))),r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("strong",null,"Volume field / value")))),v.getIn(["processor","usaget_mapping"],g.c.List()).map(function(t,n){return r.a.createElement("div",{className:"form-group",key:n,style:{marginRight:60}},r.a.createElement("div",{className:"col-lg-6"},v.getIn(["processor","usaget_mapping",n,"conditions"],g.c.List()).map(function(e,t){return r.a.createElement("div",{className:"row-lg-12",key:"condition-".concat(t)},r.a.createElement("div",{className:"col-lg-4",style:{marginLeft:-4}},e.get("src_field")),r.a.createElement("div",{className:"col-lg-4",style:{marginLeft:18}},e.get("op_label")),r.a.createElement("div",{className:"col-lg-4",style:{marginLeft:-75}},e.get("pattern")))})),r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("div",{className:"col-lg-6 pl0 pr0"},r.a.createElement("div",{className:"col-lg-7",style:{marginLeft:-92}},t.get("usaget","")),r.a.createElement("div",{className:"col-lg-5",style:{marginLeft:50}}," ",je(b,y,t.get("usaget",""),t.get("unit","")))),r.a.createElement("div",{className:"col-lg-3",style:{marginLeft:-8}},"field"===t.get("volume_type","field")?t.get("volume_src",[]).join(", "):t.get("volume_src","")),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement("button",{type:"button",className:"btn btn-default btn-sm",disabled:"dynamic"!==v.get("usaget_type",""),onClick:e.removeUsagetMapping.bind(e,n)},r.a.createElement("i",{className:"fa fa-trash-o danger-red"})," Remove"))),r.a.createElement("div",{className:"col-lg-offset-1 col-lg-10",style:{padding:16}},r.a.createElement("div",{className:"separator"})))}),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-5"},u.map(function(t,n){return r.a.createElement("div",{className:"row-lg-12 form-inner-edit-row row",key:n},r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("select",{id:"src_field",className:"form-control",onChange:e.onChangeFieldName.bind(e,n),value:""===t.src_field?"":t.src_field,disabled:"dynamic"!==v.get("usaget_type","")},C)),r.a.createElement("div",{className:"col-lg-2"},r.a.createElement("select",{id:"op",className:"form-control",onChange:e.onChangeOperator.bind(e,n,j),value:""===t.op?"":t.op,disabled:"dynamic"!==v.get("usaget_type","")},I)),r.a.createElement("div",{className:"col-lg-4"},"$in"!==t.op&&"$nin"!==t.op&&r.a.createElement("input",{className:"form-control",onChange:e.onChangePattern.bind(e,n),disabled:"dynamic"!==v.get("usaget_type",""),value:""===t.pattern?"":t.pattern}),("$in"===t.op||"$nin"===t.op)&&r.a.createElement(Tn,{fieldType:"tags",id:"cond-value-".concat(n),onChange:e.onChangeMultiValues.bind(e,n),value:t.pattern.split(",").filter(function(e){return""!==e})})),r.a.createElement("div",{className:"col-lg-1"},u.length>1&&r.a.createElement("button",{type:"button",className:"btn btn-link","data-dismiss":"alert","aria-label":"Close",onClick:e.onRemoveCondition.bind(e,n)},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))})),r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("div",{className:"col-lg-5"},r.a.createElement(Dp,{usaget:i,unit:o,onChangeUsaget:this.onChangeUsaget,onChangeUnit:this.onChangeUom,enabled:"dynamic"===v.get("usaget_type",""),showDisplayUnits:!0})),r.a.createElement("div",{className:"col-lg-2"},r.a.createElement(Tn,{fieldType:"radio",name:"dynamic-usaget-volume-type",id:"dynamic-usaget-volume-type-field",value:"field",checked:"field"===l,onChange:this.onChangeDynamicUsagetVolumeType,label:"By field"}),r.a.createElement(Tn,{fieldType:"radio",name:"dynamic-usaget-volume-type",id:"dynamic-usaget-volume-type-value",value:"value",checked:"value"===l,onChange:this.onChangeDynamicUsagetVolumeType,label:"By value"})),r.a.createElement("div",{className:"col-lg-3"},"field"===l?r.a.createElement(Tn,{fieldType:"select",multi:!0,value:s.join(","),options:k,onChange:this.onChangeDynamicUsagetVolumeField}):r.a.createElement(Tn,{fieldType:"number",value:c,onChange:this.onChangeDynamicUsagetHardCodedVolume})))),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement("button",{type:"button",className:"btn btn-primary btn-sm",onClick:this.addFieldCondition},r.a.createElement("i",{className:"fa fa-plus"})," Add Condition"))),"dynamic"===v.get("usaget_type","")&&r.a.createElement("div",{className:"form-group",style:{marginRight:60}},r.a.createElement("div",{className:"col-lg-offset-1 col-lg-10",style:{padding:16}},r.a.createElement("div",{className:"separator"}))),"dynamic"===v.get("usaget_type","")&&r.a.createElement("div",{className:"col-lg-offset-10 col-lg-1",style:{marginLeft:600}},r.a.createElement("button",{type:"button",className:"btn btn-primary btn-sm",onClick:this.addUsagetMapping},r.a.createElement("i",{className:"fa fa-plus"})," Add Mapping"))))}}]),t}(a.Component);ab.defaultProps={settings:g.c.Map(),usageTypes:g.c.List(),usageTypesData:g.c.List(),propertyTypes:g.c.List(),onSetStaticUsaget:function(){},onSetFieldMapping:function(){}};var rb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSetCustomerMapping=function(e){var t=n.props,a=t.usaget,r=t.priority,i=e.target,o=i.value,l=i.id;n.props.onSetCustomerMapping(l,o,a,r)},n.onSetCustomerMappingTarget=function(e){var t=e.target,a=t.value,r=t.id,i=n.props.subscriberFields,o={target:{id:r,value:a}};if(i.find(function(e){return e.get("field_name","")===a},null,g.c.Map()).get("unique",!1))return n.onSetCustomerMapping(o);var l={message:"You selected a non-unique field for subscriber matching. Continue?",onOk:function(){n.onSetCustomerMapping(o)},type:"delete",labelOk:"Continue"};return n.props.dispatch(ks(l))},n.onChangeClearRegex=function(e){var t=n.props,a=t.usaget,r=t.priority;n.props.onSetCustomerMapping("clear_regex",e,a,r)},n.getCustomerIdentificationFields=function(){return Ve(n.props.settings).map(function(e,t){return r.a.createElement("option",{value:e.get("value",""),key:t},e.get("label",""))}).toArray()},n.getAvailableTargetFields=function(){var e=n.props.subscriberFields.sort(function(e){return e.get("unique",!1)?-1:1}).map(function(e,t){var n=e.get("field_name",""),a=te(n,"customerIdentification",e.get("title","")),i=k()({"label-text":e.get("unique",!1),disabled:!e.get("unique",!1)});return r.a.createElement("option",{value:n,key:"target-field-".concat(t),className:i},a)});return[r.a.createElement("option",{disabled:!0,value:"-1",key:"target-field-empty"},"Select...")].concat(Object(N.a)(e.toArray()))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.mapping,t=e.getIn(["target_key"],"sid"),n=e.getIn(["src_key"],""),a=e.getIn(["clear_regex"],""),i=this.getCustomerIdentificationFields(),o=this.getAvailableTargetFields();return r.a.createElement("div",null,r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("select",{id:"src_key",className:"form-control",onChange:this.onSetCustomerMapping,value:n},i)),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement(Tn,{value:a,id:"clear_regex",disabledValue:"//",onChange:this.onChangeClearRegex,label:"Regex",fieldType:"toggeledInput"})),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("select",{id:"target_key",className:"form-control",onChange:this.onSetCustomerMappingTarget,value:t},o)))}}]),t}(a.Component);rb.defaultProps={settings:g.c.Map(),subscriberFields:g.c.List()};var ib=Object(l.connect)(null)(rb),ob=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onAddCustomerMapping=function(e){return function(){n.props.dispatch(function(e){return{type:Pv,usaget:e}}(e))}},n.onRemoveCustomerMapping=function(e,t){return function(){n.props.dispatch(function(e,t){return{type:Av,usaget:e,priority:t}}(e,t))}},n.renderAddCustomerMappingButton=function(e){return r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onAddCustomerMapping(e)},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add")},n.renderRemoveCustomerMappingButton=function(e,t){return r.a.createElement(f.c,{bsStyle:"link",bsSize:"xsmall",onClick:n.onRemoveCustomerMapping(e,t)},r.a.createElement("i",{className:"fa fa-fw fa-trash-o danger-red"}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.settings,a=t.subscriberFields,i=n.get("customer_identification_fields",g.c.Map());return r.a.createElement(f.j,{horizontal:!0,className:"customerMappings"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("h4",null,"Customer identification",r.a.createElement("small",null," | Map customer identification field in record to BillRun field")))),i.map(function(t,i){return r.a.createElement("div",{key:"customer-mapping-".concat(i)},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:i},i)),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),t.map(function(t,o){var l=k()("form-inner-edit-row","col-lg-9",{"col-lg-offset-1":o>0});return r.a.createElement("div",{className:l,key:"customer-mapping-".concat(i,"-").concat(o)},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-11"},r.a.createElement(ib,{usaget:i,mapping:t,priority:o,onSetCustomerMapping:e.props.onSetCustomerMapping,subscriberFields:a,settings:n})),r.a.createElement("div",{className:"col-lg-1"},o>0&&e.renderRemoveCustomerMappingButton(i,o))))}).toList().toArray(),r.a.createElement("div",{className:"col-lg-9 col-lg-offset-1"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-11"},r.a.createElement("div",{className:"col-lg-4"},e.renderAddCustomerMappingButton(i))))))))}).toList().toArray())}}]),t}(a.Component);ob.defaultProps={settings:g.c.Map(),subscriberFields:g.c.List()};var lb=Object(l.connect)()(ob),sb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getConditionResultProjectOptions=function(){return["condition_result","hard_coded"].map(fe)},n.getRateConditions=function(){return ee(["rates","conditions"],g.c.List()).map(he).toArray()},n.onChangeComputedLineKeyHardCodedKey=function(e){var t=e.target.value;n.props.onChangeComputedLineKey(["line_keys",1,"key"])(t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(kl(["lines"]))}},{key:"render",value:function(){var e=this.props,t=e.computedLineKey,n=e.computedlineKeyOptions;if(!t)return null;var a="In case you want to run a regular expression on the computed field before calculating the rate",i="regex"===t.get("type","regex"),o="$exists"===t.get("operator","")||"$existsFalse"===t.get("operator",""),l=Za().find(function(e){return e.get("preFunction")===t.getIn(["line_keys",0,"preFunction"],"")&&e.get("preFunctionValue")===t.getIn(["line_keys",0,"key"],"")},null,!1),s=!1===l?t.getIn(["line_keys",0,"key"],""):l.get("value",t.getIn(["line_keys",0,"preFunction"],"")),c=this.getConditionResultProjectOptions().concat(n);return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:2},"Computation Type"),r.a.createElement(f.g,{sm:10},r.a.createElement("span",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(Tn,{fieldType:"radio",name:"computed-type",id:"computed-type-regex",value:"regex",checked:i,onChange:this.props.onChangeComputedLineKeyType,label:"Regex"})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(Tn,{fieldType:"radio",name:"computed-type",id:"computed-type-condition",value:"condition",checked:!i,onChange:this.props.onChangeComputedLineKeyType,label:"Condition"}))))),r.a.createElement("div",{className:"separator"}),r.a.createElement(f.l,{key:"computed-field-1"},r.a.createElement(f.g,{sm:2,componentClass:f.h},i?"Field":"First Field"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:this.props.onChangeComputedLineKey(["line_keys",0,"key"]),value:s,options:n,allowCreate:!0})),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:t.getIn(["line_keys",0,"regex"],""),disabledValue:"",onChange:this.props.onChangeComputedLineKey(["line_keys",0,"regex"]),disabled:""===t.getIn(["line_keys",0,"key"],"")||o||!1!==l,label:r.a.createElement("span",null,"Regex",r.a.createElement(Ao,{contents:a})),fieldType:"toggeledInput"}))),!i&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.l,{key:"computed-operator"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Operator"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:this.props.onChangeComputedLineKey(["operator"]),value:t.get("operator",""),options:this.getRateConditions()}))),r.a.createElement(f.l,{key:"computed-field-2"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Second Field"),r.a.createElement(f.g,{sm:5},"$regex"===t.get("operator","")&&r.a.createElement(Tn,{value:t.getIn(["line_keys",1,"key"],""),onChange:this.onChangeComputedLineKeyHardCodedKey}),"$regex"!==t.get("operator","")&&r.a.createElement(Tn,{fieldType:"select",onChange:this.props.onChangeComputedLineKey(["line_keys",1,"key"]),value:t.getIn(["line_keys",1,"key"],""),options:n,disabled:o})),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:t.getIn(["line_keys",1,"regex"],""),disabledValue:"",onChange:this.props.onChangeComputedLineKey(["line_keys",1,"regex"]),disabled:""===t.getIn(["line_keys",1,"key"],"")||"$regex"===t.get("operator",""),label:r.a.createElement("span",null,"Regex",r.a.createElement(Ao,{contents:a})),fieldType:"toggeledInput"}))),r.a.createElement(f.l,{key:"computed-must-met"},r.a.createElement(f.g,{componentClass:f.h,sm:2},"Must met?",r.a.createElement(Ao,{contents:"This means than in case the condition is not met - a rate will not be found"})),r.a.createElement(f.g,{sm:5,style:{marginTop:10}},r.a.createElement("div",{className:"inline"},r.a.createElement(Tn,{fieldType:"checkbox",id:"computed-must-met",value:t.get("must_met",!1),onChange:this.props.onChangeComputedMustMet})))),r.a.createElement(f.l,{key:"computed-cond-project-true"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Value when True"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:this.props.onChangeComputedLineKey(["projection","on_true","key"]),value:t.getIn(["projection","on_true","key"],"condition_result"),options:c})),["hard_coded"].includes(t.getIn(["projection","on_true","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:t.getIn(["projection","on_true","value"],""),onChange:this.props.onChangeHardCodedValue(["projection","on_true","value"])})),!["","hard_coded","condition_result"].includes(t.getIn(["projection","on_true","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:t.getIn(["projection","on_true","regex"],""),disabledValue:"",onChange:this.props.onChangeComputedLineKey(["projection","on_true","regex"]),disabled:""===t.getIn(["projection","on_true","key"],""),label:"Regex",fieldType:"toggeledInput"}))),r.a.createElement(f.l,{key:"computed-cond-project-false"},r.a.createElement(f.g,{sm:2,componentClass:f.h},"Value when False"),r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{fieldType:"select",onChange:this.props.onChangeComputedLineKey(["projection","on_false","key"]),value:t.getIn(["projection","on_false","key"],"condition_result"),options:c,disabled:t.get("must_met",!1)})),["hard_coded"].includes(t.getIn(["projection","on_false","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:t.getIn(["projection","on_false","value"],""),onChange:this.props.onChangeHardCodedValue(["projection","on_false","value"])})),!["","hard_coded","condition_result"].includes(t.getIn(["projection","on_false","key"],""))&&r.a.createElement(f.g,{sm:5},r.a.createElement(Tn,{value:t.getIn(["projection","on_false","regex"],""),disabledValue:"",onChange:this.props.onChangeComputedLineKey(["projection","on_false","regex"]),disabled:""===t.getIn(["projection","on_false","key"],""),label:"Regex",fieldType:"toggeledInput"})))))}}]),t}(a.Component);sb.defaultProps={computedLineKey:g.c.Map(),settings:g.c.Map(),computedlineKeyOptions:[],onChangeComputedLineKeyType:function(){},onChangeComputedLineKey:function(){},onChangeComputedMustMet:function(){},onChangeHardCodedValue:function(){}};var cb=Object(l.connect)(function(e,t){return{computedlineKeyOptions:tr(e,t)}})(sb),ub=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={computedLineKey:null,openRateCalculators:[0]},n.componentDidMount=function(){var e=n.props,t=e.settings,a=e.rateCategory;t.getIn(["rate_calculators",a],g.c.Map()).keySeq().map(function(e){return e}).forEach(function(e){0===t.getIn(["rate_calculators",a,e],g.c.List()).size&&n.onAddRating({target:{dataset:{ratecategory:a,usaget:e}}})})},n.sortFiledByPlay=function(e){return e.get("plays",g.c.List()).isEmpty()?1:-1},n.filterFiledByPlay=function(e){var t=n.props.plays,a=e.get("plays",g.c.List());return!!a.isEmpty()||t.intersect(g.c.Set(a)).size>0},n.getCustomRatingFields=function(){return n.props.customRatingFields.filter(function(e){return e.get("field_name","").startsWith("params.")}).filter(n.filterFiledByPlay).sort(n.sortFiledByPlay).map(function(e){return{value:e.get("field_name",""),label:e.get("title","")}}).toJS()},n.getRatingTypes=function(){return ee(["rates","paramsConditions"],g.c.List()).map(he).toArray()},n.onChangeAdditionalParamRating=function(e,t,a,r,i){return function(o){var l={target:{dataset:{rate_key:o,ratecategory:e,usaget:t,priority:a,index:r},value:i,custom:!0}};n.onSetRating(l)}},n.onChangeAdditionalParamRatingType=function(e,t,a,r,i){return function(o){n.onChangeAdditionalParamRating(t,a,r,i,o)(e)}},n.getRateCalculatorFields=function(){return n.props.lineKeyOptions.map(function(e,t){return r.a.createElement("option",{value:e.get("value",""),key:t},e.get("label",""))})},n.addNewRatingCustomField=function(e,t,a){var r=n.props.customRatingFields;return n.props.dispatch(yl("rates",["fields"],r.push(g.c.Map({field_name:e,title:t,multiple:"longestPrefix"===a,display:!0,editable:!0})))),n.props.dispatch(Tl("rates"))},n.onSetRating=function(e){var t=n.props.customRatingFields,a=e.target,r=a.dataset,i=r.ratecategory,o=r.usaget,l=r.priority,s=r.index,c=a.value,u=a.custom,p=e.target.dataset.rate_key,d=L.a.snakeCase(p);if(d=(d=d.replace("params.","")).replace("params_",""),d="params.".concat(d),u&&""!==p&&!t.find(function(e){return e.get("field_name","")===d}))n.addNewRatingCustomField(d,p,c),p=d;else{var m=t.find(function(e){return e.get("field_name","")===d});m&&u&&""!==p&&p!==m.title&&p!==d&&(n.props.dispatch(Vr("Product param ".concat(p," already exists as custom field ").concat(d))),p=m.title)}var g=parseInt(s);n.props.dispatch(function(e,t,n,a,r,i){return{type:Iv,rateCategory:e,usaget:t,priority:n,index:a,rate_key:r,value:i}}(i,o,l,g,p,c))},n.onAddRating=function(e){var t=e.target.dataset,a=t.ratecategory,r=t.usaget,i=t.priority;n.props.dispatch(function(e,t,n){return{type:wv,rateCategory:e,usaget:t,priority:n}}(a,r,i))},n.onRemoveRating=function(e){var t=e.target.dataset,a=t.ratecategory,r=t.usaget,i=t.priority,o=t.index;n.props.dispatch(function(e,t,n,a){return{type:xv,rateCategory:e,usaget:t,priority:n,index:a}}(a,r,i,o))},n.onRemoveRatingPriority=function(e,t,a){return function(){n.props.dispatch(function(e,t,n){return{type:Fv,rateCategory:e,usaget:t,priority:n}}(e,t,a))}},n.onSetLineKey=function(e){var t=e.target,a=t.dataset,r=a.ratecategory,i=a.usaget,o=a.index,l=a.priority,s=t.value;n.props.dispatch(function(e,t,n,a,r){return{type:Gv,rateCategory:e,usaget:t,priority:n,index:a,value:r}}(r,i,l,o,s))},n.onSetComputedLineKey=function(e,t){n.props.dispatch(function(e,t){return{type:Kv,paths:e,values:t}}(e,t))},n.onUnsetComputedLineKey=function(e,t,a,r){n.props.dispatch(function(e,t,n,a){return{type:Wv,rateCategory:e,usaget:t,priority:n,index:a}}(e,t,a,r))},n.getComputedLineKeyObject=function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:g.c.Map();return g.c.Map({rateCategory:e,usaget:t,priority:n,index:a,type:r.getIn(["computed","type"],"regex"),line_keys:r.getIn(["computed","line_keys"],g.c.List()),operator:r.getIn(["computed","operator"],""),must_met:r.getIn(["computed","must_met"],!1),projection:g.c.Map({on_true:g.c.Map({key:r.getIn(["computed","projection","on_true","key"],"condition_result"),regex:r.getIn(["computed","projection","on_true","regex"],""),value:r.getIn(["computed","projection","on_true","value"],"")}),on_false:g.c.Map({key:r.getIn(["computed","projection","on_false","key"],"condition_result"),regex:r.getIn(["computed","projection","on_false","regex"],""),value:r.getIn(["computed","projection","on_false","value"],"")})})})},n.onChangeLineKey=function(e){var t=e.target,a=t.dataset,r=a.ratecategory,i=a.usaget,o=a.index,l=a.priority;"computed"===t.value?n.setState({computedLineKey:n.getComputedLineKeyObject(r,i,l,o)}):(n.setState({computedLineKey:null}),n.onUnsetComputedLineKey(r,i,l,o)),n.onSetLineKey(e)},n.onEditComputedLineKey=function(e,t,a,r,i){return function(){n.setState({computedLineKey:n.getComputedLineKeyObject(t,a,r,i,e)})}},n.onSaveComputedLineKey=function(){var e=n.state.computedLineKey,t=[e.get("rateCategory"),e.get("usaget"),e.get("priority"),e.get("index"),"computed"],a=[[].concat(t,["line_keys"]),[].concat(t,["operator"]),[].concat(t,["type"]),[].concat(t,["must_met"]),[].concat(t,["projection"])],r=[e.get("line_keys",g.c.List()),e.get("operator",""),e.get("type",""),e.get("must_met",!1),e.get("projection",g.c.Map())];n.onSetComputedLineKey(a,r),n.setState({computedLineKey:null})},n.onChangeComputedMustMet=function(e){var t=e.target.value,a=n.state.computedLineKey.withMutations(function(e){e.set("must_met",t),t&&e.setIn(["projection","on_false"],g.c.Map())});n.setState({computedLineKey:a})},n.onChangeHardCodedValue=function(e){return function(t){var a=t.target.value;n.onChangeComputedLineKey(e)(a)}},n.onChangeComputedLineKey=function(e){return function(t){var a=n.state.computedLineKey,r=a.withMutations(function(n){n.setIn(e,t);var r=e[1];if("operator"===e[0]){var i="$regex"===a.get("operator","")&&"$regex"!==t,o="$regex"!==a.get("operator","")&&"$regex"===t;(i||o||("$exists"===t||"$existsFalse"===t))&&(n.deleteIn(["line_keys",1]),n.deleteIn(["line_keys",0,"regex"]))}if("hard_coded"===t?n.deleteIn(["projection",r,"value"]):"condition_result"===t&&(n.deleteIn(["projection",r,"value"]),n.deleteIn(["projection",r,"regex"])),"key"===e[2]){var l=Object(N.a)(e);l[l.length-1]="preFunction";var s=Za().find(function(e){return e.get("value")===t},null,!1);if(!1===s)n.deleteIn(l);else{var c=Object(N.a)(e);c[c.length-1]="regex",n.setIn(e,s.get("preFunctionValue")),n.setIn(l,s.get("preFunction")),n.deleteIn(c)}}});n.setState({computedLineKey:r})}},n.onChangeComputedLineKeyType=function(e){var t=e.target.value,a=n.state.computedLineKey,r=a.withMutations(function(e){(e.set("type",t),"regex"===t)?(e.deleteIn(["line_keys",1]),e.delete("operator"),e.delete("must_met"),e.delete("projection")):!1!==Za().find(function(e){return e.get("preFunction")===a.getIn(["line_keys",0,"preFunction"],"")&&e.get("preFunctionValue")===a.getIn(["line_keys",0,"key"],"")},null,!1)&&(e.deleteIn(["line_keys",0,"key"]),e.deleteIn(["line_keys",0,"preFunction"]))});n.setState({computedLineKey:r})},n.onHideComputedLineKey=function(){n.setState({computedLineKey:null})},n.renderComputedLineKeyDesc=function(e,t,a,i,o){var l=n.props.computedlineKeyOptions;if("computed"!==e.get("line_key",""))return null;var s=e.getIn(["computed","operator"],""),c=ee(["rates","conditions"],g.c.Map()).find(function(e){return e.get("id","")===s},null,g.c.Map()).get("title",""),u=l.find(function(t){return t.value===e.getIn(["computed","line_keys",0,"key"],"")}),p="undefined"!==typeof u?u.label:e.getIn(["computed","line_keys",0,"key"],""),d=Za().find(function(t){return t.get("preFunction")===e.getIn(["computed","line_keys",0,"preFunction"],"")&&t.get("preFunctionValue")===e.getIn(["computed","line_keys",0,"key"],"")},null,g.c.Map()).get("label",p),m=l.find(function(t){return t.value===e.getIn(["computed","line_keys",1,"key"],"")}),h="undefined"!==typeof m?m.label:e.getIn(["computed","line_keys",1,"key"],"");return r.a.createElement("h4",null,r.a.createElement("small",null,"".concat(d," ").concat(c," ").concat(h),r.a.createElement(f.c,{onClick:n.onEditComputedLineKey(e,t,a,i,o),bsStyle:"link"},r.a.createElement("i",{className:"fa fa-fw fa-pencil"}))))},n.openRateCalculator=function(e){return function(){var t=n.state.openRateCalculators;t.push(e),n.setState({openRateCalculators:t})}},n.closeRateCalculator=function(e){return function(){var t=n.state.openRateCalculators;t.splice(t.indexOf(e),1),n.setState({openRateCalculators:t})}},n.onAddRatingPriority=function(e,t){return function(){var a=n.props.rateCalculators;n.openRateCalculator(a.size)(),n.props.dispatch(function(e,t){return{type:Nv,rateCategory:e,usaget:t}}(e,t))}},n.getLineKeyValue=function(e){return Za().find(function(t){return t.get("preFunction")===e.get("preFunction","")&&t.get("preFunctionValue")===e.get("line_key","")},null,g.c.Map()).get("value",e.get("line_key",""))},n.getRateCalculatorsForPriority=function(e,t,a,i){var o=n.getRateCalculatorFields();return i.map(function(i,l){var s=3;return"key"===i.get("rate_key","")?s=1:"usaget"===i.get("rate_key","")&&(s=2),r.a.createElement("div",{key:"rate-calc-".concat(e,"-").concat(a,"-").concat(l)},r.a.createElement(f.y,{key:"rate-calc-row-".concat(e,"-").concat(a,"-").concat(l)},r.a.createElement(f.g,{sm:3,style:{paddingRight:0}},r.a.createElement(f.l,{style:{margin:0}},r.a.createElement("select",{className:"form-control",id:t,onChange:n.onChangeLineKey,"data-ratecategory":e,"data-usaget":t,"data-index":l,"data-priority":a,value:n.getLineKeyValue(i)},o),n.renderComputedLineKeyDesc(i,e,t,a,l))),r.a.createElement(f.g,{sm:7,style:{paddingRight:0}},r.a.createElement(f.l,{style:{margin:0,paddingLeft:13}},r.a.createElement("input",{type:"radio",name:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-type"),id:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-rate-key"),value:"match","data-ratecategory":e,"data-usaget":t,"data-rate_key":"key","data-index":l,"data-priority":a,checked:1===s,onChange:n.onSetRating}),"\xa0",r.a.createElement("label",{htmlFor:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-rate-key"),style:{verticalAlign:"middle"}},"By product key")),r.a.createElement(f.l,{style:{margin:0,paddingLeft:13}},r.a.createElement("input",{type:"radio",name:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-type"),id:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-rate-usaget"),value:"match","data-ratecategory":e,"data-usaget":t,"data-rate_key":"usaget","data-index":l,"data-priority":a,checked:2===s,onChange:n.onSetRating}),"\xa0",r.a.createElement("label",{htmlFor:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-rate-usaget"),style:{verticalAlign:"middle"}},"By product unit type")),r.a.createElement(f.l,{style:{margin:0}},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-addon"},r.a.createElement("input",{type:"radio",name:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-type"),id:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-param"),value:"match","data-ratecategory":e,"data-usaget":t,checked:3===s,"data-rate_key":"","data-index":l,"data-priority":a,onChange:n.onSetRating}),"\xa0",r.a.createElement("label",{htmlFor:"".concat(e,"-").concat(t,"-").concat(a,"-").concat(l,"-by-param"),style:{verticalAlign:"middle"}},"By product param"),r.a.createElement(Ao,{contents:"This field needs to be configured in the 'Additional Parameters' of a Product"})),r.a.createElement(Tn,{fieldType:"select",onChange:n.onChangeAdditionalParamRating(e,t,a,l,i.get("type","")),value:3!==s?"":i.get("rate_key",""),disabled:3!==s,options:n.getCustomRatingFields(),allowCreate:!0}),r.a.createElement(Tn,{fieldType:"select",onChange:n.onChangeAdditionalParamRatingType(i.get("rate_key",""),e,t,a,l),disabled:3!==s,value:3!==s?"":i.get("type",""),options:n.getRatingTypes()})))),r.a.createElement(f.g,{xs:2},l>0&&r.a.createElement(f.l,{style:{margin:0}},r.a.createElement("div",{style:{width:"100%",height:39}},r.a.createElement(f.c,{onClick:n.onRemoveRating,"data-ratecategory":e,"data-usaget":t,"data-index":l,"data-priority":a,bsSize:"small",className:"pull-left"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove"))))),r.a.createElement("hr",null))}).toArray()},n.getAddRatingButton=function(e,t,a){return r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary","data-ratecategory":e,"data-usaget":t,"data-priority":a,onClick:n.onAddRating},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add")},n.getAddRatingPriorityButton=function(e,t){return r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onAddRatingPriority(e,t)},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add Next Priority")},n.getRemoveRatingPriorityButton=function(e,t,a){return r.a.createElement(f.c,{bsStyle:"link",bsSize:"xsmall",onClick:n.onRemoveRatingPriority(e,t,a)},r.a.createElement("i",{className:"fa fa-fw fa-trash-o danger-red"}))},n.renderComputedRatePopup=function(){var e=n.props.settings,t=n.state.computedLineKey;if(!t)return null;return r.a.createElement(it,{title:"Computed Rate Key",show:!0,onOk:n.onSaveComputedLineKey,onHide:n.onHideComputedLineKey,labelOk:"OK",modalSize:"large"},r.a.createElement(cb,{computedLineKey:t,settings:e,onChangeComputedLineKeyType:n.onChangeComputedLineKeyType,onChangeComputedLineKey:n.onChangeComputedLineKey,onChangeComputedMustMet:n.onChangeComputedMustMet,onChangeHardCodedValue:n.onChangeHardCodedValue}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.rateCategory,a=t.usaget,i=t.rateCalculators,o=this.state.openRateCalculators,l={paddingLeft:45};return r.a.createElement("div",null,this.renderComputedRatePopup(),i.map(function(t,i){var s=i>0,c=s?{}:l;return r.a.createElement("div",{key:"rate-calculator-".concat(a,"-").concat(i)},r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:10},"Priority ".concat(i+1)),r.a.createElement(f.g,{sm:2,style:c},s&&e.getRemoveRatingPriorityButton(n,a,i),o.includes(i)?r.a.createElement(f.c,{onClick:e.closeRateCalculator(i),bsStyle:"link"},r.a.createElement("i",{className:"fa fa-fw fa-minus"})):r.a.createElement(f.c,{onClick:e.openRateCalculator(i),bsStyle:"link"},r.a.createElement("i",{className:"fa fa-fw fa-plus"})))),r.a.createElement(f.v,{collapsible:!0,expanded:e.state.openRateCalculators.includes(i)},e.getRateCalculatorsForPriority(n,a,i,t),e.getAddRatingButton(n,a,i)))}),this.getAddRatingPriorityButton(n,a))}}]),t}(a.Component);ub.defaultProps={settings:g.c.Map(),lineKeyOptions:g.c.List(),customRatingFields:g.c.List(),rateCalculators:g.c.List(),plays:g.c.Set(),computedlineKeyOptions:[]};var pb=Object(l.connect)(function(e,t){return{plays:Wy(e,t),rateCalculators:t.settings.getIn(["rate_calculators",t.rateCategory,t.usaget]),lineKeyOptions:Xa(e,t),computedlineKeyOptions:tr(e,t)}})(ub),db=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={newCategory:"",categoryToRemove:""},n.getRateCategoriesInUse=function(){return g.c.List(n.props.settings.get("rate_calculators",g.c.Map()).keySeq().map(function(e){return e}))},n.getAvailableRateCategories=function(){var e=n.props.rateCategories,t=n.getRateCategoriesInUse();return e.filter(function(e){return!t.includes(e)}).map(fe).toArray()},n.onChangeNewRateCategory=function(e){n.setState({newCategory:e})},n.onAddNewRateCategory=function(){var e=n.state.newCategory;void 0===e||""===e?n.props.dispatch(Br("Please choose a tariff category")):n.props.dispatch({type:kv,rateCategory:e}),n.setState({newCategory:""})},n.onRemoveRateCategory=function(e){return function(){n.props.dispatch(function(e){return{type:jv,rateCategory:e}}(e)),n.onClickCloseConfirm()}},n.onClickCloseConfirm=function(){n.setState({categoryToRemove:""})},n.onClickRateCategoryRemove=function(e){return function(){n.setState({categoryToRemove:e})}},n.renderRateCategoriesSelector=function(){var e=n.getAvailableRateCategories(),t=n.state.newCategory;return r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Add a new tariff category"),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{fieldType:"select",onChange:n.onChangeNewRateCategory,value:t,options:e})),r.a.createElement(f.g,{sm:1,style:{marginTop:5}},r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onAddNewRateCategory},r.a.createElement("i",{className:"fa fa-plus"}),"\xa0Add")))},n.renderTabTitle=function(e){return r.a.createElement("div",null,L.a.sentenceCase(e),n.getRateCategoriesInUse().size>1&&r.a.createElement(f.c,{bsSize:"xsmall",bsStyle:"link",onClick:n.onClickRateCategoryRemove(e),className:"close"},r.a.createElement("i",{className:"fa fa-times",style:{color:"#222222",fontSize:16,marginTop:-5,marginRight:-5}})))},n.renderRateCategory=function(e,t){var a=n.props,i=a.settings,o=a.customRatingFields,l=i.getIn(["rate_calculators",e],g.c.Map()).keySeq().map(function(e){return e});return r.a.createElement(f.z,{eventKey:t,title:n.renderTabTitle(e),key:"rate-category-".concat(t)},l.map(function(t,n){return r.a.createElement("div",{key:n,style:{minWidth:150}},r.a.createElement("div",{className:"form-group",style:{marginTop:20}},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:t},t)),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-11"},r.a.createElement(pb,{rateCategory:e,usaget:t,customRatingFields:o,settings:i})))),n<l.size-1&&r.a.createElement("div",{className:"separator"}))}).toArray())},n.renderRemoveCategoryConfirm=function(){var e=n.state.categoryToRemove,t='Are you sure you want to remove rate category "'.concat(L.a.sentenceCase(e),'"?');return r.a.createElement(lt,{type:"delete",onOk:n.onRemoveRateCategory(e),onCancel:n.onClickCloseConfirm,show:""!==e,message:t,labelOk:"Yes"})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.getRateCategoriesInUse();return r.a.createElement(f.j,{horizontal:!0,className:"rateMappings"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("h4",null,"Rate by")),this.renderRateCategoriesSelector()),r.a.createElement(f.B,{id:"rate-mapping"},e.map(this.renderRateCategory)),this.renderRemoveCategoryConfirm())}}]),t}(a.Component);db.defaultProps={settings:g.c.Map(),customRatingFields:g.c.List(),rateCategories:g.c.List()};var mb=Object(l.connect)(function(e,t){return{rateCategories:Ia(e,t)}})(db),gb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSetPricingMapping=function(e){var t=n.props.usaget,a=e.target,r=a.value,i=a.id;n.props.onSetPricingMapping(i,r,t)},n.getVolumeOptions=function(){return n.props.settings.get("fields",g.c.List()).sortBy(function(e){return e}).map(function(e){return{label:e,value:e}}).toArray()},n.onChangeApriceField=function(e){var t={target:{value:e,id:"aprice_field"}};n.onSetPricingMapping(t)},n.onChangeApriceExists=function(){n.onChangeApriceField(void 0),n.onChangeApriceMultExists(),n.onChangeTaxIncluded({target:{value:void 0}})},n.onChangeTaxIncluded=function(e){var t={target:{value:e.target.value,id:"tax_included"}};n.onSetPricingMapping(t)},n.onChangeApriceMult=function(e){n.onSetPricingMapping(e)},n.onChangeApriceMultExists=function(){var e={target:{value:void 0,id:"aprice_mult"}};n.onChangeApriceMult(e)},n.renderPrice=function(){var e=n.props.mapping,t=e.getIn(["aprice_field"],null),a=e.get("tax_included",!1)&&null!==t,i={fieldType:"select",placeholder:"Select price field...",options:n.getVolumeOptions(),onChange:n.onChangeApriceField},o=e.getIn(["aprice_mult"])||"",l={fieldType:"number",id:"aprice_mult",onChange:n.onChangeApriceMult};return r.a.createElement("div",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-11"},r.a.createElement("div",{className:"col-lg-10 form-inner-edit-row"},r.a.createElement(Tn,{fieldType:"toggeledInput",value:t,onChange:n.onChangeApriceExists,label:"Pre priced",inputProps:i})),r.a.createElement("div",{className:"col-lg-10 col-lg form-inner-edit-row"},r.a.createElement(Tn,{fieldType:"toggeledInput",value:o,disabledValue:"",disabled:null===t||void 0===t,onChange:n.onChangeApriceMultExists,label:"Multiply by constant",inputProps:l})),r.a.createElement("div",{className:"col-lg-1"},r.a.createElement(Ao,{contents:"When checked, the price taken will be multiplied by the constant entered"})),r.a.createElement("div",{className:"col-lg-10 col-lg form-inner-edit-row"},r.a.createElement(Tn,{fieldType:"checkbox",value:a,label:"Tax is included",disabled:!t,onChange:n.onChangeTaxIncluded})))))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{className:"col-lg-12"},this.renderPrice()))}}]),t}(a.Component);gb.defaultProps={settings:g.c.Map()};var fb=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.settings,n=t.get("pricing",g.c.Map());return r.a.createElement(f.j,{horizontal:!0,className:"pricingMappings"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("h4",null,"Pre-Pricing",r.a.createElement("p",{className:"help-block"},"When Pre priced is checked, the price will be taken directly from the record instead of being calculated")))),n.map(function(n,a){return r.a.createElement("div",{key:"pricing-mapping-".concat(a)},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:a},a)),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-10"},r.a.createElement(gb,{usaget:a,mapping:n,onSetPricingMapping:e.props.onSetPricingMapping,settings:t}))))))}).toArray())}}]),t}(a.Component);fb.defaultProps={settings:g.c.Map()};var hb=Object(l.connect)()(fb),vb=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).initDefaultValues=function(e,t){if(null===e.get("receiver_type",null)){var a={target:{value:"ftp",id:"receiver_type-".concat(t)}};n.props.onSetReceiverField(a,t)}if(null===e.get("passive",null)){var r={target:{checked:!1,id:"passive-".concat(t)}};n.props.onSetReceiverCheckboxField(r,t)}if(null===e.get("delete_received",null)){var i={target:{checked:!1,id:"delete_received-".concat(t)}};n.props.onSetReceiverCheckboxField(i,t)}},n.onRemoveReceiver=function(){var e=n.props.index;n.props.dispatch(function(e){return{type:sy,index:e}}(e))},n.toggleShowDetails=function(){var e=n.state.isReceiverOpen;n.setState(function(){return{isReceiverOpen:!e}})},n.afterUpload=function(e,t){var a=n.props.index;"success"===e.desc?(n.props.dispatch(Ur(e.details.message)),n.props.onSetReceiverField({target:{value:e.details.path,id:"key-".concat(a)}},a),n.props.onSetReceiverField({target:{value:t,id:"key_label-".concat(a)}},a),n.props.OnChangeUploadingFile()):n.props.dispatch(Br(e.details.message))},n.onChangeFileSelect=function(e){var t=e.target.files,a=n.props.fileType,r=t[0];if(r.size>=1048576)n.props.dispatch(Br("Please choose file smaller than 1MB"));else{var i=new FormData;i.append("file",r,r.name),i.append("category","key"),i.append("file_type",a);var o=new XMLHttpRequest,l=Zr({api:"uploadedfile"});n.props.OnChangeUploadingFile(),o.open("POST",l,!0),o.withCredentials=!0,o.addEventListener("load",function(){var e=JSON.parse(o.responseText);n.afterUpload(e,r.name)}),o.send(i)}},n.onClickFileSelect=function(e){e.target.value=null},n.onCancelKeyAuth=function(){var e=n.props.index;n.props.onCancelKeyAuth(e),n.props.dispatch(Ur("Key was removed successfuly"))},n.onChangeReceiverType=function(e){var t=e.target.value,a=n.props.index;n.props.onSetReceiverField({target:{value:t,id:"receiver_type-".concat(a)}},a)},n.renderReceiverType=function(e,t){var a=n.props,i=a.index,o=a.receiver;return r.a.createElement(f.g,{sm:3,key:t},r.a.createElement(Tn,{fieldType:"radio",onChange:n.onChangeReceiverType,name:"receiver_type-".concat(i),value:t,label:e,checked:o.get("receiver_type","")===t}))},n.renderReceiverTypes=function(){return n.props.receiverTypes.map(n.renderReceiverType).toList().toArray()},n.renderPanelHeader=function(){var e=n.props,t=e.receiver,a=e.fileType,i=t.get("key_label",a);return r.a.createElement("div",{style:{fontSize:12,fontWeight:"bold"}},i,r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{onClick:n.onCancelKeyAuth,bsSize:"small",bsStyle:"link",style:{padding:0}},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))},n.onChangeReceiverField=function(e){var t=n.props.index;n.props.onSetReceiverField(e,t)},n.onSetReceiverCheckboxField=function(e){var t=n.props.index;n.props.onSetReceiverCheckboxField(e,t)},n.renderReceiver=function(){var e=n.props,t=e.index,a=e.receiver,i=[{min:1,label:"1 Minute"},{min:15,label:"15 Minutes"},{min:30,label:"30 Minutes"},{min:60,label:"1 Hour"},{min:360,label:"6 Hours"},{min:720,label:"12 Hours"},{min:1440,label:"24 Hours"}].map(function(e,t){return r.a.createElement("option",{value:e.min,key:t},e.label)});return r.a.createElement("div",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"name",className:"col-xs-3 control-label"},"Receiver Type"),r.a.createElement("div",{className:"col-xs-6"},n.renderReceiverTypes())),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"name",className:"col-xs-3 control-label"},"Name"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{className:"form-control",id:"name-".concat(t),onChange:n.onChangeReceiverField,value:a.get("name","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"host",className:"col-xs-3 control-label"},"Host"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{className:"form-control",id:"host-".concat(t),onChange:n.onChangeReceiverField,value:a.get("host","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"user",className:"col-xs-3 control-label"},"User"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{className:"form-control",id:"user-".concat(t),onChange:n.onChangeReceiverField,value:a.get("user","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"password",className:"col-xs-3 control-label"},"Password"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{type:"password",className:"form-control",id:"password-".concat(t),onChange:n.onChangeReceiverField,value:a.get("password","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"remote_directory",className:"col-xs-3 control-label"},"Directory"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{className:"form-control",id:"remote_directory-".concat(t),onChange:n.onChangeReceiverField,value:a.get("remote_directory","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"filename_regex",className:"col-xs-3 control-label"},"Regex"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{className:"form-control",id:"filename_regex-".concat(t),onChange:n.onChangeReceiverField,value:a.get("filename_regex","")}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"period",className:"col-xs-3 control-label"},"Period"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("select",{className:"form-control",id:"period-".concat(t),onChange:n.onChangeReceiverField,value:a.get("period","")},i))),"ftp"!==a.get("receiver_type","")&&r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"uploadFile",className:"col-xs-3 control-label"},"Key"),r.a.createElement("div",{className:"col-xs-6"},!1===a.get("key",!1)&&r.a.createElement("input",{name:"file",type:"file",onClick:n.onClickFileSelect,onChange:n.onChangeFileSelect}),!1!==a.get("key",!1)&&r.a.createElement(f.v,{header:n.renderPanelHeader(),className:"mb0"}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"delete_received",className:"col-xs-3 control-label"},"Delete received files from remote"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{type:"checkbox",id:"delete_received-".concat(t),style:{marginTop:12},onChange:n.onSetReceiverCheckboxField,checked:a.get("delete_received",!1),value:"1"}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"passive",className:"col-xs-3 control-label"},"Passive mode"),r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{type:"checkbox",id:"passive-".concat(t),style:{marginTop:12},onChange:n.onSetReceiverCheckboxField,checked:a.get("passive",!1),value:"1",disabled:"ftp"!==a.get("receiver_type","")}))))},n.getReceiverActions=function(){var e=n.props.index,t=n.state.isReceiverOpen,a=0!==e;return[{type:"edit",onClick:n.toggleShowDetails,show:!t},{type:"collapse",onClick:n.toggleShowDetails,show:t},{type:"remove",onClick:n.onRemoveReceiver,enable:a}]},n.state={isReceiverOpen:0===e.index},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.receiver,n=e.index;this.initDefaultValues(t,n)}},{key:"render",value:function(){var e=this.props.index,t=this.state.isReceiverOpen;return r.a.createElement(f.l,{key:"connection_".concat(e),className:"mb0"},r.a.createElement(f.g,{sm:12},r.a.createElement("div",{style:{paddingRight:100,display:"inline-block"}},"Receiver ".concat(e+1)),r.a.createElement("span",{style:{marginLeft:-100,paddingRight:15},className:"pull-right List row"},r.a.createElement(vt,{actions:this.getReceiverActions()}))),r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{collapsible:!0,expanded:t},this.renderReceiver())))}}]),t}(a.Component);vb.defaultProps={settings:g.c.Map(),receiverTypes:g.c.Map({ftp:"FTP",ssh:"SFTP"})};var yb=Object(l.connect)(null)(vb),bb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSetReceiverField=function(e,t){var a=e.target,r=a.id,i=a.value,o=r.split("-")[0];n.props.onSetReceiverField(o,i,t)},n.onSetReceiverCheckboxField=function(e,t){var a=e.target,r=a.id,i=a.checked,o=r.split("-")[0];n.props.onSetReceiverCheckboxField(o,i,t)},n.onAddReceiver=function(){n.props.dispatch({type:cy})},n.renderReceivers=function(){var e=n.props,t=e.settings,a=e.fileType;return t.get("receiver",g.c.List()).map(function(e,i){return r.a.createElement(yb,{key:"receiver_".concat(i),receiver:e,index:i,settings:t,onSetReceiverField:n.onSetReceiverField,onSetReceiverCheckboxField:n.onSetReceiverCheckboxField,onCancelKeyAuth:n.props.onCancelKeyAuth,fileType:a,OnChangeUploadingFile:n.props.OnChangeUploadingFile})}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(f.j,{horizontal:!0,className:"Receiver"},this.renderReceivers(),r.a.createElement(ct,{onClick:this.onAddReceiver,label:"Add Receiver"}))}}]),t}(a.Component);bb.defaultProps={settings:g.c.Map()};var Eb=Object(l.connect)()(bb),Cb=Object(l.connect)()(function(e){var t=e.onChange,n=e.onChangeDefault,a=e.settings,i=[r.a.createElement("option",{disabled:!0,value:"",key:-1},"Select Field...")].concat(Object(N.a)(a.get("fields",[]).sortBy(function(e){return e}).map(function(e,t){return r.a.createElement("option",{value:e,key:t},e)}))),o=a.get("fields",[]).sortBy(function(e){return e}).map(function(e){return{label:e,value:e}}).toJS(),l=function(e){t({target:{id:"postpay_charge",value:"true"===e.target.value}})};return r.a.createElement("div",{className:"RealtimeMapping"},r.a.createElement("form",{className:"form-horizontal CalculatorMapping"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("input",{type:"radio",name:"postpay_charge",id:"postpay_charge_false",value:"false",onChange:l,checked:!a.getIn(["realtime","postpay_charge"],!1)}),r.a.createElement("label",{htmlFor:"postpay_charge"},"\xa0Allocation based requests")),r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("input",{type:"radio",name:"postpay_charge",id:"postpay_charge_true",value:"true",onChange:l,checked:a.getIn(["realtime","postpay_charge"],!1)}),r.a.createElement("label",{htmlFor:"postpay_charge"},"\xa0One time charge requests"))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"request_type_field"},"Request type field"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("select",{id:"request_type_field",className:"form-control",onChange:t,disabled:a.getIn(["realtime","postpay_charge"],!1),value:a.getIn(["realtime","request_type_field"],"")},i))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"pretend_field"},"Request type pretend field"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("select",{id:"pretend_field",className:"form-control",onChange:t,value:a.getIn(["realtime","pretend_field"],"")},i,">"))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"used_usagev_field"},"Rebalance fields"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(Tn,{fieldType:"select",options:o,onChange:function(e){var n={target:{id:"used_usagev_field",value:e.split(",")}};t(n)},disabled:a.getIn(["realtime","postpay_charge"],!1),multi:!0,value:a.getIn(["realtime","used_usagev_field"],Object(g.a)()).join(",")}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"used_usagev_field"},"Cumulative volume"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(Tn,{id:"used_usagev_accumulative",value:a.getIn(["realtime","used_usagev_accumulative"],!1),disabled:a.getIn(["realtime","postpay_charge"],!1),onChange:t,fieldType:"checkbox"}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"used_usagev_field"},"Rebalance on last request only?"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(Tn,{id:"rebalance_on_final",value:a.getIn(["realtime","rebalance_on_final"],!1),disabled:a.getIn(["realtime","postpay_charge"],!1),onChange:t,fieldType:"checkbox"}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:""},"Group requests fields"),r.a.createElement("p",{className:"help-block"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(Tn,{fieldType:"select",options:o,onChange:function(e){var n={target:{id:"session_id_fields",value:e.split(",")}};t(n)},disabled:a.getIn(["realtime","postpay_charge"],!1),multi:!0,value:a.getIn(["realtime","session_id_fields"],Object(g.a)()).join(",")}))))),r.a.createElement("hr",null),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"initial_request"},"Initial request"),r.a.createElement("p",{className:"help-block"},"Optional")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("input",{id:"initial_request",type:"number",className:"form-control",onChange:n,disabled:a.getIn(["realtime","postpay_charge"],!1),value:a.getIn(["realtime","default_values","initial_request"],10)}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"update_request"},"Update request"),r.a.createElement("p",{className:"help-block"},"Optional")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("input",{id:"update_request",type:"number",className:"form-control",onChange:n,disabled:a.getIn(["realtime","postpay_charge"],!1),value:a.getIn(["realtime","default_values","update_request"],10)}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"final_request"},"Final request"),r.a.createElement("p",{className:"help-block"},"Optional")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("input",{id:"final_request",type:"number",className:"form-control",onChange:n,disabled:a.getIn(["realtime","postpay_charge"],!1),value:a.getIn(["realtime","default_values","final_request"],0)}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",{htmlFor:"default"},"Default"),r.a.createElement("p",{className:"help-block"},"Optional")),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-1",style:{marginTop:8}},r.a.createElement("i",{className:"fa fa-long-arrow-right"})),r.a.createElement("div",{className:"col-lg-9"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("input",{id:"default",type:"number",className:"form-control",onChange:n,disabled:a.getIn(["realtime","postpay_charge"],!1),value:a.getIn(["realtime","default_values","default"],15)})))))))}),_b=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).buildGetAllQuery=function(){return{api:"settings",params:[{category:"file_types"},{data:JSON.stringify({})}]}},n.onChangeName=function(e){var t=n.props,a=t.inputProcessorsExitNames,r=t.action,i=n.state.errors,o=e.target.value;"new"!==r||ee("keyRegex","").test(o)?a.includes(o)?n.setState({errors:i.setIn(["sampleCSV","name"],"Name ".concat(o," already exists"))}):n.setState({errors:i.deleteIn(["sampleCSV","name"])}):n.setState({errors:i.setIn(["sampleCSV","name"],"Name contains illegal characters, name should contain only alphabets, numbers and underscores (A-Z, a-z, 0-9, _)")}),n.props.dispatch(gy(e.target.value))},n.onSetDelimiterType=function(e){n.props.dispatch(fy(e.target.value))},n.onChangeInputProcessorField=function(e,t){n.props.dispatch(function(e,t){return{type:Ev,fieldPath:e,value:t}}(e,t))},n.onChangeDelimiter=function(e){var t;n.props.dispatch((t=e.target.value,{type:Cv,delimiter:t}))},n.onSelectJSON=function(e){var t=e.target.files[0];if("undefined"!==typeof t){var a=new FileReader;a.onloadend=function(e){if(e.target.readyState===FileReader.DONE)try{var t=JSON.parse(e.target.result),a=Object.keys(t).map(function(e){return n.buildJSONFields(e,t)});n.props.dispatch(hy(zy()(a)))}catch(r){n.props.dispatch(Br("Not a valid JSON"))}};var r=t.slice(0,t.size-1);a.readAsText(r)}},n.onSelectSampleCSV=function(e){var t=n.props.settings,a=e.target.files,r=t.get("delimiter",",");jp.a.parse(a[0],{dynamicTyping:!1,skipEmptyLines:!0,delimiter:r,header:!0,complete:n.onParseScvComplete,error:n.onParseScvError})},n.onParseScvError=function(e,t){n.props.dispatch(Br("Error in CSV file"))},n.onParseScvComplete=function(e){if(e.meta&&e.meta.fields&&e.meta.fields.length>0){n.props.dispatch(hy([]));var t=new RegExp("[^A-Za-z0-9_]","g"),a=e.meta.fields.map(function(e){return e.replace(t,"_")}).map(function(e){return{name:e,checked:!0}});n.props.dispatch(hy(a))}else n.props.dispatch(Br("Error in CSV file, no headers found."))},n.onAddField=function(e,t){n.props.dispatch({type:Sv,field:""})},n.onRemoveField=function(e,t){n.props.dispatch(function(e,t){return{type:zv,index:e,field:t}}(e))},n.onRemoveAllFields=function(){n.props.dispatch({type:Jv})},n.onCheckAllFields=function(e){n.props.dispatch(function(e){return{type:$v,checked:e}}(e))},n.onSetFieldMapping=function(e){var t=e.target,a=t.value,r=t.id;n.props.dispatch(function(e,t){return{type:Ov,field:e,mapping:t}}(r,a))},n.onSetFieldWidth=function(e){var t=e.target,a=t.value,r=t.dataset.field;n.props.dispatch({type:Vv,index:r,width:a})},n.onAddUsagetMapping=function(e){n.props.dispatch({type:qv,mapping:e})},n.onSetStaticUsaget=function(e){n.props.dispatch({type:Qv,usaget:e})},n.onRemoveUsagetMapping=function(e,t){n.props.dispatch(function(e){return{type:Hv,index:e}}(e))},n.onSetCustomerMapping=function(e,t,a,r){n.props.dispatch(function(e,t,n,a){return{type:Rv,field:e,mapping:t,usaget:n,index:a}}(e,t,a,r))},n.onSetPricingMapping=function(e,t,a){n.props.dispatch(function(e,t,n){return{type:Mv,field:e,mapping:t,usaget:n}}(e,t,a))},n.onSetReceiverField=function(e,t,a){n.props.dispatch(vy(e,t,a))},n.onCancelKeyAuth=function(e){n.props.dispatch(function(e,t){return{type:Lv,field:e,index:t}}("key",e))},n.onSetReceiverCheckboxField=function(e,t,a){n.props.dispatch(vy(e,t,a))},n.onMoveFieldUp=function(e){n.props.dispatch(function(e,t){return{type:Xv,index:e,field:t}}(e))},n.onMoveFieldDown=function(e){n.props.dispatch(function(e,t){return{type:ey,index:e,field:t}}(e))},n.onChangeCSVField=function(e,t){n.props.dispatch(function(e,t){return{type:ty,index:e,value:t}}(e,t))},n.onChangeRealtimeField=function(e){var t=e.target,a=t.id,r=t.value;n.props.dispatch(function(e,t){return{type:iy,name:e,value:t}}(a,r))},n.onChangeRealtimeDefaultField=function(e){var t=e.target,a=t.id,r=t.value;n.props.dispatch(function(e,t){return{type:oy,name:e,value:t}}(a,r))},n.onError=function(e){n.props.dispatch(Br(e))},n.onCheckedField=function(e,t,a){n.props.dispatch(function(e,t,n){return{type:ly,index:e,checked:t,field:n}}(e,t,a))},n.setUsagetType=function(e){n.props.dispatch({type:Yv,usaget_type:e})},n.unsetField=function(e){n.props.dispatch(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Array.isArray(e)?e:[e];return{type:ny,path:t}}(e))},n.buildJSONFields=function(e,t){return"object"!==typeof t[e]||Array.isArray(t[e])?e:Object.keys(t[e]).map(function(a){return n.buildJSONFields(a,t[e])}).map(function(t){return"".concat(e,".").concat(t)})},n.goBack=function(){n.props.router.push("/input_processors")},n.handleNext=function(){var e=n.state,t=e.stepIndex,a=e.steps,r=t===a.size-1,i=r?[]:a.get(a.findKey(function(e){return e.idx===t}),{}).parts;n.props.dispatch(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0===t.length?"set":"validate",a=e.get("processor"),r=e.get("customer_identification_fields"),i=e.get("unify",g.c.Map()),o=e.get("rate_calculators"),l=e.get("pricing"),s=e.get("receiver"),c=e.get("realtime",g.c.Map()),u=e.get("response",g.c.Map()),p=e.get("enabled"),d=e.get("filters"),m={file_type:e.get("file_type"),type:e.get("type"),parser:{type:e.get("delimiter_type"),line_types:e.get("line_types"),separator:e.get("delimiter"),structure:e.get("unfiltered_fields").reduce(function(t,n,a){var r="fixed"===e.get("delimiter_type")?g.c.Map({name:n.get("name"),checked:n.get("checked"),width:e.getIn(["field_widths",a],"")}):g.c.Map({name:n.get("name"),checked:n.get("checked")});return t.push(r)},g.c.List())}};if("json"!==e.get("delimiter")&&(m.parser.csv_has_header=e.get("csv_has_header",!1),m.parser.csv_has_footer=e.get("csv_has_footer",!1)),a){var f="static"===e.get("usaget_type")?{default_usaget:a.get("default_usaget"),default_unit:a.get("default_unit"),default_volume_type:a.get("default_volume_type"),default_volume_src:a.get("default_volume_src")}:{usaget_mapping:a.get("usaget_mapping").map(function(e){return{src_field:e.get("src_field"),stamp_fields:e.get("stamp_fields"),conditions:py(e),pattern:e.get("pattern"),usaget:e.get("usaget"),unit:e.get("unit"),volume_type:e.get("volume_type"),volume_src:e.get("volume_src")}}).toJS()};m.processor=Object(Ks.a)({type:"realtime"===m.type?"Realtime":"Usage",date_field:a.get("date_field"),volume_field:a.get("volume_field"),aprice_field:a.get("aprice_field"),aprice_mult:a.get("aprice_mult")},f),a.get("time_field",!1)&&(m.processor.time_field=a.get("time_field")),a.get("date_format",!1)&&(m.processor.date_format=a.get("date_format")),a.get("time_format",!1)&&(m.processor.time_format=a.get("time_format")),a.get("timezone_field",!1)&&(m.processor.timezone_field=a.get("timezone_field")),a.get("calculated_fields",!1)&&(m.processor.calculated_fields=a.get("calculated_fields"))}if(r&&(m.customer_identification_fields=r.toJS()),o&&(m.rate_calculators=o.toJS()),l&&(m.pricing=l.toJS()),i&&(m.unify=i.toJS()),m.enabled=void 0===p||p,d&&(m.filters=d.toJS()),"realtime"!==e.get("type")&&s){var h=s.get("receiver_type","ftp");m.receiver={type:h,connections:s}}"realtime"===e.get("type")&&(m.realtime=c.toJS(),m.response=u.size>0?u.toJS():{encode:"json",fields:[{response_field_name:"requestNum",row_field_name:"request_num"},{response_field_name:"requestType",row_field_name:"request_type"},{response_field_name:"sessionId",row_field_name:"session_id"},{response_field_name:"returnCode",row_field_name:"granted_return_code"},{response_field_name:"sid",row_field_name:"sid"},{response_field_name:"grantedVolume",row_field_name:"usagev"}]});var v={};return"set"===n?v=m:t.forEach(function(e){v[e]=m[e]}),function(e){e(jr());var t=li(v,n);return ei(t).then(function(t){return e(Ir()),t}).catch(function(t){return e(Ir()),e(Jr(t,"Error saving input processor")),!1})}}(n.props.settings,i)).then(function(e){return!1===e||r?!(!1===e||!r)&&e:(n.setState({stepIndex:t+1}),!1)}).then(function(e){!1!==e&&(n.props.dispatch(Ur("Input processor saved successfully!")),n.goBack())})},n.handlePrev=function(){var e=n.state.stepIndex;e>0?n.setState({stepIndex:e-1}):n.handleCancel()},n.handleCancel=function(){window.confirm("Are you sure you want to stop editing input processor ?")&&n.goBack()},n.isValidForm=function(){return!n.state.errors.reduce(function(e,t){return e||!t.isEmpty()},!1)},n.changeUploadingFile=function(){var e=n.state.uploadingFile;n.setState({uploadingFile:!e})},n.getStepContent=function(){var e=n.props,t=e.settings,a=e.usageTypes,i=e.usageTypesData,o=e.propertyTypes,l=e.subscriberFields,s=e.customRatingFields,c=e.action,u=e.type,p=e.format,d=e.fileType,m=n.state,f=m.stepIndex,h=m.errors,v=m.steps;switch(f){case v.get("parser",{}).idx:return r.a.createElement(nb,{settings:t,type:u,action:c,format:p,errors:h.get("sampleCSV",g.c.Map()),onAddField:n.onAddField,onSelectJSON:n.onSelectJSON,onChangeName:n.onChangeName,onRemoveField:n.onRemoveField,onMoveFieldUp:n.onMoveFieldUp,onSetFieldWidth:n.onSetFieldWidth,onMoveFieldDown:n.onMoveFieldDown,onChangeCSVField:n.onChangeCSVField,onChangeDelimiter:n.onChangeDelimiter,onSelectSampleCSV:n.onSelectSampleCSV,onRemoveAllFields:n.onRemoveAllFields,onSetDelimiterType:n.onSetDelimiterType,onChangeInputProcessorField:n.onChangeInputProcessorField,onCheckedField:n.onCheckedField,checkAllFields:n.onCheckAllFields});case v.get("processor",{}).idx:return r.a.createElement(ab,{settings:t,usageTypes:a,usageTypesData:i,propertyTypes:o,onError:n.onError,unsetField:n.unsetField,setUsagetType:n.setUsagetType,onSetStaticUsaget:n.onSetStaticUsaget,onSetFieldMapping:n.onSetFieldMapping,onAddUsagetMapping:n.onAddUsagetMapping,onRemoveUsagetMapping:n.onRemoveUsagetMapping});case v.get("customer_identification_fields",{}).idx:return r.a.createElement(lb,{settings:t,subscriberFields:l,onSetCustomerMapping:n.onSetCustomerMapping});case v.get("rate_calculators",{}).idx:return r.a.createElement(mb,{settings:t,customRatingFields:s});case v.get("pricing",{}).idx:return r.a.createElement(hb,{settings:t,onSetPricingMapping:n.onSetPricingMapping});case v.get("realtimeMapping",{}).idx:return r.a.createElement(Cb,{settings:t,onChange:n.onChangeRealtimeField,onChangeDefault:n.onChangeRealtimeDefaultField});case v.get("receiver",{}).idx:return r.a.createElement(Eb,{settings:t,onSetReceiverField:n.onSetReceiverField,onSetReceiverCheckboxField:n.onSetReceiverCheckboxField,onCancelKeyAuth:n.onCancelKeyAuth,fileType:d,OnChangeUploadingFile:n.changeUploadingFile});default:return null}},n.renderStepper=function(){var e=n.state,t=e.stepIndex,a=e.steps.sortBy(function(e){return e.idx}).map(function(e){return{title:e.label}}).toList().toArray();return r.a.createElement(Mo,{activeIndex:t,steps:a})};var a=g.c.Map({sampleCSV:g.c.Map(),fieldsMapping:g.c.Map(),calculatorMapping:g.c.Map(),realtimeMapping:g.c.Map(),receiver:g.c.Map()}),i=g.c.Map({parser:{idx:0,label:"CDR Fields",parts:["file_type","parser","filters"]},processor:{idx:1,label:"Field Mapping",parts:["file_type","parser","processor","filters"]},customer_identification_fields:{idx:2,label:"Customer Mapping",parts:["file_type","parser","processor","customer_identification_fields","filters"]},rate_calculators:{idx:3,label:"Rate Mapping",parts:["file_type","parser","processor","customer_identification_fields","rate_calculators","filters"]},pricing:{idx:4,label:"Pricing",parts:["file_type","parser","processor","customer_identification_fields","rate_calculators","pricing","filters"]}});return i="api"===e.type?i.set("realtimeMapping",{idx:5,label:"Realtime Mapping",parts:["file_type","parser","processor","customer_identification_fields","rate_calculators","pricing","realtime","response","unify","filters"]}):i.set("receiver",{idx:5,label:"Receiver",parts:["file_type","parser","processor","customer_identification_fields","rate_calculators","pricing","receiver","unify","filters"]}),n.state={stepIndex:0,errors:a,steps:i,uploadingFile:!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e,t=this.props,n=t.fileType,a=t.action,r=t.template,i=t.type,o=t.format,l="";"new"===a?(r?(this.props.dispatch(function(e){var t=dy(e);return{type:Zv,template:t}}(Hy[r])),this.props.dispatch(gy("")),l="Create New Input Processor - ".concat(r)):l="Create New Input Processor","api"===i&&"json"===o&&(this.props.dispatch({type:ay,name:"type",value:"realtime"}),this.props.dispatch(fy("json")),this.props.dispatch({type:ry,processor_type:"realtime"})),this.props.dispatch(eo("all_input_processors",this.buildGetAllQuery()))):(this.props.dispatch((e=n,function(t){return t(my(e))})),l="Edit Input Processor"),this.props.dispatch(kl(["usage_types","property_types","subscribers.subscriber.fields","rates.fields"])),this.props.dispatch(bs(l))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.settings,a=t.action,r=n.get("file_type",""),i=e.settings.get("file_type","");"new"!==a&&i!==r&&this.props.dispatch(bs("Edit Input Processor - ".concat(i)))}},{key:"componentWillUpdate",value:function(e,t){var n=this.props,a=n.settings,r=n.action,i=n.template,o=this.state.stepIndex,l=a.get("file_type",""),s=e.settings.get("file_type","");if("new"===r&&(s!==l&&o>=1||t.stepIndex>=1&&0===o)){var c=i?" - ".concat(i):"",u=s.length>0?" - ".concat(s):"";this.props.dispatch(bs("Create New Input Processor".concat(c).concat(u)))}}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:Bv}),this.props.dispatch(Xi("all_input_processors"))}},{key:"render",value:function(){var e=this.state,t=e.stepIndex,n=e.steps,a=e.uploadingFile,i=this.isValidForm();return r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},this.renderStepper()),r.a.createElement("div",{className:"panel-body"},r.a.createElement("div",{className:"contents bordered-container"},this.getStepContent())),r.a.createElement("div",{style:{marginTop:12,float:"right"}},r.a.createElement("button",{className:"btn btn-default",onClick:this.handleCancel,style:{marginRight:12}}," Cancel "),t>0&&r.a.createElement("button",{className:"btn btn-default",onClick:this.handlePrev,style:{marginRight:12}}," Back "),r.a.createElement("button",{disabled:!i||a,className:"btn btn-primary",onClick:this.handleNext}," ",t===n.size-1?"Finish":"Next"))))))}}]),t}(a.Component);_b.defaultProps={settings:g.c.Map(),subscriberFields:g.c.List(),customRatingFields:g.c.List(),inputProcessorsExitNames:g.c.List(),usageTypes:g.c.List(),propertyTypes:g.c.List(),usageTypesData:g.c.List(),fileType:"",action:"new",template:null,type:null,format:null};var Ob=Object(l.connect)(function(e,t){var n=t.location.query,a=n.file_type,r=n.action,i=n.template,o=n.type,l=n.format;return{inputProcessorsExitNames:e.list.get("all_input_processors",g.c.List()).map(function(e){return e.get("file_type","")}),settings:e.inputProcessor,usageTypes:ga(e,t),propertyTypes:va(e,t),usageTypesData:ha(e,t),subscriberFields:Oa(e,t),customRatingFields:ja(e,t),fileType:a,action:r,template:i,type:o,format:l}})(Object(s.f)(_b)),Sb=function(e){var t=e.line,n=e.onClickCancel,a=e.hiddenFields,i=e.cancelLabel,o=e.enableRemove,l=e.onClickRemove,s=e.removeLabel,c=function(e,t){var n=[];return e.forEach(function(e,i){var o=e;"billrunFields"===t&&("connection_type"===i?o=L.a.upperCaseFirst(e):"urt"!==i&&"process_time"!==i&&"rebalance"!==i||(o=S.a.unix(e.get("sec")).format(ee("datetimeLongFormat","DD/MM/YYYY HH:mm:ss")))),a.includes(i)||n.push(r.a.createElement(f.l,{key:i},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},te(i,"lines")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("input",{disabled:!0,className:"form-control",value:null===o?"":o}))))}),n};return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("div",null,t.get("type",""),r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{bsSize:"xsmall",onClick:n},i)))},o&&r.a.createElement(f.v,{className:"panel-no-border"},r.a.createElement(f.c,{onClick:l,bsSize:"xsmall",className:"pull-right"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0",s)),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"BillRun fields")},c(t,"billrunFields")),r.a.createElement(f.v,{header:r.a.createElement("h3",null,"User fields")},c(t.get("uf",g.c.Map()),"userFields")),r.a.createElement(f.c,{onClick:n},i)))))};Sb.defaultProps={line:g.c.Map(),hiddenFields:["_id","in_plan","over_plan","interconnect_aprice","out_plan","uf"],onClickCancel:function(){},cancelLabel:"Back",enableRemove:!1,onClickRemove:function(){},removeLabel:"Remove"};var Tb=Sb,kb=function(e){return function(t){t(jr());var n=function(e){return{action:"delete",entity:"lines",params:[{query:JSON.stringify({_id:e})}]}}(e);return ei(n).then(function(e){return t(Wr(e,"Line deleted successfully!"))}).catch(function(e){return t(Jr(e,"Error deleting Line"))})}},jb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={line:null,viewing:!1,page:0,size:10,sort:g.c.Map(),filter:{},showRemoveConfirm:!1},n.buildQuery=function(){var e=n.state,t=e.page,a=e.size,r=e.sort,i=e.filter;return ui(i,t,r,a)},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.onClickLine=function(e){n.setState({line:e,viewing:!0})},n.onCancelView=function(){n.setState({line:null,viewing:!1})},n.fetchItems=function(){n.props.dispatch(eo("usages",n.buildQuery()))},n.getTableFields=function(){var e=n.props.baseFilter;return[{id:"type",placeholder:"Type",showFilter:!Object.prototype.hasOwnProperty.call(e,"type")},{id:"aid",placeholder:"Customer ID",type:"number",sort:!0,showFilter:!Object.prototype.hasOwnProperty.call(e,"aid")},{id:"sid",placeholder:"Subscriber ID",type:"number",sort:!0,showFilter:!Object.prototype.hasOwnProperty.call(e,"sid")},{id:"plan",placeholder:"Plan",showFilter:!Object.prototype.hasOwnProperty.call(e,"plan")},{id:"urt",placeholder:"Time",type:"fullDate",cssClass:"long-date",showFilter:!1,sort:!0}]},n.renderMainPanelTitle=function(){return r.a.createElement("div",null,r.a.createElement("span",null,"List of all usages"),r.a.createElement("div",{className:"pull-right"},r.a.createElement(s.b,{to:"/queue",className:"btn btn-default btn-xs"},"Go to Queue")))},n.showRemoveConfirmDialog=function(){n.setState({showRemoveConfirm:!0})},n.onRemoveOk=function(){var e=n.state.line.getIn(["_id","$id"],"undefined");n.props.dispatch(kb(e)).then(function(e){e.status&&(n.setState({showRemoveConfirm:!1}),n.onCancelView(),n.fetchItems())})},n.onRemoveCancel=function(){n.setState({showRemoveConfirm:!1})},n.renderUsage=function(){var e=n.state,t=e.line,a=e.viewing,i=e.showRemoveConfirm,o=t&&"credit"===t.get("type","");return a?o?r.a.createElement("div",null,r.a.createElement(Tb,{line:t,onClickCancel:n.onCancelView,enableRemove:o,onClickRemove:n.showRemoveConfirmDialog}),r.a.createElement(lt,{onOk:n.onRemoveOk,onCancel:n.onRemoveCancel,show:i,message:"Are you sure you want to remove this line?",labelOk:"Yes"})):r.a.createElement(Tb,{line:t,onClickCancel:n.onCancelView}):null},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.viewing,n=e.sort,a=this.props,i=a.items,o=a.baseFilter,l=this.getTableFields();return r.a.createElement("div",{className:"UsageList"},this.renderUsage(),r.a.createElement("div",{style:{display:t?"none":"block"}},r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:this.renderMainPanelTitle()},r.a.createElement(xm,{fields:l,onFilter:this.onFilter,base:o}),r.a.createElement(ju,{items:i,fields:l,edit:!0,onClickEdit:this.onClickLine,editText:"view",onSort:this.onSort,sort:n})))),r.a.createElement(Pm,{onClick:this.handlePageClick,size:this.state.size,count:i.size})))}}]),t}(a.Component);jb.defaultProps={items:g.c.List(),baseFilter:{}};var Ib=Object(l.connect)(function(e,t){return{items:e.list.get("usages"),baseFilter:t.location.query.base?JSON.parse(t.location.query.base):{}}})(jb),wb=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(a){a(jr());var r=Ui(e,t,n);return ei(r).then(function(e){return a(Wr(e,"Cycle started successfully!"))}).catch(function(e){return a(Jr(e,"Error running cycle"))})}},Nb=function(e){return function(t){t(jr());var n=function(e){return{api:"billrun",action:"resetcycle",params:[{stamp:e}]}}(e);return ei(n).then(function(e){return t(Wr(e,"Cycle reseted successfully!"))}).catch(function(e){return t(Jr(e,"Error resetting cycle"))})}},Fb=function(e,t){return function(n){n(jr());var a=function(e,t){return{api:"billrun",action:"confirmCycle",params:[{stamp:e},{invoices:t}]}}(e,t);return ei(a).then(function(e){return n(Wr(e,"Confirming invoice..."))}).catch(function(e){return n(Jr(e,"Error confirming invoice"))})}},xb=function(e){return function(t){t(jr());var n=function(e){return{api:"billrun",action:"confirmCycle",params:[{stamp:e}]}}(e);return ei(n).then(function(e){return t(Wr(e,"Confirming cycle..."))}).catch(function(e){return t(Jr(e,"Error confirming cycle"))})}},Rb=function(){return function(e){return e(jr()),ei({api:"billrun",action:"chargeaccount"}).then(function(t){return e(Wr(t,"Charged all success!"))}).catch(function(t){return e(Jr(t,"Error charging all"))})}},Mb=function(){return function(e){return e(jr()),ei({api:"operations",params:[{action:"confirm_cycle"},{filtration:"all"}]}).then(function(t){return e(Wr(t))}).catch(function(t){return e(Jr(t,"Cannot get cycle confirmation status"))})}},Pb=function(e){return function(t){t(jr());var n=[];return e.forEach(function(e){return n.push(function(e){return{api:"operations",params:[{action:"confirm_cycle"},{filtration:e}]}}(e))}),ei(n).then(function(e){return t(Ir()),{status:1,data:e.data}}).catch(function(e){return t(Jr(e,"Cannot get invoice confirmation status"))})}},Ab=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={confirmationModalData:{show:!1,title:"",message:"",warningMessage:"This action is irreversible",onClick:function(){},refreshString:""},confirmingInvoices:Object(g.a)(),confirmingAll:!1},n.updateInvoicesNum=function(e){n.props.dispatch(eo("billrunInvoices",Vi(e)))},n.parseCycleDataFirstName=function(e){return e.getIn(["attributes","firstname"],"")},n.parseCycleDataLastName=function(e){return e.getIn(["attributes","lastname"],"")},n.parseCycleDataInvoiceTotal=function(e){return e.getIn(["totals","after_vat_rounded"],"")},n.parseCycleDataSubscriptionNum=function(e){return e.get("subs",Object(g.a)()).filter(function(e){return!["0",0].includes(e.get("sid",0))}).size},n.parseCycleDataInvoiceId=function(e){return e.get("invoice_id")},n.downloadURL=function(e,t,n){return"".concat(ee(["env","serverApiUrl"],""),"/api/accountinvoices?action=download&aid=").concat(e,"&billrun_key=").concat(t,"&iid=").concat(n)},n.parseCycleDataDownload=function(e){var t=n.downloadURL(e.get("aid"),e.get("billrun_key"),e.get("invoice_id"));return e.get("invoice_file",!1)&&r.a.createElement("form",{method:"post",action:t,target:"_blank"},r.a.createElement("button",{className:"btn btn-link",type:"submit"},r.a.createElement("i",{className:"fa fa-download"})," Download"))},n.autoRefreshConfirmationStatus=function(){clearTimeout(n.autoRefreshConfirmationStatusHandler);var e=n.state,t=e.confirmingAll,a=e.confirmingInvoices;t?n.autoRefreshConfirmationAllStatus():a.size&&n.autoRefreshConfirmationInvoicesStatus(a)},n.autoRefreshConfirmationAllStatus=function(){n.props.dispatch(Mb()).then(function(e){e.status&&(e.data[0].start_date?n.autoRefreshConfirmationStatusHandler=setTimeout(n.autoRefreshConfirmationStatus,1e4):n.setState({confirmingAll:!1}))})},n.autoRefreshConfirmationInvoicesStatus=function(e){n.props.dispatch(Pb(e)).then(function(t){if(t.status){var a=Object(g.a)();e.forEach(function(e,n){t.data[n].data.details[0].start_date&&(a=a.push(e))}),n.setState({confirmingInvoices:a}),a.size>0&&(n.autoRefreshConfirmationStatusHandler=setTimeout(n.autoRefreshConfirmationStatus,1e4))}})},n.onClickInvoiceConfirm=function(e){var t=n.props.billrunKey,a=n.state.confirmingInvoices;n.props.dispatch(Fb(t,e.get("invoice_id",""))).then(function(t){t.status&&(n.closeConfirmationModal(),n.setState({refreshString:S()().format(),confirmingInvoices:a.push(e.get("invoice_id"))}),setTimeout(n.props.reloadCycleData,1e3),setTimeout(n.autoRefreshConfirmationStatus,1e3))})},n.onClickConfirmAll=function(){var e=n.props,t=e.selectedCycle,a=e.invoicesNum,r=n.state.confirmationModalData;r.show=!0,r.title="Confirm all invoices",r.message="Are you sure you want to confirm all the invoices for the cycle of\n      ".concat(Fn(t,"start_date")," - ").concat(Fn(t,"end_date"),"?\n      ").concat(a," invoices will be confirmed after this action"),r.onClick=n.onClickConfirmAllConfirm,n.setState({confirmationModalData:r})},n.onClickConfirmAllConfirm=function(){var e=n.props.billrunKey;n.props.dispatch(xb(e)).then(function(e){e.status&&(n.closeConfirmationModal(),n.setState({refreshString:S()().format(),confirmingInvoices:Object(g.a)(),confirmingAll:!0}),setTimeout(n.props.reloadCycleData,1e3),setTimeout(n.autoRefreshConfirmationStatus,1e3))})},n.parseCycleDataConfirm=function(e){var t=n.state,a=t.confirmingInvoices,i=t.confirmingAll,o=function(){n.onClickInvoiceConfirm(e)};return e.get("billed",!1)?r.a.createElement(f.p,{bsStyle:"success",className:"non-editable-field"},"CONFIRMED"):i||a.includes(e.get("invoice_id"))?r.a.createElement(f.p,{bsStyle:"info",className:"non-editable-field"},"CONFIRMING..."):r.a.createElement(f.c,{onClick:function(){var t=n.state.confirmationModalData,a=n.props.currency;t.show=!0,t.title="Confirm Invoice",t.message="Are you sure you want to confirm invoice #".concat(e.get("invoice_id")," for\n        customer #").concat(e.get("aid")," (").concat(n.parseCycleDataFirstName(e)," ").concat(n.parseCycleDataLastName(e),")\n        with a total due of ").concat(n.parseCycleDataInvoiceTotal(e)).concat(vd()(a),"?"),t.onClick=o,n.setState({confirmationModalData:t})}},"confirm")},n.parseCycleDataEmailSent=function(e){var t=e.getIn(["email_sent","sec"],!1);return t?S.a.unix(t).format(ee("datetimeFormat","DD/MM/YYYY HH:mm")):"Not Sent"},n.downloadTaxURL=function(e){return"".concat(ee(["env","serverApiUrl"],""),'/api/report?action=taxationReport&report={"billrun_key":"').concat(e,'"}&type=csv')},n.parseTaxDownload=function(e){var t=n.props.billrunKey,a=n.downloadTaxURL(t);return r.a.createElement("form",{method:"post",action:a,target:"_blank"},r.a.createElement(f.c,{className:e.actionClass,bsStyle:e.actionStyle,bsSize:e.actionSize,type:"submit"},e.label))},n.getListActions=function(){var e=n.props,t=e.showConfirmAllButton,a=e.isCycleConfirmed;return[{label:"Confirm All",actionStyle:"primary",show:t,showIcon:!1,onClick:n.onClickConfirmAll,actionSize:"xsmall"},{label:"Download Taxation compliance report",actionStyle:"primary",show:a,showIcon:!1,renderFunc:n.parseTaxDownload,actionSize:"xsmall"}]},n.onCloseConfirmationModal=function(){n.closeConfirmationModal()},n.closeConfirmationModal=function(){var e=n.state.confirmationModalData;e.show=!1,e.title="",e.message="",e.onClick=function(){},n.setState({confirmationModalData:e})},n.renderConfirmationModal=function(){var e=n.state.confirmationModalData;return r.a.createElement(lt,{onOk:e.onClick,onCancel:n.onCloseConfirmationModal,show:e.show,message:e.title,labelOk:"Yes"},r.a.createElement(f.l,{validationState:"error"},e.message,r.a.createElement(f.n,null,e.warningMessage)))},n.autoRefreshConfirmationStatusHandler=null,n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.billrunKey;this.updateInvoicesNum(e)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.billrunKey;e.billrunKey!==t&&this.updateInvoicesNum(e.billrunKey)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.autoRefreshConfirmationStatusHandler)}},{key:"render",value:function(){var e=this.props,t=e.baseFilter,n=e.settings,a=this.state.refreshString,i=n.get("billrun",Object(g.b)()).get("email_after_confirmation",!1),o=[{id:"aid",title:"Customer Number",sort:!0},{id:"attributes.firstname",title:"Customer First Name",sort:!0,parser:this.parseCycleDataFirstName},{id:"attributes.lastname",title:"Customer Last Name",sort:!0,parser:this.parseCycleDataLastName},{id:"totals.after_vat_rounded",title:"Invoice Total",sort:!0,parser:this.parseCycleDataInvoiceTotal},{id:"subss",title:"# of Subscribers",parser:this.parseCycleDataSubscriptionNum},{id:"invoice_id",title:"Invoice ID",sort:!0,parser:this.parseCycleDataInvoiceId},{id:"download",title:"Invoice",parser:this.parseCycleDataDownload},{id:"confirm",title:"Confirm",parser:this.parseCycleDataConfirm},{id:"email_sent",title:"Email Sent",sort:!0,parser:this.parseCycleDataEmailSent,display:i}];return r.a.createElement("div",null,r.a.createElement(Tp,{collection:"billrun",api:"get",itemType:"billrun",itemsType:"billruns",filterFields:[{id:"aid",placeholder:"Customer Number",type:"number"},{id:"attributes.firstname",placeholder:"Customer First Name"},{id:"attributes.lastname",placeholder:"Customer Last Name"}],baseFilter:t,tableFields:o,showAddButton:!1,listActions:this.getListActions(),refreshString:a}),this.renderConfirmationModal())}}]),t}(a.Component);Ab.defaultProps={settings:Object(g.b)(),reloadCycleData:function(){},baseFilter:{},showConfirmAllButton:!0,isCycleConfirmed:!1,currency:"",invoicesNum:0};var Db=Object(l.connect)(function(e,t){return{settings:e.settings,currency:pa(e,t),invoicesNum:e.list.get("billrunInvoices",Object(g.a)()).size}})(Ab),Lb=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={selectedCycle:Object(g.b)(),selectedCycleName:"",showRerunConfirm:!1,showResetConfirm:!1,showChargeAllConfirm:!1,autoRefreshRunning:!1,autoRefreshStep:0,autoRefreshIterations:0,showRefreshButton:!1,ChargedAllClicked:!1,generatePdf:null,hideChargeButtton:!0},n.initAutoRefresh=function(){n.unsetAutoRefresh(),n.setState({autoRefreshRunning:!0,autoRefreshIterations:0,autoRefreshStep:0}),n.autoRefresh=setTimeout(n.runAutoRefresh,n.refreshSteps[0].timeout)},n.initAutoRefreshChargingStatus=function(){n.setState({ChargedAllClicked:!0}),clearTimeout(n.autoRefreshChargingStatus),n.autoRefreshChargingStatus=setTimeout(function(){return n.runAutoRefreshChargingStatus(!0)},1e4)},n.clearData=function(){n.props.dispatch(Xi("cycles_list")),n.props.dispatch(Xi("cycle_data")),n.props.dispatch(Xi("charge_status")),n.props.dispatch(Xi("charge_status_refresh")),n.props.dispatch(Xi("billrunInvoices"))},n.runAutoRefreshChargingStatus=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=n.props.chargeStatusRefreshed;clearTimeout(n.autoRefreshChargingStatus),e||null!==t.get("start_date",null)?(n.props.dispatch(eo("charge_status_refresh",Bi())),n.autoRefreshChargingStatus=setTimeout(n.runAutoRefreshChargingStatus,1e4)):n.setState({ChargedAllClicked:!1})},n.refreshSteps=[{timeout:1e4,iterations:6},{timeout:6e4,iterations:60}],n.unsetAutoRefresh=function(){clearTimeout(n.autoRefresh)},n.runAutoRefresh=function(){var e=n.props.cycleAdditionalData;if(n.props.dispatch(up("billruns")),"running"===e.get("cycle_status","")){n.reloadCycleData();var t=n.state,a=t.autoRefreshIterations,r=t.autoRefreshStep,i=n.refreshSteps[r];if(n.unsetAutoRefresh(),a<i.iterations-1)n.setState({autoRefreshIterations:a+1}),n.autoRefresh=setTimeout(n.runAutoRefresh,i.timeout);else{var o=r+1;if(o>=n.refreshSteps.length)return void n.setState({showRefreshButton:!0,autoRefreshRunning:!1});var l=n.refreshSteps[o];n.autoRefresh=setTimeout(n.runAutoRefresh,l.timeout),n.setState({autoRefreshStep:o,autoRefreshIterations:0})}}else if(n.unsetAutoRefresh(),n.setState({autoRefreshRunning:!1}),"finished"===e.get("cycle_status","")){var s=n.state.selectedCycleName;n.onChangeSelectedCycle(s)}},n.getSelectedCycleStatus=function(){var e=n.props.cycleAdditionalData,t=n.state.selectedCycle;return e.get("cycle_status",t.get("cycle_status",""))},n.runCycle=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.props.dispatch(up("billruns"));var t=n.state,a=t.selectedCycle,r=t.generatePdf,i=n.props.cycleAdditionalData,o=null!==r?r:i.get("generate_pdf",!0);n.props.dispatch(wb(a.get("billrun_key",""),e,o)).then(function(e){e.status&&(n.refreshAfterRun=setTimeout(n.reloadCycleData,1e3))})},n.resetCycle=function(){n.props.dispatch(up("billruns"));var e=n.state.selectedCycle;n.props.dispatch(Nb(e.get("billrun_key",""))).then(function(e){e.status&&(n.refreshAfterRun=setTimeout(n.reloadCycleData,1e3))})},n.onClickRun=function(){n.runCycle()},n.onClickRerun=function(){n.setState({showRerunConfirm:!0})},n.onClickReset=function(){n.setState({showResetConfirm:!0})},n.onClickChargeAll=function(){n.setState({showChargeAllConfirm:!0})},n.chargeAll=function(){n.initAutoRefreshChargingStatus(),n.props.dispatch(Rb())},n.onClickRefresh=function(){n.reloadCycleData()},n.renderRefreshButton=function(){return n.state.showRefreshButton&&"running"===n.getSelectedCycleStatus()&&r.a.createElement("div",{className:"pull-right"},r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:n.onClickRefresh},r.a.createElement("i",{className:"fa fa-refresh"}),"\xa0Refresh"))},n.renderPanelHeader=function(){return r.a.createElement("div",null,"Run a billing cycle",n.renderRefreshButton())},n.clearCycleData=function(){n.props.dispatch(Xi("cycle_data"))},n.reloadCycleData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.state.selectedCycle;n.clearCycleData();var t=e.get("billrun_key","");""!==t&&n.props.dispatch(eo("cycle_data",Li(t)))},n.getCycleData=function(e){var t=Object(g.b)({billrun_key:e});return n.reloadCycleData(t),t},n.onChangeSelectedCycle=function(e){n.props.dispatch(up("billruns")),n.setState({selectedCycle:n.getCycleData(e),selectedCycleName:e})},n.renderCyclesSelect=function(){var e=n.state.selectedCycleName;return r.a.createElement(_d,{onChange:n.onChangeSelectedCycle,statusesToDisplay:Object(g.a)(["past"]),selectedCycles:e,timeStatus:!0})},n.getStatusStyle=function(e){switch(e){case"to_run":case"to_rerun":return"info";case"running":case"current":return"primary";case"future":return"warning";case"finished":case"confirmed":return"success";default:return"default"}},n.renderCycleStatus=function(){var e=n.getSelectedCycleStatus();return r.a.createElement(f.p,{bsStyle:n.getStatusStyle(e),className:"non-editable-field"},e.toUpperCase())},n.renderStartDate=function(){var e=n.props.cycleAdditionalData,t=n.state.selectedCycle;return r.a.createElement("div",{className:"non-editable-field"},e.get("start_date",t.get("start_date","-")))},n.renderEndDate=function(){var e=n.props.cycleAdditionalData,t=n.state.selectedCycle;return r.a.createElement("div",{className:"non-editable-field"},e.get("end_date",t.get("end_date","-")))},n.renderCycleCompletionPercentage=function(){var e=n.props.cycleAdditionalData.get("completion_percentage",!1);return r.a.createElement("div",{className:"non-editable-field"},e?"".concat(e,"%"):"-")},n.renderCycleConfirmationPercentage=function(){var e=n.props.cycleAdditionalData.get("confirmation_percentage",!1);return r.a.createElement("div",{className:"non-editable-field"},e?"".concat(e,"%"):"-")},n.fields=Object(g.a)([{label:"Select cycle",renderFunc:n.renderCyclesSelect},{label:"Status",renderFunc:n.renderCycleStatus},{label:"Start date",renderFunc:n.renderStartDate},{label:"End date",renderFunc:n.renderEndDate},{label:"Completion percentage",renderFunc:n.renderCycleCompletionPercentage},{label:"Confirmation percentage",renderFunc:n.renderCycleConfirmationPercentage}]),n.renderFields=function(){return n.fields.map(function(e,t){return r.a.createElement(f.l,{key:t},r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},e.label),r.a.createElement(f.g,{sm:6,lg:6},e.renderFunc()))})},n.renderRunButton=function(){return"to_run"===n.getSelectedCycleStatus()&&r.a.createElement(f.c,{onClick:n.onClickRun},"Run!")},n.renderRerunButton=function(){return("finished"===n.getSelectedCycleStatus()||"to_rerun"===n.getSelectedCycleStatus())&&r.a.createElement(f.c,{onClick:n.onClickRerun},"Re-run")},n.onTogglePdf=function(e){var t=e.target.value;n.setState({generatePdf:t})},n.renderGeneratePdfCheckbox=function(){var e=n.state.generatePdf,t=n.props.cycleAdditionalData;return null===e&&(e=t.get("generate_pdf",!0)),"finished"===n.getSelectedCycleStatus()||"to_run"===n.getSelectedCycleStatus()?r.a.createElement(Tn,{fieldType:"checkbox",value:e,onChange:n.onTogglePdf,label:"Generate PDF invoices"}):null},n.renderResetButton=function(){return"finished"===n.getSelectedCycleStatus()&&r.a.createElement(f.c,{onClick:n.onClickReset},"Reset")},n.isChargingStatusProcessing=function(){var e=n.props.chargeStatusRefreshed,t=n.state.ChargedAllClicked,a=null!==e.get("start_date",null);return t||a},n.renderChargeAllButton=function(){var e=n.props.chargeStatus,t=!0,a="";return n.isChargingStatusProcessing()?(t=!0,a="Processing..."):e.get("status",!1)?(t=!1,a="Charge All"):(t=!0,a="Charge is running..."),r.a.createElement(f.c,{disabled:t,onClick:n.onClickChargeAll},a)},n.onRerunCancel=function(){n.setState({showRerunConfirm:!1})},n.onResetCancel=function(){n.setState({showResetConfirm:!1})},n.onRerunOk=function(){n.runCycle(!0),n.setState({showRerunConfirm:!1})},n.onResetOk=function(){n.resetCycle(),n.setState({showResetConfirm:!1})},n.renderRerunConfirmationModal=function(){var e=n.state.showRerunConfirm,t=n.props.cycleAdditionalData,a="Are you sure you want to re-run ".concat(xn(t),"?");return r.a.createElement(lt,{onOk:n.onRerunOk,onCancel:n.onRerunCancel,show:e,message:a,labelOk:"Yes"},r.a.createElement(f.l,{validationState:"error"},r.a.createElement(f.n,null,"Cycle data will be reset (except for confirmed invoices)")))},n.renderResetConfirmationModal=function(){var e=n.state.showResetConfirm,t=n.props.cycleAdditionalData,a="Are you sure you want to reset ".concat(xn(t),"?");return r.a.createElement(lt,{onOk:n.onResetOk,onCancel:n.onResetCancel,show:e,message:a,labelOk:"Yes"},r.a.createElement(f.l,{validationState:"error"},r.a.createElement(f.n,null,"Cycle data will be reset (except for confirmed invoices)")))},n.onChargeAllCancel=function(){n.setState({showChargeAllConfirm:!1})},n.onChargeAllOk=function(){n.setState({showChargeAllConfirm:!1}),n.chargeAll()},n.renderChargeAllConfirmationModal=function(){var e=n.state.showChargeAllConfirm;return r.a.createElement(lt,{onOk:n.onChargeAllOk,onCancel:n.onChargeAllCancel,show:e,message:'Are you sure you want to run a "Charge All" request?',labelOk:"Yes"},r.a.createElement(f.l,{validationState:"error"},r.a.createElement(f.n,null,"The action will charge all customers")))},n.autoRefresh=null,n.autoRefreshChargingStatus=null,n.refreshAfterRun=null,n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(eo("charge_status",{api:"billrun",action:"chargestatus"}))}},{key:"componentWillReceiveProps",value:function(){var e=this.props.cycleAdditionalData,t=this.state,n=t.autoRefreshRunning;t.showRefreshButton||n||"running"!==e.get("cycle_status","")||this.initAutoRefresh()}},{key:"componentWillUnmount",value:function(){this.unsetAutoRefresh(),clearTimeout(this.autoRefreshChargingStatus),clearTimeout(this.refreshAfterRun),this.clearData()}},{key:"render",value:function(){var e=this.state,t=e.selectedCycle,n=e.hideChargeButtton,a=this.props.cycleAdditionalData,i=t.get("billrun_key",""),o=Object(g.a)(["running","finished","confirmed","to_rerun"]).contains(this.getSelectedCycleStatus()),l="finished"===this.getSelectedCycleStatus(),s="confirmed"===this.getSelectedCycleStatus(),c={billrun_key:i};return r.a.createElement("div",null,r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement("div",{className:"pull-right",style:{paddingBottom:10}},!n&&this.renderChargeAllButton()))),r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:this.renderPanelHeader()},r.a.createElement(f.j,{horizontal:!0},this.renderFields(),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h}),r.a.createElement(f.g,{sm:6,lg:6},this.renderRunButton(),this.renderRerunButton(),this.renderResetButton(),r.a.createElement("div",{className:"pull-right",style:{paddingBottom:10}},this.renderGeneratePdfCheckbox())))),o&&r.a.createElement(Db,{billrunKey:i,selectedCycle:a,baseFilter:c,reloadCycleData:this.reloadCycleData,showConfirmAllButton:l,isCycleConfirmed:s}),this.renderRerunConfirmationModal(),this.renderResetConfirmationModal(),this.renderChargeAllConfirmationModal()))))}}]),t}(a.Component);Lb.defaultProps={cycleAdditionalData:Object(g.b)(),chargeStatus:Object(g.b)(),chargeStatusRefreshed:Object(g.b)()};var Ub=Object(l.connect)(function(e){return{cycleAdditionalData:e.list.get("cycle_data",Object(g.a)()).get(0)||Object(g.b)(),chargeStatus:e.list.get("charge_status",Object(g.a)()).get(0)||Object(g.b)(),chargeStatusRefreshed:e.list.get("charge_status_refresh",Object(g.a)()).get(0)||Object(g.b)()}})(Lb),Vb=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.line,n=e.onClickCancel,a=["_id","in_plan","over_plan","interconnect_aprice","out_plan"];return r.a.createElement("form",{className:"form-horizontal"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("button",{type:"button",onClick:n,className:"btn btn-default"},"Back"))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-body"},t.keySeq().map(function(e,n){var i=t.get(e);return"calc_time"===e?i=S.a.unix(t.get(e)).format(ee("datetimeFormat","DD/MM/YYYY HH:mm")):"urt"!==e&&"process_time"!==e||(i=S.a.unix(t.getIn([e,"sec"])).format(ee("datetimeLongFormat","DD/MM/YYYY HH:mm:ss"))),a.includes(e)?null:r.a.createElement("div",{className:"form-group",key:n},r.a.createElement("label",{className:"col-lg-2 control-label",htmlFor:"input"},te(e,"queue")),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{disabled:!0,className:"form-control",value:i})))}))),r.a.createElement("button",{type:"button",onClick:n,className:"btn btn-default"},"Back"))))}}]),t}(a.Component);Vb.defaultProps={line:g.c.Map(),onClickCancel:function(){}};var Bb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={line:null,viewing:!1,page:0,size:10,sort:g.c.Map({calc_time:-1}),filter:{}},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.onClickLine=function(e){n.setState({line:e,viewing:!0})},n.onCancelView=function(){n.setState({line:null,viewing:!1})},n.getNextCalculator=function(e){var t=n.props.calculators;return t.get(t.indexOf(e)+1)},n.getPreviousCalculator=function(e){var t=n.props.calculators;return t.get(t.indexOf(e)-1)},n.parseCalcName=function(e){var t=e.get("calc_name");return n.getNextCalculator(t)},n.parseCalcTime=function(e){var t=e.get("calc_time",!1);return!1===t?"Never":S.a.unix(t).format(ee("datetimeFormat","DD/MM/YYYY HH:mm"))},n.fetchItems=function(){n.props.dispatch(eo("queue_lines",n.buildQuery()))},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.urtQueryBuilder=function(){var e=n.state.filter.urt,t=void 0===e?{}:e,a=Object.assign({},t);return a.from?(a.$gte=a.from,delete a.from):""===a.from&&delete a.from,a.to?(a.$lte=a.to,delete a.to):""===a.to&&delete a.to,a},n.handleQuerySpecialValues=function(){var e=n.state.filter,t=void 0===e?{}:e,a=Object.assign({},t);if(a.calc_name){var r=n.getPreviousCalculator(a.calc_name);a.calc_name=!1===r?{$in:[!1]}:{$regex:r,$options:"i"}}return a.urt&&(a.urt=n.urtQueryBuilder(),Object.keys(a.urt).length||delete a.urt),a},n.buildQuery=function(){var e=n.state,t=e.page,a=e.size,r=e.sort,i=n.handleQuerySpecialValues();return pi(i,t,r,a)},n.getFilterFields=function(){return[{id:"type",title:"Type",type:"text"},{id:"calc_name",title:"Calculator Stage",type:"text"},{id:"urt",title:"Date",type:"date-range"}]},n.getTableFields=function(){return[{id:"type",title:"Type"},{id:"calc_time",title:"Last Calculation Time",sort:!0,parser:n.parseCalcTime,cssClass:"long-date"},{id:"calc_name",title:"Calculator Stage",sort:!0,parser:n.parseCalcName},{id:"urt",title:"Time",type:"fullDate",cssClass:"long-date",sort:!0}]},n.renderPanelTitle=function(){return r.a.createElement("div",null,r.a.createElement("span",null,"List of queue data"),r.a.createElement("div",{className:"pull-right"},r.a.createElement(s.b,{to:"/usage",className:"btn btn-default btn-xs"},"Back to Usage")))},n.renderQueueList=function(){var e=n.props.items,t=n.state.sort,a=n.getTableFields(),i=n.getFilterFields();return r.a.createElement("div",null,r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:n.renderPanelTitle()},r.a.createElement(Rm,{fields:i,onFilter:n.onFilter}),r.a.createElement(ju,{items:e,fields:a,edit:!0,onClickEdit:n.onClickLine,editText:"view",onSort:n.onSort,sort:t})))),r.a.createElement(Pm,{onClick:n.handlePageClick,size:n.state.size,count:e.size}))},n.renderQueueItem=function(){var e=n.state.line;return r.a.createElement(Vb,{line:e,onClickCancel:n.onCancelView})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.fetchItems()}},{key:"render",value:function(){var e=this.state.viewing;return r.a.createElement("div",{className:"QueueList"},e?this.renderQueueItem():this.renderQueueList())}}]),t}(a.Component);Bb.defaultProps={items:g.c.List(),calculators:g.c.List([!1].concat(Object(N.a)(ee("queue_calculators",[])),["-"]))};var qb=Object(l.connect)(function(e){return{items:e.list.get("queue_lines")}})(Bb),zb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={page:0,size:10,sort:g.c.Map({invoice_id:-1}),filter:{}},n.buildQuery=function(){var e=n.props.collection,t=n.state,a=t.page,r=t.size,i=t.filter,o=t.sort,l=Object.assign({},i,{action:"query_bills_invoices",type:"inv"});return l.aid&&(l.aid={$in:[l.aid]}),l.invoice_id&&(l.invoice_id={$in:[l.invoice_id]}),{entity:e,action:"get",params:[{size:r},{page:a},{sort:JSON.stringify(o)},{query:JSON.stringify(l)}]}},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.fetchItems=function(){n.props.dispatch(eo("invoices",n.buildQuery())),n.props.dispatch(eo("billrun",n.buildQuery()))},n.downloadURL=function(e,t,n){return"".concat(ee(["env","serverApiUrl"],""),"/api/accountinvoices?action=download&aid=").concat(e,"&billrun_key=").concat(t,"&iid=").concat(n)},n.renderMainPanelTitle=function(){return r.a.createElement("div",null,r.a.createElement("span",null,"List of all invoices"))},n.parserPaidBy=function(e){var t=e.get("paid",!1);return[!0,"1"].includes(t)?r.a.createElement("span",{style:{color:"#3c763d"}},"Paid"):"2"===t?r.a.createElement("span",{style:{color:"#5b5e5b"}},"Pending"):S()(e.get("due_date")).isAfter(S()())?r.a.createElement("span",{style:{color:"#8a6d3b"}},"Due"):r.a.createElement("span",{style:{color:"#a94442"}},"Not Paid")},n.parserDownload=function(e){var t=n.downloadURL(e.get("aid"),e.get("billrun_key"),e.get("invoice_id"));return e.get("invoice_file",!1)&&r.a.createElement("form",{method:"post",action:t,target:"_blank"},r.a.createElement("input",{type:"hidden",name:"a",value:"a"}),r.a.createElement("button",{className:"btn btn-link",type:"submit"},r.a.createElement("i",{className:"fa fa-download"})," Download"))},n.parseCycleDataEmailSent=function(e){var t=e.getIn(["email_sent","sec"],!1);return t?S.a.unix(t).format(ee("datetimeFormat","DD/MM/YYYY HH:mm")):"Not Sent"},n.getTableFields=function(){return[{id:"invoice_id",title:"Invoice Id",sort:!0},{id:"invoice_date",title:"Date",cssClass:"short-date",sort:!0,type:"mongodate"},{id:"due_date",title:"Due",cssClass:"short-date",sort:!0,type:"mongodate"},{id:"amount",title:"Amount",sort:!0},{id:"paid",title:"Status",parser:n.parserPaidBy},{id:"billrun_key",title:"Cycle",sort:!0},{id:"aid",title:"Customer ID",sort:!0},{id:"payer_name",title:"Name",sort:!0},{title:"Download",parser:n.parserDownload},{id:"email_sent",title:"Email Sent",sort:!0,parser:n.parseCycleDataEmailSent,display:n.props.settings.get("billrun",g.c.Map()).get("email_after_confirmation",!1)}]},n.getFilterFields=function(){var e=n.props.baseFilter;return[{id:"aid",placeholder:"Customer ID",type:"number",showFilter:!Object.prototype.hasOwnProperty.call(e,"aid")},{id:"invoice_id",placeholder:"Invoice Id",type:"number",showFilter:!Object.prototype.hasOwnProperty.call(e,"invoice_id")}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillUnmount",value:function(){this.props.dispatch(Xi("invoices"))}},{key:"render",value:function(){var e=this.props,t=e.items,n=e.baseFilter,a=this.state.sort,i=this.getTableFields(),o=this.getFilterFields();return r.a.createElement("div",{className:"InvoicesList"},r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:this.renderMainPanelTitle()},r.a.createElement(xm,{fields:o,onFilter:this.onFilter,base:n}),r.a.createElement(ju,{items:t,fields:i,onSort:this.onSort,sort:a,className:"invoices-list"})))),r.a.createElement(Pm,{onClick:this.handlePageClick,size:this.state.size,count:t.size}))}}]),t}(a.Component);zb.defaultProps={settings:g.c.Map(),items:g.c.List(),baseFilter:{},collection:"bills"};var Hb=Object(l.connect)(function(e,t){return{settings:e.settings,baseFilter:t.location.query.base?JSON.parse(t.location.query.base):{},items:e.list.get("invoices")}})(zb),Yb=n(287),Gb=n.n(Yb),Kb=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChange=function(e){n.props.onChange("billrun","timezone",e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.timeZoneOptions;return r.a.createElement("div",{className:"DateTime"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"timezone",key:"timezone"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Time Zone"),r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{fieldType:"select",options:n,onChange:this.onChange,value:t.get("timezone",""),clearable:!1})))))}}]),t}(a.Component);Kb.defaultProps={data:g.c.Map(),timeZoneOptions:Gb.a.tz.names().map(function(e){return{label:e,value:e}})};var Wb=function(e){var t=e.data,n=e.currencies;return r.a.createElement("div",{className:"CurrencyTax"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"currency",key:"currency"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Currency"),r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{fieldType:"select",options:n,value:t,onChange:function(t){e.onChange("pricing","currency",t)}})))))};Wb.defaultProps={data:"",currencies:[]};var Jb=Wb,$b=function(e){var t=e.data,n=e.chargingDayOptions,a=e.onChange,i=function(e,t){a("billrun",e,t)};return r.a.createElement("div",{className:"Invoicing"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"charging_day",key:"charging_day"},r.a.createElement(f.g,{componentClass:f.h,sm:2},"Charging Day"),r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{fieldType:"select",value:t.get("charging_day",""),onChange:function(e){i("charging_day",e)},options:n,placeholder:"Select charging day..."}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:10,smOffset:2,className:"mt10"},r.a.createElement(Tn,{fieldType:"checkbox",label:"Billing cycle generates PDF invoices",value:t.get("generate_pdf",!0),onChange:function(e){var t=e.target.value;i("generate_pdf",t),!1===t&&(i("email_after_confirmation",!1),i("detailed_invoices",!1))}}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:10,smOffset:2,className:"mt10"},r.a.createElement(Tn,{fieldType:"checkbox",label:"Detailed Invoices",value:t.get("detailed_invoices",!1),onChange:function(e){var t=e.target.value;i("detailed_invoices",t)},disabled:!t.get("generate_pdf",!0)}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:10,smOffset:2,className:"mt10"},r.a.createElement(Tn,{fieldType:"checkbox",label:"Send invoices to customers by email",value:t.get("email_after_confirmation",!1),onChange:function(e){var t=e.target.value;i("email_after_confirmation",t)},disabled:!t.get("generate_pdf",!0)}),r.a.createElement(f.n,{style:{marginLeft:20,marginTop:0}},zo.email_after_confirmation)))))};$b.defaultProps={data:g.c.Map(),chargingDayOptions:Object(N.a)(Array(28)).map(function(e,t){return{value:t+1,label:t+1}})};var Qb=$b,Zb=function(e){var t=e.plugin,n=e.index,a=e.showEnableAction,i=e.onEdit,o=e.onDisable,l=[{type:"edit",helpText:"Edit",onClick:i},{type:"enable",helpText:"Enable",onClick:e.onEnable,show:a},{type:"disable",helpText:"Disable",onClick:o,show:!a}];return r.a.createElement("tr",{key:n},r.a.createElement("td",null,r.a.createElement(I,{status:t.get("enabled",!0)?"active":"expired"})),r.a.createElement("td",null,t.get("label","")),r.a.createElement("td",{className:"td-actions"},r.a.createElement(vt,{actions:l,data:t})))};Zb.defaultProps={plugin:g.c.Map(),showEnableAction:!0};var Xb=Zb,eE=function(e){var t=e.item,n=e.onChangeEnabled,a=e.errors,i=e.onChange,o=e.onRemove;return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Status"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("span",null,r.a.createElement("span",{className:"inline mr10"},r.a.createElement(Tn,{fieldType:"radio",onChange:n,name:"type",value:"yes",label:"Enable",checked:t.get("enabled",!1)})),r.a.createElement("span",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",onChange:n,name:"type",value:"no",label:"Disable",checked:!t.get("enabled",!1)}))))),r.a.createElement(Fd,{entityName:"plugins",entity:t.getIn(["configuration","values"],g.c.Map()),errors:a,fields:t.getIn(["configuration","fields"],g.c.List()),onChangeField:i,onRemoveField:o}))};eE.defaultProps={item:g.c.Map()};var tE=eE,nE=Object(l.connect)(null,function(e,t){var n=t.item,a=t.updateField,r=t.removeField,i=t.setError;Object(mt.a)(t,["item","updateField","removeField","setError"]);return{onChangeEnabled:function(e){var t=e.target.value;a("enabled","yes"===t)},onChange:function(e,t){var r=Array.isArray(e)?e:[e],o=r.join("."),l=n.getIn(["configuration","fields"],Object(g.a)()).find(function(e){return e.get("field_name","")===o},null,Object(g.b)()),s=os(t,l);!1!==s?i(o,s):i(o),a(["configuration","values"].concat(Object(N.a)(r)),t)},onRemove:function(e){var t=Array.isArray(e)?e:[e];i(t.join("."));var a=t.reduce(function(e){var t=Object(N.a)(e);t.pop();var a=n.getIn(["configuration","values"].concat(Object(N.a)(t)),Object(g.b)());return g.b.isMap(a)&&a.size>1?e:(i(t.join(".")),t)},t);r(["configuration","values"].concat(Object(N.a)(a)))}}})(tE),aE=Object(g.b)({enabled:!0,system:!0,hide_from_ui:!1,configuration:Object(g.b)()}),rE=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,a){var r=a().settings.get("plugins",Object(g.a)()).find(function(t){return t.get("name","")===e},null,Object(g.b)());return n(iE(r,t))}},iE=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var a=t.success,r=void 0===a?"Plugin ".concat(e.get("label","")," was successfuly updated!"):a,i=t.error,o=void 0===i?"Error saving plugin ".concat(e.get("label","")):i;n(jr());var l=e.deleteIn(["configuration","fields"]),s=ii(l,"plugin");return ei(s).then(function(e){return n(Wr(e,r))}).catch(function(e){return n(Jr(e,o))}).finally(function(){return n(kl("plugins"))})}},oE=function(e){return e.map(lE).filter(uE).map(sE).map(cE)},lE=function(e){return"string"===typeof e?aE.set("name",e):e},sE=function(e){return""===e.get("label","")?e.set("label",function(e){if(!g.c.Map.isMap(e))return"Plugin";var t=e.get("name","Plugin");return"Plugin"===t?"Plugin":Object(D.titleCase)(t.substring(0,t.lastIndexOf("Plugin")))}(e)):e},cE=function(e){return e.updateIn(["configuration","fields"],Object(g.a)(),function(e){return e.sortBy(function(e){return e.get("field_name","")})})},uE=function(e){return!e.get("hide_from_ui",!1)},pE=Object(l.connect)(function(e,t){return{showEnableAction:!t.plugin.get("enabled",!0)}},function(e,t){var n=t.index,a=(t.plugin,t.plugins,t.onChange);t.onRemove,Object(mt.a)(t,["index","plugin","plugins","onChange","onRemove"]);return{onEdit:function(t){var n={title:"Edit Plugin ".concat(t.get("label","")),onOk:function(t){return!!e(function(e){return function(t){var n=e.getIn(["configuration","values"],Object(g.b)()),a=e.getIn(["configuration","fields"],Object(g.a)()),r=!0;return a.forEach(function(e){if(e.get("display",!1)&&e.get("editable",!1)){var a=e.get("field_name",""),i=a.split(".").filter(function(e){return""!==e});if(n.hasIn(i)){var o=n.getIn(i),l=os(o,e);!1!==l&&(r=!1,t(Is(a,l)))}}}),r}}(t))&&e(iE(t))},mode:"edit"};return e(js(t,nE,n))},onEnable:function(t){a([n,"enabled"],!0);var r="Plugin ".concat(t.get("label","")," was successfuly enabled"),i="Plugin ".concat(t.get("label","")," can not be enabled");return e(rE(t.get("name",""),{success:r,error:i}))},onDisable:function(t){var r={message:'Are you sure you want to disable plugin "'.concat(t.get("label",""),'"?'),onOk:function(){a([n,"enabled"],!1);var r="Plugin ".concat(t.get("label","")," was successfuly disabled"),i="Plugin ".concat(t.get("label","")," can not be disabled");return e(rE(t.get("name",""),{success:r,error:i}))},type:"delete",labelOk:"Disable"};return e(ks(r))}}})(Xb),dE=function(e){var t=e.data,n=e.onChange;return r.a.createElement("div",{className:"plugins List row panel-body"},r.a.createElement(f.A,{className:"table table-hover table-striped table-bordered"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"state"},"Status"),r.a.createElement("th",null,"Label"),r.a.createElement("th",null,"\xa0"))),r.a.createElement("tbody",null,t.map(function(e,a){return r.a.createElement(pE,{key:"plugin_".concat(a),index:a,plugin:e,onChange:n,plugins:t})}))))};dE.defaultProps={data:g.c.List()};var mE=dE,gE=Object(l.connect)(null,function(e,t){return{onChange:function(t,n){e(yl("plugins",t,n))}}})(mE),fE=function(e){var t=e.play,n=e.index,a=e.isDefaultDisabled,i=e.showEnableAction,o=e.onChangeDefault,l=e.onEdit,s=e.onDisable,c=[{type:"edit",helpText:"Edit",onClick:l},{type:"enable",helpText:"Enable",onClick:e.onEnable,show:i},{type:"disable",helpText:"Disable",onClick:s,show:!i},{type:"remove",helpText:"Remove",onClick:e.onRemove}];return r.a.createElement("tr",{key:n},r.a.createElement("td",null,r.a.createElement(I,{status:t.get("enabled",!0)?"active":"expired"})),r.a.createElement("td",null,t.get("name","")),r.a.createElement("td",null,t.get("label","")),r.a.createElement("td",{className:"text-center"},r.a.createElement(Tn,{fieldType:"radio",name:"default-play",onChange:o,checked:t.get("default",!1),disabled:a})),r.a.createElement("td",{className:"td-actions"},r.a.createElement(vt,{actions:c,data:t})))};fE.defaultProps={play:g.c.Map(),isNameEditable:!1,isDefaultDisabled:!1,showEnableAction:!0};var hE=fE,vE=function(e){var t=e.item,n=e.isNameHasError,a=e.isAllowedDisableAction,i=e.isAllowedEditName,o=e.isAllowedEditDefault,l=e.onChangeName,s=e.onChangeLabel,c=e.onChangeDefault,u=e.onChangeEnabled;return r.a.createElement(f.j,{horizontal:!0},i&&r.a.createElement(f.l,{validationState:n?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Name ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{onChange:l,value:t.get("name","")}),n&&r.a.createElement(f.n,null,n))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Description"),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{onChange:s,value:t.get("label","")}))),o&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:7,smOffset:3},r.a.createElement(Tn,{fieldType:"checkbox",label:"Default",value:t.get("default",!1),onChange:c}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:7,smOffset:3},r.a.createElement(Tn,{fieldType:"checkbox",label:"Enabled",value:t.get("enabled",!1),onChange:u,disabled:!a}))))};vE.defaultProps={item:g.c.Map(),isNameHasError:!1,isAllowedDisableAction:!0,isAllowedEditName:!0,isAllowedEditDefault:!0};var yE=vE,bE=Object(l.connect)(function(e,t){return{isAllowedDisableAction:!t.item.get("default",!1),isAllowedEditName:"create"===t.mode,isAllowedEditDefault:"create"===t.mode,isNameHasError:t.errors&&t.errors.get("name",!1)}},function(e,t){return{onChangeName:function(e){var n=t.item,a=t.updateField,r=t.setError,i=t.existingNames,o=t.errors,l=e.target.value.toUpperCase().replace(ee("keyUppercaseCleanRegex",/./),"");a(["name"],l),i.includes(l)?r("name","Name already exists"):o.get("name",!1)&&r("name"),""!==n.get("label","")&&n.get("label","").toUpperCase()!==n.get("name","").toUpperCase()||a("label",Object(D.titleCase)(l))},onChangeLabel:function(e){(0,t.updateField)("label",e.target.value)},onChangeDefault:function(e){var n=t.updateField,a=e.target.value;n("default",a),a&&n("enabled",!0)},onChangeEnabled:function(e){(0,t.updateField)("enabled",e.target.value)}}})(yE),EE=Object(l.connect)(function(e,t){return{isDefaultDisabled:!t.play.get("enabled",!0),isDisableAllowd:!t.play.get("default",!1),showEnableAction:!t.play.get("enabled",!0)}},function(e,t){var n=t.index,a=t.play,r=t.plays,i=t.onChange,o=t.onRemove;Object(mt.a)(t,["index","play","plays","onChange","onRemove"]);return{onChangeDefault:function(){return a.get("enabled",!0)?(r.forEach(function(e,t){i([t,"default"],!1)}),i([n,"default"],!0),e(Tl(["plays"])).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(kl("plays"))}).catch(function(){return e(kl("plays")),Promise.reject()})):e(Vr("Disabled play can not be default"))},onEdit:function(t){var a={title:"Edit Play ".concat(t.get("name","")),onOk:function(t){return i([n],t),e(Tl(["plays"])).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(kl("plays"))}).catch(function(){return e(kl("plays")),Promise.reject()})},mode:"edit"};return e(js(t,bE,a))},onRemove:function(t){if(t.get("default",!1))return e(Vr("Default play can not be removed"));var a={message:'Are you sure you want to remove Play "'.concat(t.get("name",""),'"?'),onOk:function(){return o(n),e(Tl(["plays"])).then(function(){return e(kl("plays"))})},labelOk:"Delete",type:"delete"};return e(ks(a))},onEnable:function(){return i([n,"enabled"],!0),e(Tl("plays")).then(function(){return e(kl("plays"))})},onDisable:function(t){if(t.get("default",!1))return e(Vr("Default play can not be disabled"));var a={message:'Are you sure you want to disable Play "'.concat(t.get("name",""),'"?'),onOk:function(){return i([n,"enabled"],!1),e(Tl(["plays"])).then(function(){return e(kl("plays"))})},type:"delete",labelOk:"Disable"};return e(ks(a))}}})(hE),CE=function(e){var t=e.data,n=e.onChange,a=e.onRemove,i=e.onAdd;return r.a.createElement("div",{className:"Plays List row panel-body"},r.a.createElement(f.A,{className:"table table-hover table-striped table-bordered"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"state"},"Status"),r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Label"),r.a.createElement("th",{className:"text-center list-status-col"},"Default"),r.a.createElement("th",null,"\xa0"))),r.a.createElement("tbody",null,t.map(function(e,i){return r.a.createElement(EE,{key:"play_".concat(i),index:i,play:e,onChange:n,onRemove:a,plays:t})}))),r.a.createElement(ct,{onClick:i,type:"Play",action:"Add"}))};CE.defaultProps={data:g.c.List()};var _E=CE,OE=Object(l.connect)(null,function(e,t){return{onChange:function(t,n){e(yl("plays",t,n))},onRemove:function(t){e(El("plays",t))},onAdd:function(){var n=t.data,a=g.c.Map({name:"",label:"",enabled:!0,default:n.isEmpty()}),r={title:"Create New Play",onOk:function(t){return""===t.get("name","")?(e(Is("name","Name is required")),!1):(t.get("default",!1)&&n.forEach(function(t,n){e(yl("plays",[n,"default"],!1))}),e(yl("plays",n.size,t)),e(Tl(["plays"])).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(kl("plays"))}).catch(function(){return e(kl("plays")),Promise.reject()}))},mode:"create",existingNames:n.map(function(e){return e.get("name","")})};return e(js(a,bE,r))}}})(_E),SE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeOrigNum=function(e){var t=n.props,a=t.fileType,r=t.usageType;n.props.onChange(a,r,"orig_num",e)},n.onChangeTermNum=function(e){var t=n.props,a=t.fileType,r=t.usageType;n.props.onChange(a,r,"term_num",e)},n.getOptions=function(){return n.props.options.map(function(e){return{label:"".concat(te(e,"lines",Object(D.sentenceCase)(e))),value:e}}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.props.disabled!==e.disabled||this.props.fileType!==e.fileType||this.props.usageType!==e.usageType||!g.c.is(this.props.options,e.options)||!g.c.is(this.props.csiMap,e.csiMap)}},{key:"render",value:function(){var e=this.props,t=e.fileType,n=e.usageType,a=e.csiMap,i=e.disabled,o=this.getOptions();return r.a.createElement(f.v,{header:"".concat(t," - ").concat(n)},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Origin Number"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",value:a.get("orig_num",""),onChange:this.onChangeOrigNum,options:o,disabled:i}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Term Number"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",value:a.get("term_num",""),onChange:this.onChangeTermNum,options:o,disabled:i}))))}}]),t}(a.Component);SE.defaultProps={fileType:"",usageType:"",csiMap:g.c.Map(),options:g.c.List(),disabled:!1};var TE=SE,kE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeProvider=function(e){var t=n.props.csi.set("provider",e);n.props.onChange(t)},n.onChangeOptionalCharges=function(e){var t=e.target.value,a=n.props.csi.set("apply_optional_charges",t);n.props.onChange(a)},n.onChangeAuthToken=function(e){var t=e.target.value,a=n.props.csi.set("auth_code",t);n.props.onChange(a)},n.onChangeTaxationMapping=function(e,t,a,r){var i=n.props.csi.update("taxation_mapping",g.c.List(),function(n){var i=n.findIndex(function(n){return n.get("file_type","")===e&&n.get("usaget","")===t});if(-1===i){var o=g.c.Map(Object(ti.a)({usaget:t,file_type:e},a,r));return n.push(o)}return n.setIn([i,a],r)});n.props.onChange(i)},n.getProviderOptions=function(){return n.props.csi.get("available_providers",g.c.Map({a:"A",b:"B"})).map(function(e,t){return{value:t,label:e}}).toList().toArray()},n.getMapperFileType=function(e){return n.props.csi.get("taxation_mapping",g.c.List()).find(function(t){return t.get("file_type","")===e.get("fileType","")&&t.get("usaget","")===e.get("usageType","")},null,g.c.Map())},n.renderTaxationMapping=function(){var e=n.props,t=e.fileTypes,a=e.disabled;return t.map(function(e,t){return r.a.createElement(TE,{key:t,csiMap:n.getMapperFileType(e),fileType:e.get("fileType",""),usageType:e.get("usageType",""),options:e.get("customKeys",g.c.List()),disabled:a,onChange:n.onChangeTaxationMapping})}).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.props.disabled!==e.disabled||!g.c.is(this.props.fileTypes,e.fileTypes)||!g.c.is(this.props.csi,e.csi)}},{key:"render",value:function(){var e=this.props,t=e.csi,n=e.disabled,a=this.getProviderOptions();return r.a.createElement("div",{className:"csi"},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Authentication Token"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:t.get("auth_code",""),onChange:this.onChangeAuthToken,disabled:n}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Provider"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",value:t.get("provider",""),onChange:this.onChangeProvider,options:a,disabled:n}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"\xa0"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"checkbox",value:t.get("apply_optional_charges",""),onChange:this.onChangeOptionalCharges,label:"Apply Optional Charges",disabled:n}))),this.renderTaxationMapping())}}]),t}(a.Component);kE.defaultProps={csi:g.c.Map(),fileTypes:g.c.List(),disabled:!1,onChange:function(){}};var jE=kE,IE=function(e){var t=e.data,n=e.csiOptions,a=e.taxRateOptions,i=e.onChange,o="CSI"===t.get("tax_type",""),l=function(e){var t=e.target.value;i("taxation","tax_type",t)},s=a.map(function(e){return{label:e.get("description",""),value:e.get("key","")}}).toArray();return r.a.createElement("div",{className:"tax"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"tax_type"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Tax Type"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(Tn,{fieldType:"radio",onChange:l,name:"tax_type",value:"usage",label:"Custom",checked:!o})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(Tn,{fieldType:"radio",onChange:l,name:"tax_type",value:"CSI",label:"CSI",checked:o})))),r.a.createElement("hr",null),o&&r.a.createElement(jE,{csi:t.get("CSI",g.c.Map()),onChange:function(e){i("taxation","CSI",e)},fileTypes:n}),!o&&r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Default Tax Rate"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",value:t.getIn(["default","key"],""),onChange:function(e){i("taxation",["default","key"],e)},options:s})))))};IE.defaultProps={data:g.c.Map(),csiOptions:g.c.List(),taxRateOptions:g.c.List()};var wE=IE,NE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={logo:""},n.onChangeField=function(e){var t=e.target,a=t.id,r=t.value;n.props.onChange("tenant",a,r)},n.updateLogoPreview=function(e){var t=new FileReader;t.onload=function(e){n.setState({logo:e.target.result})},t.readAsDataURL(e)},n.uploadFile=function(e){var t=e.target.files;if(t.length>0){var a=1024*ee("logoMaxSize",2)*1024;t[0].size<=a?(Ol(t[0],{billtype:"logo"}),n.props.onChange("tenant","logo",t[0].name),n.updateLogoPreview(t[0])):n.props.dispatch(Vr("Max file size is ".concat(wp()(a).human())))}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.data,t=this.state.logo.length>0?this.state.logo:this.props.logo;return r.a.createElement("div",{className:"Tenant"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"name",key:"name"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Name"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{type:"text",name:"name",onChange:this.onChangeField,value:e.get("name","")}))),r.a.createElement(f.l,{controlId:"address",key:"address"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Address"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{componentClass:"textarea",name:"address",onChange:this.onChangeField,value:e.get("address","")}))),r.a.createElement(f.l,{controlId:"phone",key:"phone"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Phone"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{type:"text",name:"phone",onChange:this.onChangeField,value:e.get("phone","")}))),r.a.createElement(f.l,{controlId:"email",key:"email"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Email"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{type:"email",name:"email",onChange:this.onChangeField,value:e.get("email","")}))),r.a.createElement(f.l,{controlId:"website",key:"website"},r.a.createElement(f.g,{componentClass:f.h,md:2},"Website"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{type:"text",name:"website",onChange:this.onChangeField,value:e.get("website","")}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2},"Logo"),r.a.createElement(f.g,{sm:6},r.a.createElement(f.k,{type:"file",name:"logo",onChange:this.uploadFile}),t.length>0&&r.a.createElement("img",{src:t,style:{height:100,marginTop:20},alt:"Logo"})))))}}]),t}(a.Component);NE.defaultProps={data:g.c.Map()};var FE=Object(l.connect)(function(e){return{logo:e.settings.getIn(["files","logo"])}})(NE),xE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={item:n.props.item,title:n.props.item.isEmpty()?"New":"Edit",action:n.props.item.isEmpty()?"create":"edit"},n.onChangeName=function(e){var t=n.state.item,a=e.target.value;n.setState({item:t.set("name",a)})},n.onChangeDateFrom=function(e){var t=n.state.item,a=ee("apiDateFormat","YYYY-MM-DD"),r=e?e.format(a):"";n.setState({item:t.set("from",r)})},n.onChangeDateTo=function(e){var t=n.state.item,a=ee("apiDateFormat","YYYY-MM-DD"),r=e?e.format(a):"";n.setState({item:t.set("to",r)})},n.onSave=function(){var e=n.state,t=e.item,a=e.action;n.props.onSave(t,a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.item,n=e.action,a="create"===n?"New":"Edit";return r.a.createElement(it,{title:"".concat(a," Secret"),show:!0,onOk:this.onSave,onCancel:this.props.onCancel,labelOk:"Save"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,{controlId:"name",key:"name"},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Name"),r.a.createElement(f.g,{sm:8},r.a.createElement(f.k,{type:"text",name:"name",onChange:this.onChangeName,value:t.get("name","")}))),r.a.createElement(f.l,{controlId:"key",key:"key"},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Secret Key"),r.a.createElement(f.g,{sm:8},r.a.createElement(f.k,{type:"text",name:"key",value:t.get("key",""),disabled:!0}),"create"===n&&r.a.createElement(f.n,null,"Secret will be available after saving"))),r.a.createElement(f.l,{controlId:"from",key:"from"},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Creation Date"),r.a.createElement(f.g,{sm:8},r.a.createElement("div",{className:"pull-left"},r.a.createElement(Dt.a,{className:"form-control",dateFormat:ee("dateFormat","DD/MM/YYYY"),selected:t.get("from","").length?S()(t.get("from","")):null,onChange:this.onChangeDateFrom,isClearable:!0,placeholderText:"Select Date..."})))),r.a.createElement(f.l,{controlId:"to",key:"to"},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Expiration Date"),r.a.createElement(f.g,{sm:8},r.a.createElement("div",{className:"pull-left"},r.a.createElement(Dt.a,{className:"form-control",dateFormat:ee("dateFormat","DD/MM/YYYY"),selected:t.get("to","").length?S()(t.get("to","")):null,onChange:this.onChangeDateTo,isClearable:!0,placeholderText:"Select Date..."}))))))}}]),t}(a.Component);xE.defaultProps={item:g.c.Map()};var RE=xE,ME=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={showConfirmRemove:!1,itemToRemove:null,currentItem:null},n.parseDate=function(e,t){var n=ce(e,t.id,!1);return n?n.format(ee("dateFormat","DD/MM/YYYY")):""},n.parserState=function(e){return r.a.createElement(I,{from:ce(e,"from",S()(0)).toISOString(),to:ce(e,"to",S()(0)).toISOString()})},n.onClickEdit=function(e){n.setState({currentItem:e})},n.onClickRemove=function(e){n.setState({showConfirmRemove:!0,itemToRemove:e})},n.onClickRemoveClose=function(){n.setState({showConfirmRemove:!1,itemToRemove:null})},n.onCancel=function(){n.setState({currentItem:null})},n.handleSave=function(e,t){n.props.dispatch(Il(e,t)).then(n.afterSave)},n.afterSave=function(e){1===e.status&&(n.setState({currentItem:null}),n.props.dispatch(kl(["shared_secret"])))},n.onClickRemoveOk=function(){var e=n.state.itemToRemove.get("key","");n.props.dispatch(Il(e,"remove")).then(n.afterRemove)},n.afterRemove=function(e){1===e.status&&(n.setState({showConfirmRemove:!1,itemToRemove:null}),n.props.dispatch(kl(["shared_secret"])))},n.onClickNew=function(){n.setState({currentItem:g.c.Map()})},n.renderList=function(){var e=n.props.data,t=n.getListFields(),a=n.getListActions();return r.a.createElement(ju,{items:e,fields:t,edit:!1,actions:a})},n.getListFields=function(){return[{id:"state",title:"Status",parser:n.parserState,cssClass:"state"},{id:"name",title:"Name"},{id:"key",title:"Secret Key"},{id:"from",title:"Creation Date",parser:n.parseDate,cssClass:"long-date text-center"},{id:"to",title:"Expiration Date",parser:n.parseDate,cssClass:"long-date text-center"}]},n.getListActions=function(){return[{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.onClickEdit},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.onClickRemove}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.showConfirmRemove,n=e.currentItem;return r.a.createElement("div",null,this.renderList(),r.a.createElement(ct,{onClick:this.onClickNew,label:"Add New"}),null!==n&&r.a.createElement(RE,{item:n,show:!0,onSave:this.handleSave,onCancel:this.onCancel}),r.a.createElement(lt,{onOk:this.onClickRemoveOk,onCancel:this.onClickRemoveClose,show:t,message:"Are you sure you want to remove this key ?",labelOk:"Yes"}))}}]),t}(a.Component);ME.defaultProps={data:g.c.List()};var PE=Object(s.f)(Object(l.connect)()(ME)),AE=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChangeTitle=function(e){var t=e.target.value,a=n.state.menuItem;n.setState({menuItem:a.set("title",t)})},n.onChangeRoles=function(e){var t=n.state.menuItem,a=e.length?e.split(","):[];n.setState({menuItem:t.set("roles",g.c.List(a))})},n.onChangeShowHide=function(e){var t=e.target.value,a=n.props.item;n.props.onChangeField(a.get("id"),"show",t)},n.onCancelAdvencedEdit=function(){var e=n.state.menuItem;n.setState({menuItem:e.remove("title").remove("roles")}),n.closeEdit()},n.onSaveAdvencedEdit=function(){var e=Object(Po.a)(n),t=e.props.item,a=e.state.menuItem,r=t.get("id");a.toSeq().forEach(function(e,a){t.get(a,"")!==e&&n.props.onChangeField(r,a,e)}),n.closeEdit()},n.onMouseEnter=function(e){n.setState({mouseOver:!0})},n.onMouseLeave=function(e){n.setState({mouseOver:!1})},n.toggleEdit=function(e){e.preventDefault();var t=n.state.editMode;n.setState({editMode:!t})},n.closeEdit=function(){n.setState({editMode:!1})},n.renderEditModal=function(){var e=Object(Po.a)(n),t=e.props.item,a=e.state,i=a.editMode,o=a.menuItem,l=o.title,s=o.roles,c=t.get("title",""),u=["admin","read","write"].map(function(e){return{value:e,label:e}});return r.a.createElement(it,{show:i,onOk:n.onSaveAdvencedEdit,onCancel:n.onCancelAdvencedEdit,title:"Edit ".concat(c," Details")},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Label"),r.a.createElement(f.g,{sm:10},r.a.createElement(Tn,{autoFocus:!0,onChange:n.onChangeTitle,value:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Roles"),r.a.createElement(f.g,{sm:10},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:s.join(","),options:u,onChange:n.onChangeRoles})))))},n.renderRole=function(){var e=n.state.menuItem.roles;return 0===e.size?r.a.createElement("small",null,"Visible to all roles"):r.a.createElement("small",null,e.join(","))},n.renderTitle=function(){var e=Object(Po.a)(n),t=e.props.item,a=e.state.menuItem.title,i=t.get("icon",""),o=i.length?r.a.createElement("i",{className:"fa ".concat(i," fa-fw")}):null;return r.a.createElement("span",null,o," ",a)},n.renderMouseOver=function(){return r.a.createElement("span",null,"\xa0",r.a.createElement("i",{className:"fa fa-pencil-square-o fa-fw"}))};var a=g.c.Record({title:e.item.get("title",""),roles:e.item.get("roles",g.c.List())});return n.state={editMode:!1,mouseOver:!1,menuItem:new a},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,e.item)||this.state!==t}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.editShow,a=this.state,i=a.mouseOver,o=a.editMode,l=t.get("show",!1);return r.a.createElement(f.g,{md:12,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},r.a.createElement(f.g,{md:6,style:{color:"#008cba",cursor:"pointer"},onClick:this.toggleEdit},this.renderTitle(),i&&!o&&this.renderMouseOver()),r.a.createElement(f.g,{md:4,className:"text-right",style:{cursor:"pointer"},onClick:this.toggleEdit},this.renderRole(),i&&!o&&this.renderMouseOver()),r.a.createElement(f.g,{md:2,className:"text-right",style:{marginTop:10}},r.a.createElement(Tn,{onChange:this.onChangeShowHide,value:l,fieldType:"checkbox",disabled:!n})),this.renderEditModal())}}]),t}(a.Component);AE.defaultProps={editShow:!0,item:g.c.Map(),onChangeField:function(){}};var DE=AE,LE=Object(yt.SortableElement)(function(e){var t=e.data,n=t.item,a=t.onChangeField,i=t.subMenus,o=t.renderTree,l=t.newPath,s=t.editShow;return r.a.createElement(f.g,{md:12,className:"pr0",style:{borderTop:"1px solid #eee",borderBottom:"1px solid #eee",lineHeight:"35px"}},r.a.createElement(f.g,{md:1},r.a.createElement(_t,null)),r.a.createElement(f.g,{md:11,className:"pr0"},r.a.createElement(DE,{item:n,onChangeField:a,editShow:s}),i.size>0&&o(i,[].concat(Object(N.a)(l),["subMenus"]),n.get("id"))))}),UE=Object(yt.SortableContainer)(function(e){var t=e.data,n=t.items,a=t.renderMenu,i=t.path;return r.a.createElement(f.g,{lg:12,md:12,className:"pr0"},n.map(function(e,t){return a(e,t,i)}))}),VE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeField=function(e,t,a){n.props.onChange("menu",["main",e,t],a)},n.onChangeOrder=function(e){n.props.onChangeMenuOrder(["main"],e)},n.onDragEnd=function(e){var t=e.oldIndex,a=e.newIndex,r=e.collection,i=n.props.data,o=""===r?[]:r.split("-"),l=g.c.Map();i.getIn(o).forEach(function(e){var n=e.get("order"),r=e.get("id");n>=Math.min(a,t)&&n<=Math.max(a,t)&&(l=n===t?l.set(r,a):n>t?l.set(r,n-1):l.set(r,n+1))}),n.onChangeOrder(l)},n.renderMenu=function(e,t,a){var i=n.props.disallowEditShow,o=a.join("-"),l=g.c.Record({item:e,newPath:[].concat(Object(N.a)(a),[t]),onChangeField:n.onChangeField,renderTree:n.renderTree,subMenus:e.get("subMenus",g.c.List()),editShow:!0});return r.a.createElement(LE,{collection:o,index:t,key:e.get("id"),data:new l({editShow:!i.includes(e.get("id"))})})},n.renderTree=function(e,t,a){var i=g.c.Record({path:t,items:e,renderMenu:n.renderMenu});return r.a.createElement(UE,{lockAxis:"y",helperClass:"draggable-row",key:a,onSortEnd:n.onDragEnd,useDragHandle:!0,data:new i})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.data,e.data)}},{key:"render",value:function(){var e=this.props.data;return r.a.createElement("div",null,r.a.createElement(f.g,{md:6,className:"text-left"},"Main Menu"),r.a.createElement(f.g,{md:4,className:"text-right"},"Roles"),r.a.createElement(f.g,{md:2,className:"text-right"},"Show/Hide"),r.a.createElement(f.m,{bsClass:"wrapper",style:{paddingTop:35}},this.renderTree(e,[],"root")))}}]),t}(a.Component);VE.defaultProps={disallowEditShow:g.c.List(["settings","settings_general","input_processors","custom_fields"]),data:g.c.Map()};var BE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={currentItem:null,createNew:!1,index:-1},n.getItemIndex=function(e){return n.props.usageTypesData.indexOf(e)},n.onClickEdit=function(e){n.setState({currentItem:e,createNew:!1,index:n.getItemIndex(e)})},n.onCancel=function(){n.setState({currentItem:null,createNew:!1})},n.handleSave=function(){var e=n.state,t=e.index,a=e.currentItem;n.setState({currentItem:null,createNew:!1}),n.props.dispatch(yl("usage_types",t,a)),n.props.dispatch(Tl("usage_types")),n.props.dispatch(kl("usage_types"))},n.onUpdateItem=function(e,t){var a=n.state.currentItem,r=Array.isArray(e)?e:[e],i=Array.isArray(t)?t:[t];n.setState({currentItem:a.withMutations(function(e){r.forEach(function(t,n){return e.set(t,i[n])})})})},n.onClickNew=function(){var e=n.props.usageTypesData;n.setState({currentItem:g.c.Map(),createNew:!0,index:e.size})},n.renderList=function(){var e=n.props.usageTypesData,t=n.getListFields(),a=n.getListActions();return r.a.createElement(ju,{items:e,fields:t,actions:a})},n.getListFields=function(){return[{id:"usage_type",title:"Usage Type"},{id:"label",title:"Label"},{id:"property_type",title:"Property Type"},{id:"invoice_uom",title:"Invoice Unit of Measure"},{id:"input_uom",title:"Default Unit of Measure"}]},n.getListActions=function(){return[{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.onClickEdit}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(kl(["usage_types","property_types"]))}},{key:"render",value:function(){var e=this.props.propertyTypes,t=this.state,n=t.currentItem,a=t.createNew;return r.a.createElement("div",null,this.renderList(),r.a.createElement(ct,{onClick:this.onClickNew,label:"Add New"}),null!==n&&r.a.createElement(Pp,{item:n,propertyTypes:e,onUpdateItem:this.onUpdateItem,onSave:this.handleSave,onCancel:this.onCancel,selectUoms:!0,editBase:a}))}}]),t}(a.Component);BE.defaultProps={usageTypesData:g.c.List(),propertyTypes:g.c.List()};var qE=Object(l.connect)(function(e,t){return{usageTypesData:ha(e,t),propertyTypes:va(e,t)}})(BE),zE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onToggleClosedCycleChanges=function(e){var t=e.target.value;n.props.onChange("system","closed_cycle_changes",t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.data;return r.a.createElement("div",{className:"DateTime"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2}),r.a.createElement(f.g,{sm:6,style:{marginTop:10}},r.a.createElement(Tn,{fieldType:"checkbox",value:e.get("closed_cycle_changes",""),onChange:this.onToggleClosedCycleChanges,label:"Allow making changes to entities in closed billing cycles"})))))}}]),t}(a.Component);zE.defaultProps={data:g.c.Map()};var HE=zE,YE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={currencyOptions:[],changeCategories:g.c.Set()},n.initCurrencyOptions=function(e){if(e.status){var t=g.c.fromJS(e.data).map(function(e){return{label:"".concat(e.get("code","")," - ").concat(e.get("name","")," ").concat(e.get("symbol","")),value:e.get("code","")}}).toArray();n.setState({currencyOptions:t})}},n.onChangeFieldValue=function(e,t,a){n.setState(function(t){return{changeCategories:t.changeCategories.add(e)}}),n.props.dispatch(yl(e,t,a))},n.onChangeMenuOrder=function(e,t){var a=n.props.settings.getIn(["menu"].concat(Object(N.a)(e)),g.c.Map()).withMutations(function(e){t.forEach(function(t,n){if(e.has(n))e.setIn([n,"order"],t);else{var a=g.c.Map({order:t});e.set(n,a)}})});n.props.dispatch(yl("menu",e,a))},n.onSave=function(){var e=n.state.changeCategories;if(!e.isEmpty()){var t=e.toArray();n.props.dispatch(Tl(t)).then(function(e){n.afterSave(e,t)})}},n.afterSave=function(e,t){var a=n.props.settings;if(e&&(1===e.status||2===e.status)){var r=a.getIn(["menu","main"],g.c.Map());n.props.dispatch(Zs(r)),n.setState(function(){return{changeCategories:g.c.Set()}}),t.includes("tenant")&&a.getIn(["tenant","logo"],"").length>0&&(localStorage.removeItem("logo"),n.props.dispatch(Sl({filename:a.getIn(["tenant","logo"],"")},"logo")))}},n.handleSelectTab=function(e){var t=n.props.location,a=t.pathname,r=t.query;n.props.router.push({pathname:a,query:Object.assign({},r,{tab:e})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(kl(["pricing","billrun","tenant","shared_secret","menu","taxation","file_types","system","plugins","plays"])),this.props.dispatch(function(e){var t=S()(),n=JSON.parse(localStorage.getItem("currencies-options"));return n&&S()(n.time).add(60,"minutes").isAfter(t)?Promise.resolve(n.data):(e(jr()),ei({api:"currencies",params:[{simpleArray:!0}]}).then(function(n){var a=e(Wr(n));return localStorage.setItem("currencies-options",JSON.stringify({time:t,data:a})),a}).catch(function(t){return e(Jr(t,"Error retrieving currencies"))}))}).then(this.initCurrencyOptions),this.props.dispatch(eo("available_taxRates",bi("taxes",{key:1,description:1})))}},{key:"componentWillUnmount",value:function(){var e=this.state.changeCategories;e.isEmpty()||this.props.dispatch(kl(e.toArray())),this.props.dispatch(Xi("available_taxRates"))}},{key:"render",value:function(){var e=this.props,t=e.settings,n=e.activeTab,a=e.csiOptions,i=e.rasRatesOptions,o=e.taxation,l=e.system,s=e.plays,c=this.state.currencyOptions,u=t.getIn(["pricing","currency"],""),p=t.get("plugins",g.c.List()),d=t.get("billrun",g.c.Map()),m=t.get("shared_secret",g.c.List()),h=t.get("tenant",g.c.Map()),y=t.getIn(["menu","main"],g.c.Map()),b=ec(Xs(y),"root");return r.a.createElement("div",null,r.a.createElement(f.B,{activeKey:n,animation:!1,id:"SettingsTab",onSelect:this.handleSelectTab},r.a.createElement(f.z,{title:"Company",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(FE,{onChange:this.onChangeFieldValue,data:h}))),r.a.createElement(f.z,{title:"Locale",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Kb,{onChange:this.onChangeFieldValue,data:d}),r.a.createElement(Jb,{onChange:this.onChangeFieldValue,data:u,currencies:c}))),r.a.createElement(f.z,{title:"Tax",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(wE,{data:o,csiOptions:a,taxRateOptions:i,onChange:this.onChangeFieldValue}))),r.a.createElement(f.z,{title:"Menu",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(VE,{data:b,onChange:this.onChangeFieldValue,onChangeMenuOrder:this.onChangeMenuOrder}))),r.a.createElement(f.z,{title:"Security",eventKey:5},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(PE,{data:m}))),r.a.createElement(f.z,{title:"Invoicing",eventKey:6},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(Qb,{onChange:this.onChangeFieldValue,data:d}))),r.a.createElement(f.z,{title:"Plays",eventKey:7},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(OE,{data:s}))),r.a.createElement(f.z,{title:"Activity Types",eventKey:8},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(qE,null))),r.a.createElement(f.z,{title:"System",eventKey:9},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(HE,{onChange:this.onChangeFieldValue,data:l}))),r.a.createElement(f.z,{title:"Plugins",eventKey:10},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(gE,{onChange:this.onChangeFieldValue,data:p})))),r.a.createElement(v,{onClickSave:this.onSave,hideCancel:!0,hideSave:[5,7,8,10].includes(n)}))}}]),t}(a.Component);YE.defaultProps={activeTab:1,settings:g.c.Map(),csiOptions:g.c.List(),taxation:g.c.Map(),system:g.c.Map(),plays:g.c.List()};var GE=Object(s.f)(Object(l.connect)(function(e,t){return{activeTab:mo(e,t,"settings"),settings:e.settings,csiOptions:Yn(e,t),taxation:ea(e,t),system:aa(e,t),plays:ra(e,t),rasRatesOptions:e.list.get("available_taxRates")}})(YE)),KE=n(90),WE=n.n(KE),JE=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onChangeParam=function(){var e=n.props;(0,e.onChangeParam)(e.gateway.get("name"))},n.onChangeParamValue=function(e){var t=e.target,a=t.id,r=t.value,i=n.state.gateway;n.setState({gateway:Object.assign({},i,{params:Object.assign({},i.params,Object(ti.a)({},a,r))})})},n.onChangeTransactionsReceiverValue=function(e){var t=e.target,a=t.id,r=t.value,i=n.state,o=i.gateway,l=i.transactionsConnections,s=i.transactionsConnection;s[a]=r,l.length>0?l[0][a]=r:l.push(s),n.setState({transactionsConnection:s,gateway:Object.assign({},o,{transactions:Object.assign({},o.transactions,{receiver:{connections:l}})})})},n.onChangeDenialsReceiverValue=function(e){var t=e.target,a=t.id,r=t.value,i=n.state,o=i.gateway,l=i.denialsConnections,s=i.denialsConnection;s[a]=r,l.length>0?l[0][a]=r:l.push(s),n.setState({denialsConnection:s,gateway:Object.assign({},o,{denials:Object.assign({},o.denials,{receiver:{connections:l}})})})},n.onChangeExportValue=function(e){var t=e.target,a=t.id,r=t.value,i=n.state.gateway;n.setState({gateway:Object.assign({},i,{export:Object.assign({},i.export,Object(ti.a)({},a,r))})})},n.onSave=function(){var e=n.state.gateway;(0,n.props.onSave)(e)},n.onClose=function(){n.props.onClose(),n.setState({gateway:{params:{}}})},n.handleSelectTab=function(e){n.setState({activeTab:e})},n.renderTabsBody=function(){var e=n.props.settings,t=n.state,a=t.gateway,i=t.activeTab,o=void 0!==a.export?a.export:[],l=void 0!==a.transactions?a.transactions:{},s=void 0!==l.receiver?l.receiver:[],c=void 0!==s.connections?s.connections:[],u=void 0!==c[0]?c[0]:[],p=void 0!==a.denials?a.denials:{},d=void 0!==p.receiver?p.receiver:[],m=void 0!==d.connections?d.connections:[],g=void 0!==m[0]?m[0]:[],h=void 0!==e.get("secret_fields")?e.get("secret_fields"):[];return r.a.createElement(f.B,{activeKey:i,animation:!1,id:"PaymentGatewayTab",onSelect:n.handleSelectTab},r.a.createElement(f.z,{title:"API Parameters",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement("form",{className:"form-horizontal"},e.get("params").keySeq().map(function(e,t){return r.a.createElement("div",{className:"form-group",key:t},r.a.createElement("label",{className:"col-lg-3 control-label"},e),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{type:h.includes(e)?"password":"text",id:e,autoComplete:"new-password",onChange:n.onChangeParamValue,className:"form-control",value:a.params[e]})))})))),r.a.createElement(f.z,{title:"File Based Export",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement("form",{className:"form-horizontal"},e.get("export").keySeq().map(function(e,t){return r.a.createElement("div",{className:"form-group",key:t},r.a.createElement("label",{className:"col-lg-3 control-label"},e),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{type:"text",id:e,onChange:n.onChangeExportValue,className:"form-control",value:o[e]})))})))),r.a.createElement(f.z,{title:"Transactions Receiver",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement("form",{className:"form-horizontal"},e.get("receiver").keySeq().map(function(e,t){return r.a.createElement("div",{className:"form-group",key:t},r.a.createElement("label",{className:"col-lg-3 control-label"},e),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{type:"text",id:e,onChange:n.onChangeTransactionsReceiverValue,className:"form-control",value:u[e]})))})))),r.a.createElement(f.z,{title:"Denials receiver",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement("form",{className:"form-horizontal"},e.get("receiver").keySeq().map(function(e,t){return r.a.createElement("div",{className:"form-group",key:t},r.a.createElement("label",{className:"col-lg-3 control-label"},e),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{type:"text",id:e,onChange:n.onChangeDenialsReceiverValue,className:"form-control",value:g[e]})))})))))},n.renderSingularBody=function(){var e=n.props.settings,t=n.state.gateway,a=void 0!==e.get("secret_fields")?e.get("secret_fields"):[];return r.a.createElement("form",{className:"form-horizontal"},e.get("params").keySeq().map(function(e,i){return r.a.createElement("div",{className:"form-group",key:i}," ",r.a.createElement("label",{className:"col-lg-3 control-label"},e),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("input",{type:a.includes(e)?"password":"text",id:e,onChange:n.onChangeParamValue,autoComplete:"new-password",className:"form-control",value:t.params[e]})))}))},n.renderModalBody=function(){var e=n.props.settings;return!e.get("receiver").isEmpty()&&!e.get("export").isEmpty()?n.renderTabsBody():n.renderSingularBody()},n.state={gateway:{params:{},transactions:{},denials:{},export:{}},transactionsConnections:[],denialsConnections:[],activeTab:1,transactionsConnection:{},denialsConnection:{}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.gateway,n=e.settings;if(t){var a=void 0===t.getIn(["transactions","receiver","connections",0])?{}:t.getIn(["transactions","receiver","connections",0]).toJS(),r=void 0===t.getIn(["denials","receiver","connections",0])?{}:t.getIn(["denials","receiver","connections",0]).toJS();return this.setState({transactionsConnection:a,denialsConnection:r,gateway:t.toJS()})}return this.setState({gateway:{name:n.get("name"),params:{}}})}},{key:"render",value:function(){var e=this.props,t=e.settings,n=e.show,a=void 0!==n&&n;return r.a.createElement(WE.a,{show:a,onHide:this.onClose,bsSize:"large"},r.a.createElement(WE.a.Header,{closeButton:!0},r.a.createElement(WE.a.Title,null,t.get("name")," parameters")),r.a.createElement(WE.a.Body,null,this.renderModalBody()),r.a.createElement(WE.a.Footer,null,r.a.createElement("button",{type:"button",className:"btn btn-default",onClick:this.onClose},"Cancel"),r.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.onSave},"Save")))}}]),t}(a.Component),$E=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(){var e=n.props,t=e.enabled,a=e.onClickEnable,r=e.onClickDisable;return t?r():a()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.enabled!==e.enabled}},{key:"render",value:function(){var e=this.props.enabled,t=e?"Disable":"Enable",n=e?"btn btn-danger":"btn btn-success";return r.a.createElement("button",{type:"button",className:n,onClick:this.onClick},t)}}]),t}(a.Component),QE=Object(l.connect)()(function(e){return r.a.createElement(f.r,{show:e.show,onHide:e.onClose},r.a.createElement(f.r.Header,{closeButton:!0},r.a.createElement(f.r.Title,null,"Unsupported")),r.a.createElement(f.r.Body,null,e.gateway," is not yet supported, but will be added soon!"),r.a.createElement(f.r.Footer,null,r.a.createElement("button",{type:"button",className:"btn btn-default",onClick:e.onClose},"Close")))}),ZE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showParamsModal:!1,showUnsupported:!1},n.onShowParams=function(){n.props.settings.get("supported",!1)?n.setState({showParamsModal:!0}):n.setState({showUnsupported:!0})},n.onCloseParams=function(){n.setState({showParamsModal:!1,showUnsupported:!1})},n.onSaveParams=function(e){var t=n.props;(0,t.onSaveParams)(e,void 0!==t.enabled),n.onCloseParams()},n.onClickEnable=function(){n.onShowParams()},n.onClickDisable=function(){var e=n.props,t=e.onDisable,a=e.settings;window.confirm("Are you sure you want to disable this payment gateway?")&&t(a.get("name"))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.settings,n=e.enabled,a=this.state,i=a.showParamsModal,o=a.showUnsupported,l={};return n||(l.WebkitFilter=l.filter="grayscale(100%)"),r.a.createElement("div",{className:"PaymentGateway"},t.get("supported",!1)?r.a.createElement(JE,{settings:t,show:i,gateway:n,onSave:this.onSaveParams,onClose:this.onCloseParams}):r.a.createElement(QE,{show:o,onClose:this.onCloseParams,gateway:t.get("name")}),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-8 col-md-8"},t.get("image_url")?r.a.createElement("img",{src:"".concat(ee(["env","serverApiUrl"],""),"/").concat(t.get("image_url")),alt:"Logo",style:l,width:"200",height:"51"}):t.get("name")),r.a.createElement("div",{className:"col-lg-4 col-md-4"},r.a.createElement("div",{className:"pull-right"},r.a.createElement("button",{onClick:this.onShowParams,type:"button",className:"btn btn-default btn-lg",disabled:!n},r.a.createElement("i",{className:"fa fa-gear"}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-12 col-md-12"},r.a.createElement("div",{className:"pull-right"},r.a.createElement($E,{enabled:n,onClickEnable:this.onClickEnable,onClickDisable:this.onClickDisable})))),r.a.createElement("div",{className:"separator"}))}}]),t}(a.Component),XE=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSaveGatewayParams=function(e,t){ei(gi(e)).then(function(a){n.props.dispatch(Ur("Payment gateway enabled!")),t?n.props.dispatch(vl(e)):n.props.dispatch(fl(e))},function(e){n.props.dispatch(Br("Error saving payment gateway"))}).catch(function(e){n.props.dispatch(Br("Network error - please try again"))})},n.onDisableGateway=function(e){ei(fi(e)).then(function(t){n.props.dispatch(Ur("Payment gateway disabled!")),n.props.dispatch(hl(e))},function(e){console.log("failed!",e),n.props.dispatch(Br("Error saving payment gateway"))}).catch(function(e){console.log(e),n.props.dispatch(Br("Network error - please try again"))})},n.renderPaymentGateways=function(){var e=n.props,t=e.supported_gateways,a=e.payment_gateways;return t.map(function(e,t){var i=a.find(function(t){return t.get("name")===e.get("name")});return r.a.createElement("div",{className:"col-lg-4 col-md-4",key:t},r.a.createElement(ZE,{enabled:i,settings:e,onDisable:n.onDisableGateway,onSaveParams:n.onSaveGatewayParams}))})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(kl("payment_gateways"));this.props.dispatch(eo("supported_gateways",{api:"paymentgateways",action:"list"}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},"Available payment gateways"),r.a.createElement("div",{className:"panel-body"},r.a.createElement("form",{className:"form-horizontal"},this.renderPaymentGateways())))}}]),t}(a.Component);XE.defaultProps={payment_gateways:g.c.List(),supported_gateways:g.c.List()};var eC=Object(l.connect)(function(e){return{payment_gateways:e.settings.get("payment_gateways")||void 0,supported_gateways:e.list.get("supported_gateways")||void 0}})(XE),tC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showConfirmDelete:!1,itemToDelete:null,confirmDeleteMessage:"",refreshString:""},n.getActions=function(){return[{type:"edit"},{type:"remove",showIcon:!0,onClick:n.onAskDelete,helpText:"Remove"}]},n.getFields=function(){return[{id:"username",placeholder:"User Name",sort:!0},{id:"roles",placeholder:"Roles",parser:n.parseRoles}]},n.getProjectFields=function(){return{username:1,roles:1}},n.onAskDelete=function(e){n.setState({showConfirmDelete:!0,itemToDelete:e,confirmDeleteMessage:'Are you sure you want to delete "'.concat(e.get("username",""),'" user ?')})},n.onDeleteClose=function(){n.setState({showConfirmDelete:!1,itemToDelete:null,confirmDeleteMessage:""})},n.onDeleteOk=function(){var e=n.state.itemToDelete;n.props.dispatch(rc(e)).then(n.afterDelete)},n.afterDelete=function(e){n.onDeleteClose(),e.status&&(n.setState({refreshString:S()().format()}),n.props.dispatch(Ur("User was deleted")))},n.parseRoles=function(e){return e.get("roles").join(", ")},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.showConfirmDelete,n=e.confirmDeleteMessage,a=e.refreshString,i=this.getFields(),o=this.getActions(),l=this.getProjectFields();return r.a.createElement("div",null,r.a.createElement(Tp,{api:"get",itemType:"user",itemsType:"users",filterFields:i,tableFields:i,projectFields:l,actions:o,refreshString:a}),r.a.createElement(lt,{onOk:this.onDeleteOk,onCancel:this.onDeleteClose,show:t,message:n,labelOk:"Yes"}))}}]),t}(a.Component),nC=Object(l.connect)()(tC),aC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={enableChangePassword:"create"===n.props.action,password:"",password1:"",errors:{password:"",password1:""}},n.initDefaultValues=function(){n.props.onUpdateValue("roles",["read"])},n.onPasswordChange=function(e){var t=n.state.errors,a=e.target.value.trim(),r="";0===a.length&&(r="Password is required"),n.props.onUpdateValue("password",""),n.setState({errors:Object.assign({},t,{password:r}),password:a,password1:""})},n.onPassword1Change=function(e){var t=n.state,a=t.errors,r=t.password,i=e.target.value.trim(),o="";0===i.length&&(o="Please fill confirm password"),i!==r&&(o="Passwords do not match"),0===o.length?n.props.onUpdateValue("password",i):n.props.onUpdateValue("password",""),n.setState({errors:Object.assign({},a,{password1:o}),password1:i})},n.onUserNameChange=function(e){var t=e.target.value;n.props.onUpdateValue("username",t)},n.onChangeRoles=function(e){var t=e.length>0?e.split(","):[];n.props.onUpdateValue("roles",t)},n.onChangeRole=function(e){n.props.onUpdateValue("role",e)},n.onEnableChangePassword=function(e){var t=n.state.errors,a=e.target.checked;a?(n.props.onUpdateValue("password",""),n.setState({enableChangePassword:a})):(n.props.onDeleteValue("password"),n.setState({enableChangePassword:a,errors:Object.assign({},t,{password1:"",password:""}),password:"",password1:""}))},n.renderChangePassword=function(){var e=n.props.action,t=n.state,a=t.password,i=t.password1,o=t.enableChangePassword,l=t.errors,s=l.password.length>0||l.password1.length>0;return r.a.createElement("span",null,"create"!==e&&r.a.createElement(f.l,{validationState:s?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"\xa0"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("label",{htmlFor:"enable-change-password"},r.a.createElement("input",{id:"enable-change-password",type:"checkbox",checked:o,onChange:n.onEnableChangePassword,style:{verticalAlign:"text-bottom"}}),"\xa0Enable Password Change"))),r.a.createElement(f.l,{validationState:s?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Password"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("input",{onChange:n.onPasswordChange,value:a,className:"form-control",id:"password",type:"password",disabled:!o}),l.password.length>0&&r.a.createElement(f.n,null,l.password))),r.a.createElement(f.l,{validationState:l.password1.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Confirm Password"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement("input",{onChange:n.onPassword1Change,value:i,className:"form-control",id:"password1",type:"password",disabled:!o}),l.password1.length>0&&r.a.createElement(f.n,null,l.password1))))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){"create"===this.props.action?this.initDefaultValues():this.props.onDeleteValue("password")}},{key:"render",value:function(){var e=this.props,t=e.user,n=e.availableRoles.map(function(e){return{value:e,label:Object(D.titleCase)(e)}});return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"User Name (email)"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{onChange:this.onUserNameChange,value:t.get("username","")}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Roles"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:t.get("roles",[]).join(","),options:n,onChange:this.onChangeRoles,placeholder:"Add role..."}))),this.renderChangePassword())))}}]),t}(a.Component);aC.defaultProps={user:g.c.Map(),availableRoles:["admin","read","write","reports"],action:"create"};var rC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={username:""},n.onBack=function(){n.props.router.push("/users")},n.onSave=function(){var e=n.props,t=e.item,a=e.mode;n.validate()&&n.props.dispatch(ac(t,a)).then(n.afterSave)},n.afterSave=function(e){var t=n.props.mode;if(e.status){n.props.dispatch(up("users"));var a="create"===t?"created":"updated";n.props.dispatch(Ur("User was ".concat(a))),n.onBack()}},n.onUpdateValue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n.props.dispatch(ic(e,t))},n.onDeleteValue=function(e){n.props.dispatch(oc(e))},n.validate=function(){var e=n.props,t=e.item;return"create"===e.mode?0===t.get("username","").length?(n.props.dispatch(Br("User name field is required")),!1):0===t.get("password","").length?(n.props.dispatch(Br("Password field is required")),!1):0!==t.get("roles").length||(n.props.dispatch(Br("Roles field is required")),!1):t.has("username")&&0===t.get("username","").length?(n.props.dispatch(Br("User name field is required")),!1):t.has("password")&&0===t.get("password","").length?(n.props.dispatch(Br("Password field is required")),!1):!t.has("roles")||0!==t.get("roles").length||(n.props.dispatch(Br("Roles field is required")),!1)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.itemId,n=e.mode;t&&this.props.dispatch(nc(t)),"create"===n?this.props.dispatch(bs("Create New User")):this.props.dispatch(bs("Edit user"))}},{key:"componentWillReceiveProps",value:function(e){var t=this.state.username,n=e.item,a=e.mode;""===t&&this.setState({username:n.get("username","")}),"update"===a&&""!==t&&this.props.dispatch(bs("Edit user - ".concat(t)))}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:Bl,collection:"users"})}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.mode;return"update"===n&&"undefined"===typeof t.getIn(["_id","$id"])?r.a.createElement(_,{onClick:this.onBack}):r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,null,r.a.createElement(aC,{action:n,user:t,onUpdateValue:this.onUpdateValue,onDeleteValue:this.onDeleteValue})),r.a.createElement(v,{onClickSave:this.onSave,onClickCancel:this.onBack}))}}]),t}(a.Component);rC.defaultProps={user:g.c.Map()};var iC=Object(s.f)(Object(l.connect)(function(e,t){var n=t.params.itemId;return{mode:t.location.query.action||(n?"update":"create"),item:e.entity.get("users",g.c.Map()),itemId:n}})(rC)),oC=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).onSelectFormat=function(e){var t=e.target.value;n.setState({format:t})},n.onSelectType=function(e){var t=e.target.value;n.setState({type:t})},n.onCheck=function(e){var t=e.target.value;n.setState({selected:t})},n.onSelectTemplate=function(e){var t=e.target.value;n.setState({template:t})},n.handleCancel=function(){n.context.router.push({pathname:"input_processors"})},n.buildQuery=function(){var e=n.state,t=e.type,a=e.format,r=e.selected,i=e.template;return"api"===t?{action:"new",type:t,format:a}:"predefined"===r?{action:"new",template:i}:{action:"new"}},n.handleNext=function(){var e=n.state,t=e.selected,a=e.type;""===t&&"api"!==a?n.props.dispatch(Br("Please choose one option")):n.context.router.push({pathname:"input_processor",query:n.buildQuery()})},n.state={type:"api",selected:"",format:"json",template:Object.keys(Hy)[0]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.selected,n=e.template,a=Object.keys(Hy).map(function(e,t){return r.a.createElement("option",{value:e,key:t},e)});return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},r.a.createElement("span",null,"Create new input processor")),r.a.createElement("div",{className:"panel-body"},r.a.createElement("form",{className:"form-horizontal"},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3 col-md-4"},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"select-type",value:"api",checked:"api"===this.state.type,onChange:this.onSelectType})," API-based"))),r.a.createElement("div",{className:"form-group",style:{marginLeft:15}},r.a.createElement("div",{className:"col-lg-3"},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"format",value:"json",disabled:"api"!==this.state.type,checked:"json"===this.state.format||"api"===this.state.type,onChange:this.onSelectFormat})," I will manually configure a JSON API"))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-lg-3 col-md-4"},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"select-type",value:"file",checked:"file"===this.state.type,onChange:this.onSelectType})," File-based"))),r.a.createElement("div",{className:"form-group",style:{marginLeft:15}},r.a.createElement("div",{className:"col-lg-3 col-md-4"},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"select-template",value:"predefined",disabled:"file"!==this.state.type,checked:"predefined"===this.state.selected,onChange:this.onCheck})," I will use predefined input processor")),r.a.createElement("div",{className:"col-lg-7 col-md-7"},r.a.createElement("select",{className:"form-control",value:n,onChange:this.onSelectTemplate,disabled:"predefined"!==t||"file"!==this.state.type},a))),r.a.createElement("div",{className:"form-group",style:{marginLeft:15}},r.a.createElement("div",{className:"col-lg-3 col-md-4"},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"select-template",value:"manual",disabled:"file"!==this.state.type,checked:"manual"===this.state.selected,onChange:this.onCheck})," I will configure a custom input processor"))),r.a.createElement("div",{style:{marginTop:12,float:"right"}},r.a.createElement("button",{className:"btn btn-default",type:"button",onClick:this.handleCancel,style:{marginRight:12}},"Cancel"),r.a.createElement("button",{className:"btn btn-primary",type:"button",onClick:this.handleNext},"Next")))))))}}]),t}(a.Component);oC.contextTypes={router:Vu.a.object.isRequired};var lC=function(e){return function(t,n){var a=Da(n()).findIndex(function(t){return t.get("id","")===e.get("id","")});return-1!==a&&t(function(e){return{type:dl,category:"collection",name:["steps",e]}}(a))}},sC=function(e,t,n){return function(a,r){var i=Da(r()).findIndex(function(t){return t.get("id","")===e.get("id","")});return-1!==i&&a(function(e,t,n){return{type:ll,category:"collection",name:["steps",e].concat(Object(N.a)(Ye(t))),value:n}}(i,t,n))}},cC=function(e){return function(t,n){return e.has("id")?-1!==Da(n()).findIndex(function(t){return t.get("id","")===e.get("id","")})&&t(sC(e,[],e)):t((a=e.set("id",Zt.a.v4()),{type:ml,category:"collection",path:"steps",value:a}));var a}},uC=function(){return Tl(["collection.steps"])},pC=function(){return kl(["collection.steps"])},dC=function(){return Tl(["collection.settings"])},mC=function(e,t){return{type:ll,category:"collection",name:["settings"].concat(Object(N.a)(Ye(e))),value:t}},gC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeMinDeb=function(e){var t=e.target.value;n.props.dispatch(mC("min_debt",t))},n.onChangeChangeStateUrl=function(e){var t=e.target.value;n.props.dispatch(mC("change_state_url",t))},n.onChangeChangeStateMethod=function(e){n.props.dispatch(mC("change_state_method",e))},n.onSave=function(){n.props.dispatch(dC())},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(kl(["collection.settings"]))}},{key:"render",value:function(){var e=this.props,t=e.settings,n=e.httpMethods,a=t.get("min_debt",""),i=t.get("change_state_url",""),o=t.get("change_state_method",""),l=n.map(fe).toArray();return r.a.createElement("div",null,r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{header:"General settings"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Minimum debt"),r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{value:a,onChange:this.onChangeMinDeb,fieldType:"number"}))))),r.a.createElement(f.v,{header:r.a.createElement("h4",null,"Collection State Change",r.a.createElement("br",null),r.a.createElement("small",null,"HTTP requests will be triggered to this URL when a customer enters / exits from collection"))},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"URL"),r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{value:i,onChange:this.onChangeChangeStateUrl}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"HTTP Method"),r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{fieldType:"select",options:l,onChange:this.onChangeChangeStateMethod,value:o,clearable:!1})))))),r.a.createElement(f.g,{sm:12},r.a.createElement(v,{onClickSave:this.onSave,hideCancel:!0})))}}]),t}(a.Component);gC.defaultProps={settings:g.c.Map(),httpMethods:ee(["collections","http","mthods"],g.c.List())};var fC=Object(l.connect)(function(e,t){return{settings:Aa(e,t)}})(gC),hC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSaveCollectionsSteps=function(){n.props.dispatch(uC()).then(n.afterSaveCollectionsSteps)},n.afterSaveCollectionsSteps=function(){n.props.dispatch(pC())},n.onRemoveOk=function(e){n.props.dispatch(lC(e))},n.onToggleOk=function(e,t){var a="enable"===t;n.props.dispatch(sC(e,["active"],a))},n.onClickRemove=function(e){var t={message:'Are you sure you want to delete "'.concat(e.get("name"),'" step?'),onOk:function(){return n.onRemoveOk(e)},type:"delete",labelOk:"Delete"};n.props.dispatch(ks(t))},n.onClickToggle=function(e,t){var a="disable"===t?"disable":"enable",r={message:"Are you sure you want to ".concat(a,' "').concat(e.get("name"),'" step?'),onOk:function(){return n.onToggleOk(e,t)},type:"enable"===t?"confirm":"delete",labelOk:Object(D.titleCase)(a)};n.props.dispatch(ks(r))},n.parserStatus=function(e){return r.a.createElement(I,{status:e.get("active",!1)?"active":"expired"})},n.parserType=function(e){return r.a.createElement("span",null,r.a.createElement("i",{className:"fa ".concat(ee(["collections","step_types",e.get("type",""),"icon"],"fa-circle-o"))}),"\xa0",ee(["collections","step_types",e.get("type",""),"label"],""))},n.parserTriger=function(e){return"Within ".concat(e.get("do_after_days","")," days")},n.parseShowEnable=function(e){return!e.get("active",!0)},n.parseShowDisable=function(e){return!n.parseShowEnable(e)},n.getListFields=function(){return[{id:"active",title:"Status",parser:n.parserStatus,cssClass:"state"},{id:"do_after_days",title:"Trigger after",parser:n.parserTriger},{id:"name",title:"Step Name"},{id:"type",title:"Type",parser:n.parserType}]},n.getListActions=function(){return[{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.props.onClickEdit},{type:"enable",showIcon:!0,helpText:"Enable",onClick:n.onClickToggle,show:n.parseShowEnable},{type:"disable",showIcon:!0,helpText:"Disable",onClick:n.onClickToggle,show:n.parseShowDisable},{type:"clone",showIcon:!0,helpText:"Clone",onClick:n.props.onClickClone},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.onClickRemove}]},n.renderPanelHeader=function(){var e=ee(["collections","step_types"],g.c.Map()).filter(function(e){return e.get("enable",!1)}).map(function(e,t){return{type:"add",actionStyle:"primary",actionSize:"xsmall",label:"Add new ".concat(ee(["collections","step_types",t,"label"],"")," step"),onClick:n.props.onAddStep(t)}}).toList().toArray();return r.a.createElement("div",null,"\xa0",r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:e})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(pC())}},{key:"render",value:function(){var e=this.props.items,t=this.getListFields(),n=this.getListActions();return r.a.createElement("div",null,r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{header:this.renderPanelHeader()},r.a.createElement(ju,{items:e,fields:t,actions:n}))),r.a.createElement(f.g,{sm:12},r.a.createElement(v,{onClickSave:this.onSaveCollectionsSteps,hideCancel:!0})))}}]),t}(a.Component);hC.defaultProps={items:g.c.List()};var vC=Object(l.connect)(function(e,t){return{items:La(e,t)}})(hC),yC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeDays=function(e){var t=e.target.value;n.props.onChange(["do_after_days"],t)},n.onChangeName=function(e){var t=e.target.value;n.props.onChange(["name"],t)},n.onChangeActive=function(e){var t=e.target.value;n.props.onChange(["active"],"yes"===t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.errors;return r.a.createElement("div",null,r.a.createElement(f.l,{validationState:n.has("name")?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Title",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{onChange:this.onChangeName,value:t.get("name","")}),n.has("name")&&r.a.createElement(f.n,null,n.get("name","")))),r.a.createElement(f.l,{validationState:n.has("do_after_days")?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Trigger after",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:4},r.a.createElement(f.o,null,r.a.createElement(Tn,{onChange:this.onChangeDays,value:t.get("do_after_days",""),fieldType:"number",min:"1",style:{minWidth:50}}),r.a.createElement(f.o.Addon,null,"Days")),r.a.createElement(f.n,{className:"mb0"},"Days since entering debt collection process"),n.has("do_after_days")&&r.a.createElement(f.n,null,n.get("do_after_days","")))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Status"),r.a.createElement(f.g,{sm:4},r.a.createElement("span",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"yes",label:"Active",checked:t.get("active",!0)})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"no",label:"Not Active",checked:!t.get("active",!0)}))))))}}]),t}(a.Component);yC.defaultProps={item:g.c.Map(),errors:g.c.Map()};var bC=yC,EC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeSubject=function(e){var t=e.target.value;n.props.onChange(["subject"],t)},n.onChangeBody=function(e){n.props.onChange(["body"],e)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props,a=n.content,r=n.templateToken;return!g.c.is(a,e.content)||!g.c.is(r,e.templateToken)}},{key:"render",value:function(){var e=this.props,t=e.content,n=e.templateToken,a=e.editor;return r.a.createElement("div",null,r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Subject"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{onChange:this.onChangeSubject,value:t.get("subject","")}))),r.a.createElement("div",null,r.a.createElement(Tn,{fieldType:"textEditor",value:t.get("body"),editorName:"editor",fields:n.toArray(),onChange:this.onChangeBody,configName:a})))}}]),t}(a.Component);EC.defaultProps={content:g.c.Map(),templateToken:g.c.List(),editor:"mails"};var CC=Object(l.connect)(function(e,t){return{templateToken:Pa(e,t,["general","account","collection"])}})(EC),_C=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeMethod=function(e){n.props.onChange(["method"],e)},n.onChangeDcoder=function(e){n.props.onChange(["decoder"],e)},n.onChangeUrl=function(e){var t=e.target.value;n.props.onChange(["url"],t)},n.onChangeCustomParameter=function(e){return function(t){n.props.onChange(["custom_parameter",e],t)}},n.onAddCustomParameter=function(e){n.props.content.hasIn(["custom_parameter",e])?n.props.dispatch(Vr("Custom Parameter ".concat(e," already exists"))):n.props.onChange(["custom_parameter",e],"")},n.onRemoveCustomParameter=function(e){return function(){var t=n.props.content;if(t.hasIn(["custom_parameter",e])){var a=t.get("custom_parameter",g.c.Map()).filter(function(t,n){return n!==e});n.props.onChange(["custom_parameter"],a)}else n.props.dispatch(Vr("Custom Parameter ".concat(e," does not exist")))}},n.renderCustomParameters=function(){var e=n.props,t=e.content,a=e.errors;return t.get("custom_parameter",g.c.Map()).map(function(e,t){return r.a.createElement(f.l,{validationState:a.has(t)?"error":null,key:"custom_parameter_".concat(t)},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},t),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(jn,{key:"custom_parameter_".concat(t),onChange:n.onChangeCustomParameter(t),onAction:n.onRemoveCustomParameter(t),actionType:"remove",value:e}),a.has(t)&&r.a.createElement(f.n,null,a.get(t,""))))}).toList().toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props.content;return!g.c.is(n,e.content)}},{key:"render",value:function(){var e=this.props,t=e.content,n=e.httpMethods,a=e.httpDecoders,i=e.errors,o=n.map(fe).toArray(),l=a.map(fe).toArray();return r.a.createElement("div",null,r.a.createElement(f.l,{validationState:i.has("url")?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"URL",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{onChange:this.onChangeUrl,value:t.get("url","")}),i.has("url")&&r.a.createElement(f.n,null,i.get("url","")))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"HTTP Method"),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{fieldType:"select",options:o,onChange:this.onChangeMethod,value:t.get("method",""),clearable:!1}))),r.a.createElement(f.l,{validationState:i.has("decoder")?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Decoder"),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{fieldType:"select",options:l,onChange:this.onChangeDcoder,value:t.get("decoder",""),clearable:!1}),i.has("decoder")&&r.a.createElement(f.n,null,i.get("decoder","")))),this.renderCustomParameters(),r.a.createElement("hr",null),r.a.createElement(f.l,{validationState:i.has("decoder")?"error":null},r.a.createElement(f.g,{sm:3,lg:2},"\xa0"),r.a.createElement(f.g,{componentClass:f.h,sm:8,lg:9},r.a.createElement(jn,{onAction:this.onAddCustomParameter,actionLabel:"Add custom parameter",clearAfterAction:!0}))))}}]),t}(a.Component);_C.defaultProps={content:g.c.Map(),errors:g.c.Map(),httpMethods:ee(["collections","http","mthods"],g.c.List()),httpDecoders:ee(["collections","http","decoders"],g.c.List())};var OC=Object(l.connect)(null)(_C),SC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeContent=function(e,t){n.props.onChange(["content"].concat(Object(N.a)(e)),t)},n.renderStepByType=function(e){var t=e.get("content");switch(e.get("type","")){case"mail":return r.a.createElement(CC,{content:t,onChange:n.onChangeContent,editor:"mails"});case"sms":return r.a.createElement(CC,{content:t,onChange:n.onChangeContent,editor:"sms"});case"http":return r.a.createElement(OC,{content:t,onChange:n.onChangeContent});default:return r.a.createElement("p",null)}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.errors;return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(bC,{item:t,onChange:this.props.onChange,errors:n}),r.a.createElement("hr",null),this.renderStepByType(t))))}}]),t}(a.Component);SC.defaultProps={item:g.c.Map(),errors:g.c.Map()};var TC=SC,kC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={editedItem:null,editedItemName:"",errors:g.c.Map()},n.onCloseEditStep=function(){n.setState(function(){return{editedItem:null,editedItemName:"",errors:g.c.Map()}})},n.onChangeEditStep=function(e,t){n.setState(function(n){return{editedItem:n.editedItem.setIn(e,t),errors:n.errors.deleteIn(e)}})},n.onAddStep=function(e){return function(){var t=ee(["collections","default_new_step_status"],!1);n.setState(function(){return{editedItem:g.c.Map({type:e,active:t})}})}},n.onSaveEditStep=function(){var e=n.state.editedItem;n.validateStep(e)||(n.props.dispatch(cC(e)),n.onCloseEditStep())},n.onClickEdit=function(e){n.setState(function(){return{editedItem:e,editedItemName:e.get("name",""),errors:g.c.Map()}})},n.onClickClone=function(e){n.onClickEdit(e.delete("id")),n.setState(function(){return{editedItemName:""}})},n.validateStep=function(e){var t=!1;return["",null].includes(e.get("name",""))&&(n.setState(function(e){return{errors:e.errors.setIn(["name"],"Title field is required")}}),t=!0),["",null].includes(e.get("do_after_days",""))&&(n.setState(function(e){return{errors:e.errors.setIn(["do_after_days"],"Trigger after field is required")}}),t=!0),t},n.renderEventForm=function(){var e=n.state,t=e.editedItem,a=e.editedItemName,i=e.errors;if(null===t)return null;var o=""!==a?'Edit "'.concat(a,'" step'):r.a.createElement("span",null,"Create ",ee(["collections","step_types",t.get("type",""),"label"],"")," Step");return r.a.createElement(it,{title:o,show:!0,onOk:n.onSaveEditStep,onCancel:n.onCloseEditStep,labelOk:"Save",modalSize:"large"},r.a.createElement(TC,{item:t,onChange:n.onChangeEditStep,errors:i}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(kl("template_token"))}},{key:"render",value:function(){var e=this.props.location;return r.a.createElement("div",null,r.a.createElement(No,{id:"CollectionsTab",location:e},r.a.createElement(f.z,{title:"Steps",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(vC,{onAddStep:this.onAddStep,onClickEdit:this.onClickEdit,onClickClone:this.onClickClone}))),r.a.createElement(f.z,{title:"Settings",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(fC,null)))),this.renderEventForm())}}]),t}(a.Component);kC.defaultProps={};var jC=Object(l.connect)(null)(kC),IC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).loadTemplate=function(e){var t=n.props.name;n.props.loadTemplate(t,e)},n.onChange=function(e){var t=n.props.name;n.props.onChange(t,e)},n.onChangeStatus=function(e){var t=e.target.value,a=n.props.name;n.props.onChangeStatus(a,t)},n.renderPanelHeader=function(){var e=n.props,t=e.name,a=e.templates,i=e.enabled;return r.a.createElement("span",null,"Invoice ".concat(t),r.a.createElement("div",{className:"pull-right"},a.length>0&&r.a.createElement(f.e,{className:"inline",style:{verticalAlign:"middle"}},r.a.createElement(f.i,{bsSize:"xsmall",title:"Load default",id:"dropdown-size-medium",onSelect:n.loadTemplate},a.map(function(e,t){return r.a.createElement(f.q,{key:t,eventKey:t},e)}))),r.a.createElement("div",{className:"inline",style:{marginLeft:a.length?10:0}},r.a.createElement(Tn,{fieldType:"checkbox",value:i,onChange:n.onChangeStatus,label:"Enable"}))))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.content,a=e.fields;return r.a.createElement(f.v,{header:this.renderPanelHeader()},r.a.createElement(Tn,{fieldType:"textEditor",value:n,editorName:"editor-".concat(t),name:t,configName:"invoices",editorHeight:150,fields:a,onChange:this.onChange}))}}]),t}(a.PureComponent);IC.defaultProps={content:"",fields:[],templates:[],enabled:!1,loadTemplate:function(){},onChangeStatus:function(){}};var wC=IC,NC=Object(Nn.a)(function(e,t){return e.get(t,g.c.List())},function(e){return e.map(function(e){return e.get("label","Template")}).toArray()}),FC=Object(Nn.a)(function(e){return e},function(e){return"undefined"!==typeof e?e.toArray():void 0}),xC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).loadTemplate=function(e,t){var a=n.props.templates.getIn([e,t,"content"]);n.props.onChange(e,a)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.getData()}},{key:"render",value:function(){var e=this.props,t=e.header,n=e.footer,a=e.suggestions,i=e.templates,o=e.status,l=FC(a),s=NC(i,"header"),c=NC(i,"footer"),u=o.get("header",!1),p=o.get("footer",!1);return r.a.createElement("div",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(f.j,{horizontal:!0},null!==t&&r.a.createElement(wC,{name:"header",content:t,onChange:this.props.onChange,fields:l,templates:s,loadTemplate:this.loadTemplate,enabled:u,onChangeStatus:this.props.onChangeStatus}),null!==n&&r.a.createElement(wC,{name:"footer",content:n,onChange:this.props.onChange,fields:l,templates:c,loadTemplate:this.loadTemplate,enabled:p,onChangeStatus:this.props.onChangeStatus})))),r.a.createElement(v,{onClickSave:this.props.onSave,cancelLabel:"Rollback",onClickCancel:this.props.onCancel}))}}]),t}(a.Component);xC.defaultProps={header:"",footer:"",suggestions:g.c.List(),templates:g.c.Map(),status:g.c.Map(),onChange:function(){},onSave:function(){},onCancel:function(){},getData:function(){},onChangeStatus:function(){}};var RC=xC,MC=Object(l.connect)(function(e,t){return{header:Va(e,t),footer:Ba(e,t),suggestions:qa(e),templates:za(e),status:Ha(e)}},function(e){return{getData:function(){e(kl("invoice_export"))},onChange:function(t,n){e(yl("invoice_export",t,n))},onChangeStatus:function(t,n){e(yl("invoice_export",["status",t],n))},onSave:function(){e(Tl("invoice_export")).then(function(t){t&&1===t.status&&e(kl("invoice_export"))})},onCancel:function(){var t={message:"Are you sure you want to discard editing Invoice Template?",onOk:function(){e(kl("invoice_export"))},labelOk:"Discard",type:"delete"};e(ks(t))}}})(RC),PC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).isDataReady=function(){var e=n.props,t=e.fields,a=e.emailTemplates;return!(!t||!a)},n.onSave=function(){n.props.dispatch(Tl("email_templates")).then(function(e){e&&1===e.status&&n.props.dispatch(kl("email_templates"))})},n.onCancel=function(){n.props.dispatch(kl("email_templates"))},n.onChangeContent=function(e){var t=n.props.name;n.props.dispatch(yl("email_templates",[t,"content"],e))},n.onChangeSubject=function(e){var t=e.target.value,a=n.props.name;n.props.dispatch(yl("email_templates",[a,"subject"],t))},n.getContent=function(){var e=n.props,t=e.name;return e.emailTemplates.getIn([t,"content"],"")},n.getSubject=function(){var e=n.props,t=e.name;return e.emailTemplates.getIn([t,"subject"],"")},n.getFields=function(){var e=n.props,t=e.name,a=e.fields,r=e.emailTemplates.getIn([t,"html_translation"],g.c.List());return[].concat(Object(N.a)(a.toArray()),Object(N.a)(r.toArray()))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(kl(["email_templates","subscribers"]))}},{key:"render",value:function(){var e=this.props.name;return this.isDataReady()?r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:1},"Subject"),r.a.createElement(f.g,{sm:8},r.a.createElement(Tn,{onChange:this.onChangeSubject,value:this.getSubject()}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},r.a.createElement(Tn,{fieldType:"textEditor",value:this.getContent(),editorName:"editor-".concat(e),name:e,configName:"invoices",editorHeight:150,fields:this.getFields(),onChange:this.onChangeContent}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},r.a.createElement(v,{onClickSave:this.onSave,cancelLabel:"Rollback",onClickCancel:this.onCancel})))):r.a.createElement(_,null)}}]),t}(a.Component);PC.defaultProps={name:"",fields:null,emailTemplates:null};var AC=Object(l.connect)(function(e,t){return{emailTemplates:Ga(e,t)}})(PC),DC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getFields=function(){return n.props.accountFields.map(function(e){return"customer_".concat(e)})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(kl(["subscribers"]))}},{key:"render",value:function(){return r.a.createElement(AC,{name:"invoice_ready",fields:this.getFields()})}}]),t}(a.Component);DC.defaultProps={accountFields:g.c.List()};var LC=Object(l.connect)(function(e,t){return{accountFields:Ea(e,t)}})(DC),UC=function(e){var t=e.location;return r.a.createElement("div",null,r.a.createElement(No,{id:"EmailTemplatesTab",location:t},r.a.createElement(f.z,{title:"Invoice ready",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(LC,null)))))},VC=function(){return r.a.createElement(Tp,{collection:"plans",itemType:"prepaid_plan",itemsType:"prepaid_plans",filterFields:[{id:"description",placeholder:"Title"},{id:"name",placeholder:"Key"}],baseFilter:{connection_type:{$regex:"^prepaid$"},type:{$regex:"^customer$"}},tableFields:[{id:"description",title:"Title",sort:!0},{id:"name",title:"Key",sort:!0},{id:"code",title:"Code",sort:!0}],projectFields:{description:1,name:1,code:1},showRevisionBy:"key",actions:[{type:"edit"}]})},BC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:{name:""}},n.onChangeName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=ee("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.onChangePlanField(["name"],r)},n.onChangeDescription=function(e){var t=e.target.value;n.props.onChangePlanField(["description"],t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,e.item)||this.props.mode!==e.mode}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.item,a=t.mode,i="view"!==a;return r.a.createElement("div",{className:"PrepaidPlanDetails"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Title",r.a.createElement(Ao,{contents:Do.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.get("description",""),onChange:this.onChangeDescription,editable:i}))),["clone","create"].includes(a)&&r.a.createElement(f.l,{validationState:e.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Key",r.a.createElement(Ao,{contents:Do.name})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.get("name",""),onChange:this.onChangeName,editable:i}),e.name.length>0&&r.a.createElement(f.n,null,e.name)))))}}]),t}(a.Component);BC.defaultProps={errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var qC=Object(l.connect)()(function(e){var t=e.notification,n=e.first,a=e.last,i=e.index,o=e.editable,l=e.unitLabel,s=function(t){var n=t.target,a=n.id,r=n.value;e.onUpdateField(i,a,r)};return r.a.createElement("div",{className:"Notification"},r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:2,md:2,sm:2},r.a.createElement(f.l,{style:{margin:0}},n&&r.a.createElement(f.h,null,l),r.a.createElement(Tn,{id:"value",value:t.get("value",""),onChange:s,fieldType:"number",editable:o}))),r.a.createElement(f.g,{lg:2,md:2,sm:2},r.a.createElement(f.l,{style:{margin:0}},n&&r.a.createElement(f.h,null,"Type"),r.a.createElement(Tn,{id:"type",value:t.get("type",""),onChange:s,editable:o}))),r.a.createElement(f.g,{lg:6,md:6,sm:6},r.a.createElement(f.l,{style:{margin:0}},n&&r.a.createElement(f.h,null,"Message"),r.a.createElement(Tn,{id:"msg",value:t.get("msg",""),onChange:s,editable:o}))),r.a.createElement(f.g,{lg:1,md:1,sm:1,className:"text-right"},!n&&a&&o&&r.a.createElement(f.c,{bsSize:"small",className:"pull-right",onClick:function(){e.onRemove(i)}},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove")),!a&&r.a.createElement(f.g,{lg:12,md:12,sm:12,xs:12},r.a.createElement("hr",{style:{marginTop:8,marginBottom:8}}))))}),zC=Object(l.connect)()(function(e){var t=function(t){e.onRemove(e.pp_id,t)},n=function(t,n,a){e.onUpdateField(e.pp_id,t,n,a)},a=r.a.createElement("h3",null,e.name,e.editable&&r.a.createElement(f.c,{onClick:function(){e.onRemoveBalance(e.pp_id)},bsSize:"xsmall",className:"pull-right",style:{minWidth:80}},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}),"\xa0Remove"));return r.a.createElement("div",{className:"Notifications"},r.a.createElement(f.v,{header:a},e.notifications.map(function(a,i){var o=0===i,l=i===e.notifications.size-1;return r.a.createElement(qC,{editable:e.editable,notification:a,first:o,last:l,onRemove:t,onUpdateField:n,index:i,key:i,unitLabel:e.unitLabel})}),r.a.createElement("br",null),e.editable&&r.a.createElement(ct,{onClick:function(){e.onAdd(e.pp_id)},label:"Add New"})))}),HC=function(e){var t=e.plan,n=e.ppIncludes,a=e.mode,i=e.usageTypesData,o=e.propertyTypes,l=e.currency,s="view"!==a,c=function(t){e.onAddNotification(t)},u=function(t,n){e.onRemoveNotification(t,n)},p=function(t,n,a,r){e.onUpdateNotificationField(t,n,a,r)},d=function(t){e.onRemoveBalanceNotifications(t)},m=n.map(function(e){return{value:e.get("external_id"),label:e.get("name")}}).toJS();return r.a.createElement("div",{className:"PlanNotifications"},r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,null,s&&r.a.createElement(f.v,{header:r.a.createElement("h4",null,"Select prepaid bucket")},r.a.createElement(Tn,{fieldType:"select",placeholder:"Select",options:m,onChange:function(t){e.onSelectBalance(t.toString())},value:""})),s&&r.a.createElement("hr",null),t.get("notifications_threshold",Object(g.b)()).keySeq().filter(function(e){return"on_load"!==e}).map(function(e,a){var m=t.getIn(["notifications_threshold",e],Object(g.a)()),f=function(e){return n.find(function(t){return t.get("external_id","")===parseInt(e)})||Object(g.b)()}(e),h=f.get("name",""),v=f.get("charging_by_usaget_unit",!1),y=f.get("charging_by_usaget",""),b=v?"Volume (".concat(je(o,i,y,v),")"):"Cost (".concat(vd()(l),")");return m.size?r.a.createElement(zC,{editable:s,notifications:m,onAdd:c,onRemove:u,onUpdateField:p,onRemoveBalance:d,name:h,pp_id:e,key:a,unitLabel:b}):null})))))};HC.defaultProps={plan:Object(g.b)(),ppIncludes:Object(g.a)(),mode:"create",usageTypesData:Object(g.a)(),propertyTypes:Object(g.a)(),currency:""};var YC=Object(l.connect)()(HC),GC=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={options:[]},n.loadOptions=function(){return ei(Oi({key:1,description:1})).then(function(e){var t=Object(N.a)(new Set(e.data[0].data.details.map(function(e){return e.key}))).map(function(e){return{value:e,label:e}});n.setState({options:t})}).catch(function(){n.setState({options:[]})})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.loadOptions()}},{key:"render",value:function(){var e=this.props,t=e.plan,n=e.mode,a=this.state.options,i="view"!==n,o=t.get("disallowed_rates",g.c.List()).join(",");return r.a.createElement("div",{className:"BlockedProducts"},r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Blocked products")},r.a.createElement(Tn,{fieldType:"select",value:o,options:a,onChange:this.props.onChangeBlockProduct,multi:!0,disabled:!i,placeholder:"Add product...",noResultsText:"No products found.",searchPromptText:"Type product key to search"})))}}]),t}(a.Component);GC.defaultProps={plan:g.c.Map(),mode:"create",onChangeBlockProduct:function(){}};var KC=GC,WC=function(e){var t=e.name,n=e.unitLabel,a=e.ppId,i=e.value,o=e.editable,l=[{type:"remove",showIcon:!0,onClick:function(){e.onRemove(a)}}];return r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2},"".concat(t," (").concat(n,")")),r.a.createElement(f.g,{md:7},r.a.createElement(Tn,{fieldType:"number",onChange:function(t){e.onChange(a,t.target.value)},value:i,editable:o})),r.a.createElement(f.g,{md:2},r.a.createElement(vt,{actions:l})))};WC.defaultProps={name:"",unitLabel:"",value:"",ppId:"",editable:!0};var JC=Object(l.connect)()(WC),$C=function(e){var t=e.plan,n=e.ppIncludes,a=e.mode,i=e.propertyTypes,o=e.usageTypesData,l=e.currency,s=e.onAddBalance,c=e.onChangeThreshold,u=e.onRemoveThreshold,p="view"!==a,d=n.map(function(e){return{value:e.get("external_id").toString(),label:e.get("name")}}).toJS(),m=t.get("pp_threshold",Object(g.b)());return r.a.createElement("div",{className:"Thresholds"},r.a.createElement(f.j,{horizontal:!0},p&&r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Select prepaid bucket")},r.a.createElement(Tn,{fieldType:"select",placeholder:"Select",options:d,onChange:s,value:""})),p&&r.a.createElement("hr",null),r.a.createElement(f.v,null,m.isEmpty()&&r.a.createElement("p",null,"No charging limits"),!m.isEmpty()&&m.keySeq().filter(function(e){return"on_load"!==e}).map(function(e,a){var s=function(e){return n.find(function(t){return t.get("external_id","")===parseInt(e)})||Object(g.b)()}(e),d=s.get("name",""),m=s.get("charging_by_usaget_unit",!1),f=s.get("charging_by_usaget",""),h=m?je(i,o,f,m):vd()(l);return r.a.createElement(JC,{key:a,editable:p,name:d,ppId:e,value:t.getIn(["pp_threshold",e],0),onChange:c,onRemove:u,unitLabel:h})}))))};$C.defaultProps={plan:Object(g.b)(),ppIncludes:Object(g.a)(),currency:"",usageTypesData:Object(g.a)(),propertyTypes:Object(g.a)(),mode:"create"};var QC=$C,ZC="ADD_NOTIFICATION",XC="REMOVE_NOTIFICATION",e_="UPDATE_NOTIFICATION_FIELD",t_="ADD_BALANCE_NOTIFICATIONS",n_="REMOVE_BALANCE_NOTIFICATIONS",a_="BLOCK_PRODUCT",r_="ADD_BALANCE_THRESHOLD",i_="CHANGE_BALANCE_THRESHOLD",o_="REMOVE_BALANCE_THRESHOLD";var l_=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab)},n.initDefaultValues=function(){var e=n.props.mode;if("create"===e){var t=S()().add(1,"days").toISOString();n.props.dispatch(yh(["from"],t)),n.props.dispatch(yh(["connection_type"],"prepaid")),n.props.dispatch(yh(["charging_type"],"prepaid")),n.props.dispatch(yh(["type"],"customer")),n.props.dispatch(Ch()),n.props.dispatch(yh(["price",0,"price"],0)),n.props.dispatch(yh(["upfront"],!0)),n.props.dispatch(yh(["recurrence"],g.c.Map({unit:1,periodicity:"month"}))),n.props.dispatch(yh(["tax"],g.c.Map({service_code:" ",product_code:" ",safe_harbor_override_pct:" "})))}"clone"===e&&(n.props.dispatch(Oh()),n.handleSelectTab(1))},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&ue(t,!1)){var a=t.get("name","");n.props.dispatch(dp("plans","name",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(wh(e,!0)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("name","");n.props.dispatch(sp("plans",e))},n.clearItemsList=function(){n.props.dispatch(up("prepaid_plans"))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onChangePlanField=function(e,t){n.props.dispatch(yh(e,t))},n.onSelectBalance=function(e){var t=n.props,a=t.item,r=t.dispatch;a.getIn(["notifications_threshold",e],g.c.List()).size?r(Vr("There are already notifications for selected prepaid bucket")):r({type:t_,balance:e})},n.onAddNotification=function(e){n.props.dispatch(function(e){return{type:ZC,thresholdId:e}}(e))},n.onRemoveNotification=function(e,t){n.props.dispatch(function(e,t){return{type:XC,thresholdId:e,index:t}}(e,t))},n.onUpdateNotificationField=function(e,t,a,r){n.props.dispatch(function(e,t,n,a){return{type:e_,thresholdId:e,index:t,field:n,value:a}}(e,t,a,r))},n.onRemoveBalanceNotifications=function(e){n.props.dispatch(function(e){return{type:n_,balanceId:e}}(e))},n.onChangeBlockProduct=function(e){var t,a=e.length?e.split(","):[];n.props.dispatch((t=g.c.List(a),{type:a_,rates:t}))},n.onChangeThreshold=function(e,t){n.props.dispatch(function(e,t){return{type:i_,balanceId:e,value:t}}(e,t))},n.onRemoveThreshold=function(e){n.props.dispatch(function(e){return{type:o_,balanceId:e}}(e))},n.onAddBalanceThreshold=function(e){var t=n.props,a=t.item,r=t.dispatch;a.getIn(["pp_threshold",e])?r(Vr("Prepaid bucket already defined")):r(function(e){return{type:r_,balanceId:e}}(e))},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.props.dispatch(jh(t,a)).then(n.afterSave)},n.afterSave=function(e){var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Ur("The plan was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&n.clearItemsList();var t=ee(["systemItems","prepaid_plan","itemsType"],"");n.props.router.push("/".concat(t))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(eo("pp_includes",_i())),this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if(["clone","create"].includes(e)){var t=se(e,"prepaid_plan");this.props.dispatch(bs(t))}this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=e.ppIncludes,i=this.props,o=i.item,l=i.itemId,s=i.mode,c=i.ppIncludes;if(n!==s||ue(t)!==ue(o)){var u=se(n,"prepaid_plan",t);this.props.dispatch(bs(u))}(a!==l||n!==s&&"clone"===n||!g.c.is(r,c))&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"PLAN_CLEAR"})}},{key:"render",value:function(){var e=this.state.activeTab,t=this.props,n=t.item,a=t.mode,i=t.ppIncludes,o=t.revisions,l=t.propertyTypes,s=t.usageTypesData,c=t.currency;if("loading"===a)return r.a.createElement(_,{onClick:this.handleBack});var u="view"!==a,p=n.get("rates",g.c.Map());return r.a.createElement("div",{className:"PrepaidPlan"},r.a.createElement(f.v,null,r.a.createElement(Sd,{itemName:"prepaid_plan",revisions:o,item:n,mode:a,onChangeFrom:this.onChangePlanField,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.B,{activeKey:e,animation:!1,id:"PrepaidPlan",onSelect:this.handleSelectTab},r.a.createElement(f.z,{title:"Details",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(BC,{item:n,mode:a,onChangePlanField:this.onChangePlanField}))),r.a.createElement(f.z,{title:"Override Product Price",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(lh,{itemName:"plan",mode:a,planRates:p,onChangeFieldValue:this.onChangePlanField}))),r.a.createElement(f.z,{title:"Notifications",eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(YC,{plan:n,mode:a,ppIncludes:i,propertyTypes:l,usageTypesData:s,currency:c,onAddNotification:this.onAddNotification,onRemoveNotification:this.onRemoveNotification,onUpdateNotificationField:this.onUpdateNotificationField,onSelectBalance:this.onSelectBalance,onRemoveBalanceNotifications:this.onRemoveBalanceNotifications}))),r.a.createElement(f.z,{title:"Blocked Products",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(KC,{plan:n,mode:a,onChangeBlockProduct:this.onChangeBlockProduct}))),r.a.createElement(f.z,{title:"Charging Limits",eventKey:5},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(QC,{plan:n,mode:a,ppIncludes:i,propertyTypes:l,usageTypesData:s,currency:c,onChangeThreshold:this.onChangeThreshold,onRemoveThreshold:this.onRemoveThreshold,onAddBalance:this.onAddBalanceThreshold})))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave,hideSave:!u,cancelLabel:u?void 0:"Back"}))}}]),t}(a.Component);l_.defaultProps={item:g.c.Map(),revisions:g.c.List(),ppIncludes:g.c.List(),activeTab:1,currency:"",usageTypesData:g.c.List(),propertyTypes:g.c.List()};var s_=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,"plan"),item:bo(e,t,"plan"),mode:Co(e,t,"plan"),activeTab:mo(e,t,"plan"),revisions:po(e,t,"plan"),ppIncludes:e.list.get("pp_includes"),usageTypesData:ha(e,t),propertyTypes:va(e,t),currency:pa(e,t)}})(l_)),c_=function(e){var t=e.item,n=Object(a.useState)(!1),i=Object(w.a)(n,2),o=i[0],l=i[1],s=function(){l(!1)};return r.a.createElement("div",null,""!==t.get("details","")&&r.a.createElement("p",null,t.get("details","")),["login"].includes(t.get("type",""))&&r.a.createElement("p",null,"IP: ",t.get("ip","")),!["login"].includes(t.get("type",""))&&r.a.createElement("p",null,function(e){switch(e){case"closeandnew":return"New revision";case"update":return"Updated";case"delete":return"Deleted";case"create":return"Created";case"close":return"Closed";case"move":return"Moved";case"permanentchange":return"Updated";case"reopen":return"Reopened";default:return""}}(t.get("type","")),"\xa0",r.a.createElement(f.c,{bsStyle:"link",onClick:function(){l(!0)},style:{verticalAlign:"bottom"}},r.a.createElement("i",{className:"fa fa-compress"}),"\xa0",t.get("new",null)&&t.get("old",null)?"Compare":"Details"),function(){var e=t.get("new",null),n=t.get("old",null),a=g.c.Map.isMap(e)?e.delete("_id").toJS():"",i=g.c.Map.isMap(n)?n.delete("_id").toJS():"";return r.a.createElement(E,{show:o,onClose:s,inputNew:a,inputOld:i})}()))};c_.defaultProps={item:g.c.Map()};var u_=c_,p_=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={fields:{},page:0,size:10,sort:g.c.Map({urt:-1}),filter:{}},n.onSort=function(e){var t=g.c.Map(e);n.setState({sort:t},n.fetchItems)},n.onFilter=function(e){n.setState({filter:e,page:0},n.fetchItems)},n.fetchItems=function(){n.props.dispatch(eo("audit",n.buildQuery()))},n.fetchUser=function(){var e=ki();n.props.dispatch(eo("autocompleteUser",e))},n.handlePageClick=function(e){n.setState({page:e},n.fetchItems)},n.buildQuery=function(){var e=n.state,t=e.fields,a=e.size,r=e.page,i=e.sort,o=e.filter,l=Object.assign({},o);return l.source="audit",l.urt&&(l.urt=n.urtQueryBuilder(l.urt)),isNaN(l.key)?l.key&&(l.key={$regex:l.key,$options:"i"}):l.key={$in:[l.key,Number(l.key)]},Ri(l,r,t,i,a)},n.userParser=function(e){return e.getIn(["user","name"],"")},n.collectionParser=function(e){var t=n.props.auditTrailEntityTypes,a=e.get("collection","");return t.find(function(e){return e.key===a},null,{val:a}).val},n.keyParser=function(e){return"login"===e.get("type","")?e.get("key","").split("login_")[1]:e.get("key","")},n.detailsParser=function(e){return r.a.createElement(u_,{item:e})},n.urtQueryBuilder=function(e){return{$gte:S()(e).startOf("day"),$lt:S()(e).add(1,"days")}},n.getFilterFields=function(){var e=n.props;return[{id:"urt",title:"Date",type:"date"},{id:"user.name",title:"User",type:"select",options:e.userNames},{id:"collection",title:"Entity Type",type:"select",options:e.auditTrailEntityTypes},{id:"key",title:"Entity Key"}]},n.getTableFields=function(){return[{id:"urt",title:"Date",type:"datetime",cssClass:"long-date",sort:!0},{id:"user.name",title:"User",parser:n.userParser,sort:!0},{id:"collection",title:"Module Type",parser:n.collectionParser,sort:!0},{id:"key",title:"Module Key",parser:n.keyParser,sort:!0},{title:"Details",parser:n.detailsParser}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.fetchUser()}},{key:"componentWillReceiveProps",value:function(e){g.c.is(this.props.userNames,e.userNames)||this.fetchItems()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Xi("audit")),this.props.dispatch(Xi("autocompleteUser"))}},{key:"render",value:function(){var e=this.props.items,t=this.state.sort,n=this.getFilterFields(),a=this.getTableFields();return r.a.createElement("div",{className:"Audit-Trail"},r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:r.a.createElement(Rm,{fields:n,onFilter:this.onFilter})},r.a.createElement(ju,{items:e,fields:a,edit:!1,sort:t,onSort:this.onSort})))),r.a.createElement(Pm,{onClick:this.handlePageClick,size:this.state.size,count:e.size}))}}]),t}(a.Component);p_.defaultProps={items:g.c.List(),userNames:g.c.List(),auditTrailEntityTypes:g.c.List()};var d_=Object(l.connect)(function(e){return{items:Er(e),userNames:Cr(e),auditTrailEntityTypes:_r(e)}})(p_),m_=function(){return Kl("prepaid_include","prepaid_include")},g_=function(e,t){return $l("prepaidincludes",e,t)},f_=function(e){return es("prepaidincludes",e)},h_=function(e,t){return zl("prepaid_include",e,t)},v_=function(e){return function(t){t(jr());var n=function(e){return yi("prepaidincludes",e)}(e);return ei(n).then(function(e){var n=e.data[0].data.details[0];return n.originalValue=n.from,t(Yl("prepaid_include",n)),t(Wr(e))}).catch(function(e){return t(Jr(e,"Error retrieving prepaid bucket"))})}},y_=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showConfirmRemove:!1,prepaidIncludes:null,refreshString:""},n.fields=[{id:"name",sort:!0},{id:"charging_by",showFilter:!1},{id:"charging_by_usaget",showFilter:!1},{id:"priority",showFilter:!1,sort:!0}],n.projectFields={charging_by_usaget:1,charging_by:1,priority:1,name:1},n.onClickRemoveItem=function(e){n.setState({showConfirmRemove:!0,prepaidIncludes:e})},n.onClickRemoveCancel=function(){n.setState({showConfirmRemove:!1,prepaidIncludes:null})},n.onClickRemoveOk=function(){var e=n.state.prepaidIncludes;n.setState({showConfirmRemove:!1,prepaidIncludes:null}),n.props.dispatch(f_(e)).then(function(e){e.status&&n.setState({refreshString:S()().format()})})},n.actions=[{type:"edit"},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.onClickRemoveItem,show:!0}],n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.showConfirmRemove,n=e.prepaidIncludes,a=e.refreshString,i=n?"Are you sure you want to remove ".concat(n.get("name",""),"?"):"";return r.a.createElement("div",{className:"prepaid-includes-list"},r.a.createElement(Tp,{collection:"prepaidincludes",itemType:"prepaid_include",itemsType:"prepaid_includes",filterFields:this.fields,tableFields:this.fields,projectFields:this.projectFields,showRevisionBy:"name",actions:this.actions,refreshString:a}),r.a.createElement(lt,{onOk:this.onClickRemoveOk,onCancel:this.onClickRemoveCancel,show:t,message:i,labelOk:"Yes"}))}}]),t}(a.Component),b_=Object(l.connect)()(y_),E_=function(e){var t=e.prepaidInclude,n=e.chargingByOptions,a=e.mode,i=function t(n){return function(a){if("charging_by"===n){var r="total_cost"===a?"total_cost":"";t("charging_by_usaget")(r),"usagev"!==a&&t("charging_by_usaget_unit")("")}e.onChangeField({target:{id:n,value:a}})}},o={marginTop:10},l="view"!==a;return r.a.createElement("div",{className:"PrepaidInclude"},r.a.createElement(f.v,null,r.a.createElement(f.j,{horizontal:!0},["clone","create"].includes(a)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Name"),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{id:"name",value:t.get("name",""),onChange:e.onChangeField,editable:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"External ID"),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{id:"external_id",value:t.get("external_id",""),onChange:e.onChangeField,fieldType:"number",editable:"create"===a}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Priority"),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{id:"priority",value:t.get("priority",""),onChange:e.onChangeField,tooltip:"Lower number represents higher priority",fieldType:"number",editable:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Charging by"),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{fieldType:"select",value:t.get("charging_by",""),options:n,onChange:i("charging_by"),editable:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Usage type"),r.a.createElement(f.g,{lg:7,md:7},"total_cost"===t.get("charging_by")?r.a.createElement(Tn,{fieldType:"select",disabled:!0,value:"All",editable:l}):l?r.a.createElement(Dp,{usaget:t.get("charging_by_usaget",""),unit:t.get("charging_by_usaget_unit",""),onChangeUsaget:i("charging_by_usaget"),onChangeUnit:i("charging_by_usaget_unit"),showUnits:"usagev"===t.get("charging_by","")}):r.a.createElement("div",{className:"non-editable-field"},t.get("charging_by_usaget","")))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Shared bucket"),r.a.createElement(f.g,{lg:7,md:7,style:o},r.a.createElement(Tn,{id:"shared",value:t.get("shared",!1),onChange:e.onChangeField,fieldType:"checkbox",editable:l}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Unlimited"),r.a.createElement(f.g,{lg:7,md:7,style:o},r.a.createElement(Tn,{id:"unlimited",value:t.get("unlimited",!1),onChange:e.onChangeField,fieldType:"checkbox",editable:l}))))))};E_.defaultProps={prepaidInclude:Object(g.b)(),chargingByOptions:[],mode:"create"};var C_=Object(l.connect)()(E_),__=function(e){var t=e.name,n=e.rates,a=e.allRates,i=e.onChange,o=e.onRemove,l=e.editable,s=[{type:"remove",showIcon:!0,onClick:function(){o(t)}}];return r.a.createElement("div",{className:"LimitedDestination"},r.a.createElement(f.v,{header:r.a.createElement("div",null,t,r.a.createElement("div",{className:"pull-right",style:{marginTop:-5}},r.a.createElement(vt,{actions:s})))},r.a.createElement(Tn,{fieldType:"select",multi:!0,value:n.join(","),options:a,onChange:function(e){i(t,Object(g.a)(e.split(",")))},editable:l})))};__.defaultProps={name:"",rates:Object(g.a)(),allRates:[],actions:[],editable:!0};var O_=__,S_=function(e){var t=e.limitedDestinations,n=e.allRates,a="view"!==e.mode,i=t.keySeq().toArray();return r.a.createElement("div",{className:"LimitedDestinations"},a&&r.a.createElement(f.v,null,r.a.createElement(io,{onSelectPlan:e.onSelectPlan,selectedOptions:i,planType:"prepaid"})),t.keySeq().filter(function(e){return"BASE"!==e}).map(function(i,o){return r.a.createElement(O_,{editable:a,key:o,rates:t.get(i,Object(g.a)()),onChange:e.onChange,onRemove:e.onRemove,allRates:n,name:i})}))};S_.defaultProps={limitedDestinations:Object(g.b)(),allRates:[],mode:"create"};var T_=Object(l.connect)()(S_),k_=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab)},n.initDefaultValues=function(){var e=n.props,t=e.mode,a=e.item;if("create"===t){var r=S()().add(1,"days").toISOString();n.onChangeFieldValue(["from"],r),n.onChangeFieldValue(["shared"],!1),n.onChangeFieldValue(["unlimited"],!1)}"clone"===t&&(n.props.dispatch(m_()),n.handleSelectTab(1));var i=a.get("allowed_in",g.c.Map());g.c.Map.isMap(i)||n.onChangeFieldValue(["allowed_in"],g.c.Map())},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&ue(t,!1)){var a=t.get("name","");n.props.dispatch(dp("prepaidincludes","name",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(v_(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("name","");n.props.dispatch(sp("prepaidincludes",e))},n.clearItemsList=function(){var e=ee(["systemItems","prepaid_include","itemsType"],"");n.props.dispatch(up(e))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onChangeFieldValue=function(e,t){n.props.dispatch(h_(e,t))},n.onChangeField=function(e){var t=e.target,a=t.id,r=t.value;n.onChangeFieldValue(a,r)},n.onChangeLimitedDestinations=function(e,t){n.onChangeFieldValue(["allowed_in",e],t)},n.onRemoveLimitedDestinations=function(e){var t=n.props.item.get("allowed_in",g.c.Map());n.onChangeFieldValue(["allowed_in"],t.remove(e))},n.onSelectPlan=function(e){var t=n.props,a=t.item,r=t.dispatch;a.getIn(["allowed_in",e])?r(Br("Plan already exists")):n.onChangeFieldValue(["allowed_in",e],g.c.List())},n.afterSave=function(e){var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Ur("The prepaid bucket was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.validatePrepaidBucket=function(){return n.props.item.get("allowed_in",g.c.Map()).every(function(e){return e.first()})},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.validatePrepaidBucket()?n.props.dispatch(g_(t,a)).then(n.afterSave):n.props.dispatch(Br("Associate Products - cannot have plan without products in it"))},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=ee(["systemItems","prepaid_include","itemsType"],"");e&&n.clearItemsList(),n.props.router.push("/".concat(t))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if("create"===e){var t=se(e,"prepaid_include");this.props.dispatch(bs(t))}this.props.dispatch(eo("all_rates",Oi())),this.props.dispatch(kl("usage_types")),this.initDefaultValues()}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=this.props,i=r.item,o=r.itemId,l=r.mode;if(n!==l||ue(t)!==ue(i)){var s=se(n,"prepaid_include",t);this.props.dispatch(bs(s))}(a!==o||n!==l&&"clone"===n)&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Wl("prepaid_include"))}},{key:"render",value:function(){var e=this.state.activeTab,t=this.props,n=t.item,a=t.mode,i=t.allRates,o=t.revisions;if("loading"===a)return r.a.createElement(_,{onClick:this.handleBack});var l=i.map(function(e){return{value:e.get("key"),label:e.get("key")}}).toArray(),s=n.get("allowed_in",g.c.Map());return g.c.Map.isMap(s)||(s=g.c.Map()),r.a.createElement("div",{className:"PrepaidIncludeSetup"},r.a.createElement(f.v,null,r.a.createElement(Sd,{itemName:"prepaid_include",revisions:o,item:n,mode:a,onChangeFrom:this.onChangeFieldValue,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.B,{activeKey:e,id:"PrepaidInclude",animation:!1,onSelect:this.handleSelectTab},r.a.createElement(f.z,{title:"Details",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(C_,{mode:a,prepaidInclude:n,chargingByOptions:[{value:"usagev",label:"Usage volume"},{value:"cost",label:"Cost"},{value:"total_cost",label:"Total cost"}],onChangeField:this.onChangeField,onChangeSelectField:this.onChangeSelectField}))),r.a.createElement(f.z,{title:"Associate Products",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(T_,{mode:a,limitedDestinations:s,allRates:l,onSelectPlan:this.onSelectPlan,onChange:this.onChangeLimitedDestinations,onRemove:this.onRemoveLimitedDestinations})))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave}))}}]),t}(a.Component);k_.defaultProps={item:g.c.Map(),revisions:g.c.List(),allRates:g.c.List(),activeTab:1};var j_=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,"prepaid_include"),item:bo(e,t,"prepaid_include"),mode:Co(e,t,"prepaid_include"),activeTab:mo(e,t,"prepaid_include"),revisions:po(e,t,"prepaid_include"),allRates:e.list.get("all_rates")}})(k_)),I_=function(){return r.a.createElement(Tp,{collection:"prepaidgroups",itemType:"charging_plan",itemsType:"charging_plans",filterFields:[{id:"description",placeholder:"Title"},{id:"name",placeholder:"Key"}],tableFields:[{id:"description",title:"Title",sort:!0},{id:"name",title:"Key",sort:!0},{id:"operation",title:"Operation",sort:!0},{id:"charging_value",title:"Charging value",sort:!0}],projectFields:{charging_value:1,description:1,operation:1,name:1},showRevisionBy:"name",actions:[{type:"edit"}]})},w_=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:{name:""}},n.onChangeName=function(e){var t=n.props.errorMessages.name.allowedCharacters,a=n.state.errors,r=e.target.value.toUpperCase(),i=ee("keyUppercaseRegex",/./).test(r)?"":t;n.setState({errors:Object.assign({},a,{name:i})}),n.props.onChangeField(["name"],r)},n.onChangeDescription=function(e){var t=e.target.value;n.props.onChangeField(["description"],t)},n.onChangeOperation=function(e){n.props.onChangeField(["operation"],e)},n.onChangeChargingValue=function(e){var t=e.target.value;n.props.onChangeField(["charging_value"],t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!g.c.is(this.props.item,e.item)||this.props.mode!==e.mode}},{key:"render",value:function(){var e=this.state.errors,t=this.props,n=t.item,a=t.mode,i="view"!==a;return r.a.createElement("div",{className:"PrepaidPlanDetails"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Title",r.a.createElement(Ao,{contents:Do.description})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.get("description",""),onChange:this.onChangeDescription,editable:i}))),["clone","create"].includes(a)&&r.a.createElement(f.l,{validationState:e.name.length>0?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Key",r.a.createElement(Ao,{contents:Do.name})),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{value:n.get("name",""),onChange:this.onChangeName,editable:i}),e.name.length>0&&r.a.createElement(f.n,null,e.name))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Operation"),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{fieldType:"select",options:[{value:"new",label:"New"},{value:"inc",label:"Increment"},{value:"set",label:"Set"}],value:n.get("operation",""),onChange:this.onChangeOperation}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Charging value"),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{value:n.get("charging_value",0),fieldType:"number",onChange:this.onChangeChargingValue,editable:i})))))}}]),t}(a.Component);w_.defaultProps={errorMessages:{name:{allowedCharacters:"Key contains illegal characters, key should contain only alphabets, numbers and underscores (A-Z, 0-9, _)"}}};var N_=function(e){var t=e.include,n=e.index,a=e.editable,i=[{type:"remove",showIcon:!0,onClick:function(){e.onRemove(n)}}],o=r.a.createElement("div",null,t.get("pp_includes_name",""),r.a.createElement("div",{className:"pull-right",style:{marginTop:-5}},r.a.createElement(vt,{actions:i})));return r.a.createElement("div",{className:"ChargingPlanInclude"},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:o},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2}," Operation "),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{fieldType:"select",options:[{value:"default",label:"Default"},{value:"new",label:"New"},{value:"inc",label:"Increment"},{value:"set",label:"Set"}],value:t.get("operation",""),onChange:function(t){e.onUpdateField(n,"operation",t)},editable:a}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2},t.get("unit_label","Value")),r.a.createElement(f.g,{md:9},r.a.createElement(Tn,{id:"usagev",value:t.get("usagev",0),onChange:function(t){var a=t.target,r=a.id,i=a.value;e.onUpdateField(n,r,i)},fieldType:"number",editable:e.editable}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,md:2}," Duration "),r.a.createElement(f.g,{md:9},r.a.createElement(f.g,{md:6,style:{paddingLeft:0}},r.a.createElement(Tn,{fieldType:"number",id:"duration",value:t.getIn(["period","duration"],0),onChange:function(t){var a=t.target,r=a.id,i=a.value;e.onUpdatePeriodField(n,r,i)},editable:e.editable}),!a&&r.a.createElement("div",{className:"non-editable-field"},t.getIn(["period","unit"],""))),r.a.createElement(f.g,{md:6},r.a.createElement(Tn,{fieldType:"select",options:[{value:"days",label:"Days"},{value:"months",label:"Months"}],value:t.getIn(["period","unit"],""),onChange:function(t){e.onUpdatePeriodField(n,"unit",t)},editable:a})))))))};N_.defaultProps={include:Object(g.b)(),index:0,editable:!0};var F_=Object(l.connect)()(N_),x_=function(e){var t=e.includes,n=e.mode,a=e.prepaidIncludesOptions,i=e.onSelectPPInclude,o=e.onUpdateField,l=e.onUpdatePeriodField,s=e.onRemoveChargingPlan,c="view"!==n;return r.a.createElement("div",{className:"ChargingPlanIncludes"},c&&r.a.createElement(f.v,{header:r.a.createElement("h3",null,"Select prepaid bucket")},r.a.createElement(Tn,{fieldType:"select",value:"",options:a,onChange:i})),c&&r.a.createElement("hr",null),t.keySeq().filter(function(e){return!["cost","groups"].includes(e)}).map(function(e,n){return r.a.createElement(F_,{key:n,editable:c,include:t.get(e),onUpdateField:o,onUpdatePeriodField:l,onRemove:s,index:e})}))};x_.defaultProps={includes:Object(g.a)(),prepaidIncludesOptions:[],mode:"create"};var R_=x_,M_=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:parseInt(n.props.activeTab)},n.initDefaultValues=function(){var e=n.props.mode;if("create"===e){var t=S()().add(1,"days").toISOString();n.props.dispatch(yh(["from"],t)),n.props.dispatch(yh(["connection_type"],"prepaid")),n.props.dispatch(yh(["charging_type"],"prepaid")),n.props.dispatch(yh(["type"],"charging")),n.props.dispatch(Ch()),n.props.dispatch(yh(["price",0,"price"],0)),n.props.dispatch(yh(["upfront"],!0)),n.props.dispatch(yh(["recurrence"],g.c.Map({unit:1,periodicity:"month"}))),n.props.dispatch(yh(["operation"],"inc"))}"clone"===e&&(n.props.dispatch(Oh()),n.handleSelectTab(1))},n.initRevisions=function(){var e=n.props,t=e.item;if(e.revisions.isEmpty()&&ue(t,!1)){var a=t.get("name","");n.props.dispatch(dp("prepaidgroups","name",a))}},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(Nh(e)).then(n.afterItemReceived)},n.clearRevisions=function(){var e=n.props.item.get("name","");n.props.dispatch(sp("prepaidgroups",e))},n.clearItemsList=function(){n.props.dispatch(up("charging_plans"))},n.afterItemReceived=function(e){e.status?(n.initRevisions(),n.initDefaultValues()):n.handleBack()},n.onChangeField=function(e,t){n.props.dispatch(yh(e,t))},n.onSelectPPInclude=function(e){var t=n.props,a=t.prepaidIncludes,r=t.item,i=t.propertyTypes,o=t.usageTypesData,l=t.currency;if(""!==e){var s=a.find(function(t){return t.get("name")===e}),c=s.get("name"),u=s.get("external_id"),p=s.get("charging_by_usaget_unit",!1),d=s.get("charging_by_usaget",""),m=p?"Volume (".concat(je(i,o,d,p),")"):"Cost (".concat(vd()(l),")");void 0!==r.get("include",g.c.List()).find(function(t){return t.get("pp_includes_name","")===e})||n.props.dispatch(Sh(c,u,m))}},n.onUpdatePeriodField=function(e,t,a){n.props.dispatch(yh(["include",e,"period",t],a))},n.onUpdateIncludeField=function(e,t,a){n.props.dispatch(yh(["include",e,t],a))},n.onRemoveChargingPlan=function(e){var t=n.props.item;n.props.dispatch(yh(["include"],t.get("include").remove(e)))},n.afterSave=function(e){var t=n.props.mode;if(e.status){var a=["clone","create"].includes(t)?"created":"updated";n.props.dispatch(Ur("The plan was ".concat(a))),n.clearRevisions(),n.handleBack(!0)}},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.props.dispatch(Ih(t,a)).then(n.afterSave)},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&n.clearItemsList();var t=ee(["systemItems","charging_plan","itemsType"],"");n.props.router.push("/".concat(t))},n.handleSelectTab=function(e){n.setState({activeTab:e})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(eo("pp_includes",_i())),this.fetchItem(),this.initDefaultValues()}},{key:"componentDidMount",value:function(){var e=this.props.mode;if(["clone","create"].includes(e)){var t=se(e,"charging_plan");this.props.dispatch(bs(t))}}},{key:"componentWillReceiveProps",value:function(e){var t=e.item,n=e.mode,a=e.itemId,r=e.prepaidIncludes,i=this.props,o=i.item,l=i.itemId,s=i.mode,c=i.prepaidIncludes;if(n!==s||ue(t)!==ue(o)){var u=se(n,"charging_plan",t);this.props.dispatch(bs(u))}(a!==l||n!==s&&"clone"===n||!g.c.is(r,c))&&this.fetchItem(a)}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"PLAN_CLEAR"})}},{key:"render",value:function(){var e=this.state.activeTab,t=this.props,n=t.item,a=t.prepaidIncludes,i=t.mode,o=t.revisions;if("loading"===i)return r.a.createElement(_,{onClick:this.handleBack});var l=a.map(function(e){return{label:e.get("name"),value:e.get("name")}}).toJS();return r.a.createElement("div",{className:"ChargingPlanSetup"},r.a.createElement(f.v,null,r.a.createElement(Sd,{itemName:"charging_plan",revisions:o,item:n,mode:i,onChangeFrom:this.onChangeField,backToList:this.handleBack,reLoadItem:this.fetchItem,clearRevisions:this.clearRevisions,clearList:this.clearItemsList})),r.a.createElement(f.B,{activeKey:e,id:"ChargingPlan",animation:!1,onSelect:this.handleSelectTab},r.a.createElement(f.z,{title:"Details",eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(w_,{item:n,mode:i,onChangeField:this.onChangeField}))),r.a.createElement(f.z,{title:"Prepaid Buckets",eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(R_,{mode:i,includes:n.get("include",g.c.List()),prepaidIncludesOptions:l,onSelectPPInclude:this.onSelectPPInclude,onUpdatePeriodField:this.onUpdatePeriodField,onUpdateField:this.onUpdateIncludeField,onRemoveChargingPlan:this.onRemoveChargingPlan})))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave}))}}]),t}(a.Component);M_.defaultProps={item:g.c.Map(),revisions:g.c.List(),prepaidIncludes:g.c.List(),activeTab:1,currency:"",usageTypesData:g.c.List(),propertyTypes:g.c.List()};var P_=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,"plan"),item:bo(e,t,"plan"),mode:Co(e,t,"plan"),activeTab:mo(e,t,"plan"),revisions:po(e,t,"charging_plan"),prepaidIncludes:e.list.get("pp_includes"),currency:pa(e,t),usageTypesData:ha(e,t),propertyTypes:va(e,t)}})(M_)),A_=function(e,t){return $l("autorenew",e,t)},D_=function(e){return es("autorenew",e)},L_=function(e,t){return zl("autorenew",e,t)},U_=function(e){return Xl("autorenew",function(e){return yi("autorenew",e)}(e))},V_=function(e){var t=e.get("last_renew",!1);return t?S()(t).format(ee("datetimeFormat","DD/MM/YYYY HH:mm")):"Not Renewed Yet"},B_=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={itemToDelete:null,refreshString:""},n.getFilterFields=function(){return[{id:"aid",placeholder:te("aid","autorenew")},{id:"sid",placeholder:te("sid","autorenew")},{id:"bucket_group",placeholder:te("bucket_group","autorenew")}]},n.getTableFields=function(){return[{id:"aid",title:te("aid","autorenew"),sort:!0},{id:"sid",title:te("sid","autorenew"),sort:!0},{id:"bucket_group",title:te("bucket_group","autorenew"),sort:!0},{id:"cycles",title:te("cycles","autorenew"),sort:!0},{id:"cycles_remaining",title:te("cycles_remaining","autorenew"),sort:!0},{id:"next_renew",title:te("next_renew","autorenew"),sort:!0,type:"datetime"},{id:"last_renew",title:te("last_renew","autorenew"),sort:!0,type:"datetime",parser:V_},{id:"interval",title:te("interval","autorenew"),sort:!0}]},n.getProjectFields=function(){return{aid:1,sid:1,bucket_group:1,cycles:1,cycles_remaining:1,next_renew:1,last_renew:1,interval:1}},n.onAskDelete=function(e){var t={message:"Are you sure you want to delete this recurring charge ?",onOk:n.onDeleteOk,labelOk:"Delete",type:"delete",onCancel:n.onDeleteClose};n.props.dispatch(ks(t)),n.setState({itemToDelete:e})},n.onDeleteClose=function(){n.setState({itemToDelete:null})},n.onDeleteOk=function(){var e=n.state.itemToDelete;n.props.dispatch(D_(e)).then(n.afterDelete)},n.afterDelete=function(e){n.onDeleteClose(),e.status&&(n.props.dispatch(Ur("Recurring charge removed successfully")),n.setState({refreshString:S()().format()}))},n.getActions=function(){return[{type:"edit",onClickColumn:null},{type:"remove",showIcon:!0,onClick:n.onAskDelete}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.refreshString,t=this.getFilterFields(),n=this.getTableFields(),a=this.getActions(),i=this.getProjectFields();return r.a.createElement(Tp,{collection:"autorenew",api:"get",itemType:"auto_renew",itemsType:"auto_renews",filterFields:t,tableFields:n,projectFields:i,actions:a,refreshString:e})}}]),t}(a.Component);B_.defaultProps={};var q_=Object(l.connect)()(B_),z_=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).initDefaultValues=function(){"create"!==n.props.mode&&n.props.dispatch(L_("immediate",!1))},n.fetchItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props.itemId;e&&n.props.dispatch(U_(e)).then(n.afterItemReceived)},n.afterItemReceived=function(e){e.status?n.initDefaultValues():n.handleBack()},n.onChangeFieldValue=function(e,t){n.props.dispatch(L_(e,t))},n.onChangeInputField=function(e){var t=e.target,a=t.id,r=t.value;n.onChangeFieldValue(a,r)},n.onChangeSelectField=function(e){return function(t){n.onChangeFieldValue(e,t)}},n.onChangeDateField=function(e){return function(t){n.onChangeFieldValue(e,t.toISOString())}},n.onChangeImmediate=function(e){n.onChangeFieldValue("next_renew",void 0),n.onChangeInputField(e)},n.afterSave=function(e){e.status&&(n.props.dispatch(Ur("The auto renew charge was saved")),n.handleBack(!0))},n.handleSave=function(){var e=n.props,t=e.item,a=e.mode;n.props.dispatch(A_(t,a)).then(n.afterSave)},n.handleBack=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=ee(["systemItems","auto_renew","itemsType"],"");e&&n.props.dispatch(up(t)),n.props.router.push("/".concat(t))},n.getBucketGroupsOptions=function(){return n.props.bucketGroups.map(function(e){return{value:e.get("name",""),label:e.get("description",e.get("name",""))}}).toArray()},n.getIntervalOptions=function(){return[{value:"month",label:"Monthly"},{value:"day",label:"Daily"}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(eo("bucket_groups",bi("prepaidgroups"))),this.fetchItem()}},{key:"componentDidMount",value:function(){var e=this.props.mode;this.initDefaultValues();var t=se(e,"auto_renew");this.props.dispatch(bs(t))}},{key:"componentWillReceiveProps",value:function(e){var t=e.itemId;t!==this.props.itemId&&this.fetchItem(t)}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Wl("autorenew"))}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.mode,a=this.getBucketGroupsOptions(),i=this.getIntervalOptions(),o="create"===n,l=S()(new Date(t.get("next_renew"))),s=S()(new Date).add(1,"days").startOf("day");return r.a.createElement("div",{className:"AutoRenewSetup"},r.a.createElement(f.v,null,r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},te("aid","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{id:"aid",value:t.get("aid",""),onChange:this.onChangeInputField,fieldType:"number"}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},te("sid","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{id:"sid",value:t.get("sid",""),onChange:this.onChangeInputField,fieldType:"number"}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},te("bucket_group","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{fieldType:"select",value:t.get("bucket_group",""),onChange:this.onChangeSelectField("bucket_group"),options:a}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},te("cycles","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{id:"cycles",value:t.get("cycles",""),onChange:this.onChangeInputField,fieldType:"number",disabled:!o}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},te("cycles_remaining","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{id:"cycles_remaining",value:t.get("cycles_remaining",t.get("cycles","")),onChange:this.onChangeInputField,fieldType:"number",disabled:o}))),o&&r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},"Immediate Charge"),r.a.createElement(f.g,{lg:7,md:7,style:{marginTop:10}},r.a.createElement(Tn,{id:"immediate",value:t.get("immediate",!1),onChange:this.onChangeImmediate,fieldType:"checkbox"}),t.get("immediate",!1)&&r.a.createElement(f.n,null,"The cusomter first charge will occur as soon as you will click save"))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},te("next_renew","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{id:"next_renew",value:l,minDate:s,onChange:this.onChangeDateField("next_renew"),disabled:t.get("immediate",!1),fieldType:"date"}))),!o&&r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},te("last_renew","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{id:"last_renew",value:V_(t),editable:!1}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{lg:2,md:2,componentClass:f.h},te("interval","autorenew")),r.a.createElement(f.g,{lg:7,md:7},r.a.createElement(Tn,{fieldType:"select",value:t.get("interval",""),onChange:this.onChangeSelectField("interval"),options:i}))))),r.a.createElement(v,{onClickCancel:this.handleBack,onClickSave:this.handleSave}))}}]),t}(a.Component);z_.defaultProps={item:g.c.Map(),itemId:"",mode:"",bucketGroups:g.c.List()};var H_=Object(s.f)(Object(l.connect)(function(e,t){return{itemId:Eo(e,t,"autorenew"),item:bo(e,t,"autorenew"),mode:Co(e,t,"autorenew"),bucketGroups:e.list.get("bucket_groups")}})(z_)),Y_=function(e){var t=e.field,n=e.entity,a=e.actions,i=e.fieldTypeLabel,o=e.isSortable,l=e.isReordable;return r.a.createElement(f.y,{className:"CustomFieldsListRow ".concat(n," table-row withHover")},r.a.createElement(f.g,{sm:1,className:"text-center"},l&&r.a.createElement(_t,{disabled:!o})),r.a.createElement(f.g,{sm:2,style:{wordBreak:"break-all"}},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Field Name:\xa0")),t.get("field_name","")),r.a.createElement(f.g,{sm:3},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Title:\xa0")),t.get("title","")),r.a.createElement(f.g,{sm:1},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Type:\xa0")),i),r.a.createElement(f.g,{sm:3},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Default Value:\xa0")),r.a.createElement("span",{className:"text-center"},r.a.createElement(wd,{field:t.set("field_name","default_value"),entity:Object(g.b)({default_value:t.get("default_value")}),onlyInput:!0,editable:!1}))),r.a.createElement(f.g,{sm:2,className:"actions"},r.a.createElement(vt,{actions:a,data:t})),r.a.createElement(f.g,{sm:12},r.a.createElement("hr",{style:{marginTop:0,marginBottom:0}})))};Y_.defaultProps={field:Object(g.b)(),fieldType:"text",fieldTypeLabel:"Text",entity:"",actions:[],isSortable:!0,isEditable:!0,isRemoveable:!0,isReordable:!0};var G_=Y_,K_=Object(Nn.a)(Sa,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.a)();return e.filter(Je)}),W_=Object(Nn.a)(function(e,t,n){return n},ba,_a,ja,wa,Ra,Na,Fa,K_,function(e,t,n,a,r,i,o,l,s){var c=Object(g.b)({customer:t,account_subscribers:n,subscription:n,product:a,service:r,plan:i,tax:o,discount:l,usage:s});return"undefined"===typeof e||"all"===e?c:c.get(e)}),J_=Object(Nn.a)(function(e){return e.get("field_name","")},function(e){return e.get("generated",!1)},function(e,t){return t.get("hiddenFields",Object(g.a)())},function(e,t,n){return!t&&!n.includes(e)}),$_=Object(Nn.a)(function(e){return e.get("field_name","")},function(e,t){return t.get("unReorderFields",Object(g.a)())},function(e,t){return!t.includes(e)}),Q_=Object(Nn.a)(function(e){return e.get("field_name","")},function(e){return e.get("system",!1)},function(e,t){return t.get("disabledFields",Object(g.a)())},function(e,t,n){return!t&&!n.includes(e)}),Z_=Object(Nn.a)(function(e){return e},function(e){return Object(D.titleCase)(ee(["systemItems",ae(e),"itemName"],te(e,"foreign")))}),X_=Object(Nn.a)(function(e){return e.getIn(["foreign","field"],"")},function(e,t){return t.get(ae(e.getIn(["foreign","entity"],"")),Object(g.a)())},function(e,t){return t.reduce(function(t,n){return n.get("field_name","")===e?n.get("title",e):t},e)}),eO=Object(Nn.a)(function(){return ee("customFields",Object(g.b)())},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.b)();return e.get("foreignFields",Object(g.b)())}),tO=Object(Nn.a)(eO,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.b)();return e.get("conditions",Object(g.a)())}),nO=Object(Nn.a)(tO,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.b)();return e.map(he).toArray()}),aO=Object(l.connect)(function(e,t){var n=t.field,a=t.fieldsConfig,r=Q_(n,a),i=n.get("type","text");return{fieldTypeLabel:ee(["customFields","fields"],Object(g.a)()).find(function(e){return e.get("id","")===i},null,Object(g.b)()).get("title",i),isSortable:$_(n,a),isEditable:Qe(n,r),isRemoveable:Qe(n,r,"delete")}},function(e,t){return{}},function(e,t,n){var a=e.isEditable,r=e.isRemoveable,i=Object(mt.a)(e,["isEditable","isRemoveable"]),o=n.entity,l=n.onEdit,s=n.onRemove,c=(n.fieldsConfig,Object(mt.a)(n,["entity","onEdit","onRemove","fieldsConfig"])),u=function(e){return s(o,e)},p=function(e){return l(o,e)},d=[{type:"edit",onClick:p,enable:a},{type:"remove",onClick:u,enable:r}];return Object(Ks.a)({},i,t,c,{entity:o,actions:d,onRemove:u,onEdit:p})})(Object(yt.SortableElement)(G_)),rO=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).getprintableFields=function(){var e=n.props,t=e.entity,a=e.fields,i=e.fieldsConfig,o=e.onRemove,l=e.onEdit,s=e.reordering;return a.reduce(function(e,n,a){return J_(n,i)?e.push(r.a.createElement(aO,{key:"item-".concat(t,"-").concat(n.get("field_name",""),"-").concat(a),index:a,disabled:!$_(n,i)||$_(n,i)&&!s,collection:t,entity:t,field:n,fieldsConfig:i,isReordable:s,onRemove:o,onEdit:l})):e},Object(g.a)())},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillUnmount",value:function(){var e=this.props,t=e.onReorederCancel;e.reordering&&t()}},{key:"render",value:function(){var e=this.props,t=e.fields,n=e.reordering,a=e.onReorder,i=e.onNew,o=e.onReorederStart,l=e.onReorederSave,s=e.onReorederCancel;return r.a.createElement("div",{className:"CustomFieldsList"},r.a.createElement(f.y,null,r.a.createElement(f.g,{xsHidden:!0,sm:1},"\xa0"),r.a.createElement(f.g,{xsHidden:!0,sm:2},r.a.createElement(f.h,null,"Key")),r.a.createElement(f.g,{xsHidden:!0,sm:3},r.a.createElement(f.h,null,"Title")),r.a.createElement(f.g,{xsHidden:!0,sm:1},r.a.createElement(f.h,null,"Type")),r.a.createElement(f.g,{xsHidden:!0,sm:3,className:"text-center"},r.a.createElement(f.h,null,"Default Value")),r.a.createElement(f.g,{xsHidden:!0,sm:2},"\xa0")),r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:12,xsHidden:!0},r.a.createElement("hr",{style:{marginTop:5,marginBottom:0}}))),!t.isEmpty()&&r.a.createElement(Et,{lockAxis:"y",helperClass:"draggable-row",useDragHandle:!0,items:this.getprintableFields(),onSortEnd:a}),t.isEmpty()&&r.a.createElement(f.g,{sm:12,className:"text-center mb10"},"No custom field"),!n&&r.a.createElement(f.g,{sm:12,className:"mt10"},r.a.createElement(ct,{onClick:i,type:"Field",action:"Add",buttonStyle:{marginTop:0}}),!t.isEmpty()&&r.a.createElement(f.c,{bsSize:"xsmall",className:"btn-primary",onClick:o,title:"Change fields order",style:{float:"right",minWidth:90}},r.a.createElement("i",{className:"fa fa-arrows-alt"})," Reorder")),n&&r.a.createElement(f.g,{sm:12,className:"text-right mt10"},r.a.createElement(f.c,{bsSize:"xsmall",onClick:l,title:"Save new order",bsStyle:"primary",style:{minWidth:90,marginRight:10}},"Save order"),r.a.createElement(f.c,{bsSize:"xsmall",onClick:s,title:"Cancel new order",style:{minWidth:90}},"Cancel order")))}}]),t}(a.Component);rO.defaultProps={entity:"",fields:Object(g.a)(),fieldsConfig:Object(g.b)(),reordering:!1};var iO=rO,oO=Object(l.connect)(function(e,t){return{reordering:Hs(e,t,"customFields","reorder.".concat(t.entity)),fieldsConfig:t.fieldsSettings.get(t.entity,Object(g.b)()).delete("fields"),fields:t.fieldsSettings.getIn([t.entity,"fields"])}},function(e,t){var n=t.entity,a=t.onNew,r=t.onReorder,i=t.onReorederSave,o=t.onReorederCancel,l=t.orderChanged;return{onNew:function(){return a(n)},onReorder:function(e){return r(n,e)},onReorederSave:function(){return i(n,!0===l)},onReorederCancel:function(){return o(n,!0===l)},onReorederStart:function(){return e(ws("customFields","reorder.".concat(n),!0))}}})(iO),lO=function(e){var t=e.field,n=e.actions,a=e.entitiesFieldsConfig;return r.a.createElement(f.g,{sm:12,className:"table-row row CustomFieldsListRow CustomFieldsListRow usage withHover"},r.a.createElement(f.g,{sm:2,style:{wordBreak:"break-all"}},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Title:\xa0")),t.get("title","")),r.a.createElement(f.g,{sm:2},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Entity:\xa0")),Z_(t.getIn(["foreign","entity"],""))),r.a.createElement(f.g,{sm:2},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Entity Field:\xa0")),X_(t,a)),r.a.createElement(f.g,{sm:2,className:"text-center"},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Translate:\xa0")),ee(["customFields","foreignFields","translate",t.getIn(["foreign","translate","type"],""),"title"],"")),r.a.createElement(f.g,{sm:2,className:"text-center"},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0,className:"inline"},r.a.createElement(f.h,null,"Constition:\xa0")),t.get("conditions",Object(g.a)()).isEmpty()?"No":"Yes"),r.a.createElement(f.g,{sm:2,className:"actions"},r.a.createElement(vt,{actions:n,data:t})),r.a.createElement(f.g,{sm:12},r.a.createElement("hr",{style:{marginTop:0,marginBottom:0}})))};lO.defaultProps={field:Object(g.b)(),entitiesFieldsConfig:Object(g.b)(),actions:[]};var sO=lO,cO=function(e){var t=e.fields,n=e.addAction,a=e.rowActions,i=e.entitiesFieldsConfig;return r.a.createElement("div",{className:"CustomFieldsList"},r.a.createElement(f.g,{sm:12,xsHidden:!0,className:"table-row row"},r.a.createElement(f.g,{sm:2},r.a.createElement(f.h,null,"Title")),r.a.createElement(f.g,{sm:2},r.a.createElement(f.h,null,"Entity")),r.a.createElement(f.g,{sm:2},r.a.createElement(f.h,null,"Entity Field")),r.a.createElement(f.g,{sm:2,className:"text-center"},r.a.createElement(f.h,null,"Translate")),r.a.createElement(f.g,{sm:2,className:"text-center"},r.a.createElement(f.h,null,"Condition")),r.a.createElement(f.g,{sm:2},"\xa0")),r.a.createElement(f.g,{sm:12,xsHidden:!0},r.a.createElement("hr",{style:{marginTop:5,marginBottom:15}})),!t.isEmpty()&&t.map(function(e,t){return r.a.createElement(sO,{key:t,field:e,actions:a,entitiesFieldsConfig:i})}),t.isEmpty()&&r.a.createElement(f.g,{sm:12,className:"text-center mb10"},"No foreign field"),r.a.createElement(f.g,{sm:12,className:"mt10"},r.a.createElement(vt,{actions:n,data:"usage"})))};cO.defaultProps={fields:Object(g.a)(),entitiesFieldsConfig:Object(g.b)(),addAction:[],rowActions:[]};var uO=cO,pO=function(e){var t=e.condition,n=e.index,a=e.onRemove,i=e.onUpdate,o=e.error,l=e.conditionsFields,s=e.conditionsOperatorsSelectOptions,c=e.conditionField,u=e.conditionOperator,p=function(e){return["nin","in","$nin","$in"].includes(e)},d=t.getIn(["field"],""),m=t.getIn(["op"],""),h=""===d,v=""===m||h,y=p(m)?t.set("value",t.get("value",Object(g.a)()).join(",")):t,b=l.map(fe);return r.a.createElement(f.l,{className:"form-inner-edit-row",validationState:o?"error":null},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_field"},"field")),r.a.createElement(f.g,{sm:4},r.a.createElement(Tn,{id:"condition_field",fieldType:"select",options:b,onChange:function(e){var t=Object(g.b)({field:e,op:"",value:""});i([n],t)},value:d})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_operator"},"Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement(Tn,{id:"condition_operator",fieldType:"select",options:s,onChange:function(e){i([n,"op"],e);var a=t.getIn(["op"],"");if(p(a)!==p(e)){var r=p(e)?Object(g.a)():"";i([n,"value"],r)}},value:t.getIn(["op"],""),disabled:h})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_value"},"Value")),r.a.createElement(f.g,{sm:4},r.a.createElement(Zg,{field:y,config:c,operator:u,disabled:v,onChange:function(e){var a=t.getIn(["op"],"");if(p(a)){var r=Object(g.a)(e.length?e.split(","):[]);i([n,"value"],r)}else i([n,"value"],e)}})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(f.c,{onClick:function(){a(n)},bsSize:"small",className:"pull-left"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))),o&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.n,null,r.a.createElement("small",null,o))))};pO.defaultProps={condition:Object(g.b)(),conditionField:Object(g.b)(),conditionsFields:[],conditionOperator:Object(g.b)(),conditionsOperatorsSelectOptions:[],error:""};var dO=pO,mO=function(e){var t=e.item,n=e.mode,a=e.onChangeTitle,i=e.isErrorTitle,o=e.onChangeEntity,l=e.isErrorForeigEntity,s=e.foreignEntities,c=e.onChangeField,u=e.isErrorForeignField,p=e.foreignFields,d=e.onChangeTranslateType,m=e.isErrorForeignTranslateType,h=e.translateTypes,v=e.onChangeTranslateFormat,y=e.translateTypeFormats,b=e.foreignFieldsConditionsOperators,E=e.onAddCondition,C=e.onUpdateCondition,_=e.onRemoveCondition,O=e.isErrorConditions;return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(wd,{field:Object(g.b)({title:"Title",field_name:"title",mandatory:!0}),entity:t,onChange:a,error:i}),r.a.createElement(wd,{field:Object(g.b)({title:"Entity",field_name:"foreign.entity",mandatory:!0,select_list:!0,select_options:s}),entity:t,onChange:o,disabled:"edit"===n,error:l}),r.a.createElement(wd,{field:Object(g.b)({title:"Entity Field",field_name:"foreign.field",mandatory:!0,select_list:!0,select_options:p}),entity:t,onChange:c,disabled:""===t.getIn(["foreign","entity"],"")||"edit"===n,error:u}),r.a.createElement(f.v,{header:"Translate"},r.a.createElement(wd,{field:Object(g.b)({title:"Type",field_name:"foreign.translate.type",select_list:!0,select_options:h}),entity:t,onChange:d,error:m}),0!==y.length&&r.a.createElement(wd,{field:Object(g.b)({title:"Format",field_name:"foreign.translate.format",select_list:!0,select_options:y}),entity:t,onChange:v})),r.a.createElement(f.v,{header:"Conditions"},r.a.createElement("div",{className:"fraud-event-conditions"},!t.get("conditions",Object(g.a)()).isEmpty()&&r.a.createElement(f.g,{sm:12,className:"form-inner-edit-rows"},r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Field")),r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},"Operator")),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Value")))),r.a.createElement(f.g,{sm:12},t.get("conditions",Object(g.a)()).isEmpty()&&r.a.createElement("small",null,"No conditions found"),t.get("conditions",Object(g.a)()).map(function(e,t){return r.a.createElement(dO,{key:t,condition:e,index:t,conditionsFields:p,onUpdate:C,onRemove:_,conditionsOperatorsSelectOptions:b,error:O.get("".concat(t),"")})})),r.a.createElement(f.g,{sm:12,className:"pl0 pr0"},r.a.createElement(ct,{onClick:E,label:"Add Condition",disabled:""===t.getIn(["foreign","entity"],"")})))))};mO.defaultProps={item:Object(g.b)(),mode:"create",foreignEntities:[],foreignFields:[],translateTypes:[],translateTypeFormats:[],foreignFieldsConditionsOperators:[],isErrorTitle:!1,isErrorForeigEntity:!1,isErrorForeignField:!1,isErrorForeignTranslateType:!1,isErrorConditions:Object(g.b)()};var gO=mO,fO=function(e){return function(t){var n=(Array.isArray(e)?e:[e]).map(function(e){return Ce(e,!1,["fields"])});return t(kl(n))}},hO=function(e,t){return function(n){var a=Ce(e,!0,["fields"]),r=Object(Qd.a)(a),i=r[0],o=r.slice(1);return n(bl(i,t,o))}},vO=function(e,t){return function(n,a){var r=W_(a(),{},e).findIndex(function(e){return e.getIn(["field_name"],"")===t.getIn(["field_name"],"")});if(-1!==r){var i=Ce(e,!0,["fields",r]),o=Object(Qd.a)(i),l=o[0],s=o.slice(1);return n(yl(l,s,t))}return!1}},yO=function(e,t){return function(n,a){var r=W_(a(),{},e).findIndex(function(e){return e.getIn(["field_name"],"")===t.getIn(["field_name"],"")});if(-1!==r){var i=Ce(e,!0,["fields",r]),o=Object(Qd.a)(i),l=o[0],s=o.slice(1);return n(El(l,s))}return!1}},bO=function(e){return function(t){return t(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(t){var n=(Array.isArray(e)?e:[e]).map(function(e){return Ce(e,!1,["fields"])});return t(Tl(n))}}(e)).then(function(e){return!!e.status||Promise.reject()}).then(function(){return t(fO(e))}).catch(function(){return t(fO(e)).then(function(){return Promise.reject()})})}},EO=function(e){return ws("customFields",e)},CO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return""!==e||"".concat(t," is required")},_O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return CO(e,"Title")},OO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return CO(e,"Entity")},SO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return CO(e,"Entity Field")},TO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.a)();return ee("fieldKeyRegex","").test(e)?""===e?"Key is required":!t.includes(e)||"Key already exists":"Key contains illegal characters, field name should contain only alphabets, numbers and underscores (A-Z, a-z, 0-9, ., _)"},kO=function(e){var t=Object(g.b)().withMutations(function(t){e.forEach(function(e,n){var a=function(e){var t=e.has("field")&&""===e.get("field",""),n=e.has("op")&&""===e.get("op",""),a=e.has("value")&&(""===e.get("value","")||Object(g.e)(e.get("value",Object(g.a)()),Object(g.a)()));return t?"Conditions field can not be empty":n?"Conditions operator can not be empty":!a||"Conditions value can not be empty"}(e);!0!==a&&t.set(n,a)})});return!!t.isEmpty()||t},jO=function(e,t){return function(n){var a=!0,r=_O(e.get("title",""));!0!==r&&(a=!1,n(Is("title",r)));var i=TO(e.get("field_name",""),t);return!0!==i&&(a=!1,n(Is("fieldName",i))),a}},IO=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.a)();return function(n){var a=!0,r=e.getIn(["foreign","entity"],""),i=e.getIn(["foreign","field"],""),o=e.get("conditions",Object(g.a)()),l=_O(e.get("title",""));!0!==l&&(a=!1,n(Is("title",l)));var s=OO(r);!0!==s&&(a=!1,n(Is("foreign.entity",s)));var c=SO(i);if(!0!==c&&(a=!1,n(Is("foreign.field",c))),!t.isEmpty()){var u=t.reduce(function(e,t){var n=t.getIn(["foreign","entity"],""),a=t.getIn(["foreign","field"],"");return r===n&&i===a?t:e},!1);if(u){a=!1;var p=Object(D.titleCase)(ee(["systemItems",ne(e.getIn(["foreign","entity"],"")),"itemName"],e.getIn(["foreign","entity"],""))),d=Object(D.titleCase)(te(e.getIn(["foreign","field"],""),ne(e.getIn(["foreign","entity"],"")))),m=u.get("title",u.get("field_name","")),f="Foreign field ".concat(d," from entity ").concat(p," already exists with title '").concat(m,"'");n(Is("foreign.field",f))}}var h=!!o.isEmpty()||kO(o);return!0!==h&&(a=!1,h.forEach(function(e,t){n(Is("conditions.".concat(t),e))})),a}},wO=function(e,t){return"foreign.".concat(e,".").concat(t)},NO=Object(g.b)({field:"",op:"",value:""}),FO=Object(l.connect)(function(e,t){var n=t.item,a=void 0===n?Object(g.b)():n,r=t.errors,i=void 0===r?Object(g.b)():r,o=t.entity,l=void 0===o?"":o,s=nO(e,t),c=ae(a.getIn(["foreign","entity"],"")),u=(W_(e,t)||Object(g.b)()).get(c,Object(g.a)()).map(function(e){return Object(g.b)({value:e.get("field_name",""),label:e.get("title","")})}).toArray(),p=ee(["customFields","foreignFields","entities",l],Object(g.a)()).map(function(e){return Object(g.b)({value:ee(["customFields","entities",e],e),label:Z_(e)})}).toList().toArray(),d=ee(["customFields","foreignFields","translate"],Object(g.b)()).map(function(e,t){return Object(g.b)({value:t,label:e.get("title",Object(D.titleCase)(t))})}).toList().toArray(),m=g.b.isMap(a)?a.getIn(["foreign","translate","type"],""):"",f=ee(["customFields","foreignFields","translate",m,"options"],Object(g.a)()).map(function(e){return Object(g.b)({value:e,label:e})}).toArray(),h=i.reduce(function(e,t,n){return"conditions"===n.split(".")[0]?e.set(n.split(".")[1],t):e},Object(g.b)());return{foreignFields:u,foreignEntities:p,translateTypes:d,translateTypeFormats:f,foreignFieldsConditionsOperators:s,isErrorTitle:i.get("title",!1),isErrorForeigEntity:i.get("foreign.entity",!1),isErrorForeignField:i.get("foreign.field",!1),isErrorForeignTranslateType:i.get("foreign.translate.type",!1),isErrorConditions:h}},function(e,t){var n=t.item,a=void 0===n?Object(g.b)():n,r=t.updateField,i=t.removeField,o=t.setError;return{onChangeTitle:function(e,t){var n=e.join("."),a=_O(t);!0!==a?o(n,a):o(n),r(e,t)},onChangeEntity:function(e,t){var n=e.join("."),a=OO(t);!0!==a?o(n,a):o(n),r(["foreign"],Object(g.b)({entity:t})),r(["conditions"],Object(g.a)()),r("field_name",wO(t,""))},onChangeField:function(e,t){var n=e.join("."),i=SO(t);!0!==i?o(n,i):o(n),r(e,t),r("field_name",wO(a.getIn(["foreign","entity"],""),t))},onChangeTranslateType:function(e,t){var n=["foreign","translate"];""!==t?r(n,Object(g.b)({type:t})):i(n)},onChangeTranslateFormat:function(e,t){""!==t?r(e,t):i(e)},onAddCondition:function(){var e=a.get("conditions",Object(g.a)()),t=!!e.isEmpty()||kO(e);!0!==t?t.forEach(function(e,t){o("conditions.".concat(t),e)}):r("conditions",e.push(NO))},onUpdateCondition:function(e,t){o("conditions.".concat(e[0])),r(["conditions"].concat(Object(N.a)(e)),t)},onRemoveCondition:function(e){o("conditions.".concat(e)),r("conditions",a.get("conditions",Object(g.a)()).delete(e))}}})(gO),xO=Object(g.b)({field_name:"",title:"",foreign:Object(g.b)({entity:"",field:""})}),RO=Object(l.connect)(function(e,t){var n=W_(e,t)||Object(g.b)();return{fields:n.get("usage"),entitiesFieldsConfig:n}},function(e,t){return{onNew:function(t,n){var a=ee(["systemItems",t,"itemName"],t),r={title:Object(D.titleCase)("".concat("create"," new ").concat(a," foreign field")),onOk:function(a){return!!e(IO(a,n))&&(e(hO(t,a)),e(bO(t)))},mode:"create",entity:t};return e(js(xO,FO,r))},onEdit:function(t){var n=ee(["systemItems","usage","itemName"],"usage"),a={title:"".concat(Object(D.titleCase)("".concat("edit"," ").concat(n," foreign field"))," - ").concat(t.get("title","")),onOk:function(t){return!!e(IO(t))&&(e(vO("usage",t)),e(bO("usage")))},mode:"edit",entity:"usage"};return e(js(t,FO,a))},onRemove:function(t){var n={message:'Are you sure you want to delete "'.concat(t.get("title",t.get("field_name","")),'" foreign field?'),onOk:function(){return e(yO("usage",t)),e(bO("usage"))},labelOk:"Delete",type:"delete"};return e(ks(n))}}},function(e,t,n){var a=e.fields,r=t.onEdit,i=t.onRemove,o=t.onNew,l=Object(mt.a)(t,["onEdit","onRemove","onNew"]),s=[{type:"add",onClick:function(e){return o(e,a)},label:"Add new foreign field",actionStyle:"primary",actionSize:"xsmall"}],c=[{type:"edit",onClick:r},{type:"remove",onClick:i}];return Object(Ks.a)({},e,l,n,{addAction:s,rowActions:c})})(uO),MO=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).renderUsageTab=function(){var e=n.props.tabs,t=Object(D.titleCase)(ee(["systemItems","usage","itemName"],"usage"));return r.a.createElement(f.z,{title:t,eventKey:e.size,key:"custom-fields-tab-".concat("usage")},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(RO,null)))},n.renderTab=function(e,t){var a=n.props,i=a.fieldsSettings,o=a.onReorder,l=a.onNew,s=a.onRemove,c=a.onEdit,u=a.onSave,p=a.onCancel,d=a.orderChanged,m=Object(D.titleCase)(ee(["systemItems",e,"itemName"],e));return r.a.createElement(f.z,{title:m,eventKey:t,key:"custom-fields-tab-".concat(e)},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(oO,{entity:e,fieldsSettings:i,onReorder:o,onNew:l,onRemove:s,onEdit:c,onReorederSave:u,onReorederCancel:p,orderChanged:d.get(e,!1)})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props;(0,e.loadFields)(e.tabs.toJS())}},{key:"componentWillUnmount",value:function(){(0,this.props.clearFlags)()}},{key:"render",value:function(){var e=this.props,t=e.location,n=e.tabs.filter(function(e){return"usage"!==e}).map(this.renderTab).push(this.renderUsageTab());return r.a.createElement("div",null,r.a.createElement(No,{id:"CustomFieldsTabs",location:t},n))}}]),t}(a.Component);MO.defaultProps={tabs:Object(g.a)(),fieldsSettings:Object(g.b)(),orderChanged:Object(g.b)()};var PO=MO,AO=function(e){var t=e.item,n=e.onChangeOptions,a=e.onChangePlay,i=e.onChangeType,o=e.onChangeTitle,l=e.onChangeFieldName,s=e.onChangeEntityField,c=e.disableUnique,u=e.disableMandatory,p=e.disableFieldType,d=e.disabledEditable,m=e.disabledDisplay,h=e.disabledShowInList,v=e.disableSearchable,y=e.disableMultiple,b=e.disableSelectList,E=e.disableSelectOptions,C=e.disableTitle,_=e.disableFieldName,O=e.disableHelp,S=e.disableDescription,T=e.disableDefaultValue,k=e.isErrorTitle,j=e.isErrorFieldName,I=e.fieldTypesOptions,w=e.playsOptions,N=e.fieldType,F=e.showPlays,x=e.plays,R=e.checkboxStyle,M=e.helpTextStyle;return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(wd,{field:Object(g.b)({title:"Key",field_name:"field_name",mandatory:!0}),entity:t,disabled:_,onChange:l,error:j}),r.a.createElement(wd,{field:Object(g.b)({title:"Title",field_name:"title",mandatory:!0}),entity:t,disabled:C,onChange:o,error:k}),!p&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Field Type"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",options:I,onChange:i,value:N,disabled:p,clearable:!1}))),F&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Play"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",options:w,onChange:a,value:x,multi:!0,clearable:!0}))),!S&&r.a.createElement(wd,{field:Object(g.b)({title:"Description",field_name:"description",description:"Long text will appear in question mark after the field label"}),entity:t,onChange:s,disabled:S}),!O&&r.a.createElement(wd,{field:Object(g.b)({title:"Help Text",field_name:"help",description:"Short text will appear below the field"}),entity:t,onChange:s,disabled:O}),r.a.createElement(f.v,{header:"Options"},!c&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Unique"),r.a.createElement(f.g,{sm:8,lg:9,style:R},r.a.createElement(Tn,{id:"unique",onChange:n,value:t.get("unique",""),fieldType:"checkbox",disabled:c,className:"inline mr10"}))),(!u||u&&t.get("unique",!1))&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Mandatory"),r.a.createElement(f.g,{sm:8,lg:9,style:R},r.a.createElement(Tn,{id:"mandatory",onChange:n,value:t.get("mandatory",""),fieldType:"checkbox",disabled:u,className:"inline mr10"}),u&&t.get("unique",!1)&&r.a.createElement("small",{style:M},"Unique field must be mandatory"))),!d&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Editable"),r.a.createElement(f.g,{sm:8,lg:9,style:R},r.a.createElement(Tn,{fieldType:"checkbox",id:"editable",onChange:n,value:t.get("editable",""),disabled:d,className:"inline mr10"}))),!m&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Display"),r.a.createElement(f.g,{sm:7,style:R},r.a.createElement(Tn,{fieldType:"checkbox",id:"display",onChange:n,value:t.get("display",""),disabled:m,className:"inline mr10"}))),!h&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Show in list"),r.a.createElement(f.g,{sm:8,lg:9,style:R},r.a.createElement(Tn,{fieldType:"checkbox",id:"show_in_list",onChange:n,value:t.get("show_in_list",""),disabled:h,className:"inline mr10"}))),!v&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Searchable"),r.a.createElement(f.g,{sm:8,lg:9,style:R},r.a.createElement(Tn,{fieldType:"checkbox",id:"searchable",className:"inline mr10",onChange:n,value:t.get("searchable",""),disabled:v}))),!y&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Multiple"),r.a.createElement(f.g,{sm:8,lg:9,style:R},r.a.createElement(Tn,{id:"multiple",onChange:n,value:t.get("multiple",""),fieldType:"checkbox",disabled:y,className:"inline mr10"}))),(!b||!E)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Select list"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement(Tn,{id:"select_list",onChange:n,value:t.get("select_list",""),fieldType:"checkbox",disabled:b})),r.a.createElement(Tn,{id:"select_options",onChange:n,value:t.get("select_options",""),disabled:E})),r.a.createElement(f.n,{style:{marginLeft:40}},"Select Options ",r.a.createElement("small",null,"(comma-separated list)"))))),(!T||T&&t.get("unique",!1))&&r.a.createElement(f.v,{header:"Preview and Default Value"},r.a.createElement(wd,{field:t.set("field_name","default_value"),entity:t,onChange:s,disabled:T||t.get("unique",!1)}),t.get("unique",!1)&&r.a.createElement(f.n,{className:"text-center"},"Default value can't be set for unique field")))};AO.defaultProps={item:Object(g.b)(),fieldTypeLabel:"",isErrorTitle:!1,isErrorFieldName:!1,disableUnique:!1,disableMandatory:!1,disableFieldType:!1,disabledEditable:!1,disabledDisplay:!1,disabledShowInList:!1,disableSearchable:!1,disableMultiple:!1,disableSelectList:!1,disableSelectOptions:!1,disableTitle:!1,disableFieldName:!1,disableHelp:!1,disableDescription:!1,disableDefaultValue:!1,fieldTypesOptions:[],fieldType:"",showPlays:!1,plays:"",playsOptions:[],checkboxStyle:{},helpTextStyle:{}};var DO=AO,LO=Object(l.connect)(function(e,t){var n=t.item,a=t.mode,r=t.entity,i=n.get("type","text"),o=ee(["customFields","fields"],Object(g.a)()),l=o.filter(function(e){return!Ke(e,r,"excludeEntity")&&We(e,r,"includeEntity")}).map(he).toArray(),s=o.find(function(e){return e.get("id","")===i},null,Object(g.b)()),c=Q_(n,o),u=la(e,t)||Object(g.a)(),p=u.map(function(e){return{value:e.get("name",""),label:e.get("label",e.get("name",""))}}).toArray(),d=["subscription"].includes(r)&&u.size>1;return{availablePlays:la(e,t),fieldType:i,fieldTypeLabel:s.get("title",i),fieldTypesOptions:l,playsOptions:p,showPlays:d,checkboxStyle:{marginTop:10,paddingLeft:26},helpTextStyle:{color:"#626262",verticalAlign:"text-top"},plays:n.get("plays",[]).join(","),disableTitle:Ke(s,"title")||!Qe(n,c,"title"),disableFieldName:"create"!==a,disableUnique:Ke(s,"unique")||!Qe(n,c,"unique"),disableMandatory:Ke(s,"mandatory")||!Qe(n,c,"mandatory")||n.get("unique",!1),disableFieldType:Ke(s,"type")||!Qe(n,c,"type"),disabledEditable:Ke(s,"editable")||!Qe(n,c,"editable"),disabledDisplay:Ke(s,"display")||!Qe(n,c,"display"),disabledShowInList:Ke(s,"show_in_list")||!Qe(n,c,"show_in_list"),disableSearchable:Ke(s,"searchable")||!Qe(n,c,"searchable"),disableMultiple:Ke(s,"multiple")||!Qe(n,c,"multiple"),disableSelectList:Ke(s,"select_list")||!Qe(n,c,"select_list"),disableSelectOptions:!n.get("select_list",!1)||!Qe(n,c,"select_options"),disableHelp:Ke(s,"help")||!Qe(n,c,"help"),disableDescription:Ke(s,"description")||!Qe(n,c,"description"),disableDefaultValue:Ke(s,"default_value")||!Qe(n,c,"default_value"),isErrorTitle:t.errors&&t.errors.get("title",!1),isErrorFieldName:t.errors&&t.errors.get("fieldName",!1)}},function(e,t){var n=t.item,a=void 0===n?Object(g.b)():n,r=t.existingFields,i=void 0===r?Object(g.a)():r,o=t.updateField,l=t.removeField,s=t.setError;return{onChangeTitle:function(e,t){var n=_O(t);!0!==n?s("title",n):s("title"),o("title",t)},onChangeFieldName:function(e,t){var n=TO(t,i);!0!==n?s("fieldName",n):s("fieldName"),o("field_name",t)},onChangeEntityField:function(e,t){["description","help"].includes(e[0])&&""===t?l(e):"default_value"===e[0]?"ranges"===a.get("type","text")&&t.isEmpty()?l("default_value"):""===t?l("default_value"):o(e,t):o(e,t)},onChangeOptions:function(e){var t=e.target,n=t.id,r=t.value;"unique"===n?!0===r?(o("unique",!0),o("mandatory",!0),l("default_value")):l("unique"):"select_list"===n?!0===r?(o("select_list",!0),o("select_options",a.get("select_options",""))):(l("select_list"),l("select_options")):"select_options"===n?o("select_options",r):!0===r?o(n,!0):l(n)},onChangePlay:function(e){o("plays",Object(g.a)(e.split(",")))},onChangeType:function(e){var t=a.get("type","text"),n=ee(["customFields","fields"],Object(g.a)()).find(function(t){return t.get("id","")===e},null,Object(g.b)()),r=ee(["customFields","fields"],Object(g.a)()).find(function(e){return e.get("id","")===t},null,Object(g.b)());"text"===e?l("type"):o("type",e),n.get("type","")!==r.get("type","")&&(n.has("defaultValue")?o("default_value",n.get("defaultValue")):l("default_value")),a.forEach(function(e,t){Ke(n,t)&&l(t)})}}},function(e,t,n){n.entity,n.errors,n.existingFields,n.mode,n.removeField,n.setError,n.setItem,n.updateField;var a=Object(mt.a)(n,["entity","errors","existingFields","mode","removeField","setError","setItem","updateField"]);return Object(Ks.a)({},a,e,t)})(DO),UO=Object(g.b)({field_name:"",title:"",editable:!0,display:!0}),VO=Object(l.connect)(function(e,t){var n=ee(["customFields","entities"],Object(g.b)()).keySeq().toList(),a=n.reduce(function(n,a){return n.set(a,Object(g.b)({fields:W_(e,t,a)||Object(g.a)(),hiddenFields:ee(["customFields","defaultHiddenFields",a],Object(g.a)()),disabledFields:ee(["customFields","defaultDisabledFields",a],Object(g.a)()),unReorderFields:ee(["customFields","unReorderFields",a],Object(g.a)())}))},Object(g.b)()),r=n.reduce(function(n,a){return n.set(a,Hs(e,t,"customFields","orderChanged.".concat(a)))},Object(g.b)());return{tabs:n,fieldsSettings:a,orderChanged:r}},function(e,t){return{loadFields:function(t){return e(fO(t))},clearFlags:function(){return e(ws("customFields"))},onRemove:function(t,n){var a={message:'Are you sure you want to delete "'.concat(n.get("title",n.get("field_name","")),'" field?'),onOk:function(){return e(yO(t,n)),e(bO(t))},labelOk:"Delete",type:"delete"};return e(ks(a))},onEdit:function(t,n){var a=ee(["systemItems",t,"itemName"],t),r={title:"".concat(Object(D.titleCase)("".concat("edit"," ").concat(a," field"))," - ").concat(n.get("title","")),onOk:function(n){return e(vO(t,n)),e(bO(t))},mode:"edit",entity:t};return e(js(n,LO,r))},onNew:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(g.a)(),a=ee(["customFields","fields"],Object(g.a)()).filter(function(e){return!Ke(e,t,"excludeEntity")&&We(e,t,"includeEntity")}).reduce(function(e,t){return e.push(t.get("id",""))},Object(g.a)());if(a.isEmpty())return e(Vr("No available field types "));var r=function(a){var r=ee(["customFields","saveAsParams"],Object(g.a)()).includes(t)?a.withMutations(function(e){var t=a.get("field_name");t.startsWith("params.")||e.set("field_name","params.".concat(t))}):a;return!!e(jO(r,n))&&(e(hO(t,r)),e(bO(t)))},i=ee(["systemItems",t,"itemName"],t),o="create",l=Object(D.titleCase)("".concat(o," new ").concat(i," field")),s={title:l,onOk:r,mode:o,entity:t,existingFields:n},c=a.includes("text")?UO:UO.set("type",a.first());return e(js(c,LO,s))},onReorder:function(t,n){var a,r=n.oldIndex,i=n.newIndex;if(r===i)return!0;e((a="orderChanged.".concat(t),ws("customFields",a,!0)));var o=Ce(t,!0,["fields"]);return e(function(e,t,n){return{type:gl,oldIndex:e,newIndex:t,path:n}}(r,i,o))},onCancel:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e(EO("reorder.".concat(t))),e(EO("orderChanged.".concat(t))),!n||e(fO(t))},onSave:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e(EO("reorder.".concat(t))),e(EO("orderChanged.".concat(t))),!n||e(bO(t))}}},function(e,t,n){n.children,n.dispatch,n.history,n.params,n.route,n.routeParams,n.routes;var a=Object(mt.a)(n,["children","dispatch","history","params","route","routeParams","routes"]),r=e.fieldsSettings,i=t.onNew,o=Object(mt.a)(t,["onNew"]);return Object(Ks.a)({},a,e,o,{onNew:function(e){var t=r.getIn([e,"fields"],Object(g.a)()).map(function(e){return Object(D.lowerCase)(e.get("field_name",""))});return i(e,t)}})})(PO),BO=function(){return ee("events",g.c.Map())},qO=Object(Nn.a)(BO,function(e,t){return t.eventType},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1?arguments[1]:void 0;return e.getIn(["operators",t,"conditions"],g.c.List())}),zO=Object(Nn.a)(qO,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.map(he).toArray()}),HO=Object(Nn.a)(BO,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("conditionsFields",g.c.List())}),YO=Object(Nn.a)(Sa,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return e.filter(Je).filter($e)}),GO=Object(Nn.a)(HO,YO,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List();return g.c.List().withMutations(function(n){t.forEach(function(e){e.withMutations(function(t){t.set("title",ze(e).get("title","")),t.set("type","string"),t.set("id",e.get("field_name")),n.push(t)})}),e.forEach(function(e){n.push(ze(e,null,"id"))})})}),KO=Object(Nn.a)(GO,function(e,t){return t.condition.get("field")},function(e,t){return t.usedFields},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.filter(function(e){return e.get("id","")===t||!n.includes(e.get("id",""))}).sort(Ge).map(he).toArray()}),WO=Object(Nn.a)(BO,function(e,t){return t.eventType},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1?arguments[1]:void 0;return e.getIn(["operators",t,"threshold"],g.c.List())}),JO=Object(Nn.a)(WO,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.map(he).toArray()}),$O=Object(Nn.a)(BO,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("thresholdFields",g.c.List()).map(function(e){return ze(e,null,"id")})}),QO=Object(Nn.a)(GO,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.filter(function(e){return e.get("effectOnUsaget",!1)}).map(function(e){return e.get("id","")})}),ZO=Object(Nn.a)(oo,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.getIn(["ui_flags","eventUsageType"],g.c.Map())}),XO=Object(Nn.a)(ZO,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("usaget",g.c.List())}),eS=Object(Nn.a)(ZO,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return e.get("arate_key",g.c.List())}),tS=Object(Nn.a)(ZO,Gn,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List();return g.c.Set().withMutations(function(n){t.filter(function(t,n){return e.get("type",g.c.List()).includes(n)}).forEach(function(e){n.union(e)})})}),nS=Object(Nn.a)(lr,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List();return g.c.Map().withMutations(function(t){e.forEach(function(e){var n=e.get("rates",g.c.Map()).keySeq().first();t.set(e.get("key",""),n)})})}),aS=Object(Nn.a)(eS,nS,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Map();return e.reduce(function(e,n){return e.push(t.get(n,""))},g.c.List())}),rS=Object(Nn.a)(ha,tS,XO,aS,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.List(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.List(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.List(),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.c.List(),r=g.c.List().withMutations(function(r){[t,n,a].forEach(function(t){if(!t.isEmpty()){var n=t.map(function(t){return e.find(function(e){return e.get("usage_type","")===t},null,g.c.Map()).get("property_type","")});r.push(n.filter(function(e){return""!==e}))}})});return r.isEmpty()?g.c.Set():1===r.size?g.c.Set(r.first()):g.c.Set(r.reduce(function(e,t){return e.filter(function(e){return t.includes(e)})}))}),iS=Object(Nn.a)($O,rS,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.c.Set();return e.filter(function(e){var n=e.get("allowedWithUsage",g.c.List());return!!n.isEmpty()||(t.isEmpty()?n.includes("empty"):1===t.size?n.includes("single"):n.includes("multiple"))}).sort(Ge).map(he).toArray()}),oS=function(e){return ee(["events","operators","balance","conditions"],g.c.Map()).find(function(t){return t.get("id","")===e},null,g.c.Map())},lS=function(e,t){var n="";return t.forEach(function(t,a){t.includes(e)&&(n=a)}),n},sS=function(e,t){return g.c.List().push(g.c.Map({type:"group",key:e})).push(g.c.Map({type:"service",key:lS(e,t)}))},cS=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(t){case"group":return g.c.List().withMutations(function(t){n.groupNames.split(",").forEach(function(a){return t.push(g.c.Map({path:"balance.groups.".concat(a,".").concat(e),total_path:"balance.groups.".concat(a,".total"),related_entities:sS(a,n.servicesData)}))})});case"activity_type":var a=n.hasOwnProperty("overGroup")&&"over_group"===n.overGroup?"balance.totals.".concat(n.activityType,".over_group.").concat(e):"balance.totals.".concat(n.activityType,".").concat(e);return g.c.List([g.c.Map({path:a,total_path:"",related_entities:g.c.List()})]);case"none":default:return g.c.List([g.c.Map({path:"balance.cost",total_path:"",related_entities:g.c.List()})])}},uS=function(e){return e.substr(e.lastIndexOf(".")+1)},pS=function(e){return-1!==e.indexOf(".over_group.")?"over_group":"none"},dS=function(e,t){if("activity_type"!==t)return"";var n="over_group"===pS(e)?e.lastIndexOf(".over_group"):e.lastIndexOf(".");return e.substring(e.lastIndexOf(".totals.")+8,n)},mS=function(e,t){return{value:e,label:"".concat(e," (").concat(lS(e,t),")")}},gS=function(e,t){return"group"!==t?"":e.reduce(function(e,t){var n=t.get("path",""),a=n.substring(n.lastIndexOf(".groups.")+8,n.lastIndexOf("."));return e.push(a)},g.c.List()).join()},fS=function(e){var t,n=e.get(0,g.c.Map()).get("path",""),a=-1!==(t=n).indexOf(".groups.")?"group":-1!==t.indexOf(".totals.")?"activity_type":"none",r=pS(n);return{trigger:uS(n),limitation:a,overGroup:r,activityType:dS(n,a),groupNames:gS(e,a)}},hS=function(e){return oS(e.get("type","")).get("title","")},vS=function(e,t,n,a,r,i,o){return"reached_percentage"===o?"%":"usagev"===t||""!==e?je(a,r,n,e):vd()(i)},yS=function(e,t){var n=t.propertyTypes,a=t.usageTypesData,r=t.currency,i=fS(e.get("paths",g.c.List())),o=i.trigger,l=i.limitation,s=i.activityType,c="group"===l?e.get("usaget",""):s,u=vS(e.get("unit",""),o,c,n,a,r,e.get("type",""));return"%"===u&&"tags"===oS(e.get("type","")).get("type","text")?e.get("value","").split(",").filter(function(e){return""!==e}).map(function(e){return"".concat(e).concat(u)}).join(", "):"".concat(e.get("value","")," ").concat(u)},bS=function(e,t){var n=fS(e.get("paths",g.c.List())),a=n.trigger,r=n.limitation,i=n.activityType,o="usagev"===a?"Usage":"Cost";switch(e&&-1!==e.getIn(["paths",0,"path"],"").indexOf("over_group")&&(o="Exceeding ".concat(o.toLowerCase())),r){case"group":return"".concat(o," of group(s) ").concat(hS(e)," ").concat(yS(e,t));case"activity_type":return"".concat(o," of ").concat(i," activity ").concat(hS(e)," ").concat(yS(e,t));case"none":default:return"Total cost ".concat(hS(e)," ").concat(yS(e,t))}},ES=function(e){switch(e){case"minutely":return"Minutes";case"hourly":return"Hours";default:return"Select unit..."}},CS=function(e){return"minutely"===e?[{value:15,label:"15"},{value:30,label:"30"}]:"hourly"===e?Array.from(new Array(24),function(e,t){return t+1}).map(function(e){return{value:e,label:"".concat(e)}}):[]},_S=function(e,t){return"bucket"===e?t.findIndex(function(e){return"pp_includes_external_id"===e.get("paths",g.c.List()).first(g.c.Map()).get("path","")}):"is_prepaid"===e?t.findIndex(function(e){return"connection_type"===e.get("paths",g.c.List()).first(g.c.Map()).get("path","")}):t.findIndex(function(e){return!["pp_includes_external_id","connection_type"].includes(e.get("paths",g.c.List()).first(g.c.Map()).get("path",""))})},OS=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=n.get("conditions",g.c.List()).withMutations(function(n){n.forEach(function(r,i){var o=r.get("unit",""),l=r.get("usaget","");if(""!==o&&""!==l){var s=r.get("value",0),c=Ie(e,t,l,o,s,a);n.setIn([i,"value"],c)}})});return r.isEmpty()?g.c.List():r},SS=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=n.getIn(["threshold_conditions",0],g.c.List()).withMutations(function(n){n.forEach(function(r,i){var o=r.get("unit",""),l=r.get("usaget",""),s=r.get("value",0);if(""!==o&&""!==l)if(g.c.List.isList(s)||Array.isArray(s)){var c=s.map(function(n){var r=Ie(e,t,l,o,n,a);return x()(r)?parseFloat(r):r});n.setIn([i,"value"],c)}else{var u=Ie(e,t,l,o,s,a),p=x()(u)?parseFloat(u):u;n.setIn([i,"value"],p)}!a&&g.c.Iterable.isIterable(s)&&n.setIn([i,"value"],s.toList()),a||g.c.Iterable.isIterable(s)||!["in","nin"].includes(r.get("op",""))||n.setIn([i,"value"],g.c.List([s]))})});return r.isEmpty()?g.c.List():r},TS=function(e,t){return function(e){return e.get("conditions",g.c.List()).reduce(function(e,t,n){return!0===e?e:t.has("path")},!1)}(e)?e.update("conditions",g.c.List(),function(e){return e.map(function(e){return function(e,t){var n=fS(g.c.List([g.c.Map({path:e.get("path","")})])),a=n.trigger,r=n.limitation,i=n.activityType,o=n.groupNames,l=n.overGroup,s=cS(a,r,{activityType:i,groupNames:o,overGroup:l,servicesData:t});return e.set("paths",s).set("property_type",e.get("usaget","")).delete("path")}(e,t)})}):e},kS=function(e,t,n){return e.withMutations(function(a){var r=n.propertyTypes,i=n.usageTypesData,o=n.effectOnUsagetFields,l=g.c.Map().withMutations(function(n){"fraud"===t&&e.getIn(["conditions",0]).forEach(function(e){o.includes(e.get("field",""))&&n.set(e.get("field",""),e.get("value",g.c.List()))})}),s=g.c.Map({id:Zt.a.v4(),eventUsageType:l});a.set("conditions",OS(r,i,e,!1)),a.has("threshold_conditions")&&a.setIn(["threshold_conditions",0],SS(r,i,e,!1)),a.set("ui_flags",s)})},jS=function(e,t,n){return e.withMutations(function(e){var a=n.propertyTypes,r=n.usageTypesData;if(e.delete("ui_flags"),"fraud"===t){var i=e.getIn(["conditions",0],g.c.List()).filter(function(e){return""!==e.get("field","")&&e.get("op","")});e.setIn(["conditions",0],i)}e.set("conditions",OS(a,r,e,!0)),e.has("threshold_conditions")&&e.setIn(["threshold_conditions",0],SS(a,r,e,!0))})},IS=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(t,n){var a="balancePrepaid"===e?"balance":e,r=""===a?"events":"events.".concat(a);return t(kl(r)).then(function(){var e=n(),r=ha(e),i=va(e),o=QO(e,{eventType:"fraud"}),l=Tr(e,{})||g.c.Map(),s={usageTypesData:r,propertyTypes:i,effectOnUsagetFields:o};e.settings.get("events",g.c.List()).forEach(function(e,n){if(!["settings"].includes(n)&&(""===a||a===n)){var r=e.map(function(e){return kS(e,n,s)}).map(function(e){return TS(e,l)});t(yl("events",n,r))}})})}},wS=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(t,n){var a=n(),r=ha(a),i=va(a),o="balancePrepaid"===e?"balance":e,l=a.settings.get("events",g.c.List()),s={usageTypesData:r,propertyTypes:i};l.forEach(function(e,n){if(!["settings"].includes(n)&&(""===o||o===n)){var a=e.map(function(e){return jS(e,n,s)});t(yl("events",n,a))}});var c=""===e?"events":"events.".concat(o);return t(Tl([c]))}},NS=function(e,t){return function(n,a){var r=a(),i=ha(r),o=va(r),l="balancePrepaid"===e?"balance":e,s=jS(t,l,{usageTypesData:i,propertyTypes:o}),c="event.".concat(l),u=ii(s,c);return ei(u).then(function(e){return n(Wr(e))}).catch(function(e){return n(Jr(e))})}},FS=function(e,t){return function(n,a){var r=["balancePrepaid","balance"].includes(e)?"balances":e,i=Ka(a(),{eventType:r}).findIndex(function(e){return e.getIn(["ui_flags","id"],"")===t.getIn(["ui_flags","id"],"")});return-1!==i?n(yl("events",["balancePrepaid"===e?"balance":e,i],t)):Promise.reject()}},xS=function(e){return function(t){return t(to("event_products",Pi(e.toArray(),{key:1,rates:1})))}},RS=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return""!==e||"Event Code is required"},MS=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return""!==e||"Field is required"},PS=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.c.Map();return""===e.get("field","")?"Threshold field is required":""===e.get("op","")?"Threshold Operator is required":!["",[]].includes(e.get("value",""))&&!g.c.is(g.c.List(),e.get("value",g.c.List()))||"Threshold value is required"},AS=function(e,t){return function(n){var a=!0,r=RS(e.get("event_code",""));(!0!==r&&(a=!1,n(Is("event_code",r))),"balancePrepaid"===t)&&e.get("conditions",g.c.List()).forEach(function(e){var t=function(e){var t=e.get("paths",g.c.List()).first(g.c.Map()).get("path","");return"pp_includes_external_id"===t?"bucket":"connection_type"===t?"is_prepaid":"value"}(e);if("bucket"===t){var r=function(e){return""!==e.get("value","")||"Field is required"}(e);!0!==r&&(a=!1,n(Is("bucket",r)))}else if("value"===t){var i=function(e){return""!==e.get("type","")||"Field is required"}(e);!0!==i&&(a=!1,n(Is("operator",i)));var o=function(e){if(""===e.get("value","")&&oS(e.get("type","")).get("extra_field",!0))return"Field is required";return!0}(e);!0!==o&&(a=!1,n(Is("value",o)))}});if("fraud"===t){var i=MS(e.getIn(["recurrence","value"],""));!0!==i&&(a=!1,n(Is("recurrence.value",i)));var o=MS(e.getIn(["date_range","value"],""));!0!==o&&(a=!1,n(Is("date_range.value",o)));var l=e.getIn(["threshold_conditions",0],g.c.List());l.isEmpty()?(a=!1,n(Is("threshold_condition.0",PS()))):l.forEach(function(e,t){var r=PS(e);!0!==r&&(a=!1,n(Is("threshold_condition.".concat(t),r)))})}return a}},DS=function(e){var t,n=e.eventsSettings,a=e.methodOptions,i=e.decoderOptions,o=Object(mt.a)(e,["eventsSettings","methodOptions","decoderOptions"]),l=function(e,t){return function(n){o.onEdit(e,t,n)}};return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{header:"HTTP",key:"http"},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Url ",r.a.createElement(Ao,{contents:"URL to send the requests to"})),r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{id:"url",value:n.getIn(["http","url"],""),onChange:(t="http",function(e){var n=e.target,a=n.value,r=n.id;o.onEdit(t,r,a)})}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Method ",r.a.createElement(Ao,{contents:"HTTP method"})),r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{fieldType:"select",value:n.getIn(["http","method"],""),onChange:l("http","method"),options:a}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Decoder ",r.a.createElement(Ao,{contents:"Method to decode HTTP response"})),r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{fieldType:"select",value:n.getIn(["http","decoder"],""),onChange:l("http","decoder"),options:i})))),r.a.createElement(f.v,{header:"Mail",key:"mail"},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:2,componentClass:f.h},"Mails ",r.a.createElement(Ao,{contents:"Send events to the following email addresses (For supported events)"})),r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{fieldType:"tags",value:n.getIn(["email","global_addresses"],g.c.List()).toArray(),onChange:function(e){o.onEdit("email","global_addresses",g.c.List(e))},addOnPaste:!0,pasteSplit:function(e){return e.split(new RegExp([",",";","\\(","\\)","\\*","/",":","\\?","\n","\r","\t"].join("|"))).map(function(e){return e.trim()})}}))))),r.a.createElement(f.g,{sm:12},r.a.createElement(v,{onClickSave:o.onSave,onClickCancel:o.onCancel})))};DS.defaultProps={eventsSettings:g.c.Map(),methodOptions:[{value:"post",label:"POST"},{value:"get",label:"GET"}],decoderOptions:[{value:"json",label:"JSON"},{value:"xml",label:"XML"}]};var LS=DS,US=Object(l.connect)(function(e,t){return{eventsSettings:Ua(e,t)}},function(e){return{onCancel:function(){var t={message:"Are you sure you want to cancel event settings changes?",onOk:function(){e(function(e){return e(kl(["events.settings"]))})},labelOk:"Yes",labelCancel:"No",type:"delete"};return e(ks(t))},onEdit:function(t,n,a){e(function(e,t){return function(n){return n(yl("events",["settings"].concat(Object(N.a)(e)),t))}}([t,n],a))},onSave:function(){e(function(e){return e(Tl(["events.settings"]))})}}})(LS),VS=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={filter:""},n.onChangeFilter=function(e){n.setState(function(){return{filter:e}})},n.onClearFilter=function(e){n.setState(function(){return{filter:""}})},n.parseShowEnable=function(e){return!e.get("active",!0)},n.parseShowDisable=function(e){return!n.parseShowEnable(e)},n.parserStatus=function(e){return r.a.createElement(I,{status:e.get("active",!0)?"active":"expired"})},n.parserThreshold=function(e){var t=n.props.thresholdFields;return e.getIn(["threshold_conditions",0],g.c.List()).map(function(e){return e.get("field","")}).map(function(e){return t.find(function(t){return t.get("id","")===e},null,g.c.Map()).get("title",Object(D.sentenceCase)(e))}).join(", ")},n.getListFields=function(){var e=n.props.eventType,t=[{id:"active",title:"Status",parser:n.parserStatus,cssClass:"state"},{id:"event_code",title:"Event Code"},{id:"event_description",title:"Description"}];return"fraud"===e&&t.push({id:"threshold",title:"Threshold",parser:n.parserThreshold}),t},n.getListActions=function(){return[{type:"enable",showIcon:!0,helpText:"Enable",onClick:n.props.onEnable,show:n.parseShowEnable},{type:"disable",showIcon:!0,helpText:"Disable",onClick:n.props.onDisable,show:n.parseShowDisable},{type:"edit",showIcon:!0,helpText:"Edit",onClick:n.props.onEdit},{type:"clone",showIcon:!0,helpText:"Clone",onClick:n.props.onClone},{type:"remove",showIcon:!0,helpText:"Remove",onClick:n.props.onRemove}]},n.getPanelActions=function(){return[{type:"add",actionStyle:"primary",actionSize:"xsmall",label:"Add new",onClick:n.props.onNew}]},n.filterItems=function(){var e=n.props.items,t=n.state.filter;return t?e.filter(function(e){return e.get("event_code","").includes(t)}):e},n.renderPanelHeader=function(e){var t=n.state.filter;return r.a.createElement("div",null,"\xa0",r.a.createElement("div",{className:"pull-left"},r.a.createElement(Au,{filter:t,placeholder:"Filter by event code...",onChange:n.onChangeFilter,onClear:n.onClearFilter})),""!==t&&r.a.createElement(f.p,{className:"filter-info"},e),r.a.createElement("div",{className:"pull-right"},r.a.createElement(vt,{actions:n.getPanelActions()})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.items,t=this.filterItems(),n=this.getListFields(),a=this.getListActions(),i=Gp()("event",e.size),o="Showing ".concat(t.size," of ").concat(e.size," ").concat(i);return r.a.createElement("div",null,r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{header:this.renderPanelHeader(o)},r.a.createElement(ju,{items:t,fields:n,actions:a}))))}}]),t}(a.Component);VS.defaultProps={items:g.c.List(),thresholdFields:g.c.List()};var BS=VS,qS=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={unitLabel:""},n.onChangeTrigger=function(e){var t=n.props,a=t.onChangeField,r=t.item,i=t.index,o=t.limitation,l=t.servicesData,s=e.target.value,c=cS(s,"usagev"===s&&"none"===o?"group":o,{activityType:"",groupNames:"",overGroup:"",servicesData:l});a(["conditions",i],r.withMutations(function(e){e.set("paths",c),e.set("unit",""),e.set("usaget",""),e.set("property_type","")}))},n.onChangeOverGroup=function(e){var t=n.props,a=t.onChangeField,r=t.index,i=t.trigger,o=t.activityType,l=t.groupNames,s=t.limitation,c=t.servicesData,u=e.target.value;a(["conditions",r,"paths"],cS(i,s,{activityType:o,groupNames:l,overGroup:u,servicesData:c}))},n.onChangeLimitation=function(e){var t=n.props,a=t.onChangeField,r=t.index,i=t.trigger,o=t.activityType,l=t.groupNames,s=t.servicesData,c=e.target.value;a(["conditions",r,"paths"],cS(i,c,{activityType:o,groupNames:l,overGroup:"",servicesData:s})),a(["conditions",r,"property_type"],""),a(["conditions",r,"unit"],""),a(["conditions",r,"usaget"],"")},n.onChangePropertyType=function(e){var t=n.props,a=t.onChangeField,r=t.item,i=t.index,o=t.trigger,l=t.limitation,s=t.servicesData,c=cS(o,l,{activityType:"",groupNames:"",overGroup:"",servicesData:s});a(["conditions",i],r.withMutations(function(t){t.set("property_type",e),t.set("paths",c),t.set("unit",""),t.set("usaget","")}))},n.onChangeActivityType=function(e){var t=n.props,a=t.onChangeField,r=t.item,i=t.index,o=t.trigger,l=t.limitation,s=t.overGroup,c=t.servicesData,u=cS(o,l,{activityType:e,groupNames:"",overGroup:s,servicesData:c});a(["conditions",i],r.withMutations(function(t){t.set("paths",u),t.set("unit",""),t.set("usaget",e)}))},n.onChangeGroupNames=function(e){var t=n.props,a=t.onChangeField,r=t.item,i=t.index,o=t.trigger,l=t.limitation,s=t.servicesData,c=cS(o,l,{activityType:"",groupNames:e,servicesData:s}),u=""!==e?n.getGroupUnit(e.split(",").pop()):"",p=""!==e?n.getGroupActivityType(e.split(",").pop()):"";a(["conditions",i],r.withMutations(function(e){e.set("paths",c),e.set("unit",u),e.set("usaget",p)}))},n.onChangeType=function(e){var t=n.props,a=t.onChangeField,r=t.index,i=t.item;"reached_percentage"===e?a(["conditions",r],i.set("type",e).set("unit","")):a(["conditions",r,"type"],e)},n.onChangeValue=function(e){var t=n.props;(0,t.onChangeField)(["conditions",t.index,"value"],e.target.value)},n.onChangeTagValue=function(e){var t=n.props,a=t.onChangeField,r=t.index;return"reached_percentage"===t.item.get("type","")?a(["conditions",r,"value"],n.filterPercentageMultiValues(e)):a(["conditions",r,"value"],e)},n.onChangeUnit=function(e){var t=n.props;(0,t.onChangeField)(["conditions",t.index,"unit"],e)},n.filterPercentageMultiValues=function(e){return e.split(",").filter(function(e){return""!==e}).filter(function(e){if(!x()(e))return n.props.dispatch(Vr("Condition value must be numeric")),!1;var t=parseFloat(e);return t<=0?(n.props.dispatch(Vr("Condition value should be greater than zero")),!1):!(t>100)||(n.props.dispatch(Vr("Condition value cannot be greater than 100")),!1)}).join(",")},n.filterRelevantGroups=function(e){var t=n.props,a=t.trigger,r=t.usageTypesData,i=t.item,o=t.groupsData,l=n.props.groupsData.hasIn([e,"cost"]);return!("cost"!==a||!l)||"usagev"===a&&!l&&i.get("property_type","")===ke(r,o.getIn([e,"usage_types"],g.c.Map()).keySeq().first())},n.getGroupNamesOptions=function(){return n.props.groupsOptions.filter(n.filterRelevantGroups).map(function(e){return mS(e,n.props.servicesData)}).toArray()},n.getPropertyTypesOptions=function(){return n.props.propertyTypeOptions.map(function(e){return{value:e,label:Object(D.upperCaseFirst)(e)}}).toArray()},n.getGroupUnit=function(e){return n.props.groupsData.getIn([e,"unit"],"")},n.getGroupActivityType=function(e){return xe(n.props.groupsData.get(e,g.c.Map()))},n.onChangeMultiValues=function(e){Array.isArray(e)?n.onChangeTagValue(e.join(",")):n.onChangeTagValue("")},n.renderCustomInputNumber=function(e){e.addTag;var t=e.onChange,n=e.value,a=Object(mt.a)(e,["addTag","onChange","value"]);return r.a.createElement("input",Object.assign({type:"number",onChange:t,value:n},a))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){if(this.props.dispatch(Gg()),""===this.props.trigger){this.onChangeTrigger({target:{value:"usagev"}})}}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,a=n.onChangeField,r=n.index,i=n.item,o=n.conditionsOperators,l=i.get("type",""),s=e.item.get("type","");s!==l&&a(["conditions",r],i.withMutations(function(e){oS(l).get("type","text")!==oS(s).get("type","text")&&e.set("value",""),"reached_percentage"===l&&(e.set("unit",""),e.set("value",""))}));""!==i.get("type","")&&-1===o.findIndex(function(e){return e.value===i.get("type","")})&&this.onChangeType("")}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.index,a=e.conditionsOperators,i=e.trigger,o=e.limitation,l=e.activityType,s=e.groupNames,c=e.overGroup,u=e.propertyTypes,p=e.usageTypesData,d=e.currency,m="group"===o?t.get("usaget",""):l,g=t.get("property_type",""),h=vS(t.get("unit",""),i,m,u,p,d,t.get("type","")),v=oS(t.get("type","")),y="usagev"===i&&"group"===o&&""!==s&&"reached_percentage"!==t.get("type","");return r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:4,smOffset:1,xsOffset:0,xs:12,className:"text-left",componentClass:f.h},"Condition Trigger"),r.a.createElement(f.g,{sm:7,smOffset:0,xsOffset:1,xs:11,className:"pl30"},r.a.createElement(f.g,{sm:12},r.a.createElement("span",{className:"inline mr40"},r.a.createElement(Tn,{fieldType:"radio",name:"condition-trigger-".concat(n),id:"condition-trigger-monetary-".concat(n),value:"cost",checked:"cost"===i,onChange:this.onChangeTrigger,label:"Monetary"})),r.a.createElement("span",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",name:"condition-trigger-".concat(n),id:"condition-trigger-usagev-".concat(n),value:"usagev",checked:"usagev"===i,onChange:this.onChangeTrigger,label:"Usage"}))))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:11,smOffset:1,xsOffset:0,xs:12,className:"text-left",componentClass:f.h},"Condition Limitations"),r.a.createElement(f.g,{sm:10,smOffset:2,xsOffset:1,xs:11},r.a.createElement(Tn,{fieldType:"radio",name:"condition-limitation-".concat(n),id:"condition-limitation-none-".concat(n),value:"none",checked:"none"===o,onChange:this.onChangeLimitation,disabled:"usagev"===i,label:"Total Amount"})),r.a.createElement(f.g,{sm:10,smOffset:2,xsOffset:1,xs:11},r.a.createElement(Tn,{fieldType:"radio",name:"condition-limitation-".concat(n),id:"condition-limitation-group-".concat(n),value:"group",checked:"group"===o,onChange:this.onChangeLimitation,label:"Limit to any of the Groups"})),r.a.createElement(f.g,{sm:10,smOffset:2,xsOffset:2,xs:10},"usagev"===i&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.g,{sm:4,componentClass:f.h}," Property Type:"),r.a.createElement(f.g,{sm:8,className:"form-inner-edit-row pr0"},r.a.createElement(Tn,{fieldType:"select",id:"condition-limitation-property-type-".concat(n),onChange:this.onChangePropertyType,value:g,options:this.getPropertyTypesOptions(),disabled:"group"!==o}))),r.a.createElement(f.g,{sm:4,componentClass:f.h}," Groups Included:"),r.a.createElement(f.g,{sm:8,className:"form-inner-edit-row pr0"},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeGroupNames,value:s,options:this.getGroupNamesOptions(),disabled:"group"!==o||""===g&&"usagev"===i,multi:!0})),"usagev"===i&&"reached_percentage"!==t.get("type","")?r.a.createElement(r.a.Fragment,null,r.a.createElement(f.g,{sm:4,componentClass:f.h},"Units of Measure:"),r.a.createElement(f.g,{sm:8,className:"form-inner-edit-row pr0"},r.a.createElement(Dp,{usaget:m,unit:""!==s?t.get("unit",""):"",onChangeUsaget:this.onChangeActivityType,onChangeUnit:this.onChangeUnit,enabled:y,showUnits:!0,showAddButton:!1,showSelectTypes:!1}))):r.a.createElement(f.g,{sm:12,className:"form-inner-edit-row pr0 pn10 input-min-line-height"},"\xa0")),r.a.createElement(f.g,{sm:3,smOffset:2,xsOffset:1,xs:11},r.a.createElement(Tn,{fieldType:"radio",name:"condition-limitation-".concat(n),id:"condition-limitation-activity-".concat(n),value:"activity_type",checked:"activity_type"===o,onChange:this.onChangeLimitation,label:"Limit to Activity Type"})),r.a.createElement(f.g,{sm:7,smOffset:0,xsOffset:2,xs:10,className:"form-inner-edit-row pl40 pr15"},r.a.createElement(Dp,{usaget:l,unit:t.get("unit",""),onChangeUsaget:this.onChangeActivityType,onChangeUnit:this.onChangeUnit,enabled:"activity_type"===o,showUnits:"usagev"===i&&"activity_type"===o})),"usagev"===i&&"activity_type"===o&&r.a.createElement(f.g,{sm:10,smOffset:2,xsOffset:2,xs:10},r.a.createElement(f.g,{sm:8,smOffset:4,className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:12},r.a.createElement("span",{className:"inline mr40"},r.a.createElement(Tn,{fieldType:"radio",name:"condition-over-group-".concat(n),id:"condition-over-group-all-units-".concat(n),value:"none",checked:"over_group"!==c,onChange:this.onChangeOverGroup,enabled:"activity_type"===o,label:r.a.createElement("span",{className:"helpable"},r.a.createElement(It,{helpText:Go.over_group},"Per balance"))})),r.a.createElement("span",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",name:"condition-over-group-".concat(n),id:"condition-over-group-exceeding-units-".concat(n),value:"over_group",checked:"over_group"===c,onChange:this.onChangeOverGroup,label:"Exceeding units",disabled:"activity_type"!==o})))))),r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:4,smOffset:1,xsOffset:0,xs:12,className:"text-left",componentClass:f.h},"Condition Type"),r.a.createElement(f.g,{sm:7,smOffset:0,xsOffset:2,xs:10,className:"pl40"},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeType,value:t.get("type",""),options:a}))),v.get("extra_field",!0)&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:4,smOffset:1,xsOffset:0,xs:12,className:"text-left",componentClass:f.h},"Condition Value"),r.a.createElement(f.g,{sm:7,smOffset:0,xsOffset:2,xs:10,className:"pl40"},r.a.createElement(f.o,{className:"full-width"},"tags"!==v.get("type","text")?r.a.createElement(Tn,{id:"cond-value-".concat(n),onChange:this.onChangeValue,value:t.get("value",""),fieldType:v.get("type","text")}):r.a.createElement(Tn,{fieldType:"tags",id:"cond-value-".concat(n),onChange:this.onChangeMultiValues,value:String(t.get("value","")).split(",").filter(function(e){return""!==e}),renderInput:this.renderCustomInputNumber,onlyUnique:"tags"===v.get("type","")}),""!==h&&r.a.createElement(f.o.Addon,null,h)))))}}]),t}(a.Component);qS.defaultProps={item:g.c.Map(),index:-1,onChangeField:function(){},trigger:"",limitation:"",activityType:"",groupNames:"",overGroup:"none",conditionsOperators:[],groupsOptions:g.c.List(),propertyTypes:g.c.List(),usageTypesData:g.c.List(),groupsData:g.c.Map(),servicesData:g.c.Map(),propertyTypeOptions:g.c.Set(),currency:""},qS.defaultProps={eventType:"balance"};var zS=Object(l.connect)(function(e,t){var n=fS(t.item.get("paths",g.c.List())),a=n.trigger,r=n.limitation,i=n.activityType,o=n.groupNames,l=n.overGroup,s=zO(null,qS.defaultProps);return"activity_type"===r&&(s=s.filter(function(e){return"reached_percentage"!==e.value})),{trigger:a,limitation:r,activityType:i,groupNames:o,propertyTypeOptions:kr(e,t)||g.c.Set(),overGroup:l,groupsOptions:hr(e,t)||g.c.List(),groupsData:Or(e,t)||g.c.Map(),currency:pa(e,t),servicesData:Tr(e,t)||g.c.Map(),conditionsOperators:s}})(qS),HS=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={editedConditionIndex:-1},n.onChangeEventCode=function(e){var t=e.target.value,a=RS(t);n.props.setError("event_code",!0===a?null:a),n.props.updateField(["event_code"],t)},n.onChangeField=function(e){return function(t){var a=t.target.value;n.props.updateField(e,a)}},n.onChangeActive=function(e){var t=e.target.value;n.props.updateField(["active"],"yes"===t)},n.addCondition=function(){var e=n.props.item.get("conditions",g.c.List()).push(g.c.Map());n.props.updateField(["conditions"],e),n.setState({editedConditionIndex:e.size-1})},n.editCondition=function(e){return function(){n.setState({editedConditionIndex:e})}},n.hideEditCondition=function(){n.setState({editedConditionIndex:-1})},n.removeCondition=function(e){return function(){var t=n.props.item.get("conditions",g.c.List()).delete(e);n.props.updateField(["conditions"],t)}},n.renderConditionEditForm=function(e,t){var a=n.props,i=a.propertyTypes,o=a.usageTypesData;return r.a.createElement(zS,{item:e,index:t,onChangeField:n.props.updateField,propertyTypes:i,usageTypesData:o})},n.showConditionDetails=function(e){return n.state.editedConditionIndex===e},n.getConditionActions=function(e){return[{type:"edit",onClick:n.editCondition(e),show:!n.showConditionDetails(e)},{type:"collapse",onClick:n.hideEditCondition,show:n.showConditionDetails(e)},{type:"remove",onClick:n.removeCondition(e)}]},n.renderCondition=function(e,t){var a=n.props,i={propertyTypes:a.propertyTypes,usageTypesData:a.usageTypesData,currency:a.currency,activityType:"counter"};return r.a.createElement(f.l,{key:t,className:"mb0"},r.a.createElement(f.g,{sm:12},r.a.createElement("div",{className:"inline pr100"},bS(e,i)),r.a.createElement("span",{className:"pull-right List row pr10 line-actions"},r.a.createElement(vt,{actions:n.getConditionActions(t)}))),r.a.createElement(f.g,{sm:12},r.a.createElement(f.v,{collapsible:!0,expanded:n.state.editedConditionIndex===t},n.renderConditionEditForm(e,t))))},n.renderConditions=function(){return n.props.item.get("conditions",g.c.List()).map(n.renderCondition).toArray()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.errors.get("event_code",!1);return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("span",null,"Details")},r.a.createElement(f.l,{validationState:n?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Event Code",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{id:"label",onChange:this.onChangeEventCode,value:t.get("event_code","")}),n&&r.a.createElement(f.n,null,n))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Description"),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{id:"description",onChange:this.onChangeField(["event_description"]),value:t.get("event_description","")}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Status"),r.a.createElement(f.g,{sm:7},r.a.createElement("span",null,r.a.createElement("span",{className:"mr20 inline"},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"yes",label:"Active",checked:t.get("active",!0)})),r.a.createElement("span",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"no",label:"Inactive",checked:!t.get("active",!0)})))))),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Conditions")},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},this.renderConditions()),r.a.createElement(f.g,{sm:12},r.a.createElement(ct,{onClick:this.addCondition,label:"Add Condition"})))))}}]),t}(a.Component);HS.defaultProps={item:g.c.Map(),propertyTypes:g.c.List(),usageTypesData:g.c.List(),errors:g.c.Map(),currency:""};var YS=Object(l.connect)(function(e,t){return{propertyTypes:va(e,t),usageTypesData:ha(e,t),currency:pa(e,t)}})(HS),GS=function(e){var t=e.item,n=e.eventsSettings,a=e.errors,i=e.onUpdate,o=e.setError,l=t.getIn(["recurrence","type"],""),s=ES(l),c=CS(l),u=t.getIn(["date_range","type"],""),p=ES(u),d=CS(u),m=n.getIn(["email","global_addresses"],g.c.List()),h=function(e){i(["recurrence","type"],e),i(["recurrence","value"],"")},v=function(e){i(["date_range","type"],e),i(["date_range","value"],"")},y=function(e){var t=e.target.value;i(["active"],"yes"===t)},b=m.isEmpty()?[]:[{value:"global",label:"Global emails (".concat(m.join(", "),")")}],E=function(){var e=t.getIn(["notify_by_email","additional_addresses"],g.c.List());return t.getIn(["notify_by_email","use_global_addresses"],!1)&&!m.isEmpty()?e.insert(0,"global").toArray():e.toArray()}(),C=t.getIn(["notify_by_email","notify"],!1),_=a.get("event_code",!1),O=a.get("recurrence.value",!1),S=a.get("date_range.value",!1);return r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,{validationState:_?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Event Code ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{onChange:function(e){var t=e.target.value;i(["event_code"],t);var n=RS(t);o("event_code",!0===n?null:n)},value:t.get("event_code","")}),_&&r.a.createElement(f.n,null,_))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Description"),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{onChange:function(e){var t=e.target.value;i(["event_description"],t)},value:t.get("event_description","")}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Notify also by email"),r.a.createElement(f.g,{sm:7},r.a.createElement(f.o,null,r.a.createElement(f.o.Addon,null,r.a.createElement(Tn,{fieldType:"checkbox",id:"computed-must-met",value:C,onChange:function(e){var t=e.target.value;i(["notify_by_email","notify"],t),i(["notify_by_email","use_global_addresses"],t),t||i(["notify_by_email","additional_addresses"],g.c.List())},label:""})),r.a.createElement(Tn,{allowCreate:!0,multi:!0,placeholder:C?"Select or add new email address":"No",addLabelText:"Add {label}?",noResultsText:"Add email address...",clearable:!0,fieldType:"select",options:b,value:E.join(","),onChange:function(e){var t=g.c.List(e.length?e.split(","):[]);t.includes("global")?i(["notify_by_email","use_global_addresses"],!0):i(["notify_by_email","use_global_addresses"],!1);var n=t.findIndex(function(e){return"global"===e}),a=-1===n?t:t.remove(n);i(["notify_by_email","additional_addresses"],a)},disabled:!C})))),r.a.createElement(f.l,{validationState:O?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Run every ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(f.o,null,r.a.createElement(Tn,{fieldType:"select",options:c,value:t.getIn(["recurrence","value"],""),onChange:function(e){i(["recurrence","value"],e);var t=MS(e);o("recurrence.value",!0===t?null:t)}}),r.a.createElement(f.i,{id:"balance-period-unit",componentClass:f.o.Button,title:s},r.a.createElement(f.q,{eventKey:"minutely",onSelect:h},"Minutes"),r.a.createElement(f.q,{eventKey:"hourly",onSelect:h},"Hours"))),O&&r.a.createElement(f.n,null,O))),r.a.createElement(f.l,{validationState:S?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"For the previous ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(f.o,null,r.a.createElement(Tn,{fieldType:"select",options:d,value:t.getIn(["date_range","value"],""),onChange:function(e){i(["date_range","value"],e);var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return""!==e||"Field is required"}(e);o("date_range.value",!0===t?null:t)}}),r.a.createElement(f.i,{id:"balance-period-unit",componentClass:f.o.Button,title:p},r.a.createElement(f.q,{eventKey:"minutely",onSelect:v},"Minutely"),r.a.createElement(f.q,{eventKey:"hourly",onSelect:v},"Hourly"))),S&&r.a.createElement(f.n,null,S))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Status"),r.a.createElement(f.g,{sm:7},r.a.createElement("span",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:20}},r.a.createElement(Tn,{fieldType:"radio",onChange:y,name:"step-active-status",value:"yes",label:"Active",checked:t.get("active",!0)})),r.a.createElement("span",{style:{display:"inline-block"}},r.a.createElement(Tn,{fieldType:"radio",onChange:y,name:"step-active-status",value:"no",label:"Inactive",checked:!t.get("active",!0)}))))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"\xa0"),r.a.createElement(f.g,{sm:7,style:{marginTop:10,paddingLeft:18}},r.a.createElement(Tn,{fieldType:"checkbox",id:"computed-must-met",value:t.get("lines_overlap",""),onChange:function(e){var t=e.target.value;i(["lines_overlap"],t)},label:"Events' lines overlap is allowed"}))))};GS.defaultProps={item:g.c.Map(),eventsSettings:g.c.Map(),errors:g.c.Map()};var KS=GS,WS=function(e){var t=e.condition,n=e.eventUsageTypes,i=e.effectOnUsagetFields,o=e.index,l=e.conditionField,s=e.conditionsFieldSelectOptions,c=e.conditionOperator,u=e.conditionsOperatorsSelectOptions,p=e.onUpdate,d=e.onRemove,m=e.setEventUsageType,h=e.getEventRates,v=t.getIn(["field"],""),y=t.getIn(["op"],""),b=i.includes(v),E=""===v,C=""===y||E,_=t.set("value",t.get("value",g.c.List()).join(",")),O=Object(a.useCallback)(function(e){b&&m(n.set(v,e))},[b,m,n,v]),S=Object(a.useCallback)(function(e){var t=g.c.Map({field:e,op:"",value:g.c.List()});O(g.c.List()),p([o],t)},[o,p,O]),T=Object(a.useCallback)(function(e){p([o,"op"],e)},[o,p]),k=Object(a.useCallback)(function(e){var t=g.c.List(e.length?e.split(","):[]);if(p([o,"value"],t),b&&(O(t),"arate_key"===v)){var a=t.filter(function(e){return!n.get("arate_key",g.c.List()).includes(e)});h(a)}},[o,p,h,b,O,v,n]),j=Object(a.useMemo)(function(){return[{type:"remove",onClick:function(e){O(g.c.List()),d(e)},actionStyle:"default",helpText:"Remove Condition"}]},[d,O]);return r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_filter"},"Filter")),r.a.createElement(f.g,{sm:4,className:"pl0"},r.a.createElement(Tn,{id:"condition_field",fieldType:"select",options:s,onChange:S,value:v})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_operator"},"Operator")),r.a.createElement(f.g,{sm:3},r.a.createElement(Tn,{id:"condition_operator",fieldType:"select",options:u,onChange:T,value:t.getIn(["op"],""),disabled:E})),r.a.createElement(f.g,{smHidden:!0,mdHidden:!0,lgHidden:!0},r.a.createElement("label",{htmlFor:"condition_value"},"Value")),r.a.createElement(f.g,{sm:4},r.a.createElement(Zg,{field:_,config:l,operator:c,disabled:C,onChange:k})),r.a.createElement(f.g,{sm:1,className:"actions"},r.a.createElement(vt,{actions:j,data:o})))};WS.defaultProps={condition:g.c.Map(),eventUsageTypes:g.c.Map(),effectOnUsagetFields:g.c.List(),conditionField:g.c.Map(),conditionsFieldSelectOptions:[],conditionOperator:g.c.Map(),conditionsOperatorsSelectOptions:[]};var JS=Object(l.connect)(function(e,t){return{conditionField:GO(e,{eventType:"fraud"}).find(function(e){return e.get("id","")===t.condition.getIn(["field"],"")},null,g.c.Map()),conditionsFieldSelectOptions:KO(e,Object(Ks.a)({},t,{eventType:"fraud"})),conditionOperator:qO(e,{eventType:"fraud"}).find(function(e){return e.get("id","")===t.condition.getIn(["op"],"")},null,g.c.Map()),conditionsOperatorsSelectOptions:zO(null,{eventType:"fraud"}),effectOnUsagetFields:QO(e,{eventType:"fraud"})}})(WS),$S=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeThresholdField=function(e){var t=n.props.index;n.props.onUpdate([t,"field"],e),n.props.setError("threshold_condition.".concat(t),null)},n.onChangeThresholdOperator=function(e){var t=n.props,a=t.index,r=t.threshold;n.props.onUpdate([a,"op"],e),["in","nin"].includes(e)&&!["in","nin"].includes(r.getIn(["op"],""))&&n.props.onUpdate([a,"value"],g.c.List()),!["in","nin"].includes(e)&&["in","nin"].includes(r.getIn(["op"],""))&&n.props.onUpdate([a,"value"],""),n.props.setError("threshold_condition.".concat(a),null)},n.onChangeThresholdValue=function(e){var t=n.props,a=t.index,r=t.threshold;if(["in","nin"].includes(r.getIn(["op"],""))){var i=g.c.List(e.length?e.split(","):[]).map(function(e){return x()(e)?parseFloat(e):e});n.props.onUpdate([a,"value"],i)}else{var o=x()(e)?parseFloat(e):e;n.props.onUpdate([a,"value"],o),n.props.setError("threshold_condition.".concat(a),null)}},n.onChangeThresholdUnit=function(e){var t=n.props,a=t.index,r=t.usaget;n.props.onUpdate([a,"unit"],e),n.props.onUpdate([a,"usaget"],r),n.props.setError("threshold_condition.".concat(a),null)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.index,a=t.eventPropertyType;g.c.is(a,e.eventPropertyType)||this.props.onUpdate([n],g.c.Map())}},{key:"render",value:function(){var e=this.props,t=e.index,n=e.threshold,a=e.eventPropertyType,i=e.thresholdFields,o=e.thresholdFieldsSelectOptions,l=e.thresholdOperatorsSelectOptions,s=e.usaget,c=e.currency,u=e.errors,p=n.get("value",g.c.List()),d=g.c.List.isList(p)||Array.isArray(p)?n.set("value",p.join(",")):n,m=n.getIn(["field"],""),h=n.getIn(["op"],""),v=""===m,y=""===h||v,b=i.find(function(e){return e.get("id")===m},null,g.c.Map()),E=["aprice","final_charge"].includes(m)?g.c.Map({suffix:c}):g.c.Map(),C=u.get("threshold_condition.".concat(t),!1),_=1===a.size&&!["aprice","final_charge"].includes(m);return r.a.createElement(f.l,{className:"form-inner-edit-row pl0 pr0",validationState:C?"error":null},r.a.createElement(f.g,{componentClass:f.h,smHidden:!0,mdHidden:!0,lgHidden:!0},"Field ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:_?3:4},r.a.createElement(Tn,{id:"threshold_field",fieldType:"select",options:o,onChange:this.onChangeThresholdField,value:n.getIn(["field"],"")})),r.a.createElement(f.g,{componentClass:f.h,smHidden:!0,mdHidden:!0,lgHidden:!0},"Operator ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:_?3:4},r.a.createElement(Tn,{id:"threshold_operator",fieldType:"select",options:l,onChange:this.onChangeThresholdOperator,disabled:v,value:n.getIn(["op"],"")})),r.a.createElement(f.g,{componentClass:f.h,smHidden:!0,mdHidden:!0,lgHidden:!0},"Value ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:_?3:4},r.a.createElement(Zg,{field:d,config:b,operator:E,disabled:y,onChange:this.onChangeThresholdValue})),_&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.g,{componentClass:f.h,smHidden:!0,mdHidden:!0,lgHidden:!0},"Unit of measure ",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:3,className:"pr0 pl5"},r.a.createElement(Dp,{usaget:s,unit:n.get("unit",""),onChangeUnit:this.onChangeThresholdUnit,enabled:!0,showUnits:!0,showSelectTypes:!1}))),C&&r.a.createElement(f.g,{sm:12},r.a.createElement(f.n,null,C)))}}]),t}(a.Component);$S.defaultProps={threshold:g.c.Map(),eventPropertyType:g.c.Set(),thresholdFieldsSelectOptions:[],thresholdFields:g.c.List(),thresholdOperatorsSelectOptions:[],currency:"",usaget:"",errors:g.c.Map()};var QS=Object(l.connect)(function(e,t){var n=ha(e,t);return{currency:pa(e,t),thresholdFields:$O(null,{eventType:"fraud"}),usaget:1===t.eventPropertyType.size?n.find(function(e){return e.get("property_type","")===t.eventPropertyType.first()},null,g.c.Map()).get("usage_type",""):""}})($S),ZS=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={status:"loading"},n.initEvent=function(){n.props.dispatch(kl(["lines.fields"])).then(n.initEventRates).then(n.setStatusDone).catch(n.setStatusError)},n.initEventRates=function(){var e=n.props.item.getIn(["ui_flags","eventUsageType","arate_key"],g.c.List());return e.isEmpty()?Promise.resolve():n.props.dispatch(xS(e))},n.setStatusDone=function(){n.setState(function(){return{status:"done"}})},n.setStatusError=function(){n.setState(function(){return{status:"error"}})},n.getEventRates=function(e){e.isEmpty()||n.props.dispatch(xS(e))},n.onChangeText=function(e){return function(t){var a=t.target.value;n.props.updateField(e,a)}},n.onChangeSelect=function(e){return function(t){n.props.updateField(e,t)}},n.onRemoveCondition=function(e){var t=n.props.item.getIn(["conditions",0],g.c.List()).delete(e);n.props.updateField(["conditions",0],t)},n.onUpdateCondition=function(e,t){n.props.updateField(["conditions",0].concat(Object(N.a)(e)),t)},n.onChangeThreshold=function(e,t){n.props.updateField(["threshold_conditions",0].concat(Object(N.a)(e)),t)},n.setEventUsageType=function(e){n.props.updateField(["ui_flags","eventUsageType"],e)},n.onAddCondition=function(){var e=n.props.item,t=g.c.List([].concat(Object(N.a)(e.getIn(["conditions",0],g.c.List())),[g.c.Map({field:"",op:"",value:g.c.List()})]));n.props.updateField(["conditions",0],t)},n.renderConditions=function(){var e=n.props.item,t=e.getIn(["conditions",0],g.c.List()).map(function(e){return e.get("field","")}),a=e.getIn(["ui_flags","eventUsageType"],g.c.Map()),i=e.getIn(["conditions",0],g.c.List()).map(function(e,i){return r.a.createElement(JS,{key:"condition_0_".concat(i),condition:e,index:i,usedFields:t,eventUsageTypes:a,onUpdate:n.onUpdateCondition,onRemove:n.onRemoveCondition,setEventUsageType:n.setEventUsageType,getEventRates:n.getEventRates})});return r.a.createElement("div",{className:"fraud-event-conditions"},r.a.createElement(f.g,{sm:12,className:"form-inner-edit-rows"},!i.isEmpty()&&r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"field_field"},"Filter")),r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"operator_field"},"Operator")),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"value_field"},"Value")))),r.a.createElement(f.g,{sm:12},i),r.a.createElement(f.g,{sm:12,className:"pl0 pr0"},r.a.createElement(ct,{onClick:n.onAddCondition,label:"Add Condition",disabled:!1,title:""})))},n.renderThreshold=function(){var e=n.props,t=e.item,a=e.eventPropertyType,i=e.thresholdFieldsSelectOptions,o=e.thresholdOperatorsSelectOptions,l=e.errors,s=t.getIn(["threshold_conditions",0,0],g.c.Map());return r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"threshold_field"},"Field",r.a.createElement("span",{className:"danger-red"}," *"))),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"threshold_operator"},"Operator",r.a.createElement("span",{className:"danger-red"}," *"))),r.a.createElement(f.g,{sm:4,xsHidden:!0},r.a.createElement("label",{htmlFor:"threshold_value"},"Value ",r.a.createElement("span",{className:"danger-red"}," *"))),1===a.size&&!["aprice","final_charge"].includes(s.getIn(["field"],""))&&r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"threshold_uof"},"Unit of measure",r.a.createElement("span",{className:"danger-red"}," *")))),r.a.createElement(QS,{threshold:s,index:0,eventPropertyType:a,thresholdFieldsSelectOptions:i,thresholdOperatorsSelectOptions:o,onUpdate:n.onChangeThreshold,errors:l,setError:n.props.setError}))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.initEvent()}},{key:"render",value:function(){var e=this.state.status,t=this.props,n=t.mode,a=t.item,i=t.eventsSettings,o=t.errors;return"loading"===e?r.a.createElement(_,null):"error"===e?r.a.createElement(f.p,{bsStyle:"danger"},"Oops! Something went wrong, please try again."):r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("span",null,"Details")},r.a.createElement(KS,{item:a,eventsSettings:i,onUpdate:this.props.updateField,setError:this.props.setError,errors:o})),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Conditions"),collapsible:!0,defaultExpanded:["create","clone"].includes(n),className:"collapsible"},this.renderConditions()),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Threshold")},this.renderThreshold()))}}]),t}(a.Component);ZS.defaultProps={item:g.c.Map(),mode:"create",eventsSettings:g.c.Map(),eventPropertyType:g.c.Set(),thresholdFieldsSelectOptions:[],thresholdOperatorsSelectOptions:[],errors:g.c.Map()};var XS=Object(l.connect)(function(e,t){return{eventPropertyType:rS(e,t),thresholdFieldsSelectOptions:iS(e,Object(Ks.a)({},t,{eventType:"fraud"})),thresholdOperatorsSelectOptions:JO(null,{eventType:"fraud"}),eventsSettings:Ua(e,t)}})(ZS),eT=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onChangeBucket=function(e,t){var a=t.option,r=void 0===a?{}:a,i=n.props,o=i.bucketConditionIndex,l=i.valueConditionIndex,s=r.charging_by,c=r.charging_by_usaget,u=r.charging_by_usaget_unit;n.props.setError("bucket");var p="balance.totals";p+="total_cost"===s?".cost":".".concat(c,".").concat(s),n.props.onChangeField(["conditions",o,"value"],e),n.props.onChangeField(["conditions",l,"unit"],u),n.props.onChangeField(["conditions",l,"usaget"],c),n.props.onChangeField(["conditions",l,"paths"],Object(g.a)([Object(g.b)({path:p})]))},n.onChangeCondition=function(e){var t=n.props.valueConditionIndex;n.props.setError("operator"),n.props.setError("value"),n.props.onChangeField(["conditions",t,"type"],e)},n.onChangeMultiValues=function(e){Array.isArray(e)?n.onChangeTagValue(e.join(",")):n.onChangeTagValue("")},n.onChangeTagValue=function(e){var t=n.props,a=t.onChangeField,r=t.conditions,i=t.valueConditionIndex;return n.props.setError("value"),"reached_percentage"===r.get(i,Object(g.b)()).get("type","")?a(["conditions",i,"value"],n.filterPercentageMultiValues(e)):a(["conditions",i,"value"],e)},n.onChangeValue=function(e){var t=n.props.valueConditionIndex,a=e.target.value;n.props.setError("value"),n.props.onChangeField(["conditions",t,"value"],a)},n.filterPercentageMultiValues=function(e){return e.split(",").filter(function(e){return""!==e}).filter(function(e){if(!x()(e))return n.props.dispatch(Vr("Condition value must be numeric")),!1;var t=parseFloat(e);return t<=0?(n.props.dispatch(Vr("Condition value should be greater than zero")),!1):!(t>100)||(n.props.dispatch(Vr("Condition value cannot be greater than 100")),!1)}).join(",")},n.renderCustomInputNumber=function(e){e.addTag;var t=e.onChange,n=e.value,a=Object(mt.a)(e,["addTag","onChange","value"]);return r.a.createElement("input",Object.assign({type:"number",onChange:t,value:n},a))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Bg())}},{key:"render",value:function(){var e=this.props,t=e.conditions,n=e.errors,a=e.conditionsOperators,i=e.bucketsOptions,o=e.propertyTypes,l=e.usageTypesData,s=e.bucketConditionIndex,c=e.valueConditionIndex,u=e.currency,p=t.get(c,Object(g.b)()),d=t.get(s,Object(g.b)()),m=oS(p.get("type","")),h=vS(p.get("unit",""),"",p.get("usaget",""),o,l,u,p.get("type","")),v=n.get("bucket",!1),y=n.get("operator",!1),b=n.get("value",!1);return r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,{validationState:v?"error":null},r.a.createElement(f.g,{sm:4,smOffset:1,xsOffset:0,xs:12,className:"text-left",componentClass:f.h},"Bucket"),r.a.createElement(f.g,{sm:7,smOffset:0,xsOffset:2,xs:10,className:"pl40"},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeBucket,value:d.get("value",""),options:i}),v&&r.a.createElement(f.n,null,v))),r.a.createElement(f.l,{validationState:y?"error":null},r.a.createElement(f.g,{sm:4,smOffset:1,xsOffset:0,xs:12,className:"text-left",componentClass:f.h},"Condition"),r.a.createElement(f.g,{sm:7,smOffset:0,xsOffset:2,xs:10,className:"pl40"},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeCondition,value:p.get("type",""),options:a}),y&&r.a.createElement(f.n,null,y))),m.get("extra_field",!0)&&r.a.createElement(f.l,{validationState:b?"error":null},r.a.createElement(f.g,{sm:4,smOffset:1,xsOffset:0,xs:12,className:"text-left",componentClass:f.h},"Value"),r.a.createElement(f.g,{sm:7,smOffset:0,xsOffset:2,xs:10,className:"pl40"},r.a.createElement(f.o,{className:"full-width"},"tags"!==m.get("type","text")?r.a.createElement(Tn,{onChange:this.onChangeValue,value:p.get("value",""),fieldType:m.get("type","text")}):r.a.createElement(Tn,{fieldType:"tags",onChange:this.onChangeMultiValues,value:String(p.get("value","")).split(",").filter(function(e){return""!==e}),renderInput:this.renderCustomInputNumber,onlyUnique:"tags"===m.get("type","")}),""!==h&&r.a.createElement(f.o.Addon,null,h)),b&&r.a.createElement(f.n,null,b))))}}]),t}(a.Component);eT.defaultProps={conditions:Object(g.a)(),conditionsOperators:[],bucketsOptions:[],errors:Object(g.b)(),propertyTypes:Object(g.a)(),currency:"",usageTypesData:Object(g.a)(),onChangeField:function(){},setError:function(){}};var tT=Object(l.connect)(function(e,t){return{propertyTypes:va(e,t),usageTypesData:ha(e,t),currency:pa(e,t),conditionsOperators:zO(null,{eventType:"balancePrepaid"}),bucketsOptions:yr(e,t),bucketConditionIndex:_S("bucket",t.conditions),valueConditionIndex:_S("value",t.conditions)}})(eT),nT=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onChangeField=function(e,t){n.props.updateField(e,t)},n.onChangeEventCode=function(e){var t=e.target.value,a=RS(t);n.props.setError("event_code",!0===a?null:a),n.props.updateField(["event_code"],t)},n.onChangeDescription=function(e){var t=e.target.value;n.props.updateField(["event_description"],t)},n.onChangeActive=function(e){var t=e.target.value;n.props.updateField(["active"],"yes"===t)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.errors,a=e.setError,i=n.get("event_code",!1),o=t.get("conditions",g.c.List());return r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.v,{header:r.a.createElement("span",null,"Details")},r.a.createElement(f.l,{validationState:i?"error":null},r.a.createElement(f.g,{componentClass:f.h,sm:3},"Event Code",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{id:"label",onChange:this.onChangeEventCode,value:t.get("event_code","")}),i&&r.a.createElement(f.n,null,i))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Description"),r.a.createElement(f.g,{sm:7},r.a.createElement(Tn,{id:"description",onChange:this.onChangeDescription,value:t.get("event_description","")}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},"Status"),r.a.createElement(f.g,{sm:7},r.a.createElement("span",null,r.a.createElement("span",{className:"mr20 inline"},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"yes",label:"Active",checked:t.get("active",!0)})),r.a.createElement("span",{className:"inline"},r.a.createElement(Tn,{fieldType:"radio",onChange:this.onChangeActive,name:"step-active-status",value:"no",label:"Not Active",checked:!t.get("active",!0)})))))),r.a.createElement(f.v,{header:r.a.createElement("span",null,"Condition")},r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:12},r.a.createElement(tT,{conditions:o,onChangeField:this.onChangeField,errors:n,setError:a})))))}}]),t}(a.Component);nT.defaultProps={item:g.c.Map(),errors:g.c.Map()};var aT={balance:YS,balancePrepaid:nT,fraud:XS},rT={balance:g.c.Map({active:!1}),fraud:g.c.Map({active:!1,date_range:g.c.Map({type:"hourly"}),recurrence:g.c.Map({type:"hourly"}),lines_overlap:!0,notify_by_email:g.c.Map({notify:!1})}),balancePrepaid:g.c.Map({active:!1,prepaid:!0,conditions:g.c.List([g.c.Map({type:"",value:"",unit:"",usaget:"",paths:g.c.List([g.c.Map({path:""})])}),g.c.Map({type:"is",value:"",paths:g.c.List([g.c.Map({path:"pp_includes_external_id"})])}),g.c.Map({type:"is",value:"prepaid",paths:g.c.List([g.c.Map({path:"connection_type"})])})])})},iT=Object(l.connect)(function(e,t){return{items:Ka(e,t),thresholdFields:$O(null,{eventType:"fraud"})}},function(e,t){return{onRemove:function(n){var a={message:'Are you sure you want to delete "'.concat(n.get("event_code"),'" event?'),onOk:function(){var a,r;return e((a=t.eventType,r=n,function(e,t){var n=["balancePrepaid","balance"].includes(a)?"balances":a,i=Ka(t(),{eventType:n}).findIndex(function(e){return e.getIn(["ui_flags","id"],"")===r.getIn(["ui_flags","id"],"")});return-1!==i&&e(El("events",["balancePrepaid"===a?"balance":a,i]))})),e(wS(t.eventType)).then(function(){return e(IS(t.eventType))})},labelOk:"Delete",type:"delete"};return e(ks(a))},onEdit:function(n){var a={title:'Edit "'.concat(n.get("event_code"),'" event'),onOk:function(n){return!!e(AS(n,t.eventType))&&(e(FS(t.eventType,n)),e(wS(t.eventType)).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(IS(t.eventType))}).catch(function(){return e(IS(t.eventType)),Promise.reject()}))},mode:"edit"};return e(js(n,aT[t.eventType],a))},onClone:function(n){var a=n.withMutations(function(e){e.deleteIn(["ui_flags","id"]),e.set("active",!1)}),r={title:'Clone "'.concat(n.get("event_code"),'" event'),onOk:function(n){return!!e(AS(n,t.eventType))&&e(NS(t.eventType,n)).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(Ur("New event ".concat(n.get("event_code","")," saved successfully")))}).then(function(){return e(IS(t.eventType))}).catch(function(){return Promise.reject()})},mode:"clone"};return e(js(a,aT[t.eventType],r))},onNew:function(){var n=ee(["events","entities",t.eventType,"title"],t.eventType),a={title:"Create new ".concat(Object(D.noCase)(n)," event"),onOk:function(n){return!!e(AS(n,t.eventType))&&e(NS(t.eventType,n)).then(function(e){return!!e.status||Promise.reject()}).then(function(){return e(Ur("New event ".concat(n.get("event_code","")," saved successfully")))}).then(function(){return e(IS(t.eventType))}).catch(function(){return Promise.reject()})},mode:"create"},r=rT[t.eventType];return e(js(r,aT[t.eventType],a))},onEnable:function(n){var a={message:'Are you sure you want to enable "'.concat(n.get("event_code"),'" event?'),onOk:function(){var a=n.set("active",!0);return e(FS(t.eventType,a)),e(wS(t.eventType)).then(function(){return e(IS(t.eventType))})},type:"confirm",labelOk:"Enable"};e(ks(a))},onDisable:function(n){var a={message:'Are you sure you want to disable "'.concat(n.get("event_code"),'" event?'),onOk:function(){var a=n.set("active",!1);return e(FS(t.eventType,a)),e(wS(t.eventType)).then(function(){return e(IS(t.eventType))})},type:"delete",labelOk:"Disable"};e(ks(a))}}})(BS),oT=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(IS())}},{key:"render",value:function(){var e=this.props.location;return r.a.createElement("div",null,r.a.createElement(No,{id:"EventsTab",location:e},r.a.createElement(f.z,{title:Object(D.titleCase)(ee(["events","entities","balance","title"],"balance")),eventKey:1},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(iT,{eventType:"balance"}))),r.a.createElement(f.z,{title:Object(D.titleCase)(ee(["events","entities","balancePrepaid","title"],"balance repaid")),eventKey:2},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(iT,{eventType:"balancePrepaid"}))),r.a.createElement(f.z,{title:Object(D.titleCase)(ee(["events","entities","fraud","title"],"fraud")),eventKey:3},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(iT,{eventType:"fraud"}))),r.a.createElement(f.z,{title:"Settings",eventKey:4},r.a.createElement(f.v,{style:{borderTop:"none"}},r.a.createElement(US,null)))))}}]),t}(a.Component);oT.defaultProps={};var lT=Object(l.connect)(null)(oT),sT=function(e){var t=e.item,n=e.errors,a=e.onChange,i=t.get("fields",g.c.List());return i.isEmpty()?"No additional data required to generate file":r.a.createElement(f.j,{horizontal:!0},r.a.createElement(Fd,{entityName:"payments",entity:t.get("values",g.c.Map()),errors:n,fields:i,onChangeField:a}))};sT.defaultProps={item:Object(g.b)()};var cT=Object(l.connect)(null,function(e,t){var n=t.updateField,a=t.setError,r=t.item;return{onChange:function(e,t){var i=Array.isArray(e)?e:[e],o=i.join("."),l=r.get("fields",g.c.List()).find(function(e){return e.get("field_name","")===o},null,Object(g.b)()),s=os(t,l);!1!==s?a(o,s):a(o),n(["values"].concat(Object(N.a)(i)),t)}}})(sT),uT=function(e){var t=e.item,n=t.get("fields",g.c.List());return n.isEmpty()?"No additional data required to generate file":r.a.createElement(f.j,{horizontal:!0},r.a.createElement(Fd,{entityName:"payments",entity:t.get("values",g.c.Map()),fields:n,editable:!1}))},pT=Object(Nn.a)(function(e){return e.paymentsFiles.get("paymentGateway")},function(e){return e}),dT=Object(Nn.a)(function(e){return e.paymentsFiles.get("fileType")},function(e){return e}),mT=Object(Nn.a)(function(e){return e.list.get("payment_running_files_list")},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(g.a)();return e.size}),gT=Object(Nn.a)(Ya,function(e){return e.filter(function(e){return e.has("transactions_request")&&!e.get("transactions_request",g.a).isEmpty()&&e.get("custom",!1)})}),fT=Object(Nn.a)(gT,function(e){return e.map(function(e){return fe(Object(g.b)({value:e.get("name",""),label:e.get("title",Object(D.sentenceCase)(e.get("name","")))}))}).toList().toArray()}),hT=Object(Nn.a)(gT,function(e){return e.reduce(function(e,t){return e.set(t.get("name",""),t.get("transactions_request",Object(g.a)()).filter(function(e){return e.has("file_type")}).map(function(e){return fe(Object(g.b)({value:e.get("file_type",""),label:e.get("title",Object(D.sentenceCase)(e.get("file_type","")))}))}).toArray())},Object(g.b)())}),vT="SET_FILE_TYPE",yT="SET_PAYMENT_GATEWAY",bT="CLEAR",ET=function(e){return{type:vT,value:e}},CT=function(e){return{type:yT,value:e}},_T=function(e,t){return function(n){return n(eo("payment_running_files_list",function(e,t){return{action:"get",entity:"log",params:[{page:0},{size:9999},{project:JSON.stringify({stamp:1})},{sort:JSON.stringify({})},{query:JSON.stringify({source:"custom_payment_files",cpg_name:e,cpg_file_type:t,start_process_time:{$exists:!0},process_time:{$exists:!1}})}]}}(e,t)))}},OT=function(){return function(e){return e(Xi("payment_running_files_list"))}},ST=function(){return function(e){e(up("payments_files")),e(op("payments_files",0)),e({type:np,collection:"payments_files"})}},TT=function(e){return function(t){var n=!0,a=e.get("values",Object(g.b)());return e.get("fields",Object(g.a)()).forEach(function(e){if(e.get("display",!1)&&e.get("editable",!1)){var r=e.get("field_name",""),i=r.split(".").filter(function(e){return""!==e});if(a.hasIn(i)){var o=a.getIn(i),l=rs(o,e);!0!==l&&(n=!1,t(Is(r,l)))}}}),n}},kT=function(e,t,n){return function(a){var r=function(e,t,n){return{api:"custompaymentgateway",action:"generateTransactionsRequestFile",params:[{payment_gateway:e},{file_type:t},{parameters:JSON.stringify(n)}]}}(e,t,n);return ei(r).then(function(e){return a(Wr(e,"File creation initiated"))}).catch(function(e){return a(Jr(e,"Error")),Promise.reject()})}},jT=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={refreshString:"",autoReloadCount:0},n.reloadTableTimeout=null,n.autoReloadResetCounter=function(){n.setState(function(){return{autoReloadCount:0}})},n.autoReloadData=function(e){n.reloadData(),n.setState(function(){return{autoReloadCount:e+1}})},n.getAutoReloadNextDelay=function(){var e=n.state.autoReloadCount-1;return 1e3*(e<t.secAutoReloadData.length?t.secAutoReloadData[e]:t.secAutoReloadData[t.secAutoReloadData.length-1])},n.fetchRunningPaymentFiles=function(e,t){n.props.dispatch(_T(e,t))},n.onChangePaymentGatewayValue=function(e){var t=e&&e.length?e:"";n.props.dispatch(CT(t))},n.onChangeFileTypeValue=function(e){var t=e&&e.length?e:"";n.props.dispatch(ET(t))},n.onShowDetails=function(e){var t={title:"Details of ".concat(n.getLabel("stamp").toLowerCase()," ").concat(e.get("stamp","")),labelCancel:"Hide",showOnOk:!1,skipConfirmOnClose:!0},a=Object(g.d)(n.getDetailsFields()).map(n.fixDetailsFields),r=e.map(n.fixDetailsValues),i=Object(g.b)({values:r,fields:a});return n.props.dispatch(js(i,uT,t))},n.onListRefresh=function(){var e=n.props,t=e.paymentGateway,a=e.fileType;n.fetchRunningPaymentFiles(t,a)},n.getListActions=function(){return[{type:"refresh"}]},n.getRowActions=function(){return[{type:"view",onClick:n.onShowDetails,helpText:"Details",onClickColumn:"stamp"},{type:"report",onClick:n.goToReport,helpText:"Report",show:n.isFinished}]},n.getFilterFields=function(){return[{id:"creation_time",placeholder:n.getLabel("creation_time")}]},n.getLabel=function(e){return te(e,"payment_files",Object(D.titleCase)(e))},n.getPredefinedReportConfiguration=function(e){var t=n.props,a=t.reportBillsFields,r=t.paymentGateway,i=Zt.a.v4(),o={key:"File name: ".concat(e.get("file_name","")),entity:"bills",type:0,columns:[{key:i,field_name:"urt",label:"Creation Time",op:"",entity:"bills"},{key:Zt.a.v4(),field_name:"aid",label:"Customer ID",op:"",entity:"bills"},{key:Zt.a.v4(),field_name:"txid",label:"BillRun Transaction ID",op:"",entity:"bills"},{key:Zt.a.v4(),field_name:"amount",label:"Original Absolute Due Amount",op:"",entity:"bills"},{key:Zt.a.v4(),field_name:"rejected",label:"Rejected Payment?",op:"",entity:"bills"},{key:Zt.a.v4(),field_name:"waiting_for_confirmation",label:"Waiting For Confirmation?",op:"",entity:"bills"},{key:Zt.a.v4(),field_name:"type",label:"Type",op:"",entity:"bills"},{key:Zt.a.v4(),field_name:"generated_pg_file_log",label:"Payment Gateway File ID",op:"",entity:"bills"},{key:Zt.a.v4(),field_name:"due",label:"Due Amount (Sum)",op:"",entity:"bills"}],conditions:[{field:"generated_pg_file_log",op:"in",value:e.get("stamp",""),type:"string",entity:"bills"},{field:"rejection",op:"ne",value:!0,type:"boolean",entity:"bills"}],sorts:[{field:i,op:-1}],formats:[{field:i,op:"datetime_format",value:"d/m/Y H:i"}]};return a.forEach(function(e){if(!e.get("payment_gateway",!1)||e.get("payment_gateway")===r){var t={key:Zt.a.v4(),field_name:e.get("field_name",""),label:e.get("title",""),entity:"bills"};o.columns.push(t)}}),o},n.goToReport=function(e){n.props.dispatch(Yl("reports",n.getPredefinedReportConfiguration(e))),n.props.dispatch(bs("Transactions Request File Report")),n.props.router.push({pathname:"reports/report",query:{type:"predefined"}})},n.isRunning=function(e){return""!==e.get("start_process_time","")&&""===e.get("process_time","")},n.isFinished=function(e){return""!==e.get("start_process_time","")&&""!==e.get("process_time","")},n.isFailed=function(e){return""===e.get("start_process_time","")&&""===e.get("process_time","")&&""!==e.get("errors","")},n.parserStatus=function(e){return n.isRunning(e)?r.a.createElement("i",{className:"fa fa-spinner fa-pulse",title:n.getLabel("status_running_files")}):n.isFinished(e)?r.a.createElement("i",{className:"fa fa-check-circle success-green",title:n.getLabel("status_finished_files")}):n.isFailed(e)?r.a.createElement("i",{className:"fa fa-exclamation-circle danger-red",title:n.getLabel("status_failed_files")}):"-"},n.getDetailsFields=function(){return[{field_name:"stamp"},{field_name:"creation_time",type:"datetime"},{field_name:"parameters_string",multiple:!0},{field_name:"transactions"},{field_name:"start_process_time",type:"datetime"},{field_name:"process_time",type:"datetime"},{field_name:"file_name"},{field_name:"created_by"},{field_name:"errors",multiple:!0},{field_name:"warnings",multiple:!0},{field_name:"info",multiple:!0}]},n.getTableFields=function(){return[{id:"status",title:n.getLabel("status"),parser:n.parserStatus,cssClass:"state text-center"},{id:"stamp",title:n.getLabel("stamp")},{id:"creation_time",title:n.getLabel("creation_time"),type:"datetime",cssClass:"long-date"},{id:"parameters_string",title:n.getLabel("parameters_string")},{id:"transactions",title:n.getLabel("transactions")},{id:"start_process_time",title:n.getLabel("start_process_time"),type:"mongodatetime",cssClass:"long-date"},{id:"process_time",title:n.getLabel("process_time"),type:"mongodatetime",cssClass:"long-date"},{id:"file_name",title:n.getLabel("file_name")},{id:"created_by",title:n.getLabel("created_by")},{id:"errors",title:n.getLabel("errors")}]},n.getProjectFields=function(){return{creation_time:1,parameters_string:1,transactions:1,start_process_time:1,process_time:1,file_name:1,stamp:1,created_by:1,errors:1,warnings:1,info:1}},n.getDefaultSort=function(){return Object(g.b)({creation_time:-1})},n.getGeneratePaymentFileTooltipText=function(){var e=n.props,t=e.isRunningPaymentFiles,a=e.paymentGateway,r=e.fileType;return""===a?"Please select ".concat(n.getLabel("payment_gateway")):""===r?"Please select ".concat(n.getLabel("file_type")):t>0?"".concat(t," files is running..."):"Generate Transactions Request File"},n.fixDetailsFields=function(e){return n.fixGeneratePaymentFileFields(e)},n.fixDetailsValues=function(e){return g.b.isMap(e)&&e.has("sec")?S.a.unix(e.get("sec")):e},n.fixGeneratePaymentFileFields=function(e){return e.withMutations(function(t){if(e.has("field_name")||t.set("field_name",e.get("name","")),e.has("editable")||t.set("editable",!0),e.has("display")||t.set("display",!0),!e.has("title")){var a=n.getLabel(t.get("field_name",""));t.set("title",Object(D.titleCase)(a))}})},n.onClickGenerateNewFile=function(){var e=n.getGenerateNewFileFields(),t={title:"Generate Transactions Request File",labelOk:"Generate",onOk:n.onGenerateNewFileClickOK},a=Object(g.b)({fields:e,values:Object(g.b)()});return n.props.dispatch(js(a,cT,t))},n.getGenerateNewFileFields=function(){var e=n.props,t=e.paymentFiles,a=e.isRunningPaymentFiles,r=e.paymentGateway,i=e.fileType;return 0===a&&(""!==r&&""!==i)?t.find(function(e){return e.get("name","")===r},null,Object(g.b)()).get("transactions_request",Object(g.a)()).find(function(e){return e.get("file_type","")===i},null,Object(g.b)()).get("parameters",Object(g.a)()).map(n.fixGeneratePaymentFileFields):Object(g.a)()},n.onGenerateNewFileClickOK=function(e){var t=n.props,a=t.paymentGateway,r=t.fileType;if(!n.props.dispatch(TT(e)))return!1;var i=e.get("values",Object(g.b)());return n.props.dispatch(kT(a,r,i)).then(n.afterSuccessGenerateNewFile).catch(function(e){return Promise.reject()})},n.afterSuccessGenerateNewFile=function(){var e=1e3*t.secReloadDelayAfterGenerateFile;return setTimeout(n.reloadData,e),Promise.resolve()},n.reloadData=function(){var e=n.props,t=e.paymentGateway,a=e.fileType;n.setState(function(){return{refreshString:S()().format()}}),n.fetchRunningPaymentFiles(t,a)},n.renderPanelHeader=function(){var e=n.props,t=e.isRunningPaymentFiles,a=e.paymentGateway,i=e.fileType,o=""!==a&&""!==i,l=0===t&&o,s=o?"".concat(t," running ").concat(Gp()("file",t)):"\xa0";return r.a.createElement("div",null,s,r.a.createElement("div",{className:"pull-right"},r.a.createElement(It,{helpText:n.getGeneratePaymentFileTooltipText()},r.a.createElement(ct,{onClick:n.onClickGenerateNewFile,buttonStyle:{},action:"",label:"Generate Transactions Request File",disabled:!l}))))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(kl("payment_gateways"))}},{key:"componentDidUpdate",value:function(e,n){var a=this.props,r=a.paymentGateway,i=a.fileType,o=a.isRunningPaymentFiles,l=this.state.autoReloadCount,s=o!==e.isRunningPaymentFiles,c=""!==r&&""!==i,u="".concat(r,"_").concat(i)!=="".concat(e.paymentGateway,"_").concat(e.fileType),p=l!==e.autoReloadCount;if(u&&(this.props.dispatch(OT()),this.props.dispatch(ST())),u&&this.reloadTableTimeout&&this.autoReloadResetCounter(),c&&u&&this.reloadData(),c&&o>0&&0===e.isRunningPaymentFiles){this.setState(function(){return{autoReloadCount:1}})}if(s&&0===o&&this.autoReloadResetCounter(),p){clearTimeout(this.reloadTableTimeout);var d=l<t.maxAutoReloadData;if(c&&d&&l>0){var m=this.getAutoReloadNextDelay();this.reloadTableTimeout=setTimeout(this.autoReloadData,m,l)}}}},{key:"componentWillUnmount",value:function(){this.props.dispatch(OT()),this.reloadTableTimeout&&clearTimeout(this.reloadTableTimeout)}},{key:"render",value:function(){var e=this.props,t=e.paymentGateway,n=e.fileType,a=e.paymentGatewayOptions,i=e.fileTypeOptionsOptions,o=this.state.refreshString,l=i.get(t,[]),s=""===t,c=""!==t&&""!==n;return r.a.createElement(f.v,{header:this.renderPanelHeader()},r.a.createElement(f.g,{lg:12},r.a.createElement(f.j,{horizontal:!0},r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},this.getLabel("payment_gateway")),r.a.createElement(f.g,{sm:5,lg:4},r.a.createElement(Tn,{fieldType:"select",value:t,options:a,onChange:this.onChangePaymentGatewayValue}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3},this.getLabel("file_type")),r.a.createElement(f.g,{sm:5,lg:4},r.a.createElement(Tn,{fieldType:"select",value:n,options:l,onChange:this.onChangeFileTypeValue,disabled:s}))))),c&&r.a.createElement(f.g,{lg:12},r.a.createElement(Tp,{fetchOnMount:!1,entityKey:"paymentsFiles",api:"get",showRevisionBy:!1,baseFilter:{source:"custom_payment_files",cpg_name:t,cpg_file_type:n},tableFields:this.getTableFields(),projectFields:this.getProjectFields(),listActions:this.getListActions(),actions:this.getRowActions(),defaultSort:this.getDefaultSort(),refreshString:o,onListRefresh:this.onListRefresh})))}}]),t}(a.Component);jT.defaultProps={paymentGateway:"",fileType:"",paymentFiles:Object(g.a)(),reportBillsFields:Object(g.a)(),paymentGatewayOptions:[],fileTypeOptionsOptions:Object(g.b)(),isRunningPaymentFiles:0},jT.secReloadDelayAfterGenerateFile=2,jT.maxAutoReloadData=30,jT.secAutoReloadData=[1,2,4,8,16,32,60];var IT=Object(s.f)(Object(l.connect)(function(e,t){return{paymentFiles:gT(e,t)||void 0,paymentGatewayOptions:fT(e,t)||void 0,fileTypeOptionsOptions:hT(e,t)||void 0,isRunningPaymentFiles:mT(e,t)||void 0,reportBillsFields:Df(e,t)||void 0,paymentGateway:pT(e,t),fileType:dT(e,t)}})(jT)),wT=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={progress:!1,query:t.defaultQuery,options:t.defaultOptions,entity:""},n.clickExport=function(){var e=n.state,t=e.entity,a=e.options,r=n.props.query;n.setState(function(){return{progress:!0}}),n.props.onExport(t,g.c.fromJS(r).merge(a)),n.setState(function(){return{progress:!1}})},n.onChangeEntity=function(e){var t=e.length?e:"";n.setDefaultFileName({newEntity:t}),n.setState(function(){return{entity:t}})},n.onChangeRange=function(e){var t=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"),a=S()(e.get("to","")),r=S()(e.get("from",""));n.setState(function(e){return{query:e.query.set("to",a.isValid()?a.set({second:0,millisecond:0}).utc().format(t):null).set("from",r.isValid()?r.set({second:0,millisecond:0}).utc().format(t):null)}}),r.isValid()&&n.setDefaultFileName({newDate:r})},n.onChangeFrom=function(e){if(S.a.isMoment(e)&&e.isValid()){var t=ee("apiDateTimeFormat","YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");n.setState(function(n){return{query:n.query.set("from",e.format(t))}}),n.setDefaultFileName({newDate:e})}else n.setState(function(e){return{query:e.query.delete("from")}}),n.setDefaultFileName({newDate:null})},n.onChangeFileName=function(e){var t=e.target.value;n.setState(function(e){return{options:t&&t.length>0?e.options.set("file_name",t):e.options.delete("file_name")}})},n.setDefaultFileName=function(e){var a=e.newEntity,r=e.newDate,i=n.state,o=i.entity,l=i.query,s=i.options,c=t.defaultOptions.get("file_name",""),u=s.get("file_name",""),p=c!==u,d=""===u,m=ee("apiDateFormat","YYYY-MM-DD");if("undefined"!==typeof r){var g=null!==r?"_".concat(r.format(m)):"",f=l.get("from",null),h=null!==f?"_".concat(S()(f).format(m)):"",v=ee(["systemItems",o,"itemsType"],o);if("".concat(c,"_").concat(v).concat(h)===u||d||!p){var y="".concat(c,"_").concat(o).concat(g);n.setState(function(e){return{options:e.options.set("file_name",y)}})}}else if("undefined"!==typeof a){var b=l.get("from",null),E=null!==b?"_".concat(S()(b).format(m)):"";if("".concat(c,"_").concat(o).concat(E)===u||d||!p){var C="".concat(c,"_").concat(a).concat(E);n.setState(function(e){return{options:e.options.set("file_name",C)}})}}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.entityKey,n=e.entityOptions,a=e.exportLabel,i=this.state,o=i.query,l=i.options,s=i.entity,c=i.progress,u=n.map(function(e){return{value:e,label:Object(D.sentenceCase)(ee(["systemItems",e,"itemName"],e))}}),p=ee(["env","exportVersion"],""),d=""===p?".csv":"_".concat(p,".csv"),m=g.c.Map({from:S()(o.get("from",null)).isValid()?S()(o.get("from",null)):"",to:S()(o.get("to",null)).isValid()?S()(o.get("to",null)):""});return r.a.createElement(f.j,{horizontal:!0},""===t&&r.a.createElement(f.l,null,r.a.createElement(f.g,{sm:3,lg:2,componentClass:f.h},"Entity",r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",onChange:this.onChangeEntity,options:u,value:s,placeholder:"Select entity to export....",clearable:!1}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"Revision date"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"range",onChange:this.onChangeRange,value:m,inputProps:{fieldType:"datetime",isClearable:!0},inputFromProps:{selectsStart:!0,endDate:"@valueTo@"},inputToProps:{selectsEnd:!0,startDate:"@valueFrom@",endDate:"@valueTo@",minDate:"@valueFrom@"}}))),r.a.createElement(f.l,null,r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2},"File Name"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{onChange:this.onChangeFileName,value:l.get("file_name",""),suffix:d}))),r.a.createElement("hr",null),r.a.createElement(ft,{type:"export_csv",label:a,actionStyle:"primary",actionSize:"small",onClick:this.clickExport,enable:!c}))}}],[{key:"getDerivedStateFromProps",value:function(e,n){if(""!==e.entityKey&&e.entityKey!==n.entity){var a=t.defaultOptions.get("file_name",""),r=ee(["systemItems",e.entityKey,"itemsType"],e.entityKey),i="".concat(a,"_").concat(r);return{options:n.options.set("file_name",i),entity:e.entityKey}}return null}}]),t}(a.Component);wT.defaultProps={entityKey:"",exportLabel:"Export",query:null,entityOptions:ee(["export","allowed_entities"],g.c.List()).toJS()},wT.defaultQuery=g.c.Map(),wT.defaultOptions=g.c.Map({file_name:"export"});var NT=wT,FT=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).updatePageTitle=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e)n.props.dispatch(bs("Export"));else{var t=ee(["systemItems",e,"itemsName"],e);n.props.dispatch(bs(Object(D.titleCase)("Export ".concat(t))))}},n.handleExport=function(e,t){return n.props.dispatch(Ql(e,t))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.exportEntity;this.updatePageTitle(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.exportEntity;this.props.exportEntity!==t&&this.updatePageTitle(t)}},{key:"render",value:function(){var e=this.props.exportEntity;return r.a.createElement(f.v,null,r.a.createElement(NT,{entityKey:e,onExport:this.handleExport}))}}]),t}(a.Component);FT.defaultProps={exportEntity:void 0};var xT=Object(l.connect)(function(e,t){return{exportEntity:Oo(e,t)||void 0}})(FT),RT=function(e){var t=e.line,n=e.index,a=e.aid,i=e.editable,o=e.currency,l=e.onChange,s=e.onRemove,c=ee("apiDateTimeFormat",""),u=vd()(o),p=t.get("price",""),d=t.get("volume",""),m=S()(t.get("date",null));return r.a.createElement(f.l,{className:"form-inner-edit-row body"},r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement(ss,{aid:a,onChange:function(e){l([n,"sid"],e)},editable:i})),r.a.createElement(f.g,{sm:3},r.a.createElement(us,{onChange:function(e){l([n,"rate"],e)},editable:i})),r.a.createElement(f.g,{sm:2},r.a.createElement(Tn,{fieldType:"number",onChange:function(e){var t=e.target.value;l([n,"price"],t)},value:p,suffix:u,disabled:!i})),r.a.createElement(f.g,{sm:2},r.a.createElement(Tn,{fieldType:"date",value:m,style:{display:"inline-block"},onChange:function(e){var t=S.a.isMoment(e)&&e.isValid()?e:S()();l([n,"date"],t.format(c))},disabled:!i})),r.a.createElement(f.g,{sm:1},r.a.createElement(Tn,{fieldType:"number",value:d,onChange:function(e){var t=e.target.value,a=x()(t)?t:1;l([n,"volume"],a)},disabled:!i})),r.a.createElement(f.g,{sm:1,className:"actions"},i&&r.a.createElement(f.c,{onClick:function(){s(n)},bsSize:"small",className:"pull-left"},r.a.createElement("i",{className:"fa fa-trash-o danger-red"}))))};RT.defaultProps={line:g.c.Map(),currency:"",editable:!0};var MT=RT,PT=function(e){var t=e.item,n=e.dispatch,i=Object(a.useState)(null),o=Object(w.a)(i,2),l=o[0],s=o[1],c=Object(a.useState)(!1),u=Object(w.a)(c,2),p=u[0],d=u[1],m=Object(a.useState)(!1),h=Object(w.a)(m,2),v=h[0],y=h[1],b=t.get("aid",""),E=t.get("onConfirm",null),C=t.get("invoiceData",[]),_=t.get("lines",g.c.List()),O=C[0].price,S="".concat(ee(["env","serverApiUrl"],""),"/api/accountinvoices?action=download&aid=").concat(b),T="".concat(ee(["env","serverApiUrl"],""),"/api/accountinvoices?action=download&aid=").concat(b,"&iid=").concat(l),j=k()("fa",{"fa-spinner":p,"fa-pulse":p,"fa-check":!p});return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:12},r.a.createElement("p",null,"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum"),r.a.createElement("p",{className:"text-center"},"Invoice total charge: ",O))),null===l&&r.a.createElement(f.y,{className:"mt10"},r.a.createElement(f.g,{xs:12,className:"text-center"},r.a.createElement(Tn,{fieldType:"checkbox",onChange:function(e){var t=e.target.value;y(t)},value:v,className:"inline mr10",label:"Send Email"})),r.a.createElement(f.g,{xs:6},r.a.createElement("form",{method:"post",action:S,target:"_blank"},r.a.createElement(f.c,{bsStyle:"primary",type:"submit"},r.a.createElement("i",{className:"fa fa-download"})," Download Expected Invoice"))),r.a.createElement(f.g,{xs:6,className:"text-right"},r.a.createElement(f.c,{onClick:function(){d(!0),n(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(a){var r=xi(e,t,n);return ei(r).then(function(e){return a(Wr(e,"Immediate invoice successfully generated"))}).catch(function(e){return a(Jr(e,"Error generating the invoice"))})}}(b,_,v)).then(function(e){var t=e.details[0].invoiceId;s(t),E&&E(t)}).finally(function(){d(!1)})},bsStyle:"success"},r.a.createElement("i",{className:j})," Confirm Expected Invoice"))),null!==l&&r.a.createElement(f.y,{className:"mt10"},r.a.createElement(f.g,{sm:12,className:"text-center"},r.a.createElement("form",{method:"post",action:T,target:"_blank"},r.a.createElement(f.c,{type:"submit"},p&&r.a.createElement("span",null,r.a.createElement("i",{className:"fa fa-spinner fa-pulse"}),"\xa0\xa0"),r.a.createElement("i",{className:"fa fa-download"})," Download Invoice")))))};PT.defaultProps={item:g.c.Map()};var AT=Object(l.connect)()(PT),DT=function(e){var t=e.accountsOptions,n=e.currency,i=e.dispatch,o=Object(a.useState)(null),l=Object(w.a)(o,2),s=l[0],c=l[1],u=Object(a.useState)(null),p=Object(w.a)(u,2),d=p[0],m=p[1],h=Object(a.useState)(g.c.List()),y=Object(w.a)(h,2),b=y[0],E=y[1],C=Object(a.useState)(!1),_=Object(w.a)(C,2),O=_[0],T=_[1];Object(a.useEffect)(function(){i(eo("available_accounts",Ei()))},[i]);var k=ee("apiDateTimeFormat",""),j=null!==d,I=!j,N=function(e,t){E(b.setIn(e,t))},F=function(e){E(b.delete(e))},R=function(){E(g.c.List()),c(null),m(null)},M=function(e){m(e)},P="".concat(ee(["env","serverApiUrl"],""),"/api/accountinvoices?action=download&aid=").concat(s,"&iid=").concat(d),A=[{type:"remove",showIcon:!0,enable:!b.isEmpty(),onClick:function(){i(ks({message:"Are you sure you want to reset invoice lines ?",onOk:R,type:"delete",labelOk:"Delete"}))}}],D=r.a.createElement("div",null,"Invoice Lines",r.a.createElement("div",{className:"pull-right",style:{marginTop:-5}},r.a.createElement(vt,{actions:A}))),L=b.map(function(e,t){return r.a.createElement(MT,{key:e.get("id",Zt.a.v4()),index:t,line:e,aid:s,editable:I,currency:n,onChange:N,onRemove:F})});return r.a.createElement("div",{className:"immediate-invoice-setup"},r.a.createElement(f.g,{sm:12},r.a.createElement(f.l,{className:"form-inner-edit-row"},r.a.createElement(f.g,{componentClass:f.h,sm:3,lg:2,className:"mt10"},te("select_customer","immediate_invoice"),":"),r.a.createElement(f.g,{sm:8,lg:9},r.a.createElement(Tn,{fieldType:"select",value:s,options:t,onChange:function(e,t){t.option;c(e)},placeholder:te("select_customer_help","immediate_invoice"),disabled:!b.isEmpty()})))),r.a.createElement(f.g,{sm:12,className:"mt10"},r.a.createElement(f.v,{header:D},!b.isEmpty()&&r.a.createElement(f.g,{sm:12,className:"form-inner-edit-rows"},r.a.createElement(f.l,{className:"form-inner-edit-row header"},r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"subscriber"},te("subscriber","immediate_invoice")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ao,{contents:"Type subscriber id, customer id, first name or last name to search"})),r.a.createElement(f.g,{sm:3,xsHidden:!0},r.a.createElement("label",{htmlFor:"product"},te("product","immediate_invoice")),r.a.createElement("span",{className:"danger-red"}," *"),r.a.createElement(Ao,{contents:"Type a product key or title to search"})),r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"price"},te("price","immediate_invoice")),r.a.createElement("span",{className:"danger-red"}," *")),r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"date"},te("date","immediate_invoice"))),r.a.createElement(f.g,{sm:2,xsHidden:!0},r.a.createElement("label",{htmlFor:"volume"},te("volume","immediate_invoice")))),L),b.isEmpty()&&r.a.createElement(f.g,{sm:12,className:"form-inner-edit-rows"},r.a.createElement("small",null,"No lines")),r.a.createElement(f.g,{sm:12,className:"pl0 pr0"},I&&r.a.createElement(ct,{onClick:function(){var e=g.c.Map({id:Zt.a.v4(),sid:"",rate:"",price:"",date:S()().format(k),volume:1,type:"credit"});E(b.push(e))},label:"Add Line",disabled:!x()(s)}))),!j&&r.a.createElement(v,{saveLabel:"View Expected Invoice",onClickSave:function(){var e={title:"Expected Invoice",labelCancel:"Close",showOnOk:!1};T(!0),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{success:!0};return new Promise(function(a,r){setTimeout(t?function(){a(n)}:function(){r(n)},1e3*e)})}(1,!0,{status:"OK",details:[{price:50}]}).then(function(t){if("OK"!==t.status)throw new Error("Error retrieving invoice data");var n=g.c.Map({lines:b,aid:s,invoiceData:t.details,onConfirm:M});i(js(n,AT,e))}).catch(function(e){i(Br("Error, can not generate expected invoice"))}).finally(function(){T(!1)})},disableSave:b.isEmpty(),hideCancel:!0,progress:O}),j&&r.a.createElement("form",{method:"post",action:P,target:"_blank"},r.a.createElement(f.c,{type:"submit"},r.a.createElement("i",{className:"fa fa-download"})," Download Invoice"))))};DT.defaultProps={currency:"",accountsOptions:[]};var LT=Object(l.connect)(function(e,t){return{accountsOptions:pr(e,t),currency:pa(e,t)}})(DT),UT=function(e){var t=e.get("description","");return""!==t?t:e.get("key","")},VT=function(e){var t=e.get("status",""),n=k()("non-editable-field label",{"label-info":"open"===t,"label-success":"accept"===t,"label-danger":"reject"===t}),a=t.toLocaleLowerCase();return"accept"===a?a="accepted":"reject"===a&&(a="rejected"),r.a.createElement("span",{className:n},Object(D.titleCase)(a))},BT=function(e){return function(t){t(jr());var n=e.get("aid",""),a=e.get("billrun_key",""),r=e.get("key",""),i=Ai(n,a,r);return ei(i).then(function(n){var a=e.set("status","accept");return t($l("suggestions",a,"update")),t(Wr(n,"Rebalance request sent"))}).catch(function(e){return t(Jr(e,"Error rebalancing customer"))})}},qT=function(e){return function(t){return e.map(function(e){return t(zT(e))})}},zT=function(e){return function(t){t(jr());var n=e.set("status","reject");return t($l("suggestions",n,"update")).then(function(n){if(1===n.status)return t(Ir()),t(Ur('Suggestion "'.concat(e.get("description",""),'" successfully rejected'))),t(HT(e.get("aid","")));throw new Error('Error reject suggestion "'.concat(e.get("description",""),'"'))}).catch(function(e){return t(Jr(e))})}},HT=function(e){return function(t){var n={aid:e};return t(eo("suggestions_".concat(e),bi("suggestions",{},n,{billrun_key:-1})))}},YT=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).customerParser=function(e){return"".concat(e.getIn(["firstname"],"")," ").concat(e.getIn(["lastname"],""))},n.amountParser=function(e){var t=n.props.currency,a=vd()(t);return"".concat(e.getIn(["amount"],"")).concat(a)},n.onShowDetails=function(e){var t=e.get("aid","");n.props.router.push("suggestions/".concat(t))},n.usagevParser=function(e){var t=n.props,a=t.usageTypesData,r=t.propertyTypes,i=t.suggestionsRates,o=e.get("key",""),l=_e(i,o),s=Oe(l),c=Se(l,s),u=e.get("usagev",""),p=Ie(r,a,s,c,u,!1),d=je(r,a,s,c);return"".concat(p," ").concat(d)},n.tableFields=function(){return[{id:"name",title:te("Name","suggestions"),parser:n.customerParser,sort:!0},{id:"aid",title:te("aid","suggestions"),sort:!0},{id:"sid",title:te("sid","suggestions"),sort:!0},{id:"key",title:te("key","suggestions"),parser:UT,sort:!0},{id:"usagev",title:te("usagev","suggestions"),parser:n.usagevParser,sort:!0},{id:"status",title:te("status","suggestions"),parser:VT,sort:!0},{id:"amount",title:te("amount","suggestions"),parser:n.amountParser,sort:!0},{id:"type",title:te("type","suggestions"),sort:!0}]},n.getRowActions=function(){return[{type:"view",onClick:n.onShowDetails,onClickColumn:"name"}]},n.getListActions=function(){return[{type:"refresh"}]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(e,t){var n,a=this.props,r=a.items,i=a.suggestionsRatesKeys;if(!g.c.is(r,e.items)&&!r.isEmpty()){var o=r.map(function(e){return e.get("key","")}).toSet().subtract(i.toSet());o.isEmpty()||this.props.dispatch((n=o,function(e){return e(to("suggestions_products",Pi(n.toArray(),{key:1,rates:1})))}))}}},{key:"render",value:function(){return r.a.createElement(Tp,{entityKey:"suggestions",api:"get",filterFields:t.filterFields,tableFields:this.tableFields(),actions:this.getRowActions(),listActions:this.getListActions(),projectFields:t.projectFields})}}]),t}(a.Component);YT.defaultProps={itemId:"",currency:"",items:g.c.List(),suggestionsRates:g.c.List(),suggestionsRatesKeys:g.c.List(),usageTypesData:g.c.List(),propertyTypes:g.c.List()},YT.projectFields={aid:1,sid:1,key:1,type:1,usagev:1,status:1,amount:1,lastname:1,firstname:1,description:1},YT.filterFields=[{id:"key",placeholder:te("key","suggestions")},{id:"billrun_key",placeholder:te("billrun_key","suggestions")},{id:"status",placeholder:te("status","suggestions")},{id:"sid",placeholder:te("sid","suggestions"),type:"number"},{id:"aid",placeholder:te("aid","suggestions"),type:"number"}];var GT=Object(s.f)(Object(l.connect)(function(e,t){var n=sr(e,t),a=g.c.List.isList(n)?n.map(function(e){return e.get("key","")}):g.c.List();return{items:e.entityList.items.get("suggestions"),itemId:Eo(e,t),currency:pa(e,t),usageTypesData:ha(e,t),propertyTypes:va(e,t),suggestionsRates:n,suggestionsRatesKeys:a}})(YT)),KT=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={selectedIds:g.c.List(),cycles:g.c.Map(),filteredStatus:g.c.List(["open"])},n.onClickRefresh=function(){n.getSuggestions(),n.setState(function(){return{selectedIds:g.c.List()}})},n.onClickReject=function(e){var t={message:'Are you sure you want to reject suggestion "'.concat(e.get("description",""),'" ?'),onOk:function(){return n.props.dispatch(zT(e))},type:"delete",labelOk:"Reject"};n.props.dispatch(ks(t))},n.onClickMassReject=function(){var e=n.state.selectedIds,t=n.props.items.filter(function(t){return e.includes(t.getIn(["_id","$id"],"undefined"))}),a=t.map(function(e){return e.get("description","")}).map(function(e,t){return r.a.createElement("li",{key:t},e)}),i={message:"Are you sure you want to reject suggestions ?",children:r.a.createElement("ul",null,a),onOk:function(){n.setState(function(){return{selectedIds:g.c.List()}}),n.props.dispatch(qT(t))},type:"delete",labelOk:"Reject"};n.props.dispatch(ks(i))},n.onBack=function(){n.props.router.push("suggestions")},n.onClickRebalance=function(e){n.props.dispatch(BT(e)).then(function(){n.getSuggestions()})},n.onSelectChecked=function(e){var t=e.target,a=t.value,r=t.id,i=n.state.selectedIds,o=a?i.push(r):i.filter(function(e){return e!==r});n.setState(function(){return{selectedIds:o}})},n.onFilterStatus=function(e){var t=n.state.filteredStatus,a=e.target,r=a.value,i=a.id,o=r?t.push(i):t.filter(function(e){return e!==i});n.setState(function(){return{filteredStatus:o,selectedIds:g.c.List()}})},n.getSuggestions=function(){var e=n.props.aid;null!==e&&n.props.dispatch(HT(e))},n.cycleParser=function(e){var a=n.props.chargingDay,r=e.get("billrun_key",""),i="".concat(a).padStart(2,"0"),o="".concat(r).concat(i),l=S()(o,"YYYYMMDD").subtract(1,"days").format(t.dateFormat);return"cycle ends ".concat(l)},n.isOpen=function(e){return"open"===e.get("status","")},n.isRejectable=function(){return!n.state.selectedIds.isEmpty()},n.isRebalanceable=function(e){var t=n.state.cycles;return["current","to_run"].includes(t.get(e.get("billrun_key",""),""))&&n.isOpen(e)},n.selectParser=function(e){var t=n.state.selectedIds;if(!n.isOpen(e))return null;var a=e.getIn(["_id","$id"],"undefined"),i=t.includes(a);return r.a.createElement(Tn,{id:a,value:i,onChange:n.onSelectChecked,fieldType:"checkbox"})},n.amountParser=function(e){var t=n.props.currency,a=e.get("amount","");return x()(a)?"".concat(a).concat(vd()(t)):""},n.getTableItems=function(){var e=n.props.items,t=n.state.filteredStatus;return e.filter(function(e){return t.includes(e.get("status",""))}).sort(function(e,t){return"open"===e.get("status","")?-1:"open"===t.get("status","")?1:"reject"===e.get("status","")&&"accept"===t.get("status","")?1:"accept"===e.get("status","")&&"reject"===t.get("status","")?-1:0})},n.getTableFields=function(){return[{id:"",placeholder:"",parser:n.selectParser,cssClass:"text-center"},{id:"description",placeholder:"Name"},{id:"sid",placeholder:"Subscriber ID"},{id:"amount",placeholder:"Amount",parser:n.amountParser},{id:"status",placeholder:"Status",parser:VT},{id:"billrun_key",placeholder:"Cycle",parser:n.cycleParser}]},n.getRowActions=function(){return[{type:"",showIcon:!1,label:"Rebalance",onClick:n.onClickRebalance,show:n.isRebalanceable,actionStyle:"primary",actionSize:"xsmall"},{type:"",showIcon:!1,label:"Reject",onClick:n.onClickReject,show:n.isOpen,actionStyle:"danger",actionSize:"xsmall"}]},n.getPageActions=function(){return[{type:"back",label:"Back To List",onClick:n.onBack,actionStyle:"primary"}]},n.getListActions=function(){return[{type:"refresh",label:"Refresh",actionStyle:"primary",showIcon:!0,onClick:n.onClickRefresh,actionSize:"xsmall"},{type:"",showIcon:!1,label:"Reject",enable:n.isRejectable,onClick:n.onClickMassReject,actionStyle:"danger",actionSize:"xsmall"},{type:"",showIcon:!1,label:"Create an Immediate Invoice",onClick:n.onClickRemove,actionStyle:"primary",actionSize:"xsmall",show:!1}]},n.renderPanelHeader=function(){var e=n.state,t=e.filteredStatus,a=e.selectedIds;return r.a.createElement(f.y,null,r.a.createElement(f.g,{sm:6},r.a.createElement(Tn,{id:"open",fieldType:"checkbox",value:t.includes("open"),label:"Open",onChange:n.onFilterStatus,className:"inline mr5"}),r.a.createElement(Tn,{id:"accept",fieldType:"checkbox",value:t.includes("accept"),label:"Accepted",onChange:n.onFilterStatus,className:"inline mr5"}),r.a.createElement(Tn,{id:"reject",fieldType:"checkbox",value:t.includes("reject"),label:"Rejected",onChange:n.onFilterStatus,className:"inline mr5"})),r.a.createElement(f.g,{sm:6,className:"text-right"},r.a.createElement(vt,{actions:n.getListActions(),data:a})))},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.getSuggestions()}},{key:"componentDidUpdate",value:function(e,t){var n,a=this,r=this.props.items;if(!g.c.is(r,e.items)&&!r.isEmpty()){var i=r.map(function(e){return e.get("billrun_key","")}).toSet().toList();this.props.dispatch((n=i,function(e){var t=n.map(function(e){return Li(e)}).toArray();return ei(t).then(function(e){return g.c.fromJS(e).get("data",g.c.List()).filter(function(e){return 1===e.getIn(["data","status"],"")}).map(function(e){return g.c.Map({key:e.getIn(["data","details",0,"billrun_key"],""),status:e.getIn(["data","details",0,"cycle_status"],"")})}).reduce(function(e,t){return e.set(t.get("key"),t.get("status"))},g.c.Map())}).catch(function(t){return e(Jr(t))})})).then(function(e){a.setState(function(){return{cycles:e}})})}}},{key:"render",value:function(){var e=this.getTableItems(),t=this.getRowActions(),n=this.getTableFields();return r.a.createElement(f.y,null,r.a.createElement(f.g,{lg:12},r.a.createElement(f.v,{header:this.renderPanelHeader()},r.a.createElement(ju,{items:e,fields:n,actions:t})),r.a.createElement(vt,{actions:this.getPageActions()})))}}]),t}(a.Component);KT.defaultProps={aid:null,items:g.c.List(),currency:"",chargingDay:1},KT.dateFormat=ee("dateFormat","dd/MM/yyyy");var WT=Object(s.f)(Object(l.connect)(function(e,t){var n=Eo(e,t);return{aid:x()(n)?parseFloat(n):void 0,items:e.list.get("suggestions_".concat(n)),currency:pa(e,t),chargingDay:da(e,t)}})(KT)),JT=function(){return r.a.createElement(Su,null,r.a.createElement(s.d,{history:s.e},r.a.createElement(s.c,{path:"/",component:_u},r.a.createElement(s.a,{component:Ou(ou),title:""}),r.a.createElement(s.c,{path:"users"},r.a.createElement(s.a,{component:Ou(nC),title:"Users"}),r.a.createElement(s.c,{path:"user/:itemId",component:Ou(iC)}),r.a.createElement(s.c,{path:"user",component:Ou(iC)})),r.a.createElement(s.c,{path:"plans"},r.a.createElement(s.a,{component:Ou(Wf),title:"Plans"}),r.a.createElement(s.c,{path:"plan/:itemId",component:Ou(Ah)}),r.a.createElement(s.c,{path:"plan",component:Ou(Ah)})),r.a.createElement(s.c,{path:"services"},r.a.createElement(s.a,{component:Ou(av),title:"Services"}),r.a.createElement(s.c,{path:"service/:itemId",component:Ou(fv)}),r.a.createElement(s.c,{path:"service",component:Ou(fv)})),r.a.createElement(s.c,{path:"discounts"},r.a.createElement(s.a,{component:Ou(Bh),title:"Discounts"}),r.a.createElement(s.c,{path:"discount/:itemId",component:Ou(Sm)}),r.a.createElement(s.c,{path:"discount",component:Ou(Sm)})),r.a.createElement(s.c,{path:"charges"},r.a.createElement(s.a,{component:Ou(Gh),title:"Conditional Charges"}),r.a.createElement(s.c,{path:"charge/:itemId",component:Ou(tv)}),r.a.createElement(s.c,{path:"charge",component:Ou(tv)})),r.a.createElement(s.c,{path:"products"},r.a.createElement(s.a,{component:Ou(zm),title:"Products"}),r.a.createElement(s.c,{path:"product/:itemId",component:Ou(Og)}),r.a.createElement(s.c,{path:"product",component:Ou(Og)})),r.a.createElement(s.c,{path:"prepaid_plans"},r.a.createElement(s.a,{component:Ou(VC),title:"Prepaid Plans"}),r.a.createElement(s.c,{path:"prepaid_plan/:itemId",component:Ou(s_)}),r.a.createElement(s.c,{path:"prepaid_plan",component:Ou(s_)})),r.a.createElement(s.c,{path:"charging_plans"},r.a.createElement(s.a,{component:Ou(I_),title:"Buckets Groups"}),r.a.createElement(s.c,{path:"charging_plan/:itemId",component:Ou(P_)}),r.a.createElement(s.c,{path:"charging_plan",component:Ou(P_)})),r.a.createElement(s.c,{path:"auto_renews"},r.a.createElement(s.a,{component:Ou(q_),title:"Recurring Charges"}),r.a.createElement(s.c,{path:"auto_renew/:itemId",component:Ou(H_)}),r.a.createElement(s.c,{path:"auto_renew",component:Ou(H_)})),r.a.createElement(s.c,{path:"prepaid_includes"},r.a.createElement(s.a,{component:Ou(b_),title:"Prepaid Buckets"}),r.a.createElement(s.c,{path:"prepaid_include/:itemId",component:Ou(j_)}),r.a.createElement(s.c,{path:"prepaid_include",component:Ou(j_)})),r.a.createElement(s.c,{path:"customers"},r.a.createElement(s.a,{component:Ou(fd),title:"Customers"}),r.a.createElement(s.c,{path:"customer/:itemId",component:Ou(Bm)}),r.a.createElement(s.c,{path:"customer",component:Ou(Bm)})),r.a.createElement(s.c,{path:"taxes"},r.a.createElement(s.a,{component:Ou(Wm),title:"Tax Rates"}),r.a.createElement(s.c,{path:"tax/:itemId",component:Ou(og)}),r.a.createElement(s.c,{path:"tax",component:Ou(og)}),r.a.createElement(s.c,{path:"tax",component:Ou(og)}),r.a.createElement(s.c,{path:"mapping-rules",component:Ou(sg)})),r.a.createElement(s.c,{path:"reports"},r.a.createElement(s.a,{component:Ou(Wg),title:"Reports"}),r.a.createElement(s.c,{path:"report/:itemId",component:Ou(Gf)}),r.a.createElement(s.c,{path:"report",component:Ou(Gf)})),r.a.createElement(s.c,{path:"/input_processor",component:Ou(Ob)}),r.a.createElement(s.c,{path:"/input_processors",component:Ou(Cy),title:"Input Processors"}),r.a.createElement(s.c,{path:"/export_generator(/:name)",component:Ou(By),title:"Export Generator"}),r.a.createElement(s.c,{path:"/export_generators",component:Ou(wy),title:"Export Generators"}),r.a.createElement(s.c,{path:"/usage",component:Ou(Ib),title:"Usage"}),r.a.createElement(s.c,{path:"/run_cycle",component:Ou(Ub),title:"Billing Cycle"}),r.a.createElement(s.c,{path:"/queue",component:Ou(qb),title:"Queue"}),r.a.createElement(s.c,{path:"/invoices",component:Ou(Hb),title:"Invoices"}),r.a.createElement(s.c,{path:"/custom-payment-files",component:Ou(IT),title:"Custom Transactions Request File"}),r.a.createElement(s.c,{path:"/settings",component:Ou(GE),title:"General Settings"}),r.a.createElement(s.c,{path:"/payment_gateways",component:Ou(eC),title:"Payment Gateways"}),r.a.createElement(s.c,{path:"/select_input_processor_template",component:Ou(oC),title:"Create New Input Processor"}),r.a.createElement(s.c,{path:"/collections",component:Ou(jC),title:"Collection"}),r.a.createElement(s.c,{path:"/invoice-template",component:Ou(MC),title:"Invoice Template"}),r.a.createElement(s.c,{path:"/audit-trail",component:Ou(d_),title:"Audit Trail"}),r.a.createElement(s.c,{path:"/custom_fields",component:Ou(VO),title:"Custom Fields"}),r.a.createElement(s.c,{path:"/events",component:Ou(lT),title:"Events"}),r.a.createElement(s.c,{path:"/email_templates",component:Ou(UC),title:"Email Templates"}),r.a.createElement(s.c,{path:"/login",component:Eu,title:"Login"}),r.a.createElement(s.c,{path:"/about",component:uu,title:"About"}),r.a.createElement(s.c,{path:"/changepassword(/:itemId)",component:yu,title:"Change Password"}),r.a.createElement(s.c,{path:"/import(/:itemType)",component:Ou(md)}),r.a.createElement(s.c,{path:"/export(/:itemType)",component:Ou(xT)}),r.a.createElement(s.c,{path:"/immediate-invoice",component:Ou(LT),title:"Immediate Invoice"}),r.a.createElement(s.c,{path:"suggestions"},r.a.createElement(s.a,{component:Ou(GT),title:"Repricing Suggestions"}),r.a.createElement(s.c,{path:":itemId",component:Ou(WT),title:"Customer Repricing Suggestions"})),r.a.createElement(s.c,{path:"*",component:Xc,title:" "}))))},$T=n(288),QT=n(289),ZT=n.n(QT),XT=g.c.List(),ek=g.c.Map(),tk=g.c.Map(),nk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Wu:return t.collection&&t.collection.length>0?e.set(t.collection,g.c.fromJS(t.list).toList()):e;case Yu:case Gu:return t.collection&&t.collection.length>0?e.set(t.collection,g.c.List()):e;case tc:return tk;default:return e}},ak=g.c.Map(),rk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ak,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yu:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case $u:return t.collection&&t.collection.length>0?e.set(t.collection,t.page):e;case tc:return ak;default:return e}},ik=g.c.Map(),ok=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ik,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yu:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case Qu:return t.collection&&t.collection.length>0?e.set(t.collection,g.c.fromJS(t.sort)):e;case tc:return ik;default:return e}},lk=g.c.Map(),sk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:lk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yu:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case Ju:return t.collection&&t.collection.length>0?e.set(t.collection,g.c.fromJS(t.filter)):e;case tc:return lk;default:return e}},ck=g.c.Map(),uk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ck,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case np:case Yu:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case Ku:return t.collection&&t.collection.length>0?e.set(t.collection,t.nextPage):e;case tc:return ck;default:return e}},pk=g.c.Map(),dk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yu:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case Zu:return t.collection&&t.collection.length>0&&x()(t.size)?e.set(t.collection,parseInt(t.size)):e;case tc:return pk;default:return e}},mk=g.c.Map({}),gk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yu:return t.collection&&t.collection.length>0?e.delete(t.collection):e;case Xu:return t.collection&&t.collection.length>0?t.state.isEmpty()?e.set(t.collection,g.c.List([0,1,2])):e.set(t.collection,t.state):e;case tc:return mk;default:return e}},fk=g.c.Map(),hk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case tp:var n=t.collection,a=void 0===n?null:n,r=t.key,i=void 0===r?null:r;if(a&&i){var o=Ye(i).join("_");return e.deleteIn([a,o])}return a&&!i?e.delete(t.collection):e;case ep:var l=t.collection,s=void 0===l?null:l,c=t.key,u=void 0===c?null:c,p=t.revisions,d=void 0===p?[]:p,m=g.c.fromJS(d).toList();if(s&&u){var f=Ye(u).join("_");return e.setIn([s,f],m)}return e;case tc:return fk;default:return e}},vk=Object(vp.c)({items:nk,page:rk,sort:ok,filter:sk,nextPage:uk,size:dk,state:gk,revisions:hk}),yk=g.c.Map(),bk=g.c.fromJS({file_type:"",usaget_type:"static",delimiter:"",fields:[],unfiltered_fields:[],field_widths:[],processor:{usaget_mapping:[]},customer_identification_fields:{},rate_calculators:{retail:{}},receiver:[],pricing:{},unify:{}}),Ek=g.c.fromJS({target_key:"sid",src_key:"",conditions:[{field:"usaget",regex:"/.*/"}],clear_regex:"//"}),Ck="".concat("","/assets/img/").concat(ee("defaultLogo","billRun-cloud-logo.png")),_k=g.c.fromJS({subscribers:{account:{fields:[]},subscriber:{fields:[]}},files:{logo:Ck},payment_gateways:[]}),Ok=ee("productUnlimitedValue","UNLIMITED"),Sk=g.c.Map({key:"",description:"",pricing_method:"tiered"}),Tk=g.c.Record({from:0,to:Ok,interval:"",price:"",uom_display:g.c.Map({range:"",interval:""})}),kk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Sk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PRODUCT_UPDATE_FIELD_VALUE":return e.setIn(t.path,t.value);case"PRODUCT_DELETE_FIELD":return Array.isArray(t.path)?e.deleteIn(t.path):e.deleteIn([t.path]);case"PRODUCT_UPDATE_TO_VALUE":return e.updateIn(t.path,g.c.List(),function(e){if(t.index<e.size-1){var n=t.index+1;return e.update(n,g.c.Map(),function(e){return e.set("from",t.value)}).update(t.index,g.c.Map(),function(e){return e.set("to",t.value)})}return e.update(t.index,g.c.Map(),function(e){return e.set("to",t.value)})});case"PRODUCT_UPDATE_USAGET_VALUE":var n=[].concat(Object(N.a)(t.path),[t.oldUsaget]),a=[].concat(Object(N.a)(t.path),[t.newUsaget]);return e.setIn(a,e.getIn(n,g.c.List())).deleteIn(n);case"PRODUCT_ADD_RATE":return 0===e.getIn(t.path,g.c.List()).size?e.updateIn(t.path,g.c.List(),function(e){return e.push(new Tk)}):e.updateIn(t.path,g.c.List(),function(e){var t=e.last().set("to",Ok),n=e.size-1;return e.update(n,g.c.Map(),function(e){return e.set("to","")}).push(t)});case"PRODUCT_REMOVE_RATE":return e.updateIn(t.path,function(e){if(t.index>0){var n=t.index-1;return e.update(n,function(e){return e.set("to",Ok)}).delete(t.index)}return e.delete(t.index)});case"PRODUCT_CLONE_RESET":var r=["_id","from","to","originalValue"].concat(Object(N.a)(t.uniquefields));return e.withMutations(function(e){r.forEach(function(t){e.delete(t)})});case"PRODUCT_GOT":return g.c.fromJS(t.product);case"PRODUCT_CLEAR":return Sk;default:return e}},jk=g.c.Record({auth:null,name:"",roles:["guest"],error:"",lastLogin:null}),Ik=g.c.Map(),wk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ik,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_GROUP":var n=g.c.Map({}).withMutations(function(e){if(e.set("account_shared",t.shared),e.set("account_pool",t.pooled),e.set("quantity_affected",t.quantityAffected),e.set("rates",g.c.List(t.products)),"cost"===t.usages.get(0,""))e.set("cost",t.value);else{var n=g.c.Map().withMutations(function(e){t.usages.forEach(function(n){e.set(n,g.c.Map({unit:t.unit}))})});e.set("value",t.value),e.set("usage_types",n)}});return e.updateIn(["include","groups"],g.c.Map(),function(e){return e.isEmpty()?g.c.Map():e}).setIn(["include","groups",t.groupName],n);case"REMOVE_GROUP":return e.deleteIn(["include","groups",t.groupName]);default:return e}},Nk=g.c.Map(),Fk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Nk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SERVICE_PRODUCTS_REMOVE":case"PLAN_PRODUCTS_REMOVE":return e.deleteIn([].concat(Object(N.a)(t.path),[t.name]));case"SERVICE_PRODUCTS_RATE_UPDATE_TO":case"PLAN_PRODUCTS_RATE_UPDATE_TO":var n=Object.assign(t,{type:"PRODUCT_UPDATE_TO_VALUE"});return kk(e,n);case"SERVICE_PRODUCTS_RATE_UPDATE":case"PLAN_PRODUCTS_RATE_UPDATE":var a=Object.assign(t,{type:"PRODUCT_UPDATE_FIELD_VALUE"});return kk(e,a);case"SERVICE_PRODUCTS_RATE_REMOVE":case"PLAN_PRODUCTS_RATE_REMOVE":var r=Object.assign(t,{type:"PRODUCT_REMOVE_RATE"});return kk(e,r);case"SERVICE_PRODUCTS_RATE_ADD":case"PLAN_PRODUCTS_RATE_ADD":var i=Object.assign(t,{type:"PRODUCT_ADD_RATE"});return kk(e,i);case"SERVICE_PRODUCTS_RATE_INIT":case"PLAN_PRODUCTS_RATE_INIT":var o=t.product.get("rates",g.c.Map()).keySeq().first();return e.setIn(t.path,t.product.getIn(["rates",o,"BASE","rate"]));default:return e}},xk=ee("planCycleUnlimitedValue","UNLIMITED"),Rk=g.c.Map(),Mk=g.c.Map({price:"",from:0,to:xk}),Pk=g.c.Map({value:0,type:"",msg:""}),Ak=function(e,t,n){return e.reduce(function(e,a,r){if(r===t)return a="undefined"===typeof n?a.set("to",parseInt(a.get("to",0)||0)-parseInt(a.get("from",0)||0)):n===xk?a.set("to",n):a.set("to",parseInt(a.get("from")||0)+parseInt(n)),0===t&&(a=a.set("from",0)),e.push(a);if(r>t){var i=a.get("from",0),o=a.get("to",""),l=parseInt(e.last().get("to",0)||0);if(a=a.set("from",l),""===o)a=a.set("to",a.get("from"));else if(o===xk);else{var s=parseInt(o||0)-parseInt(i||0);a=a.set("to",l+s)}return e.push(a)}return e.push(a)},g.c.List())},Dk=g.c.Map({filtration:g.c.List([g.c.Map({collection:"lines"})])}),Lk=g.c.fromJS({description:"",name:"",price:[{from:0,to:ee("serviceCycleUnlimitedValue","UNLIMITED"),price:""}]}),Uk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CLEAR_SERVICE":return Lk;case"GOT_SERVICE":return g.c.fromJS(t.item);case"UPDATE_SERVICE":return e.setIn(t.path,t.value);case"CLONE_RESET_SERVICE":var n=["_id","from","to","originalValue"].concat(Object(N.a)(t.uniquefields));return e.withMutations(function(e){n.forEach(function(t){e.delete(t)})});case"ADD_GROUP_SERVICE":var a=Object.assign({},t,{type:"ADD_GROUP"});return wk(e,a);case"REMOVE_GROUP_SERVICE":var r=Object.assign({},t,{type:"REMOVE_GROUP"});return wk(e,r);case"SERVICE_PRODUCTS_REMOVE":case"SERVICE_PRODUCTS_RATE_UPDATE_TO":case"SERVICE_PRODUCTS_RATE_UPDATE":case"SERVICE_PRODUCTS_RATE_REMOVE":case"SERVICE_PRODUCTS_RATE_ADD":case"SERVICE_PRODUCTS_RATE_INIT":return Fk(e,t);case"DELETE_SERVICE_FIELD":var i=t.path,o=Array.isArray(i)?i:[i];return e.deleteIn(o);default:return e}},Vk=g.c.Map({paymentGateway:"",fileType:""}),Bk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case yT:return e.set("paymentGateway",t.value).set("fileType","");case vT:return e.set("fileType",t.value);case bT:return Vk;default:return e}},qk=g.c.Map({title:" ",systemRequirementsLoad:!1,onBoarding:g.c.Map({step:0,state:ms}),confirm:g.c.Map({})}),zk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ps:var n="undefined"!==typeof t.title?t.title:qk.get("title");return e.set("title",n);case ds:return e.set("systemRequirementsLoad",!0);case"SET_ON_BOARDING_STEP":return e.setIn(["onBoarding","step"],t.step);case"SET_ON_BOARDING_STATE":return e.setIn(["onBoarding","state"],t.state);case"LOGIN":return t.data&&null===t.data.last_login?e.setIn(["onBoarding","state"],hs):e;case"CONFIRM_SHOW":return e.setIn(["confirm"],g.c.Map(Object(Ks.a)({},t.confirm,{show:!0})));case"CONFIRM_HIDE":return e.setIn(["confirm"],g.c.Map());case"EDIT_FORM_SHOW":var a=t.item,r=t.component,i=t.config;return e.setIn(["formModalData"],g.c.Map({item:a,component:r,config:g.c.fromJS(i),show:!0}));case"EDIT_FORM_HIDE":return e.setIn(["formModalData"],g.c.Map());case"EDIT_FORM_SET_ITEM":return e.setIn(["formModalData","item"],t.item);case"EDIT_FORM_SET_ERROR":var o=t.fieldId,l=void 0===o?null:o,s=t.message,c=void 0===s?null:s;return null===l?e.deleteIn(["formModalData","errors"]):null===c?e.deleteIn(["formModalData","errors",l]):e.setIn(["formModalData","errors",l],c);case"EDIT_FORM_UPDATE_ITEM_FIELD":var u=t.path,p=t.value,d=Array.isArray(u)?u:[u];return e.setIn(["formModalData","item"].concat(Object(N.a)(d)),p);case"EDIT_FORM_DELETE_ITEM_FIELD":var m=t.path,f=Array.isArray(m)?m:[m];return e.deleteIn(["formModalData","item"].concat(Object(N.a)(f)));case"SET_PAGE_FLAG":var h=t.page,v=t.flag,y=t.value;if(null===v)return e.deleteIn(["flag",h]);var b=Array.isArray(v)?v:[v];return null===y?e.deleteIn(["flag",h].concat(Object(N.a)(b))):e.setIn(["flag",h].concat(Object(N.a)(b)),y);default:return e}},Hk=g.c.Map({main:g.c.Map(),collapseSideBar:!1}),Yk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Hk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOGGLE_SIDE_BAR":return null===t.state?e.set("collapseSideBar",!e.get("collapseSideBar",!0)):e.set("collapseSideBar",t.state);case"PREPARE_MAIN_MENU_STRUCTURE":var n=g.c.fromJS(t.mainMenuOverrides);return e.set("main",ec(Xs(n),"root"));default:return e}},Gk=Object(vp.c)({page:zk,menu:Yk}),Kk=g.c.Map({nextPage:!0}),Wk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ji:return e.set("nextPage",t.nextPage);default:return e}},Jk=Object(vp.c)({progressIndicator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PROGRESS_INDICATOR_START":return e+1;case"PROGRESS_INDICATOR_FINISH":return e>0?e-1:0;case"PROGRESS_INDICATOR_DISMISS":return 0;default:return e}},product:kk,user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return new jk({auth:!0,roles:t.data.permissions,name:t.data.user,lastLogin:t.data.last_login?S()(t.data.last_login):null});case tc:return new jk({auth:!1});case"LOGIN_ERROR":return e.set("error",t.error);case"CLEAR_LOGIN_ERROR":return e.set("error","");default:return e}},alerts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:XT,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Pr:return e.insert(0,t.alert);case Mr:return e.filter(function(e){return e.get("id")!==t.id});case Rr:return XT;default:return e}},entityList:vk,list:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ek,t=arguments.length>1?arguments[1]:void 0,n=t.collection,a=t.type;switch(a){case Yi:return e.set(n,g.c.fromJS(t.list).toList());case Gi:var r=g.c.fromJS(t.items).toList();return e.update(n,g.c.List(),function(e){return e.push.apply(e,Object(N.a)(r))});case Ki:return e.update(n,g.c.List(),function(e){return e.delete(t.index)});case Wi:return n?e.set(n,g.c.List()):ek;default:return e}},entity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yk,t=arguments.length>1?arguments[1]:void 0,n=t.collection,a=t.path,r=t.value,i=t.type,o=t.entity;switch(i){case Ll:return["reports","sourceReports"].includes(n)||(o.originalValue=o.from),e.set(n,g.c.fromJS(o));case Ul:return Array.isArray(a)?e.setIn([n].concat(Object(N.a)(a)),r):e.setIn([n,a],r);case Vl:return Array.isArray(a)?e.deleteIn([n].concat(Object(N.a)(a))):e.deleteIn([n,a]);case ql:var l=["_id","from","to","originalValue","revision_info","creation_time"];return"string"===typeof t.uniquefields?l.push(t.uniquefields):Array.isArray(t.uniquefields)&&l.push.apply(l,Object(N.a)(t.uniquefields)),e.withMutations(function(e){l.forEach(function(t){e.deleteIn([n,t])})});case"PLAN_CLEAR":case"CLEAR_SERVICE":return n?e.set("source".concat(Object(D.upperCaseFirst)(n)),g.c.Map()):yk;case Bl:return n?e.set(n,g.c.Map()).set("source".concat(Object(D.upperCaseFirst)(n)),g.c.Map()):yk;default:return e}},inputProcessor:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bk,a=arguments.length>1?arguments[1]:void 0,r=a.field,i=a.mapping,o=a.width,l=a.index,s=a.priority;switch(a.type){case Uv:return g.c.fromJS(a.settings);case yv:return n.set("file_type",a.file_type);case ry:return n.set("type",a.processor_type);case bv:return n.set("delimiter_type",a.delimiter_type);case Ev:return n.setIn(a.fieldPath,a.value);case Cv:return n.set("delimiter",a.delimiter);case _v:return n.get("unfiltered_fields").size>0?n.update("unfiltered_fields",function(e){return[].concat(Object(N.a)(e),Object(N.a)(a.fields))}).set("fields",g.c.List(n.get("unfiltered_fields").filter(function(e){return!0===e.get("checked")}).map(function(e){return e.get("name")}))):n.set("unfiltered_fields",g.c.fromJS(a.fields)).set("fields",g.c.fromJS(a.fields).map(function(e){return e.get("name")}));case Vv:return n.setIn(["field_widths",l],o);case Ov:return n.setIn(["processor",r],i);case Sv:var c=g.c.Map({name:r,checked:!0});return n.update("unfiltered_fields",function(e){return e.push(c)}).update("fields",function(e){return e.push(r)});case zv:var u=n.getIn(["unfiltered_fields",l,"name"]),p=n.update("unfiltered_fields",function(e){return e.delete(l)}),d=p.get("fields").findIndex(function(e){return e===u});return-1!==d?p.update("fields",function(e){return e.delete(d)}):p;case Jv:return n.set("unfiltered_fields",g.c.List()).set("fields",g.c.List());case $v:var m=a.checked;return n.update("unfiltered_fields",g.c.List(),function(e){return e.map(function(e){return e.set("checked",!0===m)})}).update("fields",g.c.List(),function(e){return m?n.get("unfiltered_fields").map(function(e){return e.get("name")}):g.c.List()});case Yv:return n.set("usaget_type",a.usaget_type).set("customer_identification_fields",g.c.Map()).set("pricing",g.c.Map()).setIn(["processor","usaget_mapping"],g.c.List()).setIn(["processor","default_usaget"],"").setIn(["processor","src_field"],"").setIn(["rate_calculators"],g.c.Map({retail:g.c.Map()}));case Qv:var f=n.get("rate_calculators",g.c.Map()).map(function(){return g.c.Map(Object(ti.a)({},a.usaget,g.c.List()))});return n.setIn(["processor","default_usaget"],a.usaget).set("rate_calculators",f).update("pricing",g.c.Map(),function(e){return e.clear().set(a.usaget,g.c.Map())}).update("customer_identification_fields",g.c.Map(),function(e){return e.clear().set(a.usaget,g.c.List())});case qv:var h=a.mapping,v=h.usaget,y=h.pattern,b=h.unit,E=h.volumeType,C=h.volumeSrc,_=h.fieldName,O=h.conditions,S=g.c.fromJS({usaget:v,pattern:y,unit:b,volume_type:E,volume_src:C,src_field:_,conditions:O}),T=n.get("rate_calculators",g.c.Map()).map(function(e){return e.has(v)?e:e.set(v,g.c.List())});return n.updateIn(["processor","usaget_mapping"],function(e){return e.push(S)}).set("rate_calculators",T).update("pricing",g.c.Map(),function(e){return e.has(v)?e:e.set(v,g.c.Map())}).update("customer_identification_fields",g.c.Map(),function(e){return e.has(v)?e:e.set(v,g.c.List())});case Hv:var k=n.getIn(["processor","usaget_mapping",a.index,"usaget"]),j=n.getIn(["processor","usaget_mapping"]).map(function(e){return e.get("usaget")}).countBy(function(e){return e===k?"found":"notfound"}).get("found",0),I=n.get("rate_calculators",g.c.Map()).map(function(e){return 1===j?e.delete(k):e});return n.updateIn(["processor","usaget_mapping"],function(e){return e.remove(a.index)}).updateIn(["customer_identification_fields"],g.c.Map(),function(e){return 1===j?e.delete(k):e}).updateIn(["pricing"],g.c.Map(),function(e){return 1===j?e.delete(k):e}).set("rate_calculators",I);case Rv:return n.setIn(["customer_identification_fields",a.usaget,a.index,r],i);case Mv:return n.setIn(["pricing",a.usaget,r],i);case Pv:return n.updateIn(["customer_identification_fields",a.usaget],function(e){return e?e.push(Ek):g.c.List([Ek])});case Av:return n.updateIn(["customer_identification_fields",a.usaget],function(e){return e.remove(s)});case kv:var w=a.rateCategory,F=n.get("rate_calculators",g.c.Map()).first().map(function(){return g.c.List()});return n.setIn(["rate_calculators",w],F);case jv:var x=a.rateCategory;return n.deleteIn(["rate_calculators",x]);case Iv:var R=a.rate_key,M=a.value,P=a.rateCategory,A=a.usaget,D=n.getIn(["rate_calculators",P,A,s,l]).set("type",M).set("rate_key",R);return n.setIn(["rate_calculators",P,A,s,l],D);case wv:var L=a.rateCategory,U=a.usaget,V=g.c.fromJS({type:"",rate_key:"",line_key:""});return n.updateIn(["rate_calculators",L,U,s],function(e){return e?e.push(V):g.c.List([V])});case Nv:var B=a.rateCategory,q=a.usaget,z=g.c.fromJS({type:"",rate_key:"",line_key:""});return n.updateIn(["rate_calculators",B,q],function(e){return e.push(g.c.List([z]))});case Fv:var H=a.rateCategory,Y=a.usaget;return n.updateIn(["rate_calculators",H,Y],function(e){return e.remove(s)});case xv:var G=a.rateCategory,K=a.usaget;return n.updateIn(["rate_calculators",G,K,s],function(e){return e.remove(l)});case sy:return n.update("receiver",g.c.List(),function(e){return e.remove(l)});case cy:var W=g.c.fromJS({});return n.update("receiver",g.c.List(),function(e){return e.push(W)});case Gv:var J=a.value,$=a.rateCategory,Q=a.usaget,Z=Za().find(function(e){return e.get("value")===J},null,!1);if(!1!==Z){var X=Z.get("preFunctionValue",""),ee=Z.get("preFunction","");return n.setIn(["rate_calculators",$,Q,s,l,"line_key"],X).setIn(["rate_calculators",$,Q,s,l,"preFunction"],ee)}return n.setIn(["rate_calculators",$,Q,s,l,"line_key"],J).deleteIn(["rate_calculators",$,Q,s,l,"preFunction"]);case Kv:return n.withMutations(function(e){a.paths.forEach(function(t,n){e.setIn(["rate_calculators"].concat(Object(N.a)(t)),a.values[n])})});case Wv:return n.deleteIn(["rate_calculators",a.rateCategory,a.usaget,a.priority,a.index,"computed"]);case Dv:return n.setIn(["receiver",l,r],i);case Lv:return n.deleteIn(["receiver",l,r]);case Bv:return bk;case Zv:return g.c.fromJS(a.template);case Xv:return e=r||n.getIn(["unfiltered_fields",l]),t=o||n.getIn(["field_widths",l]),n.update("unfiltered_fields",function(t){return t.delete(l).insert(l-1,e)}).update("field_widths",function(e){return e.delete(l).insert(l-1,t)});case ey:return e=r||n.getIn(["unfiltered_fields",l]),t=o||n.getIn(["field_widths",l]),n.update("unfiltered_fields",function(t){return t.delete(l).insert(l+1,e)}).update("field_widths",function(e){return e.delete(l).insert(l+1,t)});case ty:var te=a.value,ne=n.getIn(["unfiltered_fields",l,"name"]),ae=n.updateIn(["unfiltered_fields",l],function(e){return e.set("name",te)}),re=ae.get("fields").findIndex(function(e){return e===ne});return-1!==re?ae.update("fields",function(e){return e.set(re,te)}):ae;case ny:return n.deleteIn(a.path);case ay:return n.setIn(["parser",a.name],a.value);case iy:return n.setIn(["realtime",a.name],g.c.fromJS(a.value));case oy:return n.setIn(["realtime","default_values",a.name],a.value);case ly:var ie=a.checked,oe=n.getIn(["unfiltered_fields",l,"name"]),le=n.updateIn(["unfiltered_fields",l],function(e){return e.set("checked",ie)});return le.update("fields",function(e){if(!1===ie){var t=e.findIndex(function(e){return e===oe});return-1!==t?e.delete(t):e}return e.push(oe)});default:return n}},settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_k,t=arguments.length>1?arguments[1]:void 0,n=t.name,a=t.value,r=t.category,i=t.settings,o=t.gateway;switch(t.type){case tc:return _k;case ll:return Array.isArray(n)?e.setIn([r].concat(Object(N.a)(n)),a):e.setIn([r,n],a);case ml:var l;return l=t.path?t.path&&Array.isArray(t.path)?[r].concat(Object(N.a)(t.path)):[r,t.path]:[r],e.updateIn(l,g.c.List(),function(e){return e.push(t.value)});case Tv:return e.update("usage_types",function(e){return e.push(t.usaget)});case sl:return e.withMutations(function(e){i.forEach(function(t){var n=g.c.fromJS(t.data.details);"taxation"===t.name&&""!==n.get("vat","")&&(n=n.set("vat",100*n.get("vat",""))),"import.mapping"===t.name&&g.c.List.isList(n)&&(n=n.map(rd)),"taxation.vat"===t.name&&""!==n&&(n*=100),"plugins"===t.name&&g.c.List.isList(n)&&(n=oE(n)),e.setIn(t.name.split("."),n)})});case cl:var s=e.get("payment_gateways").filterNot(function(e){return e.get("name")===o.name}).push(g.c.fromJS(o));return e.set("payment_gateways",s);case ul:var c=e.get("payment_gateways").filterNot(function(e){return e.get("name")===o});return e.set("payment_gateways",c);case pl:var u=e.get("payment_gateways").find(function(e){return e.get("name")===o.name}).set("params",o.params),p=e.get("payment_gateways").filterNot(function(e){return e.get("name")===o.name}).push(u);return e.set("payment_gateways",p);case dl:return Array.isArray(n)?e.deleteIn([r].concat(Object(N.a)(n))):e.deleteIn([r,n]);case gl:var d=e.getIn([].concat(Object(N.a)(t.path),[t.oldIndex]));return e.updateIn(t.path,g.c.List(),function(e){return e.delete(t.oldIndex).insert(t.newIndex,d)});default:return e}},plan:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PLAN_PRODUCTS_REMOVE":case"PLAN_PRODUCTS_RATE_UPDATE_TO":case"PLAN_PRODUCTS_RATE_UPDATE":case"PLAN_PRODUCTS_RATE_REMOVE":case"PLAN_PRODUCTS_RATE_ADD":case"PLAN_PRODUCTS_RATE_INIT":return Fk(e,t);case"REMOVE_GROUP_PLAN":var n=Object.assign({},t,{type:"REMOVE_GROUP"});return wk(e,n);case"ADD_GROUP_PLAN":var a=Object.assign({},t,{type:"ADD_GROUP"});return wk(e,a);case"PLAN_UPDATE_FIELD_VALUE":return e.setIn(t.path,t.value);case"PLAN_REMOVE_FIELD":return e.deleteIn(t.path);case"PLAN_UPDATE_PLAN_CYCLE":return e.updateIn(["price"],function(e){return Ak(e,t.index,t.value)});case"PLAN_ADD_TARIFF":if(t.trial){var r=Mk.set("trial",!0);return e.get("price",g.c.List()).isEmpty()?e.update("price",g.c.List(),function(e){return e.unshift(r)}):e.update("price",g.c.List(),function(e){return e.unshift(r.set("to",""))})}return e.get("price",g.c.List()).isEmpty()?e.update("price",g.c.List(),function(e){return e.push(Mk)}):e.update("price",g.c.List(),function(e){return e.update(e.size-1,g.c.Map(),function(e){return e.set("to","")}).push(Mk.set("from",""))});case"PLAN_REMOVE_TARIFF":return 0===t.index?e.update("price",g.c.List(),function(e){return e.size>1?e.update(t.index+1,g.c.Map(),function(e){return e.set("from",0)}).delete(t.index):e.delete(t.index)}):e.update("price",g.c.List(),function(e){return e.update(t.index-1,function(e){return e.set("to",xk)}).delete(t.index)});case"PLAN_GOT":return g.c.fromJS(t.plan);case"PLAN_CLEAR":return Rk;case"PLAN_CLONE_RESET":var i=["_id","from","to","originalValue"].concat(Object(N.a)(t.uniquefields));return e.withMutations(function(e){i.forEach(function(t){e.delete(t)})});case t_:var o=g.c.List([Pk]);return e.setIn(["notifications_threshold",t.balance],o);case ZC:return e.updateIn(["notifications_threshold",t.thresholdId],g.c.List(),function(e){return e.push(Pk)});case XC:return e.updateIn(["notifications_threshold",t.thresholdId],g.c.List(),function(e){return e.remove(t.index)});case e_:var l=["notifications_threshold",t.thresholdId,t.index,t.field];return e.setIn(l,t.value);case n_:var s=["notifications_threshold",t.balanceId];return e.setIn(s,g.c.List());case a_:return e.set("disallowed_rates",t.rates);case r_:return e.setIn(["pp_threshold",t.balanceId],0);case i_:return e.setIn(["pp_threshold",t.balanceId],t.value);case o_:return e.deleteIn(["pp_threshold",t.balanceId]);case"ADD_USAGET_INCLUDE":var c=g.c.fromJS({usagev:0,period:{unit:"",duration:0},pp_includes_name:t.ppIncludesName,pp_includes_external_id:t.ppIncludesExternalId,unit_label:t.unitLabel}),u=e.get("include",g.c.List());return e.set("include",u.push(c));default:return e}},exportGenerator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Dk,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GOT_EXPORT_GENERATOR":return g.c.fromJS(t.generator);case"UPDATE_EXPORT_GENERATOR_VALUE":var n=t.path,a=t.value;return Array.isArray(n)?e.setIn(n,a):e.setIn([n],a);case"REMOVE_EXPORT_GENERATOR_VALUE":var r=t.path;return Array.isArray(r)?e.deleteIn(r):e.deleteIn([r]);case"CLEAR_EXPORT_GENERATOR":return Dk;default:return e}},service:Uk,paymentsFiles:Bk,guiState:Gk,pager:Wk}),$k=function(){var e={key:ee(["env","storageVersion"],"app"),slicer:function(){return function(e){return{entityList:{size:e.entityList.size,filter:e.entityList.filter,sort:e.entityList.sort,state:e.entityList.state},guiState:{menu:e.guiState.menu},settings:e.settings}}},deserialize:function(e){var t=["entityList","guiState"],n=JSON.parse(e);return n&&Object.keys(n).forEach(function(e){t.includes(e)?Object.keys(n[e]).forEach(function(t){n[e][t]=g.c.fromJS(n[e][t])}):n[e]=g.c.fromJS(n[e])}),n}};return Object(vp.d)(ZT()(null,e),Object(vp.a)($T.a))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(536),n(537),n(538),n(539),n(540),n(541),n(542),n(543),n(544),Object(a.lazy)(function(){return Promise.all([n.e(3),n.e(4)]).then(n.bind(null,806))});var Qk=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=$k();return Object(vp.e)(Jk,e,t)}();o.a.render(r.a.createElement(l.Provider,{store:Qk},r.a.createElement(JT,null),!1),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[300,1,2]]]);
//# sourceMappingURL=main.a8978b97.chunk.js.map